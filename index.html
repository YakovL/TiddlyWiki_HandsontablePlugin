<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 10, revision: 1, date: new Date("February 5, 2024"), extensions: {}};

//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2012

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.

" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> TW spreadsheets - insert spreadsheet-like interfaces into TiddlyWiki Classic (currently: using handsontable library) </title>
<style id="styleArea" type="text/css">
#saveTest, #messageArea, #copyright, #storeArea, #shadowArea {
	display: none;
}
#javascriptWarning {
	text-align: center;
	padding: 1em;
	font-weight: bold;
	background-color: #dd1100;
	color: #fff;
}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>

</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="GettingStarted">
<pre>When getting started, you may want to:
* Set your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;
* Change the page [[title|SiteTitle]] (now &quot;&lt;&lt;tiddler SiteTitle&gt;&gt;&quot;) and [[subtitle|SiteSubtitle]] (now &quot;&lt;&lt;tiddler SiteSubtitle&gt;&gt;&quot;); they also set the browser tab title
* Create a tiddler where your content &quot;starts&quot;
** Use the button on the sidebar or [[link|My first tiddler]] it here, follow the link, edit, and click &quot;done&quot;
** It will be shown in the Timeline (usually on the right), but you may want to link it in the MainMenu (usually on the left)
** and/or make it open when the ~TiddlyWiki is opened by editing the list of [[DefaultTiddlers]] (separate links with spaces or linebreaks)
* Save your ~TiddlyWiki
** Although &quot;download saving&quot; works in any browser, it's not that convenient, so you'll probably want to use [[a dedicated saver|https://classic.tiddlywiki.com/#%5B%5BSetting up saving%5D%5D]]
</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]
</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' role='banner'&gt;
  &lt;div class='headerShadow'&gt;
    &lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class='headerForeground'&gt;
    &lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
  &lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
  &lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea' role='main'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1, h2, h3, h4, h5, h6 { color: [[ColorPalette::SecondaryDark]]; }
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.txtOptionInput {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {
	background: -moz-linear-gradient(to bottom, [[ColorPalette::PrimaryLight]], [[ColorPalette::PrimaryMid]]);
	background: linear-gradient(to bottom, [[ColorPalette::PrimaryLight]], [[ColorPalette::PrimaryMid]]);
}
.header a:hover {background:transparent;}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {
	color:[[ColorPalette::Foreground]];
	background:[[ColorPalette::Background]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard { background:[[ColorPalette::PrimaryPale]]; }
.wizard__title    { color:[[ColorPalette::PrimaryDark]]; border:none; }
.wizard__subtitle { color:[[ColorPalette::Foreground]]; border:none; }
.wizardStep { background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]]; }
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizardFooter .status a { color: [[ColorPalette::PrimaryPale]]; }
.wizard .button {
	color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryDark]];
}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {
	color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];
}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea { background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; box-shadow: 1px 2px 5px [[ColorPalette::TertiaryMid]]; }
.messageToolbar__button { color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none; }
.messageToolbar__button_withIcon { background:inherit; }
.messageToolbar__button_withIcon:active { background:inherit; border:none; }
.tw-icon line { stroke: [[ColorPalette::TertiaryDark]]; }
.messageToolbar__button:hover .tw-icon line { stroke: [[ColorPalette::Foreground]]; }

.popup {
	background: [[ColorPalette::Background]];
	color: [[ColorPalette::TertiaryDark]];
	box-shadow: 1px 2px 5px [[ColorPalette::TertiaryMid]];
}
.popup li a, .popup li a:visited, .popup li a:hover, .popup li a:active {
	color:[[ColorPalette::Foreground]]; border: none;
}
.popup li a:hover { background:[[ColorPalette::SecondaryLight]]; }
.popup li a:active { background:[[ColorPalette::SecondaryPale]]; }
.popup li.disabled { color:[[ColorPalette::TertiaryMid]]; }
.popupHighlight {color:[[ColorPalette::Foreground]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged { border: 2px solid [[ColorPalette::TertiaryPale]]; }
.selected .tagging, .selected .tagged { border: 2px solid [[ColorPalette::TertiaryLight]]; }
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button { border:none; }

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation { background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer th, .viewer thead td, .twtable th, .twtable thead td { background: [[ColorPalette::SecondaryMid]]; color: [[ColorPalette::Background]]; }
.viewer td, .viewer tr, .twtable td, .twtable tr { border: 1px solid [[ColorPalette::TertiaryLight]]; }
.twtable caption { color: [[ColorPalette::TertiaryMid]]; }

.viewer pre {background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%; background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
body { font-size:.75em; font-family:arial,helvetica,sans-serif; margin:0; padding:0; }

* html .tiddler {height:1%;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em; border-width: 1px; }

#contentWrapper .chkOptionInput {border:0;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}


a {text-decoration:none;}

.externalLink {text-decoration:underline;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
#mainMenu .tiddlyLinkNonExisting,
#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}


.header {position:relative;}
.headerShadow {position:relative; padding:3em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:3em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard { padding:0.1em 2em 0; }
.wizard__title    { font-size:2em; }
.wizard__subtitle { font-size:1.2em; }
.wizard__title, .wizard__subtitle { font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em; }
.wizardStep { padding:1em; }
.wizardFooter { padding: 0.8em 0; }
.wizardFooter .status { display: inline-block; line-height: 1.5; padding: 0.3em 1em; }
.wizardFooter .button { margin:0.5em 0 0; font-size:1.2em; padding:0.2em 0.5em; }

#messageArea { position:fixed; top:2em; right:0; margin:0.5em; padding:0.7em 1em; z-index:2000; }
.messageToolbar { text-align:right; padding:0.2em 0; }
.messageToolbar__button { text-decoration:underline; }
.messageToolbar__button_withIcon { display: inline-block; }
.tw-icon { height: 1em; width: 1em; } /* width for IE */
.tw-icon line { stroke-width: 1; stroke-linecap: round; }
.messageArea__text a { text-decoration:underline; }

.popup {position:absolute; z-index:300; font-size:.9em; padding:0.3em 0; list-style:none; margin:0;}
.popup .popupMessage, .popup li.disabled, .popup li a { padding: 0.3em 0.7em; }
.popup li a {display:block; font-weight:normal; cursor:pointer;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {display: inline-block; white-space: nowrap; position: relative; bottom: -0.7px; margin: 0 0.25em 0 0; padding:0.2em;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler { padding: 1em; }

.title { font-size: 1.6em; font-weight: bold; }
.subtitle { font-size: 1.1em; }

.missing .viewer, .missing .title { font-style: italic; }
.missing .subtitle { display: none; }

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagged li, .tagging li { margin: 0.3em 0; }
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation { padding: 0.5em 0.8em; margin: 0.5em 1px; }

.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable { border-collapse: collapse; margin: 0.8em 0; }
.viewer th, .viewer td, .viewer tr, .viewer caption, .twtable th, .twtable td, .twtable tr, .twtable caption { padding: 0.2em 0.4em; }
.twtable caption { font-size: 0.9em; }
table.listView { margin: 0.8em 1.0em; }
table.listView th, table.listView td, table.listView tr { text-align: left; }
.listView &gt; thead { position: sticky; top: 0; }

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer pre {padding:0.5em; overflow:auto;}
pre, code { font-family: monospace, monospace; font-size: 1em; }
.viewer pre, .viewer code { line-height: 1.4em; }

.editor {font-size:1.1em; line-height:1.4em;}
.editor input, .editor textarea {display:block; width:100%; box-sizing: border-box; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding: 0.3em 0.5em; display: inline-block;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel { display:none; z-index:100; position:absolute; width:90%; margin:0 5%; }
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
  #mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea { display: none !important; }
  #displayArea { margin: 1em 1em 0em; }
}
/*}}}*/
</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>

</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="DefaultTiddlers" modifier="Yakov Litvin" created="201705251944" modified="201705251944" changecount="2">
<pre>[[HandsontablePlugin]]</pre>
</div>
<div title="HandsontablePlugin" modifier="Yakov Litvin" created="201702241326" modified="201712101238" tags="systemConfig" changecount="742">
<pre>/***
|Description |Brings Handsontable spreadsheets into ~TiddlyWiki classic|
|Docs        |http://yakovlitvin.pro/TW/pre-releases/Spreadsheets.html|
|Source      |http://yakovlitvin.pro/TW/pre-releases/Spreadsheets.html#HandsontablePlugin|
|Author      |Yakov Litvin|
|Version     |0.3.7|
|Status      |Stable, useful enough to use in production, but needs some improvements|
|Initial prototype|[[by Vincent Yeh|http://twve.tiddlyspot.com/#HandsontablePlugin]]|
|License     |[[MIT|https://github.com/YakovL/TiddlyWiki_YL_ExtensionsCollection/blob/master/Common%20License%20(MIT)]] (see also &quot;The MIT License&quot; below for Handsontable)|
|~CoreVersion|2.5.0|

!! Demo
Basically if you put this macro to your TW:
{{{
&lt;&lt;handsontable [[##some section name]]&gt;&gt;
}}}
you will get this little spreadsheet (try navigating with arrows and typing some stuff):/%
!some section name
{&quot;data&quot;:[
	[&quot;&quot;]
],
&quot;options&quot;:{}}
!%/&lt;&lt;handsontable [[##some section name]]&gt;&gt;
and after creating some columns and rows and writing some data you may have something like this:
&lt;&lt;handsontable [[##another section name]]&gt;&gt;/%
!another section name
{&quot;data&quot;:[
	[&quot;&quot;,&quot;Charly&quot;,&quot;Bob&quot;,&quot;Tom&quot;],
	[&quot;Charly&quot;,&quot;–&quot;,&quot;1:1&quot;,&quot;3:0&quot;],
	[&quot;Bob&quot;,&quot;1:1&quot;,&quot;–&quot;,&quot;0:3&quot;],
	[&quot;Tom&quot;,&quot;0:3&quot;,&quot;3:0&quot;,&quot;–&quot;]
],
&quot;options&quot;:{}}
!%/You may also populate a table by copy-pasting some content from other tables, including spreadsheets. Data is stored automatically (see below for details). For other examples, see [[Handsontable Demo]].

!! Installation and usage
# Install this plugin (copy-paste it and tag with {{{systemConfig}}} or import; reload TW).
# Add a {{{handsontable}}} macro somewhere with params you see fit and start editing.
* if you use the old approach from Vincent's v0.0.1, you can adapt your data to the new format (macro + section for data and options, see below) or just copy-paste your data. In current version backward compability code is present, but it is deprecated and will be removed at some point.
There are some additional features available by hotkeys:
* //in tables for non-granulated data// you can
** press {{{ctrl+delete}}} to delete rows that contain selected cells
** {{{ctrl+i}}} to insert a row before and {{{ctrl+enter}}} to insert a row after the selected cells
** {{{ctrl+up/down/home/end}}} to move rows with selected cells up and down

!!! Macro syntax
the simplest syntax is the following:
{{{
&lt;&lt;handsontable [[##section name]]&gt;&gt;
}}}
this way, data and handsontable options will be stored in a section {{{section name}}} in the same tiddler as the macro. If the section doesn't exist, it will be created hidden (see data format for details). You can also store data in another tiddler by using
{{{
&lt;&lt;handsontable [[tiddler name##section name]]&gt;&gt;
}}}
to store it in a section or
{{{
&lt;&lt;handsontable [[tiddler name]]&gt;&gt;
}}}
to store it just as text of the {{{tiddler name}}} tiddler.

For more advanced usage, one would need to set handsontable options (see [[docs|http://docs.handsontable.com/Core.html]]):
{{{
&lt;&lt;handsontable [[...]] options:'{
	rowHeaders: true,
	...
}'&gt;&gt;
}}}
Note that options have the following priority: default ones (lowest, see below), from macro params, stored (highest, see below).

!!!Using with granulated data
Another way to use spreadsheets is to store data in separate tiddlers (per row). To do so, one should use the {{{filter}}} and {{{containers}}} like so ({{{!}}} means tiddler title, {{{t}}} means tiddler text, others are {{{:slice name}}}, {{{#section name}}}, {{{@fieldName}}}):
{{{
&lt;&lt;handsontable filter:&quot;[tag[contacts]]&quot;
  containers:&quot;!&quot; &quot;:phone&quot; &quot;:email&quot; &quot;#hobbies&quot;
&gt;&gt;
}}}
If you need a row which is not assosiated with some tiddler part, just use {{{&quot;&quot;}}} as a container name and use a custom renderer to fill it. For instance, with [[SetManagerPlugin|]] {{DDnc{add link}}} you may go like this:
{{{
&lt;&lt;handsontable filter:&quot;set: tag[granulated data to use with hot] sortField[orderCounter]&quot;
  containers:&quot;&quot; &quot;!&quot; &quot;:slice name&quot; &quot;#section name&quot; &quot;@fieldName&quot;
  options:'{
	colHeaders: [&quot;&quot;,&quot;[[not wikified..]]&lt;br&gt;title&quot;,&quot;..but custom&lt;br&gt;slice&quot;,&quot;headers&lt;br&gt;section&quot;,&quot;with &lt;i&gt;html&lt;/i&gt;&lt;br&gt;field&quot;],
	manualColumnResize: [22, null, null, 200], // colWidths changes all widths, no only specified ones
	renderer: function (instance, td, row, col, prop, value, cellProperties)
	{
		Handsontable.Dom.empty(td);

		if(col != 0)
			wikify(&quot;&quot;+(value || &quot;&quot;),td);
		else {
			var container = instance.container.parentElement,
			    filter = jQuery(container).data(&quot;tiddlersFilter&quot;),
			    tiddlers = store.filterTiddlers(filter);
			if(row &lt; tiddlers.length)
			  wikify(&quot;&lt;&lt;itemMenu [[&quot;+tiddlers[row].title+&quot;]] \&quot;&quot;+filter+&quot;\&quot; field:orderCounter&gt;&quot;+&quot;&gt;&quot;,td);
		}

		return td;
	}
  }'
&gt;&gt;
}}}
{{PoGc{show example inline, add SMP to repo}}}

!!!Default options
In the version 0.3.5, the following handsontable options are set by default:
|{{{colHeaders: true}}}		|headers are useful for manual resizing of columns (as of 05.2017, [[resizing can't be done without them|https://github.com/handsontable/handsontable/issues/4244]])|
|{{{manualColumnResize: true}}}|enables manual resizing, ({{DDn{sizes are not saved yet}}})|
|{{{contextMenu: true}}}		|enables context menu ({{DDn{results of toggling read-only and changing alignment are not saved yet}}})|
|{{{manualRowMove: true}}}	|(for non-granulated data) enables rows moving (by hotkeys and using drag&amp;drop by row header)|
You may hard-code them in the {{{defaultOptions}}} property of {{{config.macros.handsontable}}}.

!!!wikifiedRenderer
To display cells' content wikified, you may use the {{{renderer}}} option with the pre-defined renderer {{{config.macros.handsontable.wikifiedRenderer}}} like this:
{{{
&lt;&lt;handsontable [[##section name]] options:'{
	renderer: this.wikifiedRenderer
}'
&gt;&gt;
}}}
For this case, there's a shortcut
{{{
&lt;&lt;handsontable [[##section name]] wikified&gt;&gt;
}}}
It is also possible to use it only in certain columns using the {{{columns}}} option (2d and 5th columns in the following example):
{{{
	columns: [ {},{renderer: this.wikifiedRenderer},
    	{},{},{renderer: this.wikifiedRenderer}
	{},{},{}]
}}}
However, this method prevents creating new columns, so a preferrable approach would be to use a custom renderer:
{{{
	renderer: function (instance, td, row, col, prop, value, cellProperties)
	{
		if(col == 1 || col == 4) // first column has an index of 0
			config.macros.handsontable.wikifiedRenderer.apply(this,arguments);
		else
			Handsontable.renderers.TextRenderer.apply(this,arguments);
	}
}}}

!!!Data format
Normally, you don't need to know the data storage format. However, it may be useful if you want to adapt handsontables created with the 0.0.1 version to the new version (use macros) or repair/convert some data.

Data and options are stored as JSON in the section/tiddler chosen in the first macro param:
{{{
!section
{data:[
	...
],
options:[
	...
]}
}}}
if the section doesn't exist it is created hidden in the end of the tiddler text:
{{{
.../%
!section
...
!%/
}}}
and if the text ends with {{{|}}}, extra linebreak is added (not to hurt a table in TW syntax):
{{{
...|
/%
!section
...
!%/
}}}

!! Changelog
* 0.3.7 (10.12.2017, ~) – done some refactoring, fixed the bug that created a tiddler with emply name in a complicated case and prevented TW from saving
* 0.3.6 (14.09.2017, ~) – added the {{{wikified}}} option
* 0.3.5 (1.09.2017, ~) – introduced hotkeys for adding/removing/rearranging rows for non-granular data, added docs about using for granular data (one row per tiddler), added a warning when no place to save data is specified
* 0.3.4 (10.08.2017, ~) – some fixes of setting store dirty; added hotkeys to add rows before (ctrl+i) or after (ctrl+enter) currently selected ones and to delete selected rows (ctrl+delete)
* 0.3.3 (2.07.2017, ~) – fixed a major bug with refreshing when changing the set of tiddlers by an &quot;external&quot; mean
* 0.3.2 (14.06.2017, ~) – added refreshing to the aggregated handsontable
* 0.3.1 (20.05.2017, ~) – fixed setting dirty on displaying aggregated handsontable, fixed: allow to use ctrl+tab to switch browser tab from handsontable
* 0.3.0 (17.05.2017, ~) – implemented rough prototype for editing granulated data (collected from a filtered set of tiddlers)
* 0.2.4 (15.05.2017, ~) – fixed autoremoving empty columns/rows (prevented &quot;jumping&quot;/extra page scrolling, removing the only column/row)
* 0.2.3 (2.05.2017, ~) – implemented autoinserting columns/rows when moving out of right/bottom boundaries when pressing right/down + autoremoving empty columns/rows when going back
* 0.2.2 (22.04.2017, ~) – tested {{{wikifiedRenderer}}}, refactored options system, added {{{wikifiedRenderer}}} to the plugin
* 0.2.0 (06.04.2017, ~) – added a macro that edits data and stores it in a tiddler/section, now ~InlineJavascriptPlugin is not necessary to use this
* 0.1.0 (02.03.2017, by Yakov Litvin) – local copies of handsontable (js and css) used (embedded into the plugin) instead of external ones loaded from web
* 0.0.1 (22.06.2015, by Vincent Yeh) – Born this day.
** Works __with or without a locally installed version__ of Handsontable.
*** If a local version is not installed, this plugin will load its on-line version (http://handsontable.com/dist/handsontable.full.min.js) and its stylesheet (http://handsontable.com/dist/handsontable.full.min.css).
** Updates wiki text upon content change using Handsontable.
** __Works with multiple tables__ in one tiddler if each table data is given a __unique variable name__.
** Tested only in normally loaded tiddlers.
!!Code
***/
// /%
/***
handsontable.min.js 0.31.0
downloaded from http://handsontable.com/dist/handsontable.full.min.js
which redirected to http://docs.handsontable.com/0.31.0/bower_components/handsontable/dist/handsontable.full.min.js
(The MIT License)

Copyright (c) 2012-2014 Marcin Warpechowski
Copyright (c) 2015 Handsoncode sp. z o.o. &lt;hello@handsoncode.net&gt;

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the 'Software'), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
***/
//{{{
!function(e){if(&quot;object&quot;==typeof exports&amp;&amp;&quot;undefined&quot;!=typeof module)module.exports=e();else if(&quot;function&quot;==typeof define&amp;&amp;define.amd)define([],e);else{var t;t=&quot;undefined&quot;!=typeof window?window:&quot;undefined&quot;!=typeof global?global:&quot;undefined&quot;!=typeof self?self:this,t.Handsontable=e()}}(function(){var e;return function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var u=&quot;function&quot;==typeof require&amp;&amp;require;if(!l&amp;&amp;u)return u(a,!0);if(i)return i(a,!0);if(s[a]&amp;&amp;&quot;undefined&quot;!=typeof window[s[a]])return window[s[a]];var c=new Error(&quot;Cannot find module '&quot;+a+&quot;'&quot;);throw c.code=&quot;MODULE_NOT_FOUND&quot;,c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i=&quot;function&quot;==typeof require&amp;&amp;require,s=JSON.parse('{&quot;zeroclipboard&quot;:&quot;ZeroClipboard&quot;,&quot;moment&quot;:&quot;moment&quot;,&quot;numbro&quot;:&quot;numbro&quot;,&quot;pikaday&quot;:&quot;Pikaday&quot;}')||{},a=0;a&lt;o.length;a++)r(o[a]);return r}({1:[function(e,t,n){},{}],2:[function(e,t,n){window.jQuery&amp;&amp;!function(e){e.fn.handsontable=function(e){var t,n,o,r,i,s=this.first(),a=s.data(&quot;handsontable&quot;);if(&quot;string&quot;!=typeof e)return i=e||{},a?a.updateSettings(i):(a=new Handsontable.Core(s[0],i),s.data(&quot;handsontable&quot;,a),a.init()),s;if(o=[],arguments.length&gt;1)for(t=1,n=arguments.length;t&lt;n;t++)o.push(arguments[t]);if(a){if(&quot;undefined&quot;==typeof a[e])throw new Error(&quot;Handsontable do not provide action: &quot;+e);r=a[e].apply(a,o),&quot;destroy&quot;===e&amp;&amp;s.removeData()}return r}}(window.jQuery)},{}],3:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableBorder:{get:function(){return C}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),c=u.getComputedStyle,d=u.getTrimmingContainer,h=u.innerWidth,f=u.innerHeight,p=u.offset,m=u.outerHeight,g=u.outerWidth,w=(r=e(&quot;helpers/dom/event&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).stopImmediatePropagation,v=(i=e(&quot;helpers/browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).isMobileBrowser,y=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).EventManager,b=(a=e(&quot;cell/coords&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableCellCoords,C=((l=e(&quot;overlay/_base.js&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).WalkontableOverlay,function(e,t){t&amp;&amp;(this.eventManager=new y(e),this.instance=e,this.wot=e,this.settings=t,this.mouseDown=!1,this.main=null,this.top=null,this.left=null,this.bottom=null,this.right=null,this.topStyle=null,this.leftStyle=null,this.bottomStyle=null,this.rightStyle=null,this.cornerDefaultStyle={width:&quot;5px&quot;,height:&quot;5px&quot;,borderWidth:&quot;2px&quot;,borderStyle:&quot;solid&quot;,borderColor:&quot;#FFF&quot;},this.corner=null,this.cornerStyle=null,this.createBorders(t),this.registerListeners())});$traceurRuntime.createClass(C,{registerListeners:function(){var e=this;this.eventManager.addEventListener(document.body,&quot;mousedown&quot;,function(){return e.onMouseDown()}),this.eventManager.addEventListener(document.body,&quot;mouseup&quot;,function(){return e.onMouseUp()});for(var t=this,n=function(n,o){t.eventManager.addEventListener(t.main.childNodes[n],&quot;mouseenter&quot;,function(t){return e.onMouseEnter(t,e.main.childNodes[n])})},o=0,r=this.main.childNodes.length;o&lt;r;o++)n(o,r)},onMouseDown:function(){this.mouseDown=!0},onMouseUp:function(){this.mouseDown=!1},onMouseEnter:function(e,t){function n(e){return e.clientY&lt;Math.floor(i.top)||(e.clientY&gt;Math.ceil(i.top+i.height)||(e.clientX&lt;Math.floor(i.left)||(e.clientX&gt;Math.ceil(i.left+i.width)||void 0)))}function o(e){n(e)&amp;&amp;(r.eventManager.removeEventListener(document.body,&quot;mousemove&quot;,o),t.style.display=&quot;block&quot;)}if(this.mouseDown&amp;&amp;this.wot.getSetting(&quot;hideBorderOnMouseDownOver&quot;)){e.preventDefault(),w(e);var r=this,i=t.getBoundingClientRect();t.style.display=&quot;none&quot;,this.eventManager.addEventListener(document.body,&quot;mousemove&quot;,o)}},createBorders:function(e){this.main=document.createElement(&quot;div&quot;);var t=[&quot;top&quot;,&quot;left&quot;,&quot;bottom&quot;,&quot;right&quot;,&quot;corner&quot;],n=this.main.style;n.position=&quot;absolute&quot;,n.top=0,n.left=0;for(var o=0;o&lt;5;o++){var r=t[o],i=document.createElement(&quot;div&quot;);i.className=&quot;wtBorder &quot;+(this.settings.className||&quot;&quot;),this.settings[r]&amp;&amp;this.settings[r].hide&amp;&amp;(i.className+=&quot; hidden&quot;),n=i.style,n.backgroundColor=this.settings[r]&amp;&amp;this.settings[r].color?this.settings[r].color:e.border.color,n.height=this.settings[r]&amp;&amp;this.settings[r].width?this.settings[r].width+&quot;px&quot;:e.border.width+&quot;px&quot;,n.width=this.settings[r]&amp;&amp;this.settings[r].width?this.settings[r].width+&quot;px&quot;:e.border.width+&quot;px&quot;,this.main.appendChild(i)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.topStyle=this.top.style,this.leftStyle=this.left.style,this.bottomStyle=this.bottom.style,this.rightStyle=this.right.style,this.corner=this.main.childNodes[4],this.corner.className+=&quot; corner&quot;,this.cornerStyle=this.corner.style,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.height=this.cornerDefaultStyle.height,this.cornerStyle.border=[this.cornerDefaultStyle.borderWidth,this.cornerDefaultStyle.borderStyle,this.cornerDefaultStyle.borderColor].join(&quot; &quot;),v()&amp;&amp;this.createMultipleSelectorHandles(),this.disappear(),this.wot.wtTable.bordersHolder||(this.wot.wtTable.bordersHolder=document.createElement(&quot;div&quot;),this.wot.wtTable.bordersHolder.className=&quot;htBorders&quot;,this.wot.wtTable.spreader.appendChild(this.wot.wtTable.bordersHolder)),this.wot.wtTable.bordersHolder.insertBefore(this.main,this.wot.wtTable.bordersHolder.firstChild)},createMultipleSelectorHandles:function(){this.selectionHandles={topLeft:document.createElement(&quot;DIV&quot;),topLeftHitArea:document.createElement(&quot;DIV&quot;),bottomRight:document.createElement(&quot;DIV&quot;),bottomRightHitArea:document.createElement(&quot;DIV&quot;)};var e=10,t=40;this.selectionHandles.topLeft.className=&quot;topLeftSelectionHandle&quot;,this.selectionHandles.topLeftHitArea.className=&quot;topLeftSelectionHandle-HitArea&quot;,this.selectionHandles.bottomRight.className=&quot;bottomRightSelectionHandle&quot;,this.selectionHandles.bottomRightHitArea.className=&quot;bottomRightSelectionHandle-HitArea&quot;,this.selectionHandles.styles={topLeft:this.selectionHandles.topLeft.style,topLeftHitArea:this.selectionHandles.topLeftHitArea.style,bottomRight:this.selectionHandles.bottomRight.style,bottomRightHitArea:this.selectionHandles.bottomRightHitArea.style};var n={position:&quot;absolute&quot;,height:t+&quot;px&quot;,width:t+&quot;px&quot;,&quot;border-radius&quot;:parseInt(t/1.5,10)+&quot;px&quot;};for(var o in n)n.hasOwnProperty(o)&amp;&amp;(this.selectionHandles.styles.bottomRightHitArea[o]=n[o],this.selectionHandles.styles.topLeftHitArea[o]=n[o]);var r={position:&quot;absolute&quot;,height:e+&quot;px&quot;,width:e+&quot;px&quot;,&quot;border-radius&quot;:parseInt(e/1.5,10)+&quot;px&quot;,background:&quot;#F5F5FF&quot;,border:&quot;1px solid #4285c8&quot;};for(var i in r)r.hasOwnProperty(i)&amp;&amp;(this.selectionHandles.styles.bottomRight[i]=r[i],this.selectionHandles.styles.topLeft[i]=r[i]);this.main.appendChild(this.selectionHandles.topLeft),this.main.appendChild(this.selectionHandles.bottomRight),this.main.appendChild(this.selectionHandles.topLeftHitArea),this.main.appendChild(this.selectionHandles.bottomRightHitArea)},isPartRange:function(e,t){return!(!this.wot.selections.area.cellRange||e==this.wot.selections.area.cellRange.to.row&amp;&amp;t==this.wot.selections.area.cellRange.to.col)},updateMultipleSelectionHandlesPosition:function(e,t,n,o,r,i){var s=parseInt(this.selectionHandles.styles.topLeft.width,10),a=parseInt(this.selectionHandles.styles.topLeftHitArea.width,10);this.selectionHandles.styles.topLeft.top=parseInt(n-s,10)+&quot;px&quot;,this.selectionHandles.styles.topLeft.left=parseInt(o-s,10)+&quot;px&quot;,this.selectionHandles.styles.topLeftHitArea.top=parseInt(n-a/4*3,10)+&quot;px&quot;,this.selectionHandles.styles.topLeftHitArea.left=parseInt(o-a/4*3,10)+&quot;px&quot;,this.selectionHandles.styles.bottomRight.top=parseInt(n+i,10)+&quot;px&quot;,this.selectionHandles.styles.bottomRight.left=parseInt(o+r,10)+&quot;px&quot;,this.selectionHandles.styles.bottomRightHitArea.top=parseInt(n+i-a/4,10)+&quot;px&quot;,this.selectionHandles.styles.bottomRightHitArea.left=parseInt(o+r-a/4,10)+&quot;px&quot;,this.settings.border.multipleSelectionHandlesVisible&amp;&amp;this.settings.border.multipleSelectionHandlesVisible()?(this.selectionHandles.styles.topLeft.display=&quot;block&quot;,this.selectionHandles.styles.topLeftHitArea.display=&quot;block&quot;,this.isPartRange(e,t)?(this.selectionHandles.styles.bottomRight.display=&quot;none&quot;,this.selectionHandles.styles.bottomRightHitArea.display=&quot;none&quot;):(this.selectionHandles.styles.bottomRight.display=&quot;block&quot;,this.selectionHandles.styles.bottomRightHitArea.display=&quot;block&quot;)):(this.selectionHandles.styles.topLeft.display=&quot;none&quot;,this.selectionHandles.styles.bottomRight.display=&quot;none&quot;,this.selectionHandles.styles.topLeftHitArea.display=&quot;none&quot;,this.selectionHandles.styles.bottomRightHitArea.display=&quot;none&quot;),e==this.wot.wtSettings.getSetting(&quot;fixedRowsTop&quot;)||t==this.wot.wtSettings.getSetting(&quot;fixedColumnsLeft&quot;)?(this.selectionHandles.styles.topLeft.zIndex=&quot;9999&quot;,this.selectionHandles.styles.topLeftHitArea.zIndex=&quot;9999&quot;):(this.selectionHandles.styles.topLeft.zIndex=&quot;&quot;,this.selectionHandles.styles.topLeftHitArea.zIndex=&quot;&quot;)},appear:function(e){if(!this.disabled){var t,n,o,r,i,s,a,l,u,w,y,C,_,R,M,S,E,O,T;T=this.wot.wtTable.getRenderedRowsCount();for(var k=0;k&lt;T;k++){var x=this.wot.wtTable.rowFilter.renderedToSource(k);if(x&gt;=e[0]&amp;&amp;x&lt;=e[2]){_=x;break}}for(var D=T-1;D&gt;=0;D--){var H=this.wot.wtTable.rowFilter.renderedToSource(D);if(H&gt;=e[0]&amp;&amp;H&lt;=e[2]){M=H;break}}T=this.wot.wtTable.getRenderedColumnsCount();for(var A=0;A&lt;T;A++){var P=this.wot.wtTable.columnFilter.renderedToSource(A);if(P&gt;=e[1]&amp;&amp;P&lt;=e[3]){R=P;break}}for(var N=T-1;N&gt;=0;N--){var L=this.wot.wtTable.columnFilter.renderedToSource(N);if(L&gt;=e[1]&amp;&amp;L&lt;=e[3]){S=L;break}}if(void 0===_||void 0===R)return void this.disappear();t=_!==M||R!==S,n=this.wot.wtTable.getCell(new b(_,R)),o=t?this.wot.wtTable.getCell(new b(M,S)):n,r=p(n),i=t?p(o):r,s=p(this.wot.wtTable.TABLE),l=r.top,y=i.top+m(o)-l,w=r.left,C=i.left+g(o)-w,a=l-s.top-1,u=w-s.left-1;var I=c(n);parseInt(I.borderTopWidth,10)&gt;0&amp;&amp;(a+=1,y=y&gt;0?y-1:0),parseInt(I.borderLeftWidth,10)&gt;0&amp;&amp;(u+=1,C=C&gt;0?C-1:0),this.topStyle.top=a+&quot;px&quot;,this.topStyle.left=u+&quot;px&quot;,this.topStyle.width=C+&quot;px&quot;,this.topStyle.display=&quot;block&quot;,this.leftStyle.top=a+&quot;px&quot;,this.leftStyle.left=u+&quot;px&quot;,this.leftStyle.height=y+&quot;px&quot;,this.leftStyle.display=&quot;block&quot;;var W=Math.floor(this.settings.border.width/2);this.bottomStyle.top=a+y-W+&quot;px&quot;,this.bottomStyle.left=u+&quot;px&quot;,this.bottomStyle.width=C+&quot;px&quot;,this.bottomStyle.display=&quot;block&quot;,this.rightStyle.top=a+&quot;px&quot;,this.rightStyle.left=u+C-W+&quot;px&quot;,this.rightStyle.height=y+1+&quot;px&quot;,this.rightStyle.display=&quot;block&quot;,v()||!this.hasSetting(this.settings.border.cornerVisible)||this.isPartRange(M,S)?this.cornerStyle.display=&quot;none&quot;:(this.cornerStyle.top=a+y-4+&quot;px&quot;,this.cornerStyle.left=u+C-4+&quot;px&quot;,this.cornerStyle.borderRightWidth=this.cornerDefaultStyle.borderWidth,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.display=&quot;none&quot;,E=d(this.wot.wtTable.TABLE),S===this.wot.getSetting(&quot;totalColumns&quot;)-1&amp;&amp;(O=o.offsetLeft+g(o)+parseInt(this.cornerDefaultStyle.width)/2&gt;=h(E),O&amp;&amp;(this.cornerStyle.left=Math.floor(u+C-3-parseInt(this.cornerDefaultStyle.width)/2)+&quot;px&quot;,this.cornerStyle.borderRightWidth=0)),M===this.wot.getSetting(&quot;totalRows&quot;)-1&amp;&amp;(O=o.offsetTop+m(o)+parseInt(this.cornerDefaultStyle.height)/2&gt;=f(E),O&amp;&amp;(this.cornerStyle.top=Math.floor(a+y-3-parseInt(this.cornerDefaultStyle.height)/2)+&quot;px&quot;,this.cornerStyle.borderBottomWidth=0)),this.cornerStyle.display=&quot;block&quot;),v()&amp;&amp;this.updateMultipleSelectionHandlesPosition(_,R,a,u,C,y)}},disappear:function(){this.topStyle.display=&quot;none&quot;,this.leftStyle.display=&quot;none&quot;,this.bottomStyle.display=&quot;none&quot;,this.rightStyle.display=&quot;none&quot;,this.cornerStyle.display=&quot;none&quot;,v()&amp;&amp;(this.selectionHandles.styles.topLeft.display=&quot;none&quot;,this.selectionHandles.styles.bottomRight.display=&quot;none&quot;)},hasSetting:function(e){return&quot;function&quot;==typeof e?e():!!e}},{}),window.WalkontableBorder=C},{&quot;cell/coords&quot;:6,eventManager:42,&quot;helpers/browser&quot;:44,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;overlay/_base.js&quot;:12}],4:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableViewportColumnsCalculator:{get:function(){return r}},__esModule:{value:!0}});var o=new WeakMap,r=function(e,t,n,r,i,s,a){var l=void 0!==arguments[7]?arguments[7]:function(e){return e};o.set(this,{viewportWidth:e,scrollOffset:t,totalColumns:n,columnWidthFn:r,overrideFn:i,onlyFullyVisible:s,stretchingColumnWidthFn:l}),this.count=0,this.startColumn=null,this.endColumn=null,this.startPosition=null,this.stretchAllRatio=0,this.stretchLastWidth=0,this.stretch=a,this.totalTargetWidth=0,this.needVerifyLastColumnWidth=!0,this.stretchAllColumnsWidth=[],this.calculate()},i=r;$traceurRuntime.createClass(r,{calculate:function(){for(var e,t=0,n=!0,r=[],i=o.get(this),s=i.onlyFullyVisible,a=i.overrideFn,l=i.scrollOffset,u=i.totalColumns,c=i.viewportWidth,d=0;d&lt;u;d++){e=this._getColumnWidth(d),t&lt;=l&amp;&amp;!s&amp;&amp;(this.startColumn=d);var h=l&gt;0?c+1:c;if(t&gt;=l&amp;&amp;t+e&lt;=l+h&amp;&amp;(null==this.startColumn&amp;&amp;(this.startColumn=d),this.endColumn=d),r.push(t),t+=e,s||(this.endColumn=d),t&gt;=l+c){n=!1;break}}if(this.endColumn===u-1&amp;&amp;n)for(this.startColumn=this.endColumn;this.startColumn&gt;0;){var f=r[this.endColumn]+e-r[this.startColumn-1];if((f&lt;=c||!s)&amp;&amp;this.startColumn--,f&gt;c)break}null!==this.startColumn&amp;&amp;a&amp;&amp;a(this),this.startPosition=r[this.startColumn],void 0==this.startPosition&amp;&amp;(this.startPosition=null),null!==this.startColumn&amp;&amp;(this.count=this.endColumn-this.startColumn+1)},refreshStretching:function(e){if(&quot;none&quot;!==this.stretch){this.totalTargetWidth=e;for(var t=o.get(this),n=t.totalColumns,r=0,i=0;i&lt;n;i++){var s=this._getColumnWidth(i),a=t.stretchingColumnWidthFn(void 0,i);&quot;number&quot;==typeof a?e-=a:r+=s}var l=e-r;if(&quot;all&quot;===this.stretch&amp;&amp;l&gt;0)this.stretchAllRatio=e/r,this.stretchAllColumnsWidth=[],this.needVerifyLastColumnWidth=!0;else if(&quot;last&quot;===this.stretch&amp;&amp;e!==1/0){var u=this._getColumnWidth(n-1),c=l+u;this.stretchLastWidth=c&gt;=0?c:u}}},getStretchedColumnWidth:function(e,t){var n=null;return&quot;all&quot;===this.stretch&amp;&amp;0!==this.stretchAllRatio?n=this._getStretchedAllColumnWidth(e,t):&quot;last&quot;===this.stretch&amp;&amp;0!==this.stretchLastWidth&amp;&amp;(n=this._getStretchedLastColumnWidth(e)),n},_getStretchedAllColumnWidth:function(e,t){var n=0,r=o.get(this),i=r.totalColumns;if(!this.stretchAllColumnsWidth[e]){var s=Math.round(t*this.stretchAllRatio),a=r.stretchingColumnWidthFn(s,e);void 0===a?this.stretchAllColumnsWidth[e]=s:this.stretchAllColumnsWidth[e]=isNaN(a)?this._getColumnWidth(e):a}if(this.stretchAllColumnsWidth.length===i&amp;&amp;this.needVerifyLastColumnWidth){this.needVerifyLastColumnWidth=!1;for(var l=0;l&lt;this.stretchAllColumnsWidth.length;l++)n+=this.stretchAllColumnsWidth[l];n!==this.totalTargetWidth&amp;&amp;(this.stretchAllColumnsWidth[this.stretchAllColumnsWidth.length-1]+=this.totalTargetWidth-n)}return this.stretchAllColumnsWidth[e]},_getStretchedLastColumnWidth:function(e){var t=o.get(this),n=t.totalColumns;return e===n-1?this.stretchLastWidth:null},_getColumnWidth:function(e){var t=o.get(this).columnWidthFn(e);return void 0===t&amp;&amp;(t=i.DEFAULT_WIDTH),t}},{get DEFAULT_WIDTH(){return 50}}),window.WalkontableViewportColumnsCalculator=r},{}],5:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableViewportRowsCalculator:{get:function(){return r}},__esModule:{value:!0}});var o=new WeakMap,r=function(e,t,n,r,i,s,a){o.set(this,{viewportHeight:e,scrollOffset:t,totalRows:n,rowHeightFn:r,overrideFn:i,onlyFullyVisible:s,horizontalScrollbarHeight:a}),this.count=0,this.startRow=null,this.endRow=null,this.startPosition=null,this.calculate()},i=r;$traceurRuntime.createClass(r,{calculate:function(){for(var e=0,t=!0,n=[],r=o.get(this),s=r.onlyFullyVisible,a=r.overrideFn,l=r.rowHeightFn,u=r.scrollOffset,c=r.totalRows,d=r.viewportHeight,h=r.horizontalScrollbarHeight||0,f=0;f&lt;c;f++){var p=l(f);if(void 0===p&amp;&amp;(p=i.DEFAULT_HEIGHT),e&lt;=u&amp;&amp;!s&amp;&amp;(this.startRow=f),e&gt;=u&amp;&amp;e+p&lt;=u+d-h&amp;&amp;(null===this.startRow&amp;&amp;(this.startRow=f),this.endRow=f),n.push(e),e+=p,s||(this.endRow=f),e&gt;=u+d-h){t=!1;break}}if(this.endRow===c-1&amp;&amp;t)for(this.startRow=this.endRow;this.startRow&gt;0;){var m=n[this.endRow]+p-n[this.startRow-1];if((m&lt;=d-h||!s)&amp;&amp;this.startRow--,m&gt;=d-h)break}null!==this.startRow&amp;&amp;a&amp;&amp;a(this),this.startPosition=n[this.startRow],void 0==this.startPosition&amp;&amp;(this.startPosition=null),null!==this.startRow&amp;&amp;(this.count=this.endRow-this.startRow+1)}},{get DEFAULT_HEIGHT(){return 23}}),window.WalkontableViewportRowsCalculator=r},{}],6:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableCellCoords:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t){&quot;undefined&quot;!=typeof e&amp;&amp;&quot;undefined&quot;!=typeof t?(this.row=e,this.col=t):(this.row=null,this.col=null)};$traceurRuntime.createClass(o,{isValid:function(e){return!(this.row&lt;0||this.col&lt;0)&amp;&amp;!(this.row&gt;=e.getSetting(&quot;totalRows&quot;)||this.col&gt;=e.getSetting(&quot;totalColumns&quot;))},isEqual:function(e){return e===this||this.row===e.row&amp;&amp;this.col===e.col},isSouthEastOf:function(e){return this.row&gt;=e.row&amp;&amp;this.col&gt;=e.col},isNorthWestOf:function(e){return this.row&lt;=e.row&amp;&amp;this.col&lt;=e.col},isSouthWestOf:function(e){return this.row&gt;=e.row&amp;&amp;this.col&lt;=e.col},isNorthEastOf:function(e){return this.row&lt;=e.row&amp;&amp;this.col&gt;=e.col}},{}),window.WalkontableCellCoords=o},{}],7:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableCellRange:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e(&quot;cell/coords&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).WalkontableCellCoords,i=function(e,t,n){this.highlight=e,this.from=t,this.to=n},s=i;$traceurRuntime.createClass(i,{isValid:function(e){return this.from.isValid(e)&amp;&amp;this.to.isValid(e)},isSingle:function(){return this.from.row===this.to.row&amp;&amp;this.from.col===this.to.col},getHeight:function(){return Math.max(this.from.row,this.to.row)-Math.min(this.from.row,this.to.row)+1},getWidth:function(){return Math.max(this.from.col,this.to.col)-Math.min(this.from.col,this.to.col)+1},includes:function(e){var t=e,n=t.row,o=t.col,r=this.getTopLeftCorner(),i=this.getBottomRightCorner();return r.row&lt;=n&amp;&amp;i.row&gt;=n&amp;&amp;r.col&lt;=o&amp;&amp;i.col&gt;=o},includesRange:function(e){return this.includes(e.getTopLeftCorner())&amp;&amp;this.includes(e.getBottomRightCorner())},isEqual:function(e){return Math.min(this.from.row,this.to.row)==Math.min(e.from.row,e.to.row)&amp;&amp;Math.max(this.from.row,this.to.row)==Math.max(e.from.row,e.to.row)&amp;&amp;Math.min(this.from.col,this.to.col)==Math.min(e.from.col,e.to.col)&amp;&amp;Math.max(this.from.col,this.to.col)==Math.max(e.from.col,e.to.col)},overlaps:function(e){return e.isSouthEastOf(this.getTopLeftCorner())&amp;&amp;e.isNorthWestOf(this.getBottomRightCorner())},isSouthEastOf:function(e){return this.getTopLeftCorner().isSouthEastOf(e)||this.getBottomRightCorner().isSouthEastOf(e)},isNorthWestOf:function(e){return this.getTopLeftCorner().isNorthWestOf(e)||this.getBottomRightCorner().isNorthWestOf(e)},expand:function(e){var t=this.getTopLeftCorner(),n=this.getBottomRightCorner();return(e.row&lt;t.row||e.col&lt;t.col||e.row&gt;n.row||e.col&gt;n.col)&amp;&amp;(this.from=new r(Math.min(t.row,e.row),Math.min(t.col,e.col)),this.to=new r(Math.max(n.row,e.row),Math.max(n.col,e.col)),!0)},expandByRange:function(e){if(this.includesRange(e)||!this.overlaps(e))return!1;var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=(this.getTopRightCorner(),this.getBottomLeftCorner(),e.getTopLeftCorner()),i=e.getBottomRightCorner(),a=Math.min(t.row,o.row),l=Math.min(t.col,o.col),u=Math.max(n.row,i.row),c=Math.max(n.col,i.col),d=new r(a,l),h=new r(u,c),f=new s(d,d,h).isCorner(this.from,e),p=e.isEqual(new s(d,d,h));return f&amp;&amp;!p&amp;&amp;(this.from.col&gt;d.col&amp;&amp;(d.col=c,h.col=l),this.from.row&gt;d.row&amp;&amp;(d.row=u,h.row=a)),this.from=d,this.to=h,!0},getDirection:function(){return this.from.isNorthWestOf(this.to)?&quot;NW-SE&quot;:this.from.isNorthEastOf(this.to)?&quot;NE-SW&quot;:this.from.isSouthEastOf(this.to)?&quot;SE-NW&quot;:this.from.isSouthWestOf(this.to)?&quot;SW-NE&quot;:void 0},setDirection:function(e){var t,n,o,r;switch(e){case&quot;NW-SE&quot;:t=[this.getTopLeftCorner(),this.getBottomRightCorner()],this.from=t[0],this.to=t[1],t;break;case&quot;NE-SW&quot;:n=[this.getTopRightCorner(),this.getBottomLeftCorner()],this.from=n[0],this.to=n[1],n;break;case&quot;SE-NW&quot;:o=[this.getBottomRightCorner(),this.getTopLeftCorner()],this.from=o[0],this.to=o[1],o;break;case&quot;SW-NE&quot;:r=[this.getBottomLeftCorner(),this.getTopRightCorner()],this.from=r[0],this.to=r[1],r}},getTopLeftCorner:function(){return new r(Math.min(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},getBottomRightCorner:function(){return new r(Math.max(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},getTopRightCorner:function(){return new r(Math.min(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},getBottomLeftCorner:function(){return new r(Math.max(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},isCorner:function(e,t){return!!(t&amp;&amp;t.includes(e)&amp;&amp;(this.getTopLeftCorner().isEqual(new r(t.from.row,t.from.col))||this.getTopRightCorner().isEqual(new r(t.from.row,t.to.col))||this.getBottomLeftCorner().isEqual(new r(t.to.row,t.from.col))||this.getBottomRightCorner().isEqual(new r(t.to.row,t.to.col))))||(e.isEqual(this.getTopLeftCorner())||e.isEqual(this.getTopRightCorner())||e.isEqual(this.getBottomLeftCorner())||e.isEqual(this.getBottomRightCorner()))},getOppositeCorner:function(e,t){if(!(e instanceof r))return!1;if(t&amp;&amp;t.includes(e)){if(this.getTopLeftCorner().isEqual(new r(t.from.row,t.from.col)))return this.getBottomRightCorner();if(this.getTopRightCorner().isEqual(new r(t.from.row,t.to.col)))return this.getBottomLeftCorner();if(this.getBottomLeftCorner().isEqual(new r(t.to.row,t.from.col)))return this.getTopRightCorner();if(this.getBottomRightCorner().isEqual(new r(t.to.row,t.to.col)))return this.getTopLeftCorner()}return e.isEqual(this.getBottomRightCorner())?this.getTopLeftCorner():e.isEqual(this.getTopLeftCorner())?this.getBottomRightCorner():e.isEqual(this.getTopRightCorner())?this.getBottomLeftCorner():e.isEqual(this.getBottomLeftCorner())?this.getTopRightCorner():void 0},getBordersSharedWith:function(e){if(!this.includesRange(e))return[];var t={top:Math.min(this.from.row,this.to.row),bottom:Math.max(this.from.row,this.to.row),left:Math.min(this.from.col,this.to.col),right:Math.max(this.from.col,this.to.col)},n={top:Math.min(e.from.row,e.to.row),bottom:Math.max(e.from.row,e.to.row),left:Math.min(e.from.col,e.to.col),right:Math.max(e.from.col,e.to.col)},o=[];return t.top==n.top&amp;&amp;o.push(&quot;top&quot;),t.right==n.right&amp;&amp;o.push(&quot;right&quot;),t.bottom==n.bottom&amp;&amp;o.push(&quot;bottom&quot;),t.left==n.left&amp;&amp;o.push(&quot;left&quot;),o},getInner:function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o&lt;=t.row;o++)for(var i=e.col;i&lt;=t.col;i++)this.from.row===o&amp;&amp;this.from.col===i||this.to.row===o&amp;&amp;this.to.col===i||n.push(new r(o,i));return n},getAll:function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o&lt;=t.row;o++)for(var i=e.col;i&lt;=t.col;i++)e.row===o&amp;&amp;e.col===i?n.push(e):t.row===o&amp;&amp;t.col===i?n.push(t):n.push(new r(o,i));return n},forAll:function(e){for(var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=t.row;o&lt;=n.row;o++)for(var r=t.col;r&lt;=n.col;r++){var i=e(o,r);if(i===!1)return}}},{}),window.WalkontableCellRange=i},{&quot;cell/coords&quot;:6}],8:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{Walkontable:{get:function(){return H}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),v=w.addClass,y=w.fastInnerText,b=w.isVisible,C=w.removeClass,_=(r=e(&quot;helpers/object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).objectEach,R=(i=e(&quot;helpers/string&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),M=R.toUpperCaseFirst,S=R.randomString,E=(s=e(&quot;event&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).WalkontableEvent,O=(a=e(&quot;overlays&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableOverlays,T=(l=e(&quot;scroll&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).WalkontableScroll,k=(u=e(&quot;settings&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).WalkontableSettings,x=(c=e(&quot;table&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).WalkontableTable,D=(d=e(&quot;viewport&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).WalkontableViewport,H=((h=e(&quot;overlay/_base.js&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).WalkontableOverlay,(f=e(&quot;overlay/top.js&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).WalkontableTopOverlay,(p=e(&quot;overlay/left.js&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}).WalkontableLeftOverlay,(m=e(&quot;overlay/debug.js&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).WalkontableDebugOverlay,(g=e(&quot;overlay/topLeftCorner.js&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}).WalkontableTopLeftCornerOverlay,function(e){var t=[];if(this.guid=&quot;wt_&quot;+S(),e.cloneSource?(this.cloneSource=e.cloneSource,this.cloneOverlay=e.cloneOverlay,this.wtSettings=e.cloneSource.wtSettings,this.wtTable=new x(this,e.table,e.wtRootElement),this.wtScroll=new T(this),this.wtViewport=e.cloneSource.wtViewport,this.wtEvent=new E(this),this.selections=this.cloneSource.selections):(this.wtSettings=new k(this,e),this.wtTable=new x(this,e.table),this.wtScroll=new T(this),this.wtViewport=new D(this),this.wtEvent=new E(this),this.selections=this.getSetting(&quot;selections&quot;),this.wtOverlays=new O(this),this.exportSettingsAsClassNames()),this.wtTable.THEAD.childNodes.length&amp;&amp;this.wtTable.THEAD.childNodes[0].childNodes.length){for(var n=0,o=this.wtTable.THEAD.childNodes[0].childNodes.length;n&lt;o;n++)t.push(this.wtTable.THEAD.childNodes[0].childNodes[n].innerHTML);this.getSetting(&quot;columnHeaders&quot;).length||this.update(&quot;columnHeaders&quot;,[function(e,n){y(n,t[e])}])}this.drawn=!1,this.drawInterrupted=!1});$traceurRuntime.createClass(H,{draw:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];return this.drawInterrupted=!1,e||b(this.wtTable.TABLE)?this.wtTable.draw(e):this.drawInterrupted=!0,this},getCell:function(e){var t=void 0!==arguments[1]&amp;&amp;arguments[1];if(!t)return this.wtTable.getCell(e);var n=this.wtSettings.getSetting(&quot;totalRows&quot;),o=this.wtSettings.getSetting(&quot;fixedRowsTop&quot;),r=this.wtSettings.getSetting(&quot;fixedRowsBottom&quot;),i=this.wtSettings.getSetting(&quot;fixedColumnsLeft&quot;);if(e.row&lt;o&amp;&amp;e.col&lt;i)return this.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell(e);if(e.row&lt;o)return this.wtOverlays.topOverlay.clone.wtTable.getCell(e);if(e.col&lt;i&amp;&amp;e.row&gt;=n-r){if(this.wtOverlays.bottomLeftCornerOverlay&amp;&amp;this.wtOverlays.bottomLeftCornerOverlay.clone)return this.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell(e)}else{if(e.col&lt;i)return this.wtOverlays.leftOverlay.clone.wtTable.getCell(e);if(e.row&lt;n&amp;&amp;e.row&gt;n-r&amp;&amp;this.wtOverlays.bottomOverlay&amp;&amp;this.wtOverlays.bottomOverlay.clone)return this.wtOverlays.bottomOverlay.clone.wtTable.getCell(e)}return this.wtTable.getCell(e)},update:function(e,t){return this.wtSettings.update(e,t)},scrollVertical:function(e){return this.wtOverlays.topOverlay.scrollTo(e),this.getSetting(&quot;onScrollVertically&quot;),this},scrollHorizontal:function(e){return this.wtOverlays.leftOverlay.scrollTo(e),this.getSetting(&quot;onScrollHorizontally&quot;),this},scrollViewport:function(e){return this.wtScroll.scrollViewport(e),this},getViewport:function(){return[this.wtTable.getFirstVisibleRow(),this.wtTable.getFirstVisibleColumn(),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]},getOverlayName:function(){return this.cloneOverlay?this.cloneOverlay.type:&quot;master&quot;},isOverlayName:function(e){return!!this.cloneOverlay&amp;&amp;this.cloneOverlay.type===e},exportSettingsAsClassNames:function(){var e=this,t={rowHeaders:[&quot;array&quot;],columnHeaders:[&quot;array&quot;]},n=[],o=[];_(t,function(t,r){t.indexOf(&quot;array&quot;)&gt;-1&amp;&amp;e.getSetting(r).length&amp;&amp;o.push(&quot;ht&quot;+M(r)),n.push(&quot;ht&quot;+M(r))}),C(this.wtTable.wtRootElement.parentNode,n),v(this.wtTable.wtRootElement.parentNode,o)},getSetting:function(e,t,n,o,r){return this.wtSettings.getSetting(e,t,n,o,r)},hasSetting:function(e){return this.wtSettings.has(e)},destroy:function(){this.wtOverlays.destroy(),this.wtEvent.destroy()}},{}),window.Walkontable=H},{event:9,&quot;helpers/dom/element&quot;:47,&quot;helpers/object&quot;:53,&quot;helpers/string&quot;:55,&quot;overlay/_base.js&quot;:12,&quot;overlay/debug.js&quot;:13,&quot;overlay/left.js&quot;:14,&quot;overlay/top.js&quot;:15,&quot;overlay/topLeftCorner.js&quot;:16,overlays:17,scroll:18,settings:20,table:21,viewport:23}],9:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=this,n=m(e);this.instance=e;var o=[null,null];this.dblClickTimeout=[null,null];var r,i=function(e){var n=document.activeElement,r=f(h,e.realTarget),i=e.realTarget;if(i!==n&amp;&amp;r(0)!==n&amp;&amp;r(1)!==n){var s=t.parentCell(i);c(i,&quot;corner&quot;)?t.instance.getSetting(&quot;onCellCornerMouseDown&quot;,e,i):s.TD&amp;&amp;t.instance.hasSetting(&quot;onCellMouseDown&quot;)&amp;&amp;t.instance.getSetting(&quot;onCellMouseDown&quot;,e,s.coords,s.TD,t.instance),2!==e.button&amp;&amp;s.TD&amp;&amp;(o[0]=s.TD,clearTimeout(t.dblClickTimeout[0]),t.dblClickTimeout[0]=setTimeout(function(){o[0]=null},1e3))}},s=function(e){t.instance.touchMoving=!0},a=function(e){n.addEventListener(this,&quot;touchmove&quot;,s),t.checkIfTouchMove=setTimeout(function(){return t.instance.touchMoving===!0?(t.instance.touchMoving=void 0,void n.removeEventListener(&quot;touchmove&quot;,s,!1)):void i(e)},30)},l=function(e){var n,o,r;t.instance.hasSetting(&quot;onCellMouseOver&quot;)&amp;&amp;(n=t.instance.wtTable.TABLE,o=u(e.realTarget,[&quot;TD&quot;,&quot;TH&quot;],n),r=t.instance.cloneSource||t.instance,o&amp;&amp;o!==r.lastMouseOver&amp;&amp;d(o,n)&amp;&amp;(r.lastMouseOver=o,t.instance.getSetting(&quot;onCellMouseOver&quot;,e,t.instance.wtTable.getCoords(o),o,t.instance)))},g=function(e){if(2!==e.button){var n=t.parentCell(e.realTarget);n.TD===o[0]&amp;&amp;n.TD===o[1]?(c(e.realTarget,&quot;corner&quot;)?t.instance.getSetting(&quot;onCellCornerDblClick&quot;,e,n.coords,n.TD,t.instance):t.instance.getSetting(&quot;onCellDblClick&quot;,e,n.coords,n.TD,t.instance),o[0]=null,o[1]=null):n.TD===o[0]?(t.instance.getSetting(&quot;onCellMouseUp&quot;,e,n.coords,n.TD,t.instance),o[1]=n.TD,clearTimeout(t.dblClickTimeout[1]),t.dblClickTimeout[1]=setTimeout(function(){o[1]=null},500)):n.TD&amp;&amp;t.instance.hasSetting(&quot;onCellMouseUp&quot;)&amp;&amp;t.instance.getSetting(&quot;onCellMouseUp&quot;,e,n.coords,n.TD,t.instance)}},w=function(e){clearTimeout(r),e.preventDefault(),g(e)};if(n.addEventListener(this.instance.wtTable.holder,&quot;mousedown&quot;,i),n.addEventListener(this.instance.wtTable.TABLE,&quot;mouseover&quot;,l),n.addEventListener(this.instance.wtTable.holder,&quot;mouseup&quot;,g),this.instance.wtTable.holder.parentNode.parentNode&amp;&amp;p()&amp;&amp;!t.instance.wtTable.isWorkingOnClone()){var v=&quot;.&quot;+this.instance.wtTable.holder.parentNode.className.split(&quot; &quot;).join(&quot;.&quot;);n.addEventListener(this.instance.wtTable.holder,&quot;touchstart&quot;,function(e){t.instance.touchApplied=!0,d(e.target,v)&amp;&amp;a.call(e.target,e)}),n.addEventListener(this.instance.wtTable.holder,&quot;touchend&quot;,function(e){t.instance.touchApplied=!1,d(e.target,v)&amp;&amp;w.call(e.target,e)}),t.instance.momentumScrolling||(t.instance.momentumScrolling={}),n.addEventListener(this.instance.wtTable.holder,&quot;scroll&quot;,function(e){clearTimeout(t.instance.momentumScrolling._timeout),t.instance.momentumScrolling.ongoing||t.instance.getSetting(&quot;onBeforeTouchScroll&quot;),t.instance.momentumScrolling.ongoing=!0,t.instance.momentumScrolling._timeout=setTimeout(function(){t.instance.touchApplied||(t.instance.momentumScrolling.ongoing=!1,t.instance.getSetting(&quot;onAfterMomentumScroll&quot;))},200)})}n.addEventListener(window,&quot;resize&quot;,function(){&quot;none&quot;!==t.instance.getSetting(&quot;stretchH&quot;)&amp;&amp;t.instance.draw()}),this.destroy=function(){clearTimeout(this.dblClickTimeout[0]),clearTimeout(this.dblClickTimeout[1]),n.destroy()}}Object.defineProperties(n,{WalkontableEvent:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),u=l.closestDown,c=l.hasClass,d=l.isChildOf,h=l.getParent,f=(i=e(&quot;helpers/function&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).partial,p=(s=e(&quot;helpers/browser&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isMobileBrowser,m=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).eventManager;o.prototype.parentCell=function(e){var t={},n=this.instance.wtTable.TABLE,o=u(e,[&quot;TD&quot;,&quot;TH&quot;],n);return o?(t.coords=this.instance.wtTable.getCoords(o),t.TD=o):c(e,&quot;wtBorder&quot;)&amp;&amp;c(e,&quot;current&quot;)?(t.coords=this.instance.selections.current.cellRange.highlight,t.TD=this.instance.wtTable.getCell(t.coords)):c(e,&quot;wtBorder&quot;)&amp;&amp;c(e,&quot;area&quot;)&amp;&amp;this.instance.selections.area.cellRange&amp;&amp;(t.coords=this.instance.selections.area.cellRange.to,t.TD=this.instance.wtTable.getCell(t.coords)),t},window.WalkontableEvent=o},{eventManager:42,&quot;helpers/browser&quot;:44,&quot;helpers/dom/element&quot;:47,&quot;helpers/function&quot;:50}],10:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{
WalkontableColumnFilter:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t,n){this.offset=e,this.total=t,this.countTH=n};$traceurRuntime.createClass(o,{offsetted:function(e){return e+this.offset},unOffsetted:function(e){return e-this.offset},renderedToSource:function(e){return this.offsetted(e)},sourceToRendered:function(e){return this.unOffsetted(e)},offsettedTH:function(e){return e-this.countTH},unOffsettedTH:function(e){return e+this.countTH},visibleRowHeadedColumnToSourceColumn:function(e){return this.renderedToSource(this.offsettedTH(e))},sourceColumnToVisibleRowHeadedColumn:function(e){return this.unOffsettedTH(this.sourceToRendered(e))}},{}),window.WalkontableColumnFilter=o},{}],11:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableRowFilter:{get:function(){return o}},__esModule:{value:!0}});var o=function(e,t,n){this.offset=e,this.total=t,this.countTH=n};$traceurRuntime.createClass(o,{offsetted:function(e){return e+this.offset},unOffsetted:function(e){return e-this.offset},renderedToSource:function(e){return this.offsetted(e)},sourceToRendered:function(e){return this.unOffsetted(e)},offsettedTH:function(e){return e-this.countTH},unOffsettedTH:function(e){return e+this.countTH},visibleColHeadedRowToSourceRow:function(e){return this.renderedToSource(this.offsettedTH(e))},sourceRowToVisibleColHeadedRow:function(e){return this.unOffsettedTH(this.sourceToRendered(e))}},{}),window.WalkontableRowFilter=o},{}],12:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableOverlay:{get:function(){return p}},__esModule:{value:!0}});var o,r,i,s,a=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),l=a.getScrollableElement,u=a.getTrimmingContainer,c=(r=e(&quot;helpers/object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).defineGetter,d=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,h=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).eventManager,f={},p=function(e){c(this,&quot;wot&quot;,e,{writable:!1}),this.instance=this.wot,this.type=&quot;&quot;,this.mainTableScrollableElement=null,this.TABLE=this.wot.wtTable.TABLE,this.hider=this.wot.wtTable.hider,this.spreader=this.wot.wtTable.spreader,this.holder=this.wot.wtTable.holder,this.wtRootElement=this.wot.wtTable.wtRootElement,this.trimmingContainer=u(this.hider.parentNode.parentNode),this.areElementSizesAdjusted=!1,this.updateStateOfRendering()},m=p;$traceurRuntime.createClass(p,{updateStateOfRendering:function(){var e=this.needFullRender;this.needFullRender=this.shouldBeRendered();var t=e!==this.needFullRender;return t&amp;&amp;!this.needFullRender&amp;&amp;this.reset(),t},shouldBeRendered:function(){return!0},updateTrimmingContainer:function(){this.trimmingContainer=u(this.hider.parentNode.parentNode)},updateMainScrollableElement:function(){this.mainTableScrollableElement=l(this.wot.wtTable.TABLE)},makeClone:function(e){if(m.CLONE_TYPES.indexOf(e)===-1)throw new Error('Clone type &quot;'+e+'&quot; is not supported.');var t=document.createElement(&quot;DIV&quot;),n=document.createElement(&quot;TABLE&quot;);t.className=&quot;ht_clone_&quot;+e+&quot; handsontable&quot;,t.style.position=&quot;absolute&quot;,t.style.top=0,t.style.left=0,t.style.overflow=&quot;hidden&quot;,n.className=this.wot.wtTable.TABLE.className,t.appendChild(n),this.type=e,this.wot.wtTable.wtRootElement.parentNode.appendChild(t);var o=this.wot.getSetting(&quot;preventOverflow&quot;);return o===!0||&quot;horizontal&quot;===o&amp;&amp;this.type===m.CLONE_TOP||&quot;vertical&quot;===o&amp;&amp;this.type===m.CLONE_LEFT?this.mainTableScrollableElement=window:this.mainTableScrollableElement=l(this.wot.wtTable.TABLE),new Walkontable({cloneSource:this.wot,cloneOverlay:this,table:n})},refresh:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0],t=this.shouldBeRendered();this.clone&amp;&amp;(this.needFullRender||t)&amp;&amp;this.clone.draw(e),this.needFullRender=t},reset:function(){if(this.clone){var e=this.clone.wtTable.holder,t=this.clone.wtTable.hider,n=e.style,o=t.style,r=e.parentNode.style;d([n,o,r],function(e){e.width=&quot;&quot;,e.height=&quot;&quot;})}},destroy:function(){h(this.clone).destroy()}},{get CLONE_TOP(){return&quot;top&quot;},get CLONE_BOTTOM(){return&quot;bottom&quot;},get CLONE_LEFT(){return&quot;left&quot;},get CLONE_TOP_LEFT_CORNER(){return&quot;top_left_corner&quot;},get CLONE_BOTTOM_LEFT_CORNER(){return&quot;bottom_left_corner&quot;},get CLONE_DEBUG(){return&quot;debug&quot;},get CLONE_TYPES(){return[m.CLONE_TOP,m.CLONE_BOTTOM,m.CLONE_LEFT,m.CLONE_TOP_LEFT_CORNER,m.CLONE_BOTTOM_LEFT_CORNER,m.CLONE_DEBUG]},registerOverlay:function(e,t){if(m.CLONE_TYPES.indexOf(e)===-1)throw new Error(&quot;Unsupported overlay (&quot;+e+&quot;).&quot;);f[e]=t},createOverlay:function(e,t){return new f[e](t)},isOverlayTypeOf:function(e,t){return!(!e||!f[t])&amp;&amp;e instanceof f[t]}}),window.WalkontableOverlay=p},{eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/object&quot;:53}],13:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableDebugOverlay:{get:function(){return a}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).addClass,s=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).WalkontableOverlay,a=function(e){$traceurRuntime.superConstructor(l).call(this,e),this.clone=this.makeClone(s.CLONE_DEBUG),this.clone.wtTable.holder.style.opacity=.4,this.clone.wtTable.holder.style.textShadow=&quot;0 0 2px #ff0000&quot;,i(this.clone.wtTable.holder.parentNode,&quot;wtDebugVisible&quot;)},l=a;$traceurRuntime.createClass(a,{},{},s),window.WalkontableDebugOverlay=a,s.registerOverlay(s.CLONE_DEBUG,a)},{_base:12,&quot;helpers/dom/element&quot;:47}],14:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableLeftOverlay:{get:function(){return w}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),s=i.addClass,a=i.getScrollbarWidth,l=i.getScrollLeft,u=i.getWindowScrollTop,c=i.hasClass,d=i.outerWidth,h=i.innerHeight,f=i.removeClass,p=i.setOverlayPosition,m=i.resetCssTransform,g=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).WalkontableOverlay,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.clone=this.makeClone(g.CLONE_LEFT)},v=w;$traceurRuntime.createClass(w,{shouldBeRendered:function(){return!(!this.wot.getSetting(&quot;fixedColumnsLeft&quot;)&amp;&amp;!this.wot.getSetting(&quot;rowHeaders&quot;).length)},resetFixedPosition:function(){if(this.needFullRender&amp;&amp;this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=0,n=this.wot.getSetting(&quot;preventOverflow&quot;);if(this.trimmingContainer!==window||n&amp;&amp;&quot;horizontal&quot;===n)t=this.getScrollPosition(),m(e);else{var o,r,i=this.wot.wtTable.hider.getBoundingClientRect(),s=Math.ceil(i.left),a=Math.ceil(i.right);r=this.wot.wtTable.hider.style.top,r=&quot;&quot;===r?0:r,o=s&lt;0&amp;&amp;a-e.offsetWidth&gt;0?-s:0,t=o,o+=&quot;px&quot;,p(e,o,r)}this.adjustHeaderBordersPosition(t),this.adjustElementsSize()}},setScrollPosition:function(e){this.mainTableScrollableElement===window?window.scrollTo(e,u()):this.mainTableScrollableElement.scrollLeft=e},onScroll:function(){this.wot.getSetting(&quot;onScrollVertically&quot;)},sumCellSizes:function(e,t){for(var n=0,o=this.wot.wtSettings.defaultColumnWidth;e&lt;t;)n+=this.wot.wtTable.getStretchedColumnWidth(e)||o,e++;return n},adjustElementsSize:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];this.updateTrimmingContainer(),(this.needFullRender||e)&amp;&amp;(this.adjustRootElementSize(),this.adjustRootChildrenSize(),e||(this.areElementSizesAdjusted=!0))},adjustRootElementSize:function(){var e,t=this.wot.wtTable.holder,n=t.clientHeight===t.offsetHeight?0:a(),o=this.clone.wtTable.holder.parentNode,r=o.style,i=this.wot.getSetting(&quot;preventOverflow&quot;);if(this.trimmingContainer!==window||&quot;vertical&quot;===i){var s=this.wot.wtViewport.getWorkspaceHeight()-n;s=Math.min(s,h(this.wot.wtTable.wtRootElement)),r.height=s+&quot;px&quot;}else r.height=&quot;&quot;;this.clone.wtTable.holder.style.height=r.height,e=d(this.clone.wtTable.TABLE),r.width=(0===e?e:e+4)+&quot;px&quot;},adjustRootChildrenSize:function(){var e=a();this.clone.wtTable.hider.style.height=this.hider.style.height,this.clone.wtTable.holder.style.height=this.clone.wtTable.holder.parentNode.style.height,0===e&amp;&amp;(e=30),this.clone.wtTable.holder.style.width=parseInt(this.clone.wtTable.holder.parentNode.style.width,10)+e+&quot;px&quot;},applyToDOM:function(){var e=this.wot.getSetting(&quot;totalColumns&quot;);if(this.areElementSizesAdjusted||this.adjustElementsSize(),&quot;number&quot;==typeof this.wot.wtViewport.columnsRenderCalculator.startPosition)this.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+&quot;px&quot;;else{if(0!==e)throw new Error(&quot;Incorrect value of the columnsRenderCalculator&quot;);this.spreader.style.left=&quot;0&quot;}this.spreader.style.right=&quot;&quot;,this.needFullRender&amp;&amp;this.syncOverlayOffset()},syncOverlayOffset:function(){&quot;number&quot;==typeof this.wot.wtViewport.rowsRenderCalculator.startPosition?this.clone.wtTable.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+&quot;px&quot;:this.clone.wtTable.spreader.style.top=&quot;&quot;},scrollTo:function(e,t){var n=this.getTableParentOffset(),o=this.wot.cloneSource?this.wot.cloneSource:this.wot,r=o.wtTable.holder,i=0;t&amp;&amp;r.offsetWidth!==r.clientWidth&amp;&amp;(i=a()),t?(n+=this.sumCellSizes(0,e+1),n-=this.wot.wtViewport.getViewportWidth()):n+=this.sumCellSizes(this.wot.getSetting(&quot;fixedColumnsLeft&quot;),e),n+=i,this.setScrollPosition(n)},getTableParentOffset:function(){var e=this.wot.getSetting(&quot;preventOverflow&quot;),t=0;return e||this.trimmingContainer!==window||(t=this.wot.wtTable.holderOffset.left),t},getScrollPosition:function(){return l(this.mainTableScrollableElement)},adjustHeaderBordersPosition:function(e){var t=this.wot.wtTable.holder.parentNode,n=this.wot.getSetting(&quot;rowHeaders&quot;),o=this.wot.getSetting(&quot;fixedColumnsLeft&quot;),r=this.wot.getSetting(&quot;totalRows&quot;);if(r?f(t,&quot;emptyRows&quot;):s(t,&quot;emptyRows&quot;),o&amp;&amp;!n.length)s(t,&quot;innerBorderLeft&quot;);else if(!o&amp;&amp;n.length){var i=c(t,&quot;innerBorderLeft&quot;);e?s(t,&quot;innerBorderLeft&quot;):f(t,&quot;innerBorderLeft&quot;),(!i&amp;&amp;e||i&amp;&amp;!e)&amp;&amp;this.wot.wtOverlays.adjustElementsSize()}}},{},g),window.WalkontableLeftOverlay=w,g.registerOverlay(g.CLONE_LEFT,w)},{_base:12,&quot;helpers/dom/element&quot;:47}],15:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableTopOverlay:{get:function(){return w}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),s=i.addClass,a=i.getScrollbarWidth,l=i.getScrollTop,u=i.getWindowScrollLeft,c=i.hasClass,d=i.outerHeight,h=i.innerWidth,f=i.removeClass,p=i.setOverlayPosition,m=i.resetCssTransform,g=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).WalkontableOverlay,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.clone=this.makeClone(g.CLONE_TOP)},v=w;$traceurRuntime.createClass(w,{shouldBeRendered:function(){return!(!this.wot.getSetting(&quot;fixedRowsTop&quot;)&amp;&amp;!this.wot.getSetting(&quot;columnHeaders&quot;).length)},resetFixedPosition:function(){if(this.needFullRender&amp;&amp;this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=0,n=this.wot.getSetting(&quot;preventOverflow&quot;);if(this.trimmingContainer!==window||n&amp;&amp;&quot;vertical&quot;===n)t=this.getScrollPosition(),m(e);else{var o,r,i=this.wot.wtTable.hider.getBoundingClientRect(),s=Math.ceil(i.top),a=Math.ceil(i.bottom);o=this.wot.wtTable.hider.style.left,o=&quot;&quot;===o?0:o,r=s&lt;0&amp;&amp;a-e.offsetHeight&gt;0?-s:0,t=r,r+=&quot;px&quot;,p(e,o,r)}this.adjustHeaderBordersPosition(t),this.adjustElementsSize()}},setScrollPosition:function(e){this.mainTableScrollableElement===window?window.scrollTo(u(),e):this.mainTableScrollableElement.scrollTop=e},onScroll:function(){this.wot.getSetting(&quot;onScrollHorizontally&quot;)},sumCellSizes:function(e,t){for(var n=0,o=this.wot.wtSettings.settings.defaultRowHeight;e&lt;t;){var r=this.wot.wtTable.getRowHeight(e);n+=void 0===r?o:r,e++}return n},adjustElementsSize:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];this.updateTrimmingContainer(),(this.needFullRender||e)&amp;&amp;(this.adjustRootElementSize(),this.adjustRootChildrenSize(),e||(this.areElementSizesAdjusted=!0))},adjustRootElementSize:function(){var e,t=this.wot.wtTable.holder,n=t.clientWidth===t.offsetWidth?0:a(),o=this.clone.wtTable.holder.parentNode,r=o.style,i=this.wot.getSetting(&quot;preventOverflow&quot;);if(this.trimmingContainer!==window||&quot;horizontal&quot;===i){var s=this.wot.wtViewport.getWorkspaceWidth()-n;s=Math.min(s,h(this.wot.wtTable.wtRootElement)),r.width=s+&quot;px&quot;}else r.width=&quot;&quot;;this.clone.wtTable.holder.style.width=r.width,e=d(this.clone.wtTable.TABLE),r.height=(0===e?e:e+4)+&quot;px&quot;},adjustRootChildrenSize:function(){var e=a();this.clone.wtTable.hider.style.width=this.hider.style.width,this.clone.wtTable.holder.style.width=this.clone.wtTable.holder.parentNode.style.width,0===e&amp;&amp;(e=30),this.clone.wtTable.holder.style.height=parseInt(this.clone.wtTable.holder.parentNode.style.height,10)+e+&quot;px&quot;},applyToDOM:function(){var e=this.wot.getSetting(&quot;totalRows&quot;);if(this.areElementSizesAdjusted||this.adjustElementsSize(),&quot;number&quot;==typeof this.wot.wtViewport.rowsRenderCalculator.startPosition)this.spreader.style.top=this.wot.wtViewport.rowsRenderCalculator.startPosition+&quot;px&quot;;else{if(0!==e)throw new Error(&quot;Incorrect value of the rowsRenderCalculator&quot;);this.spreader.style.top=&quot;0&quot;}this.spreader.style.bottom=&quot;&quot;,this.needFullRender&amp;&amp;this.syncOverlayOffset()},syncOverlayOffset:function(){&quot;number&quot;==typeof this.wot.wtViewport.columnsRenderCalculator.startPosition?this.clone.wtTable.spreader.style.left=this.wot.wtViewport.columnsRenderCalculator.startPosition+&quot;px&quot;:this.clone.wtTable.spreader.style.left=&quot;&quot;},scrollTo:function(e,t){var n=this.getTableParentOffset(),o=this.wot.cloneSource?this.wot.cloneSource:this.wot,r=o.wtTable.holder,i=0;if(t&amp;&amp;r.offsetHeight!==r.clientHeight&amp;&amp;(i=a()),t){var s=this.wot.getSetting(&quot;fixedRowsBottom&quot;),l=(this.wot.getSetting(&quot;fixedRowsTop&quot;),this.wot.getSetting(&quot;totalRows&quot;));n+=this.sumCellSizes(0,e+1),n-=this.wot.wtViewport.getViewportHeight()-this.sumCellSizes(l-s,l),n+=1}else n+=this.sumCellSizes(this.wot.getSetting(&quot;fixedRowsTop&quot;),e);n+=i,this.setScrollPosition(n)},getTableParentOffset:function(){return this.mainTableScrollableElement===window?this.wot.wtTable.holderOffset.top:0},getScrollPosition:function(){return l(this.mainTableScrollableElement)},adjustHeaderBordersPosition:function(e){var t=this.wot.wtTable.holder.parentNode,n=this.wot.getSetting(&quot;totalColumns&quot;);if(n?f(t,&quot;emptyColumns&quot;):s(t,&quot;emptyColumns&quot;),0===this.wot.getSetting(&quot;fixedRowsTop&quot;)&amp;&amp;this.wot.getSetting(&quot;columnHeaders&quot;).length&gt;0){var o=c(t,&quot;innerBorderTop&quot;);e||0===this.wot.getSetting(&quot;totalRows&quot;)?s(t,&quot;innerBorderTop&quot;):f(t,&quot;innerBorderTop&quot;),(!o&amp;&amp;e||o&amp;&amp;!e)&amp;&amp;this.wot.wtOverlays.adjustElementsSize()}if(0===this.wot.getSetting(&quot;rowHeaders&quot;).length){var r=this.clone.wtTable.THEAD.querySelectorAll(&quot;th:nth-of-type(2)&quot;);if(r)for(var i=0;i&lt;r.length;i++)r[i].style[&quot;border-left-width&quot;]=0}}},{},g),window.WalkontableTopOverlay=w,g.registerOverlay(g.CLONE_TOP,w)},{_base:12,&quot;helpers/dom/element&quot;:47}],16:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableTopLeftCornerOverlay:{get:function(){return d}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),s=i.outerHeight,a=i.outerWidth,l=i.setOverlayPosition,u=i.resetCssTransform,c=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).WalkontableOverlay,d=function(e){$traceurRuntime.superConstructor(h).call(this,e),this.clone=this.makeClone(c.CLONE_TOP_LEFT_CORNER)},h=d;$traceurRuntime.createClass(d,{shouldBeRendered:function(){return!(!this.wot.getSetting(&quot;fixedRowsTop&quot;)&amp;&amp;!this.wot.getSetting(&quot;columnHeaders&quot;).length||!this.wot.getSetting(&quot;fixedColumnsLeft&quot;)&amp;&amp;!this.wot.getSetting(&quot;rowHeaders&quot;).length)},resetFixedPosition:function(){if(this.updateTrimmingContainer(),this.wot.wtTable.holder.parentNode){var e=this.clone.wtTable.holder.parentNode,t=s(this.clone.wtTable.TABLE),n=a(this.clone.wtTable.TABLE),o=this.wot.getSetting(&quot;preventOverflow&quot;);if(this.trimmingContainer===window){var r=this.wot.wtTable.hider.getBoundingClientRect(),i=Math.ceil(r.top),c=Math.ceil(r.left),d=Math.ceil(r.bottom),h=Math.ceil(r.right),f=&quot;0&quot;,p=&quot;0&quot;;o&amp;&amp;&quot;vertical&quot;!==o||c&lt;0&amp;&amp;h-e.offsetWidth&gt;0&amp;&amp;(f=-c+&quot;px&quot;),o&amp;&amp;&quot;horizontal&quot;!==o||i&lt;0&amp;&amp;d-e.offsetHeight&gt;0&amp;&amp;(p=-i+&quot;px&quot;),l(e,f,p)}else u(e);e.style.height=(0===t?t:t+4)+&quot;px&quot;,e.style.width=(0===n?n:n+4)+&quot;px&quot;}}},{},c),window.WalkontableTopLeftCornerOverlay=d,c.registerOverlay(c.CLONE_TOP_LEFT_CORNER,d)},{_base:12,&quot;helpers/dom/element&quot;:47}],17:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableOverlays:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),u=l.getScrollableElement,c=l.getScrollbarWidth,d=l.getScrollLeft,h=l.getScrollTop,f=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayEach,p=(i=e(&quot;helpers/unicode&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).isKey,m=(s=e(&quot;helpers/browser&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isMobileBrowser,g=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).EventManager,w=function(e){this.wot=e,this.instance=this.wot,this.eventManager=new g(this.wot),this.wot.update(&quot;scrollbarWidth&quot;,c()),this.wot.update(&quot;scrollbarHeight&quot;,c()),this.scrollableElement=u(this.wot.wtTable.TABLE),this.prepareOverlays(),this.destroyed=!1,this.keyPressed=!1,this.spreaderLastSize={width:null,height:null},this.overlayScrollPositions={master:{top:0,left:0},top:{top:null,left:0},bottom:{top:null,left:0},left:{top:0,left:null}},this.pendingScrollCallbacks={master:{top:0,left:0},top:{left:0},bottom:{left:0},left:{top:0}},this.verticalScrolling=!1,this.horizontalScrolling=!1,this.delegatedScrollCallback=!1,this.registeredListeners=[],this.registerListeners()};$traceurRuntime.createClass(w,{prepareOverlays:function(){var e=!1;return this.topOverlay?e=this.topOverlay.updateStateOfRendering()||e:this.topOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_TOP,this.wot),&quot;undefined&quot;==typeof WalkontableBottomOverlay&amp;&amp;(this.bottomOverlay={needFullRender:!1,updateStateOfRendering:function(){return!1}}),&quot;undefined&quot;==typeof WalkontableBottomLeftCornerOverlay&amp;&amp;(this.bottomLeftCornerOverlay={needFullRender:!1,updateStateOfRendering:function(){return!1}}),this.bottomOverlay?e=this.bottomOverlay.updateStateOfRendering()||e:this.bottomOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_BOTTOM,this.wot),this.leftOverlay?e=this.leftOverlay.updateStateOfRendering()||e:this.leftOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_LEFT,this.wot),this.topOverlay.needFullRender&amp;&amp;this.leftOverlay.needFullRender&amp;&amp;(this.topLeftCornerOverlay?e=this.topLeftCornerOverlay.updateStateOfRendering()||e:this.topLeftCornerOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,this.wot)),this.bottomOverlay.needFullRender&amp;&amp;this.leftOverlay.needFullRender&amp;&amp;(this.bottomLeftCornerOverlay?e=this.bottomLeftCornerOverlay.updateStateOfRendering()||e:this.bottomLeftCornerOverlay=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER,this.wot)),this.wot.getSetting(&quot;debug&quot;)&amp;&amp;!this.debug&amp;&amp;(this.debug=WalkontableOverlay.createOverlay(WalkontableOverlay.CLONE_DEBUG,this.wot)),e},refreshAll:function(){if(this.wot.drawn){if(!this.wot.wtTable.holder.parentNode)return void this.destroy();this.wot.draw(!0),this.verticalScrolling&amp;&amp;this.leftOverlay.onScroll(),this.horizontalScrolling&amp;&amp;this.topOverlay.onScroll(),this.verticalScrolling=!1,this.horizontalScrolling=!1}},registerListeners:function(){var e=this,t=this.topOverlay.mainTableScrollableElement,n=this.leftOverlay.mainTableScrollableElement,o=[];for(o.push([document.documentElement,&quot;keydown&quot;,function(t){return e.onKeyDown(t)}]),o.push([document.documentElement,&quot;keyup&quot;,function(){return e.onKeyUp()}]),o.push([document,&quot;visibilitychange&quot;,function(){return e.onKeyUp()}]),o.push([t,&quot;scroll&quot;,function(t){return e.onTableScroll(t)}]),t!==n&amp;&amp;o.push([n,&quot;scroll&quot;,function(t){return e.onTableScroll(t)}]),this.topOverlay.needFullRender&amp;&amp;(o.push([this.topOverlay.clone.wtTable.holder,&quot;scroll&quot;,function(t){return e.onTableScroll(t)}]),o.push([this.topOverlay.clone.wtTable.holder,&quot;wheel&quot;,function(t){return e.onTableScroll(t)}])),this.bottomOverlay.needFullRender&amp;&amp;(o.push([this.bottomOverlay.clone.wtTable.holder,&quot;scroll&quot;,function(t){return e.onTableScroll(t)}]),o.push([this.bottomOverlay.clone.wtTable.holder,&quot;wheel&quot;,function(t){return e.onTableScroll(t)}])),this.leftOverlay.needFullRender&amp;&amp;(o.push([this.leftOverlay.clone.wtTable.holder,&quot;scroll&quot;,function(t){return e.onTableScroll(t)}]),o.push([this.leftOverlay.clone.wtTable.holder,&quot;wheel&quot;,function(t){return e.onTableScroll(t)}])),this.topLeftCornerOverlay&amp;&amp;this.topLeftCornerOverlay.needFullRender&amp;&amp;o.push([this.topLeftCornerOverlay.clone.wtTable.holder,&quot;wheel&quot;,function(t){return e.onTableScroll(t)}]),this.bottomLeftCornerOverlay&amp;&amp;this.bottomLeftCornerOverlay.needFullRender&amp;&amp;o.push([this.bottomLeftCornerOverlay.clone.wtTable.holder,&quot;wheel&quot;,function(t){return e.onTableScroll(t)}]),this.topOverlay.trimmingContainer!==window&amp;&amp;this.leftOverlay.trimmingContainer!==window&amp;&amp;o.push([window,&quot;wheel&quot;,function(t){var n,o=t.wheelDeltaY||t.deltaY,r=t.wheelDeltaX||t.deltaX;e.topOverlay.clone.wtTable.holder.contains(t.realTarget)?n=&quot;top&quot;:e.bottomOverlay.clone&amp;&amp;e.bottomOverlay.clone.wtTable.holder.contains(t.realTarget)?n=&quot;bottom&quot;:e.leftOverlay.clone.wtTable.holder.contains(t.realTarget)?n=&quot;left&quot;:e.topLeftCornerOverlay&amp;&amp;e.topLeftCornerOverlay.clone&amp;&amp;e.topLeftCornerOverlay.clone.wtTable.holder.contains(t.realTarget)?n=&quot;topLeft&quot;:e.bottomLeftCornerOverlay&amp;&amp;e.bottomLeftCornerOverlay.clone&amp;&amp;e.bottomLeftCornerOverlay.clone.wtTable.holder.contains(t.realTarget)&amp;&amp;(n=&quot;bottomLeft&quot;),(&quot;top&quot;==n&amp;&amp;0!==o||&quot;left&quot;==n&amp;&amp;0!==r||&quot;bottom&quot;==n&amp;&amp;0!==o||(&quot;topLeft&quot;===n||&quot;bottomLeft&quot;===n)&amp;&amp;(0!==o||0!==r))&amp;&amp;t.preventDefault()}]);o.length;){var r=o.pop();this.eventManager.addEventListener(r[0],r[1],r[2]),this.registeredListeners.push(r)}},deregisterListeners:function(){for(;this.registeredListeners.length;){var e=this.registeredListeners.pop();this.eventManager.removeEventListener(e[0],e[1],e[2])}},onTableScroll:function(e){if(!m()){var t=this.leftOverlay.mainTableScrollableElement,n=this.topOverlay.mainTableScrollableElement,o=e.target;this.keyPressed&amp;&amp;(n!==window&amp;&amp;o!==window&amp;&amp;!e.target.contains(n)||t!==window&amp;&amp;o!==window&amp;&amp;!e.target.contains(t))||(&quot;scroll&quot;===e.type?this.syncScrollPositions(e):this.translateMouseWheelToScroll(e))}},onKeyDown:function(e){this.keyPressed=p(e.keyCode,&quot;ARROW_UP|ARROW_RIGHT|ARROW_DOWN|ARROW_LEFT&quot;)},onKeyUp:function(){this.keyPressed=!1},translateMouseWheelToScroll:function(e){var t=this.topOverlay.clone.wtTable.holder,n=this.bottomOverlay.clone?this.bottomOverlay.clone.wtTable.holder:null,o=this.leftOverlay.clone.wtTable.holder,r=this.topLeftCornerOverlay&amp;&amp;this.topLeftCornerOverlay.clone?this.topLeftCornerOverlay.clone.wtTable.holder:null,i=this.bottomLeftCornerOverlay&amp;&amp;this.bottomLeftCornerOverlay.clone?this.bottomLeftCornerOverlay.clone.wtTable.holder:null,s=-.2,a=e.wheelDeltaY||-1*e.deltaY,l=e.wheelDeltaX||-1*e.deltaX,u=null,c={type:&quot;wheel&quot;},d=e.target,h=null;for(1===e.deltaMode&amp;&amp;(a*=120,l*=120);d!=document&amp;&amp;null!=d;){if(d.className.indexOf(&quot;wtHolder&quot;)&gt;-1){u=d;break}d=d.parentNode}return c.target=u,u===r||u===i?(this.syncScrollPositions(c,s*l,&quot;x&quot;),this.syncScrollPositions(c,s*a,&quot;y&quot;)):(u===t||u===n?h=a:u===o&amp;&amp;(h=l),this.syncScrollPositions(c,s*h)),!1},syncScrollPositions:function(e){var t=void 0!==arguments[1]?arguments[1]:null,n=void 0!==arguments[2]?arguments[2]:null;if(!this.destroyed){if(0===arguments.length)return void this.syncScrollWithMaster();var o,r,i,s,a,l=this.leftOverlay.mainTableScrollableElement,u=this.topOverlay.mainTableScrollableElement,c=e.target,f=0,p=!1,m=!1,g=this.wot.getSetting(&quot;preventOverflow&quot;);this.topOverlay.needFullRender&amp;&amp;(o=this.topOverlay.clone.wtTable.holder),this.bottomOverlay.needFullRender&amp;&amp;(a=this.bottomOverlay.clone.wtTable.holder),this.leftOverlay.needFullRender&amp;&amp;(r=this.leftOverlay.clone.wtTable.holder),this.leftOverlay.needFullRender&amp;&amp;this.topOverlay.needFullRender&amp;&amp;(i=this.topLeftCornerOverlay.clone.wtTable.holder),this.leftOverlay.needFullRender&amp;&amp;this.bottomOverlay.needFullRender&amp;&amp;(s=this.bottomLeftCornerOverlay.clone.wtTable.holder),c===document&amp;&amp;(c=window),c===l||c===u?(f=d(g?this.scrollableElement:c),this.horizontalScrolling=!0,this.overlayScrollPositions.master.left=f,p=!0,this.pendingScrollCallbacks.master.left&gt;0?this.pendingScrollCallbacks.master.left--:(o&amp;&amp;o.scrollLeft!==f&amp;&amp;(null==t&amp;&amp;this.pendingScrollCallbacks.top.left++,o.scrollLeft=f,m=l!==window),a&amp;&amp;a.scrollLeft!==f&amp;&amp;(null==t&amp;&amp;this.pendingScrollCallbacks.bottom.left++,a.scrollLeft=f,m=l!==window)),f=h(c),this.verticalScrolling=!0,this.overlayScrollPositions.master.top=f,p=!0,this.pendingScrollCallbacks.master.top&gt;0?this.pendingScrollCallbacks.master.top--:r&amp;&amp;r.scrollTop!==f&amp;&amp;(null==t&amp;&amp;this.pendingScrollCallbacks.left.top++,r.scrollTop=f,m=u!==window)):c===a?(f=d(c),this.horizontalScrolling=!0,this.overlayScrollPositions.bottom.left=f,p=!0,this.pendingScrollCallbacks.bottom.left&gt;0?this.pendingScrollCallbacks.bottom.left--:(null==t&amp;&amp;this.pendingScrollCallbacks.master.left++,l.scrollLeft=f,o&amp;&amp;o.scrollLeft!==f&amp;&amp;(null==t&amp;&amp;this.pendingScrollCallbacks.top.left++,o.scrollLeft=f,m=u!==window)),null!==t&amp;&amp;(p=!0,u.scrollTop+=t)):c===o?(f=d(c),this.horizontalScrolling=!0,this.overlayScrollPositions.top.left=f,p=!0,this.pendingScrollCallbacks.top.left&gt;0?this.pendingScrollCallbacks.top.left--:(null==t&amp;&amp;this.pendingScrollCallbacks.master.left++,l.scrollLeft=f),null!==t&amp;&amp;(p=!0,u.scrollTop+=t),a&amp;&amp;a.scrollLeft!==f&amp;&amp;(null==t&amp;&amp;this.pendingScrollCallbacks.bottom.left++,a.scrollLeft=f,m=u!==window)):c===r?(f=h(c),this.overlayScrollPositions.left.top!==f&amp;&amp;(this.verticalScrolling=!0,this.overlayScrollPositions.left.top=f,p=!0,this.pendingScrollCallbacks.left.top&gt;0?this.pendingScrollCallbacks.left.top--:(null==t&amp;&amp;this.pendingScrollCallbacks.master.top++,u.scrollTop=f)),null!==t&amp;&amp;(p=!0,u.scrollLeft+=t)):c!==i&amp;&amp;c!==s||null!==t&amp;&amp;(p=!0,&quot;x&quot;===n?u.scrollLeft+=t:&quot;y&quot;===n&amp;&amp;(u.scrollTop+=t)),!this.keyPressed&amp;&amp;p&amp;&amp;&quot;scroll&quot;===e.type&amp;&amp;(this.delegatedScrollCallback?this.delegatedScrollCallback=!1:this.refreshAll(),m&amp;&amp;(this.delegatedScrollCallback=!0))}},syncScrollWithMaster:function(){var e=this.topOverlay.mainTableScrollableElement,t=e,n=t.scrollLeft,o=t.scrollTop;this.topOverlay.needFullRender&amp;&amp;(this.topOverlay.clone.wtTable.holder.scrollLeft=n),this.bottomOverlay.needFullRender&amp;&amp;(this.bottomOverlay.clone.wtTable.holder.scrollLeft=n),this.leftOverlay.needFullRender&amp;&amp;(this.leftOverlay.clone.wtTable.holder.scrollTop=o)},updateMainScrollableElements:function(){this.deregisterListeners(),this.leftOverlay.updateMainScrollableElement(),this.topOverlay.updateMainScrollableElement(),this.bottomOverlay.needFullRender&amp;&amp;this.bottomOverlay.updateMainScrollableElement(),this.scrollableElement=u(this.wot.wtTable.TABLE),this.registerListeners()},destroy:function(){this.eventManager.destroy(),this.topOverlay.destroy(),this.bottomOverlay.clone&amp;&amp;this.bottomOverlay.destroy(),this.leftOverlay.destroy(),this.topLeftCornerOverlay&amp;&amp;this.topLeftCornerOverlay.destroy(),this.bottomLeftCornerOverlay&amp;&amp;this.bottomLeftCornerOverlay.clone&amp;&amp;this.bottomLeftCornerOverlay.destroy(),this.debug&amp;&amp;this.debug.destroy(),this.destroyed=!0},refresh:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];if(this.topOverlay.areElementSizesAdjusted&amp;&amp;this.leftOverlay.areElementSizesAdjusted){var t=this.wot.wtTable.wtRootElement.parentNode||this.wot.wtTable.wtRootElement,n=t.clientWidth,o=t.clientHeight;n===this.spreaderLastSize.width&amp;&amp;o===this.spreaderLastSize.height||(this.spreaderLastSize.width=n,this.spreaderLastSize.height=o,this.adjustElementsSize())}this.bottomOverlay.clone&amp;&amp;this.bottomOverlay.refresh(e),this.leftOverlay.refresh(e),this.topOverlay.refresh(e),this.topLeftCornerOverlay&amp;&amp;this.topLeftCornerOverlay.refresh(e),this.bottomLeftCornerOverlay&amp;&amp;this.bottomLeftCornerOverlay.clone&amp;&amp;this.bottomLeftCornerOverlay.refresh(e),this.debug&amp;&amp;this.debug.refresh(e)},adjustElementsSize:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0],t=this.wot.getSetting(&quot;totalColumns&quot;),n=this.wot.getSetting(&quot;totalRows&quot;),o=this.wot.wtViewport.getRowHeaderWidth(),r=this.wot.wtViewport.getColumnHeaderHeight(),i=this.wot.wtTable.hider.style;i.width=o+this.leftOverlay.sumCellSizes(0,t)+&quot;px&quot;,i.height=r+this.topOverlay.sumCellSizes(0,n)+1+&quot;px&quot;,this.topOverlay.adjustElementsSize(e),this.leftOverlay.adjustElementsSize(e),this.bottomOverlay.clone&amp;&amp;this.bottomOverlay.adjustElementsSize(e)},applyToDOM:function(){this.topOverlay.areElementSizesAdjusted&amp;&amp;this.leftOverlay.areElementSizesAdjusted||this.adjustElementsSize(),this.topOverlay.applyToDOM(),this.bottomOverlay.clone&amp;&amp;this.bottomOverlay.applyToDOM(),this.leftOverlay.applyToDOM()},getParentOverlay:function(e){if(!e)return null;var t=[this.topOverlay,this.leftOverlay,this.bottomOverlay,this.topLeftCornerOverlay,this.bottomLeftCornerOverlay],n=null;return f(t,function(t,o){t&amp;&amp;t.clone&amp;&amp;t.clone.wtTable.TABLE.contains(e)&amp;&amp;(n=t.clone)}),n}},{}),window.WalkontableOverlays=w},{eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/browser&quot;:44,&quot;helpers/dom/element&quot;:47,&quot;helpers/unicode&quot;:56}],18:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableScroll:{get:function(){return p}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),s=i.innerHeight,a=i.innerWidth,l=i.getScrollLeft,u=i.getScrollTop,c=i.offset,d=(r=e(&quot;helpers/number&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),h=d.rangeEach,f=d.rangeEachReverse,p=function(e){this.wot=e,this.instance=e};$traceurRuntime.createClass(p,{scrollViewport:function(e){if(this.wot.drawn){var t=this._getVariables(),n=t.topOverlay,o=t.leftOverlay,r=t.totalRows,i=t.totalColumns,s=t.fixedRowsTop,a=t.fixedRowsBottom,l=t.fixedColumnsLeft;if(e.row&lt;0||e.row&gt;Math.max(r-1,0))throw new Error(&quot;row &quot;+e.row+&quot; does not exist&quot;);if(e.col&lt;0||e.col&gt;Math.max(i-1,0))throw new Error(&quot;column &quot;+e.col+&quot; does not exist&quot;);e.row&gt;=s&amp;&amp;e.row&lt;this.getFirstVisibleRow()?n.scrollTo(e.row):e.row&gt;this.getLastVisibleRow()&amp;&amp;e.row&lt;r-a&amp;&amp;n.scrollTo(e.row,!0),e.col&gt;=l&amp;&amp;e.col&lt;this.getFirstVisibleColumn()?o.scrollTo(e.col):e.col&gt;this.getLastVisibleColumn()&amp;&amp;o.scrollTo(e.col,!0)}},getFirstVisibleRow:function(){var e=this._getVariables(),t=e.topOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalRows,i=e.fixedRowsTop,a=n.getFirstVisibleRow();if(t.mainTableScrollableElement===window){var l=c(n.wtRootElement),d=s(n.hider),h=s(window),p=u(window);if(l.top+d-h&lt;=p){var m=o.getColumnHeaderHeight();m+=t.sumCellSizes(0,i),f(r,1,function(e){if(m+=t.sumCellSizes(e-1,e),l.top+d-m&lt;=p)return a=e,!1})}}return a},getLastVisibleRow:function(){var e=this._getVariables(),t=e.topOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalRows,i=n.getLastVisibleRow();if(t.mainTableScrollableElement===window){var a=c(n.wtRootElement),l=s(window),d=u(window);if(a.top&gt;d){var f=o.getColumnHeaderHeight();h(1,r,function(e){if(f+=t.sumCellSizes(e-1,e),a.top+f-d&gt;=l)return i=e-2,!1})}}return i},getFirstVisibleColumn:function(){var e=this._getVariables(),t=e.leftOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalColumns,i=(e.fixedColumnsLeft,n.getFirstVisibleColumn());if(t.mainTableScrollableElement===window){var s=c(n.wtRootElement),u=a(n.hider),d=a(window),h=l(window);if(s.left+u-d&lt;=h){var p=o.getRowHeaderWidth();f(r,1,function(e){if(p+=t.sumCellSizes(e-1,e),s.left+u-p&lt;=h)return i=e,!1})}}return i},getLastVisibleColumn:function(){var e=this._getVariables(),t=e.leftOverlay,n=e.wtTable,o=e.wtViewport,r=e.totalColumns,i=n.getLastVisibleColumn();if(t.mainTableScrollableElement===window){var s=c(n.wtRootElement),u=a(window),d=l(window);if(s.left&gt;d){var f=o.getRowHeaderWidth();h(1,r,function(e){if(f+=t.sumCellSizes(e-1,e),s.left+f-d&gt;=u)return i=e-2,!1})}}return i},_getVariables:function(){var e=this.wot,t=e.wtOverlays.topOverlay,n=e.wtOverlays.leftOverlay,o=e.wtTable,r=e.wtViewport,i=e.getSetting(&quot;totalRows&quot;),s=e.getSetting(&quot;totalColumns&quot;),a=e.getSetting(&quot;fixedRowsTop&quot;),l=e.getSetting(&quot;fixedRowsBottom&quot;),u=e.getSetting(&quot;fixedColumnsLeft&quot;);return{topOverlay:t,leftOverlay:n,wtTable:o,wtViewport:r,totalRows:i,totalColumns:s,fixedRowsTop:a,fixedRowsBottom:l,fixedColumnsLeft:u}}},{}),window.WalkontableScroll=p},{&quot;helpers/dom/element&quot;:47,&quot;helpers/number&quot;:52}],19:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableSelection:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=(o=e(&quot;helpers/dom/element&quot;),
o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).addClass,l=(r=e(&quot;border&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).WalkontableBorder,u=(i=e(&quot;cell/coords&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).WalkontableCellCoords,c=(s=e(&quot;cell/range&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).WalkontableCellRange,d=function(e,t){this.settings=e,this.cellRange=t||null,this.instanceBorders={}};$traceurRuntime.createClass(d,{getBorder:function(e){return this.instanceBorders[e.guid]?this.instanceBorders[e.guid]:void(this.instanceBorders[e.guid]=new l(e,this.settings))},isEmpty:function(){return null===this.cellRange},add:function(e){this.isEmpty()?this.cellRange=new c(e,e,e):this.cellRange.expand(e)},replace:function(e,t){if(!this.isEmpty()){if(this.cellRange.from.isEqual(e))return this.cellRange.from=t,!0;if(this.cellRange.to.isEqual(e))return this.cellRange.to=t,!0}return!1},clear:function(){this.cellRange=null},getCorners:function(){var e=this.cellRange.getTopLeftCorner(),t=this.cellRange.getBottomRightCorner();return[e.row,e.col,t.row,t.col]},addClassAtCoords:function(e,t,n,o){var r=e.wtTable.getCell(new u(t,n));&quot;object&quot;==typeof r&amp;&amp;a(r,o)},draw:function(e){if(this.isEmpty()){if(this.settings.border){var t=this.getBorder(e);t&amp;&amp;t.disappear()}}else{for(var n,o,r,i=e.wtTable.getRenderedRowsCount(),s=e.wtTable.getRenderedColumnsCount(),l=this.getCorners(),u=0;u&lt;s;u++)if(o=e.wtTable.columnFilter.renderedToSource(u),o&gt;=l[1]&amp;&amp;o&lt;=l[3]&amp;&amp;(r=e.wtTable.getColumnHeader(o))){var c=[];this.settings.highlightHeaderClassName&amp;&amp;c.push(this.settings.highlightHeaderClassName),this.settings.highlightColumnClassName&amp;&amp;c.push(this.settings.highlightColumnClassName),a(r,c)}for(var d=0;d&lt;i;d++){if(n=e.wtTable.rowFilter.renderedToSource(d),n&gt;=l[0]&amp;&amp;n&lt;=l[2]&amp;&amp;(r=e.wtTable.getRowHeader(n))){var h=[];this.settings.highlightHeaderClassName&amp;&amp;h.push(this.settings.highlightHeaderClassName),this.settings.highlightRowClassName&amp;&amp;h.push(this.settings.highlightRowClassName),a(r,h)}for(var f=0;f&lt;s;f++)o=e.wtTable.columnFilter.renderedToSource(f),n&gt;=l[0]&amp;&amp;n&lt;=l[2]&amp;&amp;o&gt;=l[1]&amp;&amp;o&lt;=l[3]?this.settings.className&amp;&amp;this.addClassAtCoords(e,n,o,this.settings.className):n&gt;=l[0]&amp;&amp;n&lt;=l[2]?this.settings.highlightRowClassName&amp;&amp;this.addClassAtCoords(e,n,o,this.settings.highlightRowClassName):o&gt;=l[1]&amp;&amp;o&lt;=l[3]&amp;&amp;this.settings.highlightColumnClassName&amp;&amp;this.addClassAtCoords(e,n,o,this.settings.highlightColumnClassName)}if(e.getSetting(&quot;onBeforeDrawBorders&quot;,l,this.settings.className),this.settings.border){var p=this.getBorder(e);p&amp;&amp;p.appear(l)}}}},{}),window.WalkontableSelection=d},{border:3,&quot;cell/coords&quot;:6,&quot;cell/range&quot;:7,&quot;helpers/dom/element&quot;:47}],20:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableSettings:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).fastInnerText,i=function(e,t){var n=this;this.wot=e,this.instance=e,this.defaults={table:void 0,debug:!1,externalRowCalculator:!1,stretchH:&quot;none&quot;,currentRowClassName:null,currentColumnClassName:null,preventOverflow:function(){return!1},data:void 0,fixedColumnsLeft:0,fixedRowsTop:0,fixedRowsBottom:0,minSpareRows:0,rowHeaders:function(){return[]},columnHeaders:function(){return[]},totalRows:void 0,totalColumns:void 0,cellRenderer:function(e,t,o){var i=n.getSetting(&quot;data&quot;,e,t);r(o,void 0===i||null===i?&quot;&quot;:i)},columnWidth:function(e){},rowHeight:function(e){},defaultRowHeight:23,defaultColumnWidth:50,selections:null,hideBorderOnMouseDownOver:!1,viewportRowCalculatorOverride:null,viewportColumnCalculatorOverride:null,onCellMouseDown:null,onCellMouseOver:null,onCellMouseUp:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,onBeforeDrawBorders:null,onScrollVertically:null,onScrollHorizontally:null,onBeforeTouchScroll:null,onAfterMomentumScroll:null,onBeforeStretchingColumnWidth:function(e){return e},onModifyRowHeaderWidth:null,scrollbarWidth:10,scrollbarHeight:10,renderAllRows:!1,groups:!1,rowHeaderWidth:null,columnHeaderHeight:null,headerClassName:null},this.settings={};for(var o in this.defaults)if(this.defaults.hasOwnProperty(o))if(void 0!==t[o])this.settings[o]=t[o];else{if(void 0===this.defaults[o])throw new Error('A required setting &quot;'+o+'&quot; was not provided');this.settings[o]=this.defaults[o]}};$traceurRuntime.createClass(i,{update:function(e,t){if(void 0===t)for(var n in e)e.hasOwnProperty(n)&amp;&amp;(this.settings[n]=e[n]);else this.settings[e]=t;return this.wot},getSetting:function(e,t,n,o,r){return&quot;function&quot;==typeof this.settings[e]?this.settings[e](t,n,o,r):void 0!==t&amp;&amp;Array.isArray(this.settings[e])?this.settings[e][t]:this.settings[e]},has:function(e){return!!this.settings[e]}},{}),window.WalkontableSettings=i},{&quot;helpers/dom/element&quot;:47}],21:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableTable:{get:function(){return S}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}),d=c.getStyle,h=c.getTrimmingContainer,f=c.hasClass,p=c.index,m=c.offset,g=c.removeClass,w=c.removeTextNodes,v=c.overlayContainsElement,y=c.closest,b=(r=e(&quot;helpers/function&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).isFunction,C=(i=e(&quot;cell/coords&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).WalkontableCellCoords,_=((s=e(&quot;cell/range&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).WalkontableCellRange,(a=e(&quot;filter/column&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableColumnFilter),R=(l=e(&quot;filter/row&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).WalkontableRowFilter,M=(u=e(&quot;tableRenderer&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).WalkontableTableRenderer,S=function(e,t){var n=this;this.wot=e,this.instance=this.wot,this.TABLE=t,this.TBODY=null,this.THEAD=null,this.COLGROUP=null,this.tableOffset=0,this.holderOffset=0,w(this.TABLE),this.spreader=this.createSpreader(this.TABLE),this.hider=this.createHider(this.spreader),this.holder=this.createHolder(this.hider),this.wtRootElement=this.holder.parentNode,this.alignOverlaysWithTrimmingContainer(),this.fixTableDomTree(),this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length,this.rowFilter=null,this.columnFilter=null,this.correctHeaderWidth=!1;var o=this.wot.wtSettings.settings.rowHeaderWidth;this.wot.wtSettings.settings.rowHeaderWidth=function(){return n._modifyRowHeaderWidth(o)}};$traceurRuntime.createClass(S,{fixTableDomTree:function(){this.TBODY=this.TABLE.querySelector(&quot;tbody&quot;),this.TBODY||(this.TBODY=document.createElement(&quot;tbody&quot;),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.querySelector(&quot;thead&quot;),this.THEAD||(this.THEAD=document.createElement(&quot;thead&quot;),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.querySelector(&quot;colgroup&quot;),this.COLGROUP||(this.COLGROUP=document.createElement(&quot;colgroup&quot;),this.TABLE.insertBefore(this.COLGROUP,this.THEAD)),this.wot.getSetting(&quot;columnHeaders&quot;).length&amp;&amp;!this.THEAD.childNodes.length&amp;&amp;this.THEAD.appendChild(document.createElement(&quot;TR&quot;))},createSpreader:function(e){var t,n=e.parentNode;return n&amp;&amp;1===n.nodeType&amp;&amp;f(n,&quot;wtHolder&quot;)||(t=document.createElement(&quot;div&quot;),t.className=&quot;wtSpreader&quot;,n&amp;&amp;n.insertBefore(t,e),t.appendChild(e)),t.style.position=&quot;relative&quot;,t},createHider:function(e){var t,n=e.parentNode;return n&amp;&amp;1===n.nodeType&amp;&amp;f(n,&quot;wtHolder&quot;)||(t=document.createElement(&quot;div&quot;),t.className=&quot;wtHider&quot;,n&amp;&amp;n.insertBefore(t,e),t.appendChild(e)),t},createHolder:function(e){var t,n=e.parentNode;return n&amp;&amp;1===n.nodeType&amp;&amp;f(n,&quot;wtHolder&quot;)||(t=document.createElement(&quot;div&quot;),t.style.position=&quot;relative&quot;,t.className=&quot;wtHolder&quot;,n&amp;&amp;n.insertBefore(t,e),this.isWorkingOnClone()||(t.parentNode.className+=&quot;ht_master handsontable&quot;),t.appendChild(e)),t},alignOverlaysWithTrimmingContainer:function(){var e=h(this.wtRootElement);if(!this.isWorkingOnClone())if(this.holder.parentNode.style.position=&quot;relative&quot;,e===window){var t=this.wot.getSetting(&quot;preventOverflow&quot;);t||(this.holder.style.overflow=&quot;visible&quot;,this.wtRootElement.style.overflow=&quot;visible&quot;)}else this.holder.style.width=d(e,&quot;width&quot;),this.holder.style.height=d(e,&quot;height&quot;),this.holder.style.overflow=&quot;&quot;},isWorkingOnClone:function(){return!!this.wot.cloneSource},draw:function(e){var t=this.wot,n=t.wtOverlays,o=t.wtViewport,r=this.instance.getSetting(&quot;totalRows&quot;),i=this.wot.getSetting(&quot;rowHeaders&quot;).length,s=this.wot.getSetting(&quot;columnHeaders&quot;).length,a=!1;if(!this.isWorkingOnClone()&amp;&amp;(this.holderOffset=m(this.holder),e=o.createRenderCalculators(e),i&amp;&amp;!this.wot.getSetting(&quot;fixedColumnsLeft&quot;))){var l=n.leftOverlay.getScrollPosition(),u=this.correctHeaderWidth;this.correctHeaderWidth=l&gt;0,u!==this.correctHeaderWidth&amp;&amp;(e=!1)}if(this.isWorkingOnClone()||(a=n.prepareOverlays()),e)this.isWorkingOnClone()||o.createVisibleCalculators(),n&amp;&amp;n.refresh(!0);else{this.isWorkingOnClone()?this.tableOffset=this.wot.cloneSource.wtTable.tableOffset:this.tableOffset=m(this.TABLE);var c;c=WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_DEBUG)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP_LEFT_CORNER)?0:WalkontableOverlay.isOverlayTypeOf(this.instance.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM)||WalkontableOverlay.isOverlayTypeOf(this.instance.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER)?Math.max(r-this.wot.getSetting(&quot;fixedRowsBottom&quot;),0):o.rowsRenderCalculator.startRow;var d;d=WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_DEBUG)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_LEFT)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_TOP_LEFT_CORNER)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER)?0:o.columnsRenderCalculator.startColumn,this.rowFilter=new R(c,r,s),this.columnFilter=new _(d,this.wot.getSetting(&quot;totalColumns&quot;),i),this.alignOverlaysWithTrimmingContainer(),this._doDraw()}return this.refreshSelections(e),this.isWorkingOnClone()||(n.topOverlay.resetFixedPosition(),n.bottomOverlay.clone&amp;&amp;n.bottomOverlay.resetFixedPosition(),n.leftOverlay.resetFixedPosition(),n.topLeftCornerOverlay&amp;&amp;n.topLeftCornerOverlay.resetFixedPosition(),n.bottomLeftCornerOverlay&amp;&amp;n.bottomLeftCornerOverlay.clone&amp;&amp;n.bottomLeftCornerOverlay.resetFixedPosition()),a&amp;&amp;n.syncScrollWithMaster(),this.wot.drawn=!0,this},_doDraw:function(){var e=new M(this);e.render()},removeClassFromCells:function(e){for(var t=this.TABLE.querySelectorAll(&quot;.&quot;+e),n=0,o=t.length;n&lt;o;n++)g(t[n],e)},refreshSelections:function(e){if(this.wot.selections){var t=this.wot.selections.length;if(e)for(var n=0;n&lt;t;n++)this.wot.selections[n].settings.className&amp;&amp;this.removeClassFromCells(this.wot.selections[n].settings.className),this.wot.selections[n].settings.highlightHeaderClassName&amp;&amp;this.removeClassFromCells(this.wot.selections[n].settings.highlightHeaderClassName),this.wot.selections[n].settings.highlightRowClassName&amp;&amp;this.removeClassFromCells(this.wot.selections[n].settings.highlightRowClassName),this.wot.selections[n].settings.highlightColumnClassName&amp;&amp;this.removeClassFromCells(this.wot.selections[n].settings.highlightColumnClassName);for(var o=0;o&lt;t;o++)this.wot.selections[o].draw(this.wot,e)}},getCell:function(e){if(this.isRowBeforeRenderedRows(e.row))return-1;if(this.isRowAfterRenderedRows(e.row))return-2;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e.row)];return t?t.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e.col)]:void 0},getColumnHeader:function(e){var t=void 0!==arguments[1]?arguments[1]:0,n=this.THEAD.childNodes[t];if(n)return n.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e)]},getRowHeader:function(e){if(0===this.columnFilter.sourceColumnToVisibleRowHeadedColumn(0))return null;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)];return t?t.childNodes[0]:void 0},getCoords:function(e){&quot;TD&quot;!==e.nodeName&amp;&amp;&quot;TH&quot;!==e.nodeName&amp;&amp;(e=y(e,[&quot;TD&quot;,&quot;TH&quot;]));var t=e.parentNode,n=t.parentNode,o=p(t),r=e.cellIndex;return v(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,e)||v(WalkontableOverlay.CLONE_TOP,e)?&quot;THEAD&quot;===n.nodeName&amp;&amp;(o-=n.childNodes.length):o=n===this.THEAD?this.rowFilter.visibleColHeadedRowToSourceRow(o):this.rowFilter.renderedToSource(o),r=v(WalkontableOverlay.CLONE_TOP_LEFT_CORNER,e)||v(WalkontableOverlay.CLONE_LEFT,e)?this.columnFilter.offsettedTH(r):this.columnFilter.visibleRowHeadedColumnToSourceColumn(r),new C(o,r)},getTrForRow:function(e){return this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)]},getFirstRenderedRow:function(){return this.wot.wtViewport.rowsRenderCalculator.startRow},getFirstVisibleRow:function(){return this.wot.wtViewport.rowsVisibleCalculator.startRow},getFirstRenderedColumn:function(){return this.wot.wtViewport.columnsRenderCalculator.startColumn},getFirstVisibleColumn:function(){return this.wot.wtViewport.columnsVisibleCalculator.startColumn},getLastRenderedRow:function(){return this.wot.wtViewport.rowsRenderCalculator.endRow},getLastVisibleRow:function(){return this.wot.wtViewport.rowsVisibleCalculator.endRow},getLastRenderedColumn:function(){return this.wot.wtViewport.columnsRenderCalculator.endColumn},getLastVisibleColumn:function(){return this.wot.wtViewport.columnsVisibleCalculator.endColumn},isRowBeforeRenderedRows:function(e){return this.rowFilter&amp;&amp;this.rowFilter.sourceToRendered(e)&lt;0&amp;&amp;e&gt;=0},isRowAfterViewport:function(e){return this.rowFilter&amp;&amp;this.rowFilter.sourceToRendered(e)&gt;this.getLastVisibleRow()},isRowAfterRenderedRows:function(e){return this.rowFilter&amp;&amp;this.rowFilter.sourceToRendered(e)&gt;this.getLastRenderedRow()},isColumnBeforeViewport:function(e){return this.columnFilter&amp;&amp;this.columnFilter.sourceToRendered(e)&lt;0&amp;&amp;e&gt;=0},isColumnAfterViewport:function(e){return this.columnFilter&amp;&amp;this.columnFilter.sourceToRendered(e)&gt;this.getLastVisibleColumn()},isLastRowFullyVisible:function(){return this.getLastVisibleRow()===this.getLastRenderedRow()},isLastColumnFullyVisible:function(){return this.getLastVisibleColumn()===this.getLastRenderedColumn()},getRenderedColumnsCount:function(){var e=this.wot.wtViewport.columnsRenderCalculator.count,t=this.wot.getSetting(&quot;totalColumns&quot;);if(this.wot.isOverlayName(WalkontableOverlay.CLONE_DEBUG))e=t;else if(this.wot.isOverlayName(WalkontableOverlay.CLONE_LEFT)||this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP_LEFT_CORNER)||this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))return Math.min(this.wot.getSetting(&quot;fixedColumnsLeft&quot;),t);return e},getRenderedRowsCount:function(){var e=this.wot.wtViewport.rowsRenderCalculator.count,t=this.wot.getSetting(&quot;totalRows&quot;);return this.wot.isOverlayName(WalkontableOverlay.CLONE_DEBUG)?e=t:this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP)||this.wot.isOverlayName(WalkontableOverlay.CLONE_TOP_LEFT_CORNER)?e=Math.min(this.wot.getSetting(&quot;fixedRowsTop&quot;),t):(this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))&amp;&amp;(e=Math.min(this.wot.getSetting(&quot;fixedRowsBottom&quot;),t)),e},getVisibleRowsCount:function(){return this.wot.wtViewport.rowsVisibleCalculator.count},allRowsInViewport:function(){return this.wot.getSetting(&quot;totalRows&quot;)==this.getVisibleRowsCount()},getRowHeight:function(e){var t=this.wot.wtSettings.settings.rowHeight(e),n=this.wot.wtViewport.oversizedRows[e];return void 0!==n&amp;&amp;(t=void 0===t?n:Math.max(t,n)),t},getColumnHeaderHeight:function(e){var t=this.wot.wtSettings.settings.defaultRowHeight,n=this.wot.wtViewport.oversizedColumnHeaders[e];return void 0!==n&amp;&amp;(t=t?Math.max(t,n):n),t},getVisibleColumnsCount:function(){return this.wot.wtViewport.columnsVisibleCalculator.count},allColumnsInViewport:function(){return this.wot.getSetting(&quot;totalColumns&quot;)==this.getVisibleColumnsCount()},getColumnWidth:function(e){var t=this.wot.wtSettings.settings.columnWidth;return&quot;function&quot;==typeof t?t=t(e):&quot;object&quot;==typeof t&amp;&amp;(t=t[e]),t||this.wot.wtSettings.settings.defaultColumnWidth},getStretchedColumnWidth:function(e){var t=this.getColumnWidth(e),n=null==t?this.instance.wtSettings.settings.defaultColumnWidth:t,o=this.wot.wtViewport.columnsRenderCalculator;if(o){var r=o.getStretchedColumnWidth(e,n);r&amp;&amp;(n=r)}return n},_modifyRowHeaderWidth:function(e){var t=b(e)?e():null;return Array.isArray(t)?(t=$traceurRuntime.spread(t),t[t.length-1]=this._correctRowHeaderWidth(t[t.length-1])):t=this._correctRowHeaderWidth(t),t},_correctRowHeaderWidth:function(e){return&quot;number&quot;!=typeof e&amp;&amp;(e=this.wot.getSetting(&quot;defaultColumnWidth&quot;)),this.correctHeaderWidth&amp;&amp;e++,e}},{}),window.WalkontableTable=S},{&quot;cell/coords&quot;:6,&quot;cell/range&quot;:7,&quot;filter/column&quot;:10,&quot;filter/row&quot;:11,&quot;helpers/dom/element&quot;:47,&quot;helpers/function&quot;:50,tableRenderer:22}],22:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n=document.createElement(&quot;TH&quot;);return t.insertBefore(n,e),t.removeChild(e),n}function r(e,t){var n=document.createElement(&quot;TD&quot;);return t.insertBefore(n,e),t.removeChild(e),n}Object.defineProperties(n,{WalkontableTableRenderer:{get:function(){return p}},__esModule:{value:!0}});var i,s=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),a=s.addClass,l=s.empty,u=s.getScrollbarWidth,c=s.hasClass,d=s.innerHeight,h=s.outerWidth,f=!1,p=function(e){this.wtTable=e,this.wot=e.instance,this.instance=e.instance,this.rowFilter=e.rowFilter,this.columnFilter=e.columnFilter,this.TABLE=e.TABLE,this.THEAD=e.THEAD,this.TBODY=e.TBODY,this.COLGROUP=e.COLGROUP,this.rowHeaders=[],this.rowHeaderCount=0,this.columnHeaders=[],this.columnHeaderCount=0,this.fixedRowsTop=0,this.fixedRowsBottom=0};$traceurRuntime.createClass(p,{render:function(){if(!this.wtTable.isWorkingOnClone()){var e={};if(this.wot.getSetting(&quot;beforeDraw&quot;,!0,e),e.skipRender===!0)return}this.rowHeaders=this.wot.getSetting(&quot;rowHeaders&quot;),this.rowHeaderCount=this.rowHeaders.length,this.fixedRowsTop=this.wot.getSetting(&quot;fixedRowsTop&quot;),this.fixedRowsBottom=this.wot.getSetting(&quot;fixedRowsBottom&quot;),this.columnHeaders=this.wot.getSetting(&quot;columnHeaders&quot;),this.columnHeaderCount=this.columnHeaders.length;var t,n=this.wtTable.getRenderedColumnsCount(),o=this.wtTable.getRenderedRowsCount(),r=this.wot.getSetting(&quot;totalColumns&quot;),i=this.wot.getSetting(&quot;totalRows&quot;),s=!1;if((WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM)||WalkontableOverlay.isOverlayTypeOf(this.wot.cloneOverlay,WalkontableOverlay.CLONE_BOTTOM_LEFT_CORNER))&amp;&amp;(this.columnHeaders=[],this.columnHeaderCount=0),r&gt;=0&amp;&amp;(this.adjustAvailableNodes(),s=!0,this.renderColumnHeaders(),this.renderRows(i,o,n),this.wtTable.isWorkingOnClone()||(t=this.wot.wtViewport.getWorkspaceWidth(),this.wot.wtViewport.containerWidth=null),this.adjustColumnWidths(n),this.markOversizedColumnHeaders(),this.adjustColumnHeaderHeights()),s||this.adjustAvailableNodes(),this.removeRedundantRows(o),this.wtTable.isWorkingOnClone()&amp;&amp;!this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.markOversizedRows(),this.wtTable.isWorkingOnClone())this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)&amp;&amp;this.wot.cloneSource.wtOverlays.adjustElementsSize();else{this.wot.wtViewport.createVisibleCalculators(),this.wot.wtOverlays.refresh(!1),this.wot.wtOverlays.applyToDOM();var a=h(this.wtTable.hider),l=h(this.wtTable.TABLE);if(0!==a&amp;&amp;l!==a&amp;&amp;this.adjustColumnWidths(n),t!==this.wot.wtViewport.getWorkspaceWidth()){this.wot.wtViewport.containerWidth=null;var u=this.wtTable.getFirstRenderedColumn(),c=this.wtTable.getLastRenderedColumn(),d=this.wot.getSetting(&quot;defaultColumnWidth&quot;),f=this.wot.getSetting(&quot;rowHeaderWidth&quot;);if(f=this.instance.getSetting(&quot;onModifyRowHeaderWidth&quot;,f),null!=f)for(var p=0;p&lt;this.rowHeaderCount;p++){var m=Array.isArray(f)?f[p]:f;m=null==m?d:m,this.COLGROUP.childNodes[p].style.width=m+&quot;px&quot;}for(var g=u;g&lt;c;g++){var w=this.wtTable.getStretchedColumnWidth(g),v=this.columnFilter.sourceToRendered(g);this.COLGROUP.childNodes[v+this.rowHeaderCount].style.width=w+&quot;px&quot;}}this.wot.getSetting(&quot;onDraw&quot;,!0)}},removeRedundantRows:function(e){for(;this.wtTable.tbodyChildrenLength&gt;e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--},renderRows:function(e,t,n){for(var o,r,i=0,s=this.rowFilter.renderedToSource(i),a=this.wtTable.isWorkingOnClone();s&lt;e&amp;&amp;s&gt;=0&amp;&amp;(!f&amp;&amp;i&gt;1e3&amp;&amp;(f=!0,console.warn('Performance tip: Handsontable rendered more than 1000 visible rows. Consider limiting the number of rendered rows by specifying the table height and/or turning off the &quot;renderAllRows&quot; option.')),void 0===t||i!==t);){if(r=this.getOrCreateTrForRow(i,r),this.renderRowHeaders(s,r),this.adjustColumns(r,n+this.rowHeaderCount),o=this.renderCells(s,r,n),a&amp;&amp;!this.wot.isOverlayName(WalkontableOverlay.CLONE_BOTTOM)||this.resetOversizedRow(s),r.firstChild){var l=this.wot.wtTable.getRowHeight(s);l?(l--,r.firstChild.style.height=l+&quot;px&quot;):r.firstChild.style.height=&quot;&quot;}i++,s=this.rowFilter.renderedToSource(i)}},resetOversizedRow:function(e){this.wot.getSetting(&quot;externalRowCalculator&quot;)||this.wot.wtViewport.oversizedRows&amp;&amp;this.wot.wtViewport.oversizedRows[e]&amp;&amp;(this.wot.wtViewport.oversizedRows[e]=void 0)},markOversizedRows:function(){if(!this.wot.getSetting(&quot;externalRowCalculator&quot;)){var e,t,n,o,r,i=this.instance.wtTable.TBODY.childNodes.length,s=i*this.instance.wtSettings.settings.defaultRowHeight,a=d(this.instance.wtTable.TBODY)-1;this.instance.getSetting(&quot;totalRows&quot;);if(s!==a||this.instance.getSetting(&quot;fixedRowsBottom&quot;))for(;i;)i--,n=this.instance.wtTable.rowFilter.renderedToSource(i),e=this.instance.wtTable.getRowHeight(n),o=this.instance.wtTable.getTrForRow(n),r=o.querySelector(&quot;th&quot;),t=r?d(r):d(o)-1,(!e&amp;&amp;this.instance.wtSettings.settings.defaultRowHeight&lt;t||e&lt;t)&amp;&amp;(this.instance.wtViewport.oversizedRows[n]=++t)}},markOversizedColumnHeaders:function(){var e=this.wot.getOverlayName();if(this.columnHeaderCount&amp;&amp;!this.wot.wtViewport.hasOversizedColumnHeadersMarked[e]&amp;&amp;!this.wtTable.isWorkingOnClone()){for(var t=this.wtTable.getRenderedColumnsCount(),n=0;n&lt;this.columnHeaderCount;n++)for(var o=-1*this.rowHeaderCount;o&lt;t;o++)this.markIfOversizedColumnHeader(o);this.wot.wtViewport.hasOversizedColumnHeadersMarked[e]=!0}},adjustColumnHeaderHeights:function(){for(var e=this.wot.getSetting(&quot;columnHeaders&quot;),t=this.wot.wtTable.THEAD.childNodes,n=this.wot.wtViewport.oversizedColumnHeaders,o=0,r=e.length;o&lt;r;o++)if(n[o]){if(!t[o]||0===t[o].childNodes.length)return;t[o].childNodes[0].style.height=n[o]+&quot;px&quot;}},markIfOversizedColumnHeader:function(e){for(var t,n,o,r=this.wot.wtTable.columnFilter.renderedToSource(e),i=this.columnHeaderCount,s=this.wot.wtSettings.settings.defaultRowHeight,a=this.wot.getSetting(&quot;columnHeaderHeight&quot;)||[];i;)i--,t=this.wot.wtTable.getColumnHeaderHeight(i),n=this.wot.wtTable.getColumnHeader(r,i),n&amp;&amp;(o=d(n),(!t&amp;&amp;s&lt;o||t&lt;o)&amp;&amp;(this.wot.wtViewport.oversizedColumnHeaders[i]=o),Array.isArray(a)?null!=a[i]&amp;&amp;(this.wot.wtViewport.oversizedColumnHeaders[i]=a[i]):isNaN(a)||(this.wot.wtViewport.oversizedColumnHeaders[i]=a),this.wot.wtViewport.oversizedColumnHeaders[i]&lt;(a[i]||a)&amp;&amp;(this.wot.wtViewport.oversizedColumnHeaders[i]=a[i]||a))},renderCells:function(e,t,n){for(var o,i,s=0;s&lt;n;s++)i=this.columnFilter.renderedToSource(s),o=0===s?t.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(i)]:o.nextSibling,&quot;TH&quot;==o.nodeName&amp;&amp;(o=r(o,t)),c(o,&quot;hide&quot;)||(o.className=&quot;&quot;),o.removeAttribute(&quot;style&quot;),this.wot.wtSettings.settings.cellRenderer(e,i,o);return o},adjustColumnWidths:function(e){var t=0,n=this.wot.cloneSource?this.wot.cloneSource:this.wot,o=n.wtTable.holder,r=this.wot.getSetting(&quot;defaultColumnWidth&quot;),i=this.wot.getSetting(&quot;rowHeaderWidth&quot;);if(o.offsetHeight&lt;o.scrollHeight&amp;&amp;(t=u()),this.wot.wtViewport.columnsRenderCalculator.refreshStretching(this.wot.wtViewport.getViewportWidth()-t),i=this.instance.getSetting(&quot;onModifyRowHeaderWidth&quot;,i),null!=i)for(var s=0;s&lt;this.rowHeaderCount;s++){var a=Array.isArray(i)?i[s]:i;a=null==a?r:a,this.COLGROUP.childNodes[s].style.width=a+&quot;px&quot;}for(var l=0;l&lt;e;l++){var c=this.wtTable.getStretchedColumnWidth(this.columnFilter.renderedToSource(l));this.COLGROUP.childNodes[l+this.rowHeaderCount].style.width=c+&quot;px&quot;}},appendToTbody:function(e){this.TBODY.appendChild(e),this.wtTable.tbodyChildrenLength++},getOrCreateTrForRow:function(e,t){var n;return e&gt;=this.wtTable.tbodyChildrenLength?(n=this.createRow(),this.appendToTbody(n)):n=0===e?this.TBODY.firstChild:t.nextSibling,n.className&amp;&amp;n.removeAttribute(&quot;class&quot;),n},createRow:function(){for(var e=document.createElement(&quot;TR&quot;),t=0;t&lt;this.rowHeaderCount;t++)e.appendChild(document.createElement(&quot;TH&quot;));return e},renderRowHeader:function(e,t,n){n.className=&quot;&quot;,n.removeAttribute(&quot;style&quot;),this.rowHeaders[t](e,n,t)},renderRowHeaders:function(e,t){for(var n=t.firstChild,r=0;r&lt;this.rowHeaderCount;r++)n?&quot;TD&quot;==n.nodeName&amp;&amp;(n=o(n,t)):(n=document.createElement(&quot;TH&quot;),t.appendChild(n)),this.renderRowHeader(e,r,n),n=n.nextSibling},adjustAvailableNodes:function(){this.adjustColGroups(),this.adjustThead()},renderColumnHeaders:function(){if(this.columnHeaderCount)for(var e=this.wtTable.getRenderedColumnsCount(),t=0;t&lt;this.columnHeaderCount;t++)for(var n=this.getTrForColumnHeaders(t),o=-1*this.rowHeaderCount;o&lt;e;o++){var r=this.columnFilter.renderedToSource(o);this.renderColumnHeader(t,r,n.childNodes[o+this.rowHeaderCount])}},adjustColGroups:function(){for(var e=this.wtTable.getRenderedColumnsCount();this.wtTable.colgroupChildrenLength&lt;e+this.rowHeaderCount;)this.COLGROUP.appendChild(document.createElement(&quot;COL&quot;)),this.wtTable.colgroupChildrenLength++;for(;this.wtTable.colgroupChildrenLength&gt;e+this.rowHeaderCount;)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.wtTable.colgroupChildrenLength--;this.rowHeaderCount&amp;&amp;a(this.COLGROUP.childNodes[0],&quot;rowHeader&quot;)},adjustThead:function(){var e=this.wtTable.getRenderedColumnsCount(),t=this.THEAD.firstChild;if(this.columnHeaders.length){for(var n=0,o=this.columnHeaders.length;n&lt;o;n++){for(t=this.THEAD.childNodes[n],t||(t=document.createElement(&quot;TR&quot;),this.THEAD.appendChild(t)),this.theadChildrenLength=t.childNodes.length;this.theadChildrenLength&lt;e+this.rowHeaderCount;)t.appendChild(document.createElement(&quot;TH&quot;)),this.theadChildrenLength++;for(;this.theadChildrenLength&gt;e+this.rowHeaderCount;)t.removeChild(t.lastChild),this.theadChildrenLength--}var r=this.THEAD.childNodes.length;if(r&gt;this.columnHeaders.length)for(var i=this.columnHeaders.length;i&lt;r;i++)this.THEAD.removeChild(this.THEAD.lastChild)}else t&amp;&amp;l(t)},getTrForColumnHeaders:function(e){return this.THEAD.childNodes[e]},renderColumnHeader:function(e,t,n){return n.className=&quot;&quot;,n.removeAttribute(&quot;style&quot;),this.columnHeaders[e](t,n,e)},adjustColumns:function(e,t){for(var n=e.childNodes.length;n&lt;t;){var o=document.createElement(&quot;TD&quot;);e.appendChild(o),n++}for(;n&gt;t;)e.removeChild(e.lastChild),n--},removeRedundantColumns:function(e){for(;this.wtTable.tbodyChildrenLength&gt;e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--}},{}),window.WalkontableTableRenderer=p},{&quot;helpers/dom/element&quot;:47}],23:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{WalkontableViewport:{get:function(){return b}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),d=c.getScrollbarWidth,h=(c.getScrollTop,c.getStyle),f=c.offset,p=c.outerHeight,m=c.outerWidth,g=(i=e(&quot;helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).objectEach,w=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).EventManager,v=(a=e(&quot;calculator/viewportColumns&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableViewportColumnsCalculator,y=(l=e(&quot;calculator/viewportRows&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).WalkontableViewportRowsCalculator,b=function(e){var t=this;this.wot=e,this.instance=this.wot,this.oversizedRows=[],this.oversizedColumnHeaders=[],this.hasOversizedColumnHeadersMarked={},this.clientHeight=0,this.containerWidth=NaN,this.rowHeaderWidth=NaN,this.rowsVisibleCalculator=null,this.columnsVisibleCalculator=null,this.eventManager=new w(this.wot),this.eventManager.addEventListener(window,&quot;resize&quot;,function(){t.clientHeight=t.getWorkspaceHeight()})};$traceurRuntime.createClass(b,{getWorkspaceHeight:function(){var e,t=this.instance.wtOverlays.topOverlay.trimmingContainer,n=0;return t===window?n=document.documentElement.clientHeight:(e=p(t),n=e&gt;0&amp;&amp;t.clientHeight&gt;0?t.clientHeight:1/0),n},getWorkspaceWidth:function(){var e,t,n=this.wot.getSetting(&quot;totalColumns&quot;),o=this.instance.wtOverlays.leftOverlay.trimmingContainer,r=this.wot.getSetting(&quot;stretchH&quot;),i=document.documentElement.offsetWidth,s=this.wot.getSetting(&quot;preventOverflow&quot;);return s?m(this.instance.wtTable.wtRootElement):(e=u.freezeOverlays?Math.min(i-this.getWorkspaceOffset().left,i):Math.min(this.getContainerFillWidth(),i-this.getWorkspaceOffset().left,i),o===window&amp;&amp;n&gt;0&amp;&amp;this.sumColumnWidths(0,n-1)&gt;e?document.documentElement.clientWidth:o!==window&amp;&amp;(t=h(this.instance.wtOverlays.leftOverlay.trimmingContainer,&quot;overflow&quot;),&quot;scroll&quot;==t||&quot;hidden&quot;==t||&quot;auto&quot;==t)?Math.max(e,o.clientWidth):&quot;none&quot;!==r&amp;&amp;r?e:Math.max(e,m(this.instance.wtTable.TABLE)))},hasVerticalScroll:function(){return this.getWorkspaceActualHeight()&gt;this.getWorkspaceHeight()},hasHorizontalScroll:function(){return this.getWorkspaceActualWidth()&gt;this.getWorkspaceWidth()},sumColumnWidths:function(e,t){for(var n=0;e&lt;t;)n+=this.wot.wtTable.getColumnWidth(e),e++;return n},getContainerFillWidth:function(){if(this.containerWidth)return this.containerWidth;var e,t,n=this.instance.wtTable.holder;return t=document.createElement(&quot;div&quot;),t.style.width=&quot;100%&quot;,t.style.height=&quot;1px&quot;,n.appendChild(t),e=t.offsetWidth,this.containerWidth=e,n.removeChild(t),e},getWorkspaceOffset:function(){return f(this.wot.wtTable.TABLE)},getWorkspaceActualHeight:function(){return p(this.wot.wtTable.TABLE)},getWorkspaceActualWidth:function(){return m(this.wot.wtTable.TABLE)||m(this.wot.wtTable.TBODY)||m(this.wot.wtTable.THEAD)},getColumnHeaderHeight:function(){return isNaN(this.columnHeaderHeight)&amp;&amp;(this.columnHeaderHeight=p(this.wot.wtTable.THEAD)),this.columnHeaderHeight},getViewportHeight:function(){var e,t=this.getWorkspaceHeight();return t===1/0?t:(e=this.getColumnHeaderHeight(),e&gt;0&amp;&amp;(t-=e),t)},getRowHeaderWidth:function(){var e=this.instance.getSetting(&quot;rowHeaderWidth&quot;),t=this.instance.getSetting(&quot;rowHeaders&quot;);if(e){this.rowHeaderWidth=0;for(var n=0,o=t.length;n&lt;o;n++)this.rowHeaderWidth+=e[n]||e}if(this.wot.cloneSource)return this.wot.cloneSource.wtViewport.getRowHeaderWidth();if(isNaN(this.rowHeaderWidth))if(t.length){var r=this.instance.wtTable.TABLE.querySelector(&quot;TH&quot;);this.rowHeaderWidth=0;for(var i=0,s=t.length;i&lt;s;i++)r?(this.rowHeaderWidth+=m(r),r=r.nextSibling):this.rowHeaderWidth+=50}else this.rowHeaderWidth=0;return this.rowHeaderWidth=this.instance.getSetting(&quot;onModifyRowHeaderWidth&quot;,this.rowHeaderWidth)||this.rowHeaderWidth,this.rowHeaderWidth},getViewportWidth:function(){var e,t=this.getWorkspaceWidth();return t===1/0?t:(e=this.getRowHeaderWidth(),e&gt;0?t-e:t)},createRowsCalculator:function(){var e,t,n,o,r,i,s,a=void 0!==arguments[0]&amp;&amp;arguments[0],l=this;return this.rowHeaderWidth=NaN,e=this.wot.wtSettings.settings.renderAllRows?1/0:this.getViewportHeight(),t=this.wot.wtOverlays.topOverlay.getScrollPosition()-this.wot.wtOverlays.topOverlay.getTableParentOffset(),t&lt;0&amp;&amp;(t=0),n=this.wot.getSetting(&quot;fixedRowsTop&quot;),r=this.wot.getSetting(&quot;fixedRowsBottom&quot;),s=this.wot.getSetting(&quot;totalRows&quot;),n&amp;&amp;(i=this.wot.wtOverlays.topOverlay.sumCellSizes(0,n),t+=i,e-=i),r&amp;&amp;this.wot.wtOverlays.bottomOverlay.clone&amp;&amp;(i=this.wot.wtOverlays.bottomOverlay.sumCellSizes(s-r,s),e-=i),o=this.wot.wtTable.holder.clientHeight===this.wot.wtTable.holder.offsetHeight?0:d(),new y(e,t,this.wot.getSetting(&quot;totalRows&quot;),function(e){return l.wot.wtTable.getRowHeight(e)},a?null:this.wot.wtSettings.settings.viewportRowCalculatorOverride,a,o)},createColumnsCalculator:function(){var e,t,n=void 0!==arguments[0]&amp;&amp;arguments[0],o=this,r=this.getViewportWidth();if(this.columnHeaderHeight=NaN,e=this.wot.wtOverlays.leftOverlay.getScrollPosition()-this.wot.wtOverlays.leftOverlay.getTableParentOffset(),
e&lt;0&amp;&amp;(e=0),t=this.wot.getSetting(&quot;fixedColumnsLeft&quot;)){var i=this.wot.wtOverlays.leftOverlay.sumCellSizes(0,t);e+=i,r-=i}return this.wot.wtTable.holder.clientWidth!==this.wot.wtTable.holder.offsetWidth&amp;&amp;(r-=d()),new v(r,e,this.wot.getSetting(&quot;totalColumns&quot;),function(e){return o.wot.wtTable.getColumnWidth(e)},n?null:this.wot.wtSettings.settings.viewportColumnCalculatorOverride,n,this.wot.getSetting(&quot;stretchH&quot;),function(e,t){return o.wot.getSetting(&quot;onBeforeStretchingColumnWidth&quot;,e,t)})},createRenderCalculators:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];if(e){var t=this.createRowsCalculator(!0),n=this.createColumnsCalculator(!0);this.areAllProposedVisibleRowsAlreadyRendered(t)&amp;&amp;this.areAllProposedVisibleColumnsAlreadyRendered(n)||(e=!1)}return e||(this.rowsRenderCalculator=this.createRowsCalculator(),this.columnsRenderCalculator=this.createColumnsCalculator()),this.rowsVisibleCalculator=null,this.columnsVisibleCalculator=null,e},createVisibleCalculators:function(){this.rowsVisibleCalculator=this.createRowsCalculator(!0),this.columnsVisibleCalculator=this.createColumnsCalculator(!0)},areAllProposedVisibleRowsAlreadyRendered:function(e){return!!this.rowsVisibleCalculator&amp;&amp;(!(e.startRow&lt;this.rowsRenderCalculator.startRow||e.startRow===this.rowsRenderCalculator.startRow&amp;&amp;e.startRow&gt;0)&amp;&amp;!(e.endRow&gt;this.rowsRenderCalculator.endRow||e.endRow===this.rowsRenderCalculator.endRow&amp;&amp;e.endRow&lt;this.wot.getSetting(&quot;totalRows&quot;)-1))},areAllProposedVisibleColumnsAlreadyRendered:function(e){return!!this.columnsVisibleCalculator&amp;&amp;(!(e.startColumn&lt;this.columnsRenderCalculator.startColumn||e.startColumn===this.columnsRenderCalculator.startColumn&amp;&amp;e.startColumn&gt;0)&amp;&amp;!(e.endColumn&gt;this.columnsRenderCalculator.endColumn||e.endColumn===this.columnsRenderCalculator.endColumn&amp;&amp;e.endColumn&lt;this.wot.getSetting(&quot;totalColumns&quot;)-1))},resetHasOversizedColumnHeadersMarked:function(){g(this.hasOversizedColumnHeadersMarked,function(e,t,n){n[t]=void 0})}},{}),window.WalkontableViewport=b},{browser:24,&quot;calculator/viewportColumns&quot;:4,&quot;calculator/viewportRows&quot;:5,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/object&quot;:53}],24:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n=new o.Core(e,t||{});return n.init(),n}var r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,M,S,E,O;t.exports=o,o.utils={},r=e(&quot;shims/runtime&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r},i=e(&quot;es6collections&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i};var T=(s=e(&quot;pluginHooks&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).Hooks,k=(a=e(&quot;numbro&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).default,x=(l=e(&quot;moment&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).default;&quot;object&quot;==typeof window&amp;&amp;(&quot;undefined&quot;==typeof window.numbro&amp;&amp;(window.numbro=k),&quot;undefined&quot;==typeof window.moment&amp;&amp;(window.moment=x)),o.hooks||(o.hooks=new T),o.utils.Hooks=T,u=e(&quot;core&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u},c=e(&quot;renderers/_cellDecorator&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c},d=e(&quot;cellTypes&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d},h=e(&quot;plugins/jqueryHandsontable&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h};var D=(f=e(&quot;helpers/array&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),H=(p=e(&quot;helpers/browser&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}),A=(m=e(&quot;helpers/data&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}),P=(g=e(&quot;helpers/date&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}),N=(w=e(&quot;helpers/feature&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}),L=(v=e(&quot;helpers/function&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}),I=(y=e(&quot;helpers/mixed&quot;),y&amp;&amp;y.__esModule&amp;&amp;y||{default:y}),W=(b=e(&quot;helpers/number&quot;),b&amp;&amp;b.__esModule&amp;&amp;b||{default:b}),j=(C=e(&quot;helpers/object&quot;),C&amp;&amp;C.__esModule&amp;&amp;C||{default:C}),V=(_=e(&quot;helpers/setting&quot;),_&amp;&amp;_.__esModule&amp;&amp;_||{default:_}),B=(R=e(&quot;helpers/string&quot;),R&amp;&amp;R.__esModule&amp;&amp;R||{default:R}),F=(M=e(&quot;helpers/unicode&quot;),M&amp;&amp;M.__esModule&amp;&amp;M||{default:M}),z=(S=e(&quot;helpers/dom/element&quot;),S&amp;&amp;S.__esModule&amp;&amp;S||{default:S}),Y=(E=e(&quot;helpers/dom/event&quot;),E&amp;&amp;E.__esModule&amp;&amp;E||{default:E}),U=[D,H,A,P,N,L,I,W,j,V,B,F],G=[z,Y];o.buildDate=&quot;Tue Feb 14 2017 11:02:09 GMT+0100 (CET)&quot;,o.packageName=&quot;handsontable&quot;,o.version=&quot;0.31.0&quot;;var $=&quot;@@baseVersion&quot;;/^@@/.test($)||(o.baseVersion=$),o.plugins={};var K=(O=e(&quot;plugins&quot;),O&amp;&amp;O.__esModule&amp;&amp;O||{default:O}).registerPlugin;o.plugins.registerPlugin=K,o.helper={},o.dom={},o.Dom=o.dom,D.arrayEach(U,function(e){D.arrayEach(Object.getOwnPropertyNames(e),function(t){&quot;_&quot;!==t.charAt(0)&amp;&amp;(o.helper[t]=e[t])})}),D.arrayEach(G,function(e){D.arrayEach(Object.getOwnPropertyNames(e),function(t){&quot;_&quot;!==t.charAt(0)&amp;&amp;(o.dom[t]=e[t])})})},{cellTypes:25,core:26,es6collections:&quot;es6collections&quot;,&quot;helpers/array&quot;:43,&quot;helpers/browser&quot;:44,&quot;helpers/data&quot;:45,&quot;helpers/date&quot;:46,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/feature&quot;:49,&quot;helpers/function&quot;:50,&quot;helpers/mixed&quot;:51,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;helpers/setting&quot;:54,&quot;helpers/string&quot;:55,&quot;helpers/unicode&quot;:56,moment:&quot;moment&quot;,numbro:&quot;numbro&quot;,pluginHooks:60,plugins:61,&quot;plugins/jqueryHandsontable&quot;:2,&quot;renderers/_cellDecorator&quot;:118,&quot;shims/runtime&quot;:125}],25:[function(e,t,n){&quot;use strict&quot;;var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,M,S,E,O=(o=e(&quot;helpers/browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).isMobileBrowser,T=(r=e(&quot;editors&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getEditorConstructor,k=(i=e(&quot;renderers&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).getRenderer,x=((s=e(&quot;editors/autocompleteEditor&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).AutocompleteEditor,(a=e(&quot;editors/checkboxEditor&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).CheckboxEditor,(l=e(&quot;editors/dateEditor&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).DateEditor,(u=e(&quot;editors/dropdownEditor&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).DropdownEditor,(c=e(&quot;editors/handsontableEditor&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).HandsontableEditor,(d=e(&quot;editors/mobileTextEditor&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).MobileTextEditor,(h=e(&quot;editors/numericEditor&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).NumericEditor,(f=e(&quot;editors/passwordEditor&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).PasswordEditor,(p=e(&quot;editors/selectEditor&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}).SelectEditor,(m=e(&quot;editors/textEditor&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).TextEditor,(g=e(&quot;renderers/autocompleteRenderer&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}).AutocompleteRenderer,(w=e(&quot;renderers/checkboxRenderer&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}).CheckboxRenderer,(v=e(&quot;renderers/htmlRenderer&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}).HtmlRenderer,(y=e(&quot;renderers/numericRenderer&quot;),y&amp;&amp;y.__esModule&amp;&amp;y||{default:y}).NumericRenderer,(b=e(&quot;renderers/passwordRenderer&quot;),b&amp;&amp;b.__esModule&amp;&amp;b||{default:b}).PasswordRenderer,(C=e(&quot;renderers/textRenderer&quot;),C&amp;&amp;C.__esModule&amp;&amp;C||{default:C}).TextRenderer,(_=e(&quot;validators/autocompleteValidator&quot;),_&amp;&amp;_.__esModule&amp;&amp;_||{default:_}).AutocompleteValidator,(R=e(&quot;validators/dateValidator&quot;),R&amp;&amp;R.__esModule&amp;&amp;R||{default:R}).DateValidator,(M=e(&quot;validators/timeValidator&quot;),M&amp;&amp;M.__esModule&amp;&amp;M||{default:M}).TimeValidator,(S=e(&quot;validators/numericValidator&quot;),S&amp;&amp;S.__esModule&amp;&amp;S||{default:S}).NumericValidator,(E=e(&quot;browser&quot;),E&amp;&amp;E.__esModule&amp;&amp;E||{default:E}).default);x.AutocompleteCell={editor:T(&quot;autocomplete&quot;),renderer:k(&quot;autocomplete&quot;),validator:x.AutocompleteValidator},x.CheckboxCell={editor:T(&quot;checkbox&quot;),renderer:k(&quot;checkbox&quot;)},x.TextCell={editor:T(O()?&quot;mobile&quot;:&quot;text&quot;),renderer:k(&quot;text&quot;)},x.NumericCell={editor:T(&quot;numeric&quot;),renderer:k(&quot;numeric&quot;),validator:x.NumericValidator,dataType:&quot;number&quot;},x.DateCell={editor:T(&quot;date&quot;),validator:x.DateValidator,renderer:k(&quot;autocomplete&quot;)},x.TimeCell={editor:T(&quot;text&quot;),validator:x.TimeValidator,renderer:k(&quot;text&quot;)},x.HandsontableCell={editor:T(&quot;handsontable&quot;),renderer:k(&quot;autocomplete&quot;)},x.PasswordCell={editor:T(&quot;password&quot;),renderer:k(&quot;password&quot;),copyable:!1},x.DropdownCell={editor:T(&quot;dropdown&quot;),renderer:k(&quot;autocomplete&quot;),validator:x.AutocompleteValidator},x.cellTypes={text:x.TextCell,date:x.DateCell,time:x.TimeCell,numeric:x.NumericCell,checkbox:x.CheckboxCell,autocomplete:x.AutocompleteCell,handsontable:x.HandsontableCell,password:x.PasswordCell,dropdown:x.DropdownCell},x.cellLookup={validator:{numeric:x.NumericValidator,autocomplete:x.AutocompleteValidator}}},{browser:24,editors:30,&quot;editors/autocompleteEditor&quot;:32,&quot;editors/checkboxEditor&quot;:33,&quot;editors/dateEditor&quot;:34,&quot;editors/dropdownEditor&quot;:35,&quot;editors/handsontableEditor&quot;:36,&quot;editors/mobileTextEditor&quot;:37,&quot;editors/numericEditor&quot;:38,&quot;editors/passwordEditor&quot;:39,&quot;editors/selectEditor&quot;:40,&quot;editors/textEditor&quot;:41,&quot;helpers/browser&quot;:44,renderers:117,&quot;renderers/autocompleteRenderer&quot;:119,&quot;renderers/checkboxRenderer&quot;:120,&quot;renderers/htmlRenderer&quot;:121,&quot;renderers/numericRenderer&quot;:122,&quot;renderers/passwordRenderer&quot;:123,&quot;renderers/textRenderer&quot;:124,&quot;validators/autocompleteValidator&quot;:133,&quot;validators/dateValidator&quot;:134,&quot;validators/numericValidator&quot;:135,&quot;validators/timeValidator&quot;:136}],26:[function(e,t,n){&quot;use strict&quot;;var o,r,i,s,a,l,u,c,d,h,f,p,m,g,w,v,y,b,C,_,R,M,S,E=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,O=(r=e(&quot;numbro&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,T=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),k=T.addClass,x=T.empty,D=T.isChildOfWebComponentTable,H=T.removeClass,A=(s=e(&quot;helpers/setting&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).columnFactory,P=(a=e(&quot;helpers/function&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).isFunction,N=(l=e(&quot;helpers/mixed&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),L=N.isDefined,I=N.isUndefined,W=(u=e(&quot;helpers/browser&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).isMobileBrowser,j=(c=e(&quot;dataMap&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).DataMap,V=(d=e(&quot;editorManager&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).EditorManager,B=(h=e(&quot;eventManager&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).eventManager,F=(f=e(&quot;helpers/object&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),z=F.deepClone,Y=F.duckSchema,U=F.extend,G=F.isObject,$=F.isObjectEquals,K=F.deepObjectSize,X=(p=e(&quot;helpers/array&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}),q=X.arrayFlatten,Z=X.arrayMap,J=(m=e(&quot;plugins&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).getPlugin,Q=(g=e(&quot;renderers&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}).getRenderer,ee=(w=e(&quot;helpers/string&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}).randomString,te=(v=e(&quot;helpers/number&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}).rangeEach,ne=(y=e(&quot;tableView&quot;),y&amp;&amp;y.__esModule&amp;&amp;y||{default:y}).TableView,oe=(b=e(&quot;dataSource&quot;),b&amp;&amp;b.__esModule&amp;&amp;b||{default:b}).DataSource,re=(C=e(&quot;helpers/data&quot;),C&amp;&amp;C.__esModule&amp;&amp;C||{default:C}),ie=re.translateRowsToColumns,se=re.cellMethodLookupFactory,ae=re.spreadsheetColumnLabel,le=(_=e(&quot;utils/recordTranslator&quot;),_&amp;&amp;_.__esModule&amp;&amp;_||{default:_}).getTranslator,ue=(R=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),R&amp;&amp;R.__esModule&amp;&amp;R||{default:R}).WalkontableCellCoords,ce=(M=e(&quot;3rdparty/walkontable/src/cell/range&quot;),M&amp;&amp;M.__esModule&amp;&amp;M||{default:M}).WalkontableCellRange,de=(S=e(&quot;3rdparty/walkontable/src/calculator/viewportColumns&quot;),S&amp;&amp;S.__esModule&amp;&amp;S||{default:S}).WalkontableViewportColumnsCalculator;E.activeGuid=null,E.Core=function(e,t){function n(){var e=!1;return{validatorsInQueue:0,valid:!0,addValidatorToQueue:function(){this.validatorsInQueue++,e=!1},removeValidatorFormQueue:function(){this.validatorsInQueue=this.validatorsInQueue-1&lt;0?0:this.validatorsInQueue-1,this.checkIfQueueIsEmpty()},onQueueEmpty:function(e){},checkIfQueueIsEmpty:function(){0==this.validatorsInQueue&amp;&amp;0==e&amp;&amp;(e=!0,this.onQueueEmpty(this.valid))}}}function o(e,t,o){function r(){var n;e.length&amp;&amp;(n=E.hooks.run(p,&quot;beforeChange&quot;,e,t),P(n)?console.warn(&quot;Your beforeChange callback returns a function. It's not supported since Handsontable 0.12.1 (and the returned function will not be executed).&quot;):n===!1&amp;&amp;e.splice(0,e.length)),o()}var i=new n;i.onQueueEmpty=r;for(var s=e.length-1;s&gt;=0;s--)if(null===e[s])e.splice(s,1);else{var a=e[s][0],l=u.propToCol(e[s][1]),c=p.getCellMeta(a,l);if(&quot;numeric&quot;===c.type&amp;&amp;&quot;string&quot;==typeof e[s][3]&amp;&amp;e[s][3].length&gt;0&amp;&amp;(/^-?[\d\s]*(\.|\,)?\d*$/.test(e[s][3])||c.format)){var d=e[s][3].length;I(c.language)?O.culture(&quot;en-US&quot;):e[s][3].indexOf(&quot;.&quot;)===d-3&amp;&amp;e[s][3].indexOf(&quot;,&quot;)===-1?O.culture(&quot;en-US&quot;):O.culture(c.language);O.cultureData(O.culture()).delimiters;O.validate(e[s][3])&amp;&amp;!isNaN(e[s][3])?e[s][3]=parseFloat(e[s][3]):e[s][3]=O().unformat(e[s][3])||e[s][3]}p.getCellValidator(c)&amp;&amp;(i.addValidatorToQueue(),p.validateCell(e[s][3],c,function(t,n){return function(o){if(&quot;boolean&quot;!=typeof o)throw new Error(&quot;Validation error: result is not boolean&quot;);if(o===!1&amp;&amp;n.allowInvalid===!1){e.splice(t,1),n.valid=!0;var r=p.getCell(n.row,n.col);H(r,p.getSettings().invalidCellClassName),--t}i.removeValidatorFormQueue()}}(s,c),t))}i.checkIfQueueIsEmpty()}function r(e,t){var n=e.length-1;if(!(n&lt;0)){for(;0&lt;=n;n--){var o=!1;if(null!==e[n]){if(null!=e[n][2]||null!=e[n][3]){if(l.settings.allowInsertRow)for(;e[n][0]&gt;p.countRows()-1;){var r=u.createRow(void 0,void 0,t);if(0===r){o=!0;break}}if(!o){if(&quot;array&quot;===p.dataType&amp;&amp;(!l.settings.columns||0===l.settings.columns.length)&amp;&amp;l.settings.allowInsertColumn)for(;u.propToCol(e[n][1])&gt;p.countCols()-1;)u.createCol(void 0,void 0,t);u.set(e[n][0],e[n][1],e[n][3])}}}else e.splice(n,1)}p.forceFullRender=!0,d.adjustRowsAndCols(),E.hooks.run(p,&quot;beforeChangeRender&quot;,e,t),h.refreshBorders(null,!0),p.view.wt.wtOverlays.adjustElementsSize(),E.hooks.run(p,&quot;afterChange&quot;,e,t||&quot;edit&quot;);var i=p.getActiveEditor();i&amp;&amp;L(i.refreshValue)&amp;&amp;i.refreshValue()}}function i(e,t,n){return&quot;object&quot;==typeof e?e:[[e,t,n]]}function s(e){if(e.hasOwnProperty(&quot;type&quot;)){var t,n={};if(&quot;object&quot;==typeof e.type)t=e.type;else if(&quot;string&quot;==typeof e.type&amp;&amp;(t=E.cellTypes[e.type],void 0===t))throw new Error('You declared cell type &quot;'+e.type+'&quot; as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');for(var o in t)t.hasOwnProperty(o)&amp;&amp;!e.hasOwnProperty(o)&amp;&amp;(n[o]=t[o]);return n}}function a(){throw new Error(&quot;This method cannot be called because this Handsontable instance has been destroyed&quot;)}var l,u,c,d,h,f,p=this,m=function(){},g=B(p),w=le(p);U(m.prototype,he.prototype),U(m.prototype,t),U(m.prototype,s(t)),this.rootElement=e,this.isHotTableEnv=D(this.rootElement),E.eventManager.isHotTableEnv=this.isHotTableEnv,this.container=document.createElement(&quot;DIV&quot;),this.renderCall=!1,e.insertBefore(this.container,e.firstChild),this.guid=&quot;ht_&quot;+ee(),c=new oe(p),this.rootElement.id&amp;&amp;&quot;ht_&quot;!==this.rootElement.id.substring(0,3)||(this.rootElement.id=this.guid),l={cellSettings:[],columnSettings:[],columnsSettingConflicts:[&quot;data&quot;,&quot;width&quot;],settings:new m,selRange:null,isPopulated:null,scrollable:null,firstRun:!0},d={alter:function(e,t,n,o,r){function i(e,t,n,o){var r=function(){var e;return&quot;array&quot;===o?e=[]:&quot;object&quot;===o&amp;&amp;(e={}),e},i=Z(new Array(n),function(){return r()});i.unshift(t,0),e.splice.apply(e,i)}var s;switch(n=n||1,e){case&quot;insert_row&quot;:var a=p.countSourceRows();if(p.getSettings().maxRows===a)return;t=L(t)?t:a,s=u.createRow(t,n,o),i(l.cellSettings,t,n,&quot;array&quot;),s&amp;&amp;(h.isSelected()&amp;&amp;l.selRange.from.row&gt;=t?(l.selRange.from.row=l.selRange.from.row+s,h.transformEnd(s,0)):h.refreshBorders());break;case&quot;insert_col&quot;:s=u.createCol(t,n,o);for(var c=0,f=p.countSourceRows();c&lt;f;c++)l.cellSettings[c]&amp;&amp;i(l.cellSettings[c],t,n);if(s){if(Array.isArray(p.getSettings().colHeaders)){var m=[t,0];m.length+=s,Array.prototype.splice.apply(p.getSettings().colHeaders,m)}h.isSelected()&amp;&amp;l.selRange.from.col&gt;=t?(l.selRange.from.col=l.selRange.from.col+s,h.transformEnd(0,s)):h.refreshBorders()}break;case&quot;remove_row&quot;:u.removeRow(t,n,o),l.cellSettings.splice(t,n);var g=p.countRows(),v=p.getSettings().fixedRowsTop;v&gt;=t+1&amp;&amp;(p.getSettings().fixedRowsTop-=Math.min(n,v-t));var y=p.getSettings().fixedRowsBottom;y&amp;&amp;t&gt;=g-y&amp;&amp;(p.getSettings().fixedRowsBottom-=Math.min(n,y)),d.adjustRowsAndCols(),h.refreshBorders();break;case&quot;remove_col&quot;:var b=w.toPhysicalColumn(t);u.removeCol(t,n,o);for(var C=0,_=p.countSourceRows();C&lt;_;C++)l.cellSettings[C]&amp;&amp;l.cellSettings[C].splice(b,n);var R=p.getSettings().fixedColumnsLeft;R&gt;=t+1&amp;&amp;(p.getSettings().fixedColumnsLeft-=Math.min(n,R-t)),Array.isArray(p.getSettings().colHeaders)&amp;&amp;(&quot;undefined&quot;==typeof b&amp;&amp;(b=-1),p.getSettings().colHeaders.splice(b,n)),d.adjustRowsAndCols(),h.refreshBorders();break;default:throw new Error('There is no such action &quot;'+e+'&quot;')}r||d.adjustRowsAndCols()},adjustRowsAndCols:function(){if(l.settings.minRows){var e=p.countRows();if(e&lt;l.settings.minRows)for(var t=0,n=l.settings.minRows;t&lt;n-e;t++)u.createRow(p.countRows(),1,&quot;auto&quot;)}if(l.settings.minSpareRows){var o=p.countEmptyRows(!0);if(o&lt;l.settings.minSpareRows)for(;o&lt;l.settings.minSpareRows&amp;&amp;p.countSourceRows()&lt;l.settings.maxRows;o++)u.createRow(p.countRows(),1,&quot;auto&quot;)}var r;if((l.settings.minCols||l.settings.minSpareCols)&amp;&amp;(r=p.countEmptyCols(!0)),l.settings.minCols&amp;&amp;!l.settings.columns&amp;&amp;p.countCols()&lt;l.settings.minCols)for(;p.countCols()&lt;l.settings.minCols;r++)u.createCol(p.countCols(),1,&quot;auto&quot;);if(l.settings.minSpareCols&amp;&amp;!l.settings.columns&amp;&amp;&quot;array&quot;===p.dataType&amp;&amp;r&lt;l.settings.minSpareCols)for(;r&lt;l.settings.minSpareCols&amp;&amp;p.countCols()&lt;l.settings.maxCols;r++)u.createCol(p.countCols(),1,&quot;auto&quot;);var i=p.countRows(),s=p.countCols();if(0!==i&amp;&amp;0!==s||h.deselect(),h.isSelected()){var a=!1,c=l.selRange.from.row,d=l.selRange.from.col,f=l.selRange.to.row,m=l.selRange.to.col;c&gt;i-1?(c=i-1,a=!0,f&gt;c&amp;&amp;(f=c)):f&gt;i-1&amp;&amp;(f=i-1,a=!0,c&gt;f&amp;&amp;(c=f)),d&gt;s-1?(d=s-1,a=!0,m&gt;d&amp;&amp;(m=d)):m&gt;s-1&amp;&amp;(m=s-1,a=!0,d&gt;m&amp;&amp;(d=m)),a&amp;&amp;p.selectCell(c,d,f,m)}p.view&amp;&amp;p.view.wt.wtOverlays.adjustElementsSize()},populateFromArray:function(e,t,n,o,r,i,s){var a,u,c,d,h=[],f={};if(u=t.length,0===u)return!1;var m,g,w,v;({row:null===n?null:n.row,col:null===n?null:n.col});switch(r){case&quot;shift_down&quot;:for(m=n?n.col-e.col+1:0,g=n?n.row-e.row+1:0,t=ie(t),c=0,d=t.length,w=Math.max(d,m);c&lt;w;c++)if(c&lt;d){for(a=0,u=t[c].length;a&lt;g-u;a++)t[c].push(t[c][a%u]);t[c].unshift(e.col+c,e.row,0),p.spliceCol.apply(p,t[c])}else t[c%d][0]=e.col+c,p.spliceCol.apply(p,t[c%d]);break;case&quot;shift_right&quot;:for(m=n?n.col-e.col+1:0,g=n?n.row-e.row+1:0,a=0,u=t.length,v=Math.max(u,g);a&lt;v;a++)if(a&lt;u){for(c=0,d=t[a].length;c&lt;m-d;c++)t[a].push(t[a][c%d]);t[a].unshift(e.row+a,e.col,0),p.spliceRow.apply(p,t[a])}else t[a%u][0]=e.row+a,p.spliceRow.apply(p,t[a%u]);break;case&quot;overwrite&quot;:default:f.row=e.row,f.col=e.col;var y,b={row:n&amp;&amp;e?n.row-e.row+1:1,col:n&amp;&amp;e?n.col-e.col+1:1},C=0,_=0,R=!0,M=function(e){var n=void 0!==arguments[1]?arguments[1]:null,o=t[e%t.length];return null!==n?o[n%o.length]:o},S=t.length,E=n?n.row-e.row+1:0;for(u=n?E:Math.max(S,E),a=0;a&lt;u&amp;&amp;!(n&amp;&amp;f.row&gt;n.row&amp;&amp;E&gt;S||!l.settings.allowInsertRow&amp;&amp;f.row&gt;p.countRows()-1||f.row&gt;=l.settings.maxRows);a++){var O=a-C,T=M(O).length,k=n?n.col-e.col+1:0;if(d=n?k:Math.max(T,k),f.col=e.col,y=p.getCellMeta(f.row,f.col),&quot;CopyPaste.paste&quot;!==o&amp;&amp;&quot;Autofill.autofill&quot;!==o||!y.skipRowOnPaste){for(_=0,c=0;c&lt;d&amp;&amp;!(n&amp;&amp;f.col&gt;n.col&amp;&amp;k&gt;T||!l.settings.allowInsertColumn&amp;&amp;f.col&gt;p.countCols()-1||f.col&gt;=l.settings.maxCols);c++)if(y=p.getCellMeta(f.row,f.col),&quot;CopyPaste.paste&quot;!==o&amp;&amp;&quot;Autofill.fill&quot;!==o||!y.skipColumnOnPaste)if(y.readOnly)f.col++;else{var x=c-_,D=M(O,x),H=p.getDataAtCell(f.row,f.col),A={row:O,col:x};if(&quot;Autofill.fill&quot;===o){var P=p.runHooks(&quot;beforeAutofillInsidePopulate&quot;,A,i,t,s,{},b);P&amp;&amp;(D=I(P.value)?D:P.value)}if(null!==D&amp;&amp;&quot;object&quot;==typeof D)if(null===H||&quot;object&quot;!=typeof H)R=!1;else{var N=Y(H[0]||H),L=Y(D[0]||D);$(N,L)?D=z(D):R=!1}else null!==H&amp;&amp;&quot;object&quot;==typeof H&amp;&amp;(R=!1);R&amp;&amp;h.push([f.row,f.col,D]),R=!0,f.col++}else _++,f.col++,d++;f.row++}else C++,f.row++,u++}p.setDataAtCell(h,null,null,o||&quot;populateFromArray&quot;)}}},this.selection=h={inProgress:!1,selectedHeader:{cols:!1,rows:!1},setSelectedHeaders:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0],t=void 0!==arguments[1]&amp;&amp;arguments[1],n=void 0!==arguments[2]&amp;&amp;arguments[2];p.selection.selectedHeader.rows=e,p.selection.selectedHeader.cols=t,p.selection.selectedHeader.corner=n},begin:function(){p.selection.inProgress=!0},finish:function(){var e=p.getSelected();E.hooks.run(p,&quot;afterSelectionEnd&quot;,e[0],e[1],e[2],e[3]),E.hooks.run(p,&quot;afterSelectionEndByProp&quot;,e[0],p.colToProp(e[1]),e[2],p.colToProp(e[3])),p.selection.inProgress=!1},isInProgress:function(){return p.selection.inProgress},setRangeStart:function(e,t){E.hooks.run(p,&quot;beforeSetRangeStart&quot;,e),l.selRange=new ce(e,e,e),h.setRangeEnd(e,null,t)},setRangeStartOnly:function(e){E.hooks.run(p,&quot;beforeSetRangeStartOnly&quot;,e),l.selRange=new ce(e,e,e)},setRangeEnd:function(e,t,n){if(null!==l.selRange){var o,r=!1,i=!0,s=p.view.wt.wtTable.getFirstVisibleRow(),a=p.view.wt.wtTable.getFirstVisibleColumn(),c={row:null,col:null};E.hooks.run(p,&quot;beforeSetRangeEnd&quot;,e),p.selection.begin(),c.row=e.row&lt;0?s:e.row,c.col=e.col&lt;0?a:e.col,l.selRange.to=new ue(c.row,c.col),l.settings.multiSelect||(l.selRange.from=e),p.view.wt.selections.current.clear(),o=p.getCellMeta(l.selRange.highlight.row,l.selRange.highlight.col).disableVisualSelection,&quot;string&quot;==typeof o&amp;&amp;(o=[o]),(o===!1||Array.isArray(o)&amp;&amp;o.indexOf(&quot;current&quot;)===-1)&amp;&amp;p.view.wt.selections.current.add(l.selRange.highlight),p.view.wt.selections.area.clear(),(o===!1||Array.isArray(o)&amp;&amp;o.indexOf(&quot;area&quot;)===-1)&amp;&amp;h.isMultiple()&amp;&amp;(p.view.wt.selections.area.add(l.selRange.from),p.view.wt.selections.area.add(l.selRange.to)),(l.settings.currentHeaderClassName||l.settings.currentRowClassName||l.settings.currentColClassName)&amp;&amp;(p.view.wt.selections.highlight.clear(),p.view.wt.selections.highlight.add(l.selRange.from),p.view.wt.selections.highlight.add(l.selRange.to)),E.hooks.run(p,&quot;afterSelection&quot;,l.selRange.from.row,l.selRange.from.col,l.selRange.to.row,l.selRange.to.col),E.hooks.run(p,&quot;afterSelectionByProp&quot;,l.selRange.from.row,u.colToProp(l.selRange.from.col),l.selRange.to.row,u.colToProp(l.selRange.to.col)),(0===l.selRange.from.row&amp;&amp;l.selRange.to.row===p.countRows()-1&amp;&amp;p.countRows()&gt;1||0===l.selRange.from.col&amp;&amp;l.selRange.to.col===p.countCols()-1&amp;&amp;p.countCols()&gt;1)&amp;&amp;(r=!0),(e.row&lt;0||e.col&lt;0)&amp;&amp;(i=!1),t!==!1&amp;&amp;!r&amp;&amp;i&amp;&amp;(l.selRange.from&amp;&amp;!h.isMultiple()?p.view.scrollViewport(l.selRange.from):p.view.scrollViewport(e)),h.refreshBorders(null,n)}},refreshBorders:function(e,t){t||f.destroyEditor(e),p.view.render(),h.isSelected()&amp;&amp;!t&amp;&amp;f.prepareEditor()},isMultiple:function(){var e=!(l.selRange.to.col===l.selRange.from.col&amp;&amp;l.selRange.to.row===l.selRange.from.row),t=E.hooks.run(p,&quot;afterIsMultipleSelection&quot;,e);if(e)return t},transformStart:function(e,t,n,o){var r,i,s,a,u=new ue(e,t),c=0,d=0;p.runHooks(&quot;modifyTransformStart&quot;,u),r=p.countRows(),i=p.countCols(),a=p.getSettings().fixedRowsBottom,l.selRange.highlight.row+e&gt;r-1?n&amp;&amp;l.settings.minSpareRows&gt;0&amp;&amp;!(a&amp;&amp;l.selRange.highlight.row&gt;=r-a-1)?(p.alter(&quot;insert_row&quot;,r),r=p.countRows()):l.settings.autoWrapCol&amp;&amp;(u.row=1-r,u.col=l.selRange.highlight.col+u.col==i-1?1-i:1):l.settings.autoWrapCol&amp;&amp;l.selRange.highlight.row+u.row&lt;0&amp;&amp;l.selRange.highlight.col+u.col&gt;=0&amp;&amp;(u.row=r-1,u.col=l.selRange.highlight.col+u.col==0?i-1:-1),l.selRange.highlight.col+u.col&gt;i-1?n&amp;&amp;l.settings.minSpareCols&gt;0?(p.alter(&quot;insert_col&quot;,i),i=p.countCols()):l.settings.autoWrapRow&amp;&amp;(u.row=l.selRange.highlight.row+u.row==r-1?1-r:1,u.col=1-i):l.settings.autoWrapRow&amp;&amp;l.selRange.highlight.col+u.col&lt;0&amp;&amp;l.selRange.highlight.row+u.row&gt;=0&amp;&amp;(u.row=l.selRange.highlight.row+u.row==0?r-1:-1,u.col=i-1),s=new ue(l.selRange.highlight.row+u.row,l.selRange.highlight.col+u.col),s.row&lt;0?(c=-1,s.row=0):s.row&gt;0&amp;&amp;s.row&gt;=r&amp;&amp;(c=1,s.row=r-1),s.col&lt;0?(d=-1,s.col=0):s.col&gt;0&amp;&amp;s.col&gt;=i&amp;&amp;(d=1,s.col=i-1),p.runHooks(&quot;afterModifyTransformStart&quot;,s,c,d),h.setRangeStart(s,o)},transformEnd:function(e,t){var n,o,r,i=new ue(e,t),s=0,a=0;p.runHooks(&quot;modifyTransformEnd&quot;,i),n=p.countRows(),o=p.countCols(),r=new ue(l.selRange.to.row+i.row,l.selRange.to.col+i.col),r.row&lt;0?(s=-1,r.row=0):r.row&gt;0&amp;&amp;r.row&gt;=n&amp;&amp;(s=1,r.row=n-1),r.col&lt;0?(a=-1,r.col=0):r.col&gt;0&amp;&amp;r.col&gt;=o&amp;&amp;(a=1,r.col=o-1),p.runHooks(&quot;afterModifyTransformEnd&quot;,r,s,a),h.setRangeEnd(r,!0)},isSelected:function(){return null!==l.selRange},inInSelection:function(e){return!!h.isSelected()&amp;&amp;l.selRange.includes(e)},deselect:function(){h.isSelected()&amp;&amp;(p.selection.inProgress=!1,l.selRange=null,p.view.wt.selections.current.clear(),p.view.wt.selections.area.clear(),(l.settings.currentHeaderClassName||l.settings.currentRowClassName||l.settings.currentColClassName)&amp;&amp;p.view.wt.selections.highlight.clear(),f.destroyEditor(),h.refreshBorders(),H(p.rootElement,[&quot;ht__selection--rows&quot;,&quot;ht__selection--columns&quot;]),E.hooks.run(p,&quot;afterDeselect&quot;))},selectAll:function(){l.settings.multiSelect&amp;&amp;(h.setRangeStart(new ue(0,0)),h.setRangeEnd(new ue(p.countRows()-1,p.countCols()-1),!1))},empty:function(){if(h.isSelected()){var e,t,n=l.selRange.getTopLeftCorner(),o=l.selRange.getBottomRightCorner(),r=[];for(e=n.row;e&lt;=o.row;e++)for(t=n.col;t&lt;=o.col;t++)p.getCellMeta(e,t).readOnly||r.push([e,t,&quot;&quot;]);p.setDataAtCell(r)}}},this.init=function(){c.setData(l.settings.data),E.hooks.run(p,&quot;beforeInit&quot;),W()&amp;&amp;k(p.rootElement,&quot;mobile&quot;),this.updateSettings(l.settings,!0),this.view=new ne(this),f=new V(p,l,h,u),this.forceFullRender=!0,E.hooks.run(p,&quot;init&quot;),this.view.render(),&quot;object&quot;==typeof l.firstRun&amp;&amp;(E.hooks.run(p,&quot;afterChange&quot;,l.firstRun[0],l.firstRun[1]),l.firstRun=!1),E.hooks.run(p,&quot;afterInit&quot;)},this.validateCell=function(e,t,n,o){function r(e){var o=t.visualCol,r=t.visualRow,i=p.getCell(r,o,!0);i&amp;&amp;&quot;TH&quot;!=i.nodeName&amp;&amp;p.view.wt.wtSettings.settings.cellRenderer(r,o,i),n(e)}var i=p.getCellValidator(t);&quot;[object RegExp]&quot;===Object.prototype.toString.call(i)&amp;&amp;(i=function(e){return function(t,n){n(e.test(t))}}(i)),P(i)?(e=E.hooks.run(p,&quot;beforeValidate&quot;,e,t.visualRow,t.prop,o),p._registerTimeout(setTimeout(function(){i.call(t,e,function(n){n=E.hooks.run(p,&quot;afterValidate&quot;,n,e,t.visualRow,t.prop,o),t.valid=n,r(n),E.hooks.run(p,&quot;postAfterValidate&quot;,n,e,t.visualRow,t.prop,o)})},0))):p._registerTimeout(setTimeout(function(){t.valid=!0,r(t.valid)},0))},this.setDataAtCell=function(e,t,n,s){var a,l,d,h=i(e,t,n),f=[];for(a=0,l=h.length;a&lt;l;a++){if(&quot;object&quot;!=typeof h[a])throw new Error(&quot;Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter&quot;);if(&quot;number&quot;!=typeof h[a][1])throw new Error(&quot;Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`&quot;);d=u.colToProp(h[a][1]),f.push([h[a][0],d,c.getAtCell(w.toPhysicalRow(h[a][0]),h[a][1]),h[a][2]])}s||&quot;object&quot;!=typeof e||(s=t),p.runHooks(&quot;afterSetDataAtCell&quot;,f,s),o(f,s,function(){r(f,s)})},this.setDataAtRowProp=function(e,t,n,s){var a,l,u=i(e,t,n),d=[];for(a=0,l=u.length;a&lt;l;a++)d.push([u[a][0],u[a][1],c.getAtCell(w.toPhysicalRow(u[a][0]),u[a][1]),u[a][2]]);s||&quot;object&quot;!=typeof e||(s=t),p.runHooks(&quot;afterSetDataAtRowProp&quot;,d,s),o(d,s,function(){r(d,s)})},this.listen=function(){E.activeGuid=p.guid},this.unlisten=function(){E.activeGuid=null},this.isListening=function(){return E.activeGuid===p.guid},this.destroyEditor=function(e){h.refreshBorders(e)},this.populateFromArray=function(e,t,n,o,r,i,s,a,l){var u;if(&quot;object&quot;!=typeof n||&quot;object&quot;!=typeof n[0])throw new Error(&quot;populateFromArray parameter `input` must be an array of arrays&quot;);return u=&quot;number&quot;==typeof o?new ue(o,r):null,d.populateFromArray(new ue(e,t),n,u,i,s,a,l)},this.spliceCol=function(e,t,n){return u.spliceCol.apply(u,arguments)},this.spliceRow=function(e,t,n){return u.spliceRow.apply(u,arguments)},this.getSelected=function(){if(h.isSelected())return[l.selRange.from.row,l.selRange.from.col,l.selRange.to.row,l.selRange.to.col]},this.getSelectedRange=function(){if(h.isSelected())return l.selRange},this.render=function(){p.view&amp;&amp;(p.renderCall=!0,p.forceFullRender=!0,h.refreshBorders(null,!0))},this.loadData=function(e){function t(){l.cellSettings.length=0}if(Array.isArray(l.settings.dataSchema)?p.dataType=&quot;array&quot;:P(l.settings.dataSchema)?p.dataType=&quot;function&quot;:p.dataType=&quot;object&quot;,u&amp;&amp;u.destroy(),u=new j(p,l,m),&quot;object&quot;==typeof e&amp;&amp;null!==e)e.push&amp;&amp;e.splice||(e=[e]);else{if(null!==e)throw new Error(&quot;loadData only accepts array of objects or array of arrays (&quot;+typeof e+&quot; given)&quot;);e=[];var n,o=0,r=0,i=u.getSchema();for(o=0,r=l.settings.startRows;o&lt;r;o++)if(&quot;object&quot;!==p.dataType&amp;&amp;&quot;function&quot;!==p.dataType||!l.settings.dataSchema)if(&quot;array&quot;===p.dataType)n=z(i[0]),e.push(n);else{n=[];for(var s=0,a=l.settings.startCols;s&lt;a;s++)n.push(null);e.push(n)}else n=z(i),e.push(n)}l.isPopulated=!1,m.prototype.data=e,Array.isArray(e[0])&amp;&amp;(p.dataType=&quot;array&quot;),u.dataSource=e,c.data=e,c.dataType=p.dataType,c.colToProp=u.colToProp.bind(u),c.propToCol=u.propToCol.bind(u),t(),d.adjustRowsAndCols(),E.hooks.run(p,&quot;afterLoadData&quot;,l.firstRun),l.firstRun?l.firstRun=[null,&quot;loadData&quot;]:(E.hooks.run(p,&quot;afterChange&quot;,null,&quot;loadData&quot;),p.render()),l.isPopulated=!0},this.getData=function(e,t,n,o){return I(e)?u.getAll():u.getRange(new ue(e,t),new ue(n,o),u.DESTINATION_RENDERER)},this.getCopyableText=function(e,t,n,o){return u.getCopyableText(new ue(e,t),new ue(n,o))},this.getCopyableData=function(e,t){return u.getCopyable(e,u.colToProp(t))},this.getSchema=function(){return u.getSchema()},this.updateSettings=function(e,t){var n,o,r,i=!1;if(L(e.rows))throw new Error('&quot;rows&quot; setting is no longer supported. do you mean startRows, minRows or maxRows?');if(L(e.cols))throw new Error('&quot;cols&quot; setting is no longer supported. do you mean startCols, minCols or maxCols?');for(n in e)&quot;data&quot;!==n&amp;&amp;(E.hooks.getRegistered().indexOf(n)&gt;-1?(P(e[n])||Array.isArray(e[n]))&amp;&amp;p.addHook(n,e[n]):!t&amp;&amp;e.hasOwnProperty(n)&amp;&amp;(m.prototype[n]=e[n]));if(void 0===e.data&amp;&amp;void 0===l.settings.data?p.loadData(null):void 0!==e.data?p.loadData(e.data):void 0!==e.columns&amp;&amp;u.createMap(),r=p.countCols(),e.columns&amp;&amp;P(e.columns)&amp;&amp;(r=p.countSourceCols(),i=!0),void 0===e.cell&amp;&amp;void 0===e.cells&amp;&amp;void 0===e.columns||(l.cellSettings.length=0),r&gt;0){var a,c;for(n=0,o=0;n&lt;r;n++)i&amp;&amp;!e.columns(n)||(l.columnSettings[o]=A(m,l.columnsSettingConflicts),a=l.columnSettings[o].prototype,m.prototype.columns&amp;&amp;(c=i?m.prototype.columns(n):m.prototype.columns[o],c&amp;&amp;(U(a,c),U(a,s(c)))),o++)}if(L(e.cell))for(var f in e.cell)if(e.cell.hasOwnProperty(f)){var g=e.cell[f];p.setCellMetaObject(g.row,g.col,g)}E.hooks.run(p,&quot;afterCellMetaReset&quot;),L(e.className)&amp;&amp;(m.prototype.className&amp;&amp;H(p.rootElement,m.prototype.className),e.className&amp;&amp;k(p.rootElement,e.className));var w=p.rootElement.style.height;&quot;&quot;!==w&amp;&amp;(w=parseInt(p.rootElement.style.height,10));var v=e.height;if(P(v)&amp;&amp;(v=v()),t){var y=p.rootElement.getAttribute(&quot;style&quot;);y&amp;&amp;p.rootElement.setAttribute(&quot;data-initialstyle&quot;,p.rootElement.getAttribute(&quot;style&quot;))}if(null===v){var b=p.rootElement.getAttribute(&quot;data-initialstyle&quot;);b&amp;&amp;(b.indexOf(&quot;height&quot;)&gt;-1||b.indexOf(&quot;overflow&quot;)&gt;-1)?p.rootElement.setAttribute(&quot;style&quot;,b):(p.rootElement.style.height=&quot;&quot;,p.rootElement.style.overflow=&quot;&quot;)}else void 0!==v&amp;&amp;(p.rootElement.style.height=v+&quot;px&quot;,p.rootElement.style.overflow=&quot;hidden&quot;);if(&quot;undefined&quot;!=typeof e.width){var C=e.width;P(C)&amp;&amp;(C=C()),p.rootElement.style.width=C+&quot;px&quot;}t||(u.clearLengthCache(),p.view&amp;&amp;p.view.wt.wtViewport.resetHasOversizedColumnHeadersMarked(),E.hooks.run(p,&quot;afterUpdateSettings&quot;)),d.adjustRowsAndCols(),p.view&amp;&amp;!l.firstRun&amp;&amp;(p.forceFullRender=!0,h.refreshBorders(null,!0)),t||!p.view||&quot;&quot;!==w&amp;&amp;&quot;&quot;!==v&amp;&amp;void 0!==v||w===v||p.view.wt.wtOverlays.updateMainScrollableElements()},this.getValue=function(){var e=p.getSelected();if(m.prototype.getValue){if(P(m.prototype.getValue))return m.prototype.getValue.call(p);if(e)return p.getData()[e[0]][m.prototype.getValue]}else if(e)return p.getDataAtCell(e[0],e[1])},this.getSettings=function(){return l.settings},this.clear=function(){h.selectAll(),h.empty()},this.alter=function(e,t,n,o,r){d.alter(e,t,n,o,r)},this.getCell=function(e,t,n){return p.view.getCellAtCoords(new ue(e,t),n)},this.getCoords=function(e){return this.view.wt.wtTable.getCoords.call(this.view.wt.wtTable,e)},this.colToProp=function(e){return u.colToProp(e)},this.propToCol=function(e){return u.propToCol(e)},this.toVisualRow=function(e){return w.toVisualRow(e)},this.toVisualColumn=function(e){return w.toVisualColumn(e)},this.toPhysicalRow=function(e){return w.toPhysicalRow(e)},this.toPhysicalColumn=function(e){return w.toPhysicalColumn(e)},this.getDataAtCell=function(e,t){return u.get(e,u.colToProp(t))},this.getDataAtRowProp=function(e,t){return u.get(e,t)},this.getDataAtCol=function(e){var t=[];return t.concat.apply(t,u.getRange(new ue(0,e),new ue(l.settings.data.length-1,e),u.DESTINATION_RENDERER))},this.getDataAtProp=function(e){var t,n=[];return t=u.getRange(new ue(0,u.propToCol(e)),new ue(l.settings.data.length-1,u.propToCol(e)),u.DESTINATION_RENDERER),
n.concat.apply(n,t)},this.getSourceData=function(e,t,n,o){var r;return r=void 0===e?c.getData():c.getByRange(new ue(e,t),new ue(n,o))},this.getSourceDataArray=function(e,t,n,o){var r;return r=void 0===e?c.getData(!0):c.getByRange(new ue(e,t),new ue(n,o),!0)},this.getSourceDataAtCol=function(e){return c.getAtColumn(e)},this.getSourceDataAtRow=function(e){return c.getAtRow(e)},this.getSourceDataAtCell=function(e,t){return c.getAtCell(e,t)},this.getDataAtRow=function(e){var t=u.getRange(new ue(e,0),new ue(e,this.countCols()-1),u.DESTINATION_RENDERER);return t[0]},this.getDataType=function(e,t,n,o){var r=this,i=null,s=null;void 0===e&amp;&amp;(e=0,n=this.countRows(),t=0,o=this.countCols()),void 0===n&amp;&amp;(n=e),void 0===o&amp;&amp;(o=t);var a=&quot;mixed&quot;;return te(Math.min(e,n),Math.max(e,n),function(e){var n=!0;return te(Math.min(t,o),Math.max(t,o),function(t){var o=r.getCellMeta(e,t);return s=o.type,i?n=i===s:i=s,n}),a=n?s:&quot;mixed&quot;,n}),a},this.removeCellMeta=function(e,t,n){var o=p.getCellMeta(e,t);void 0!=o[n]&amp;&amp;delete l.cellSettings[e][t][n]},this.spliceCellsMeta=function(e,t){for(var n,o=[],r=2;r&lt;arguments.length;r++)o[r-2]=arguments[r];(n=l.cellSettings).splice.apply(n,$traceurRuntime.spread([e,t],o))},this.setCellMetaObject=function(e,t,n){if(&quot;object&quot;==typeof n)for(var o in n)if(n.hasOwnProperty(o)){var r=n[o];this.setCellMeta(e,t,o,r)}},this.setCellMeta=function(e,t,n,o){var r;r=w.toPhysical(e,t),e=r[0],t=r[1],r,l.cellSettings[e]||(l.cellSettings[e]=[]),l.cellSettings[e][t]||(l.cellSettings[e][t]=new l.columnSettings[t]),l.cellSettings[e][t][n]=o,E.hooks.run(p,&quot;afterSetCellMeta&quot;,e,t,n,o)},this.getCellsMeta=function(){return q(l.cellSettings)},this.getCellMeta=function(e,t){var n,o,r=u.colToProp(t),i=e,a=t;if(n=w.toPhysical(e,t),e=n[0],t=n[1],n,l.columnSettings[t]||(l.columnSettings[t]=A(m,l.columnsSettingConflicts)),l.cellSettings[e]||(l.cellSettings[e]=[]),l.cellSettings[e][t]||(l.cellSettings[e][t]=new l.columnSettings[t]),o=l.cellSettings[e][t],o.row=e,o.col=t,o.visualRow=i,o.visualCol=a,o.prop=r,o.instance=p,E.hooks.run(p,&quot;beforeGetCellMeta&quot;,e,t,o),U(o,s(o)),o.cells){var c=o.cells.call(o,e,t,r);c&amp;&amp;(U(o,c),U(o,s(c)))}return E.hooks.run(p,&quot;afterGetCellMeta&quot;,e,t,o),o},this.getCellMetaAtRow=function(e){return l.cellSettings[e]},this.isColumnModificationAllowed=function(){return!(&quot;object&quot;===p.dataType||p.getSettings().columns)};var v=se(&quot;renderer&quot;);this.getCellRenderer=function(e,t){var n=v.call(this,e,t);return Q(n)},this.getCellEditor=se(&quot;editor&quot;),this.getCellValidator=se(&quot;validator&quot;),this.validateCells=function(e){var t=new n;e&amp;&amp;(t.onQueueEmpty=e);for(var o=p.countRows()-1;o&gt;=0;){for(var r=p.countCols()-1;r&gt;=0;)t.addValidatorToQueue(),p.validateCell(p.getDataAtCell(o,r),p.getCellMeta(o,r),function(e){if(&quot;boolean&quot;!=typeof e)throw new Error(&quot;Validation error: result is not boolean&quot;);e===!1&amp;&amp;(t.valid=!1),t.removeValidatorFormQueue()},&quot;validateCells&quot;),r--;o--}t.checkIfQueueIsEmpty()},this.getRowHeader=function(e){var t=l.settings.rowHeaders;return void 0!==e&amp;&amp;(e=E.hooks.run(p,&quot;modifyRowHeader&quot;,e)),void 0===e?(t=[],te(p.countRows()-1,function(e){t.push(p.getRowHeader(e))})):Array.isArray(t)&amp;&amp;void 0!==t[e]?t=t[e]:P(t)?t=t(e):t&amp;&amp;&quot;string&quot;!=typeof t&amp;&amp;&quot;number&quot;!=typeof t&amp;&amp;(t=e+1),t},this.hasRowHeaders=function(){return!!l.settings.rowHeaders},this.hasColHeaders=function(){if(void 0!==l.settings.colHeaders&amp;&amp;null!==l.settings.colHeaders)return!!l.settings.colHeaders;for(var e=0,t=p.countCols();e&lt;t;e++)if(p.getColHeader(e))return!0;return!1},this.getColHeader=function(e){var t=l.settings.columns&amp;&amp;P(l.settings.columns),n=l.settings.colHeaders;if(e=E.hooks.run(p,&quot;modifyColHeader&quot;,e),void 0===e){for(var o=[],r=t?p.countSourceCols():p.countCols(),i=0;i&lt;r;i++)o.push(p.getColHeader(i));n=o}else{var s=function(e){for(var t=[],n=p.countSourceCols(),o=0;o&lt;n;o++)P(p.getSettings().columns)&amp;&amp;p.getSettings().columns(o)&amp;&amp;t.push(o);return t[e]},a=e;e=E.hooks.run(p,&quot;modifyCol&quot;,e);var u=s(e);l.settings.columns&amp;&amp;P(l.settings.columns)&amp;&amp;l.settings.columns(u)&amp;&amp;l.settings.columns(u).title?n=l.settings.columns(u).title:l.settings.columns&amp;&amp;l.settings.columns[e]&amp;&amp;l.settings.columns[e].title?n=l.settings.columns[e].title:Array.isArray(l.settings.colHeaders)&amp;&amp;void 0!==l.settings.colHeaders[e]?n=l.settings.colHeaders[e]:P(l.settings.colHeaders)?n=l.settings.colHeaders(e):l.settings.colHeaders&amp;&amp;&quot;string&quot;!=typeof l.settings.colHeaders&amp;&amp;&quot;number&quot;!=typeof l.settings.colHeaders&amp;&amp;(n=ae(a))}return n},this._getColWidthFromSettings=function(e){var t=p.getCellMeta(0,e),n=t.width;if(void 0!==n&amp;&amp;n!==l.settings.width||(n=t.colWidths),void 0!==n&amp;&amp;null!==n){switch(typeof n){case&quot;object&quot;:n=n[e];break;case&quot;function&quot;:n=n(e)}&quot;string&quot;==typeof n&amp;&amp;(n=parseInt(n,10))}return n},this.getColWidth=function(e){var t=p._getColWidthFromSettings(e);return t=E.hooks.run(p,&quot;modifyColWidth&quot;,t,e),void 0===t&amp;&amp;(t=de.DEFAULT_WIDTH),t},this._getRowHeightFromSettings=function(e){var t=l.settings.rowHeights;if(void 0!==t&amp;&amp;null!==t){switch(typeof t){case&quot;object&quot;:t=t[e];break;case&quot;function&quot;:t=t(e)}&quot;string&quot;==typeof t&amp;&amp;(t=parseInt(t,10))}return t},this.getRowHeight=function(e){var t=p._getRowHeightFromSettings(e);return t=E.hooks.run(p,&quot;modifyRowHeight&quot;,t,e)},this.countSourceRows=function(){var e=E.hooks.run(p,&quot;modifySourceLength&quot;);return e||(p.getSourceData()?p.getSourceData().length:0)},this.countSourceCols=function(){var e=0,t=p.getSourceData()&amp;&amp;p.getSourceData()[0]?p.getSourceData()[0]:[];return e=G(t)?K(t):t.length||0},this.countRows=function(){return u.getLength()},this.countCols=function(){var e=!1,t=0;if(&quot;array&quot;===p.dataType&amp;&amp;(e=l.settings.data&amp;&amp;l.settings.data[0]&amp;&amp;l.settings.data[0].length),e&amp;&amp;(t=l.settings.data[0].length),l.settings.columns){var n=P(l.settings.columns);if(n)if(&quot;array&quot;===p.dataType){for(var o=0,r=0;r&lt;t;r++)l.settings.columns(r)&amp;&amp;o++;t=o}else&quot;object&quot;!==p.dataType&amp;&amp;&quot;function&quot;!==p.dataType||(t=u.colToPropCache.length);else t=l.settings.columns.length}else&quot;object&quot;!==p.dataType&amp;&amp;&quot;function&quot;!==p.dataType||(t=u.colToPropCache.length);return t},this.rowOffset=function(){return p.view.wt.wtTable.getFirstRenderedRow()},this.colOffset=function(){return p.view.wt.wtTable.getFirstRenderedColumn()},this.countRenderedRows=function(){return p.view.wt.drawn?p.view.wt.wtTable.getRenderedRowsCount():-1},this.countVisibleRows=function(){return p.view.wt.drawn?p.view.wt.wtTable.getVisibleRowsCount():-1},this.countRenderedCols=function(){return p.view.wt.drawn?p.view.wt.wtTable.getRenderedColumnsCount():-1},this.countVisibleCols=function(){return p.view.wt.drawn?p.view.wt.wtTable.getVisibleColumnsCount():-1},this.countEmptyRows=function(e){for(var t,n=p.countRows()-1,o=0;n&gt;=0;){if(t=E.hooks.run(this,&quot;modifyRow&quot;,n),p.isEmptyRow(t))o++;else if(e)break;n--}return o},this.countEmptyCols=function(e){if(p.countRows()&lt;1)return 0;for(var t=p.countCols()-1,n=0;t&gt;=0;){if(p.isEmptyCol(t))n++;else if(e)break;t--}return n},this.isEmptyRow=function(e){return l.settings.isEmptyRow.call(p,e)},this.isEmptyCol=function(e){return l.settings.isEmptyCol.call(p,e)},this.selectCell=function(e,t,n,o,r,i){var s;if(i=I(i)||i===!0,&quot;number&quot;!=typeof e||e&lt;0||e&gt;=p.countRows())return!1;if(&quot;number&quot;!=typeof t||t&lt;0||t&gt;=p.countCols())return!1;if(L(n)){if(&quot;number&quot;!=typeof n||n&lt;0||n&gt;=p.countRows())return!1;if(&quot;number&quot;!=typeof o||o&lt;0||o&gt;=p.countCols())return!1}return s=new ue(e,t),l.selRange=new ce(s,s,s),i&amp;&amp;p.listen(),I(n)?h.setRangeEnd(l.selRange.from,r):h.setRangeEnd(new ue(n,o),r),p.selection.finish(),!0},this.selectCellByProp=function(e,t,n,o,r){return arguments[1]=u.propToCol(arguments[1]),L(arguments[3])&amp;&amp;(arguments[3]=u.propToCol(arguments[3])),p.selectCell.apply(p,arguments)},this.deselectCell=function(){h.deselect()},this.scrollViewportTo=function(e,t){var n=void 0!==arguments[2]&amp;&amp;arguments[2],o=void 0!==arguments[3]&amp;&amp;arguments[3];if(void 0!==e&amp;&amp;(e&lt;0||e&gt;=p.countRows()))return!1;if(void 0!==t&amp;&amp;(t&lt;0||t&gt;=p.countCols()))return!1;var r=!1;return void 0!==e&amp;&amp;void 0!==t&amp;&amp;(p.view.wt.wtOverlays.topOverlay.scrollTo(e,n),p.view.wt.wtOverlays.leftOverlay.scrollTo(t,o),r=!0),&quot;number&quot;==typeof e&amp;&amp;&quot;number&quot;!=typeof t&amp;&amp;(p.view.wt.wtOverlays.topOverlay.scrollTo(e,n),r=!0),&quot;number&quot;==typeof t&amp;&amp;&quot;number&quot;!=typeof e&amp;&amp;(p.view.wt.wtOverlays.leftOverlay.scrollTo(t,o),r=!0),r},this.destroy=function(){p._clearTimeouts(),p.view&amp;&amp;p.view.destroy(),c&amp;&amp;c.destroy(),c=null,x(p.rootElement),g.destroy(),E.hooks.run(p,&quot;afterDestroy&quot;),E.hooks.destroy(p);for(var e in p)p.hasOwnProperty(e)&amp;&amp;(P(p[e])?p[e]=a:&quot;guid&quot;!==e&amp;&amp;(p[e]=null));u&amp;&amp;u.destroy(),u=null,l=null,d=null,h=null,f=null,p=null,m=null},this.getActiveEditor=function(){return f.getActiveEditor()},this.getPlugin=function(e){return J(this,e)},this.getInstance=function(){return p},this.addHook=function(e,t){E.hooks.add(e,t,p)},this.hasHook=function(e){return E.hooks.has(e,p)},this.addHookOnce=function(e,t){E.hooks.once(e,t,p)},this.removeHook=function(e,t){E.hooks.remove(e,t,p)},this.runHooks=function(e,t,n,o,r,i,s){return E.hooks.run(p,e,t,n,o,r,i,s)},this.timeouts=[],this._registerTimeout=function(e){this.timeouts.push(e)},this._clearTimeouts=function(){for(var e=0,t=this.timeouts.length;e&lt;t;e++)clearTimeout(this.timeouts[e])},this.version=E.version,E.hooks.run(p,&quot;construct&quot;)};var he=function(){};he.prototype={data:void 0,dataSchema:void 0,width:void 0,height:void 0,startRows:5,startCols:5,rowHeaders:void 0,colHeaders:null,colWidths:void 0,rowHeights:void 0,columns:void 0,cells:void 0,cell:[],comments:!1,customBorders:!1,minRows:0,minCols:0,maxRows:1/0,maxCols:1/0,minSpareRows:0,minSpareCols:0,allowInsertRow:!0,allowInsertColumn:!0,allowRemoveRow:!0,allowRemoveColumn:!0,multiSelect:!0,fillHandle:!0,fixedRowsTop:0,fixedRowsBottom:0,fixedColumnsLeft:0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,pasteMode:&quot;overwrite&quot;,persistentState:void 0,currentRowClassName:void 0,currentColClassName:void 0,currentHeaderClassName:&quot;ht__highlight&quot;,className:void 0,tableClassName:void 0,stretchH:&quot;none&quot;,isEmptyRow:function(e){var t,n,o,r;for(t=0,n=this.countCols();t&lt;n;t++)if(o=this.getDataAtCell(e,t),&quot;&quot;!==o&amp;&amp;null!==o&amp;&amp;L(o))return&quot;object&quot;==typeof o&amp;&amp;(r=this.getCellMeta(e,t),$(this.getSchema()[r.prop],o));return!0},isEmptyCol:function(e){var t,n,o;for(t=0,n=this.countRows();t&lt;n;t++)if(o=this.getDataAtCell(t,e),&quot;&quot;!==o&amp;&amp;null!==o&amp;&amp;L(o))return!1;return!0},observeDOMVisibility:!0,allowInvalid:!0,allowEmpty:!0,invalidCellClassName:&quot;htInvalid&quot;,placeholder:!1,placeholderCellClassName:&quot;htPlaceholder&quot;,readOnlyCellClassName:&quot;htDimmed&quot;,renderer:void 0,commentedCellClassName:&quot;htCommentCell&quot;,fragmentSelection:!1,readOnly:!1,skipColumnOnPaste:!1,search:!1,type:&quot;text&quot;,copyable:!0,editor:void 0,autoComplete:void 0,visibleRows:10,trimDropdown:!0,debug:!1,wordWrap:!0,noWordWrapClassName:&quot;htNoWrap&quot;,contextMenu:void 0,contextMenuCopyPaste:void 0,copyPaste:void 0,undo:void 0,columnSorting:void 0,manualColumnMove:void 0,manualColumnResize:void 0,manualRowMove:void 0,manualRowResize:void 0,mergeCells:!1,viewportRowRenderingOffset:&quot;auto&quot;,viewportColumnRenderingOffset:&quot;auto&quot;,validator:void 0,disableVisualSelection:!1,sortIndicator:void 0,manualColumnFreeze:void 0,trimWhitespace:!0,settings:void 0,source:void 0,title:void 0,checkedTemplate:void 0,uncheckedTemplate:void 0,label:void 0,format:void 0,language:void 0,selectOptions:void 0,autoColumnSize:void 0,autoRowSize:void 0,dateFormat:void 0,correctFormat:!1,defaultDate:void 0,strict:void 0,allowHtml:!1,renderAllRows:void 0,preventOverflow:!1,bindRowsWithHeaders:void 0,collapsibleColumns:void 0,columnSummary:void 0,dropdownMenu:void 0,filters:void 0,formulas:void 0,ganttChart:void 0,headerTooltips:void 0,hiddenColumns:void 0,hiddenRows:void 0,nestedHeaders:void 0,trimRows:void 0,rowHeaderWidth:void 0,columnHeaderHeight:void 0,observeChanges:void 0,sortFunction:void 0,sortByRelevance:!0,filter:!0,filteringCaseSensitive:!1},E.DefaultSettings=he},{&quot;3rdparty/walkontable/src/calculator/viewportColumns&quot;:4,&quot;3rdparty/walkontable/src/cell/coords&quot;:6,&quot;3rdparty/walkontable/src/cell/range&quot;:7,browser:24,dataMap:27,dataSource:28,editorManager:29,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/browser&quot;:44,&quot;helpers/data&quot;:45,&quot;helpers/dom/element&quot;:47,&quot;helpers/function&quot;:50,&quot;helpers/mixed&quot;:51,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;helpers/setting&quot;:54,&quot;helpers/string&quot;:55,numbro:&quot;numbro&quot;,plugins:61,renderers:117,tableView:126,&quot;utils/recordTranslator&quot;:130}],27:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n){var o=this;this.instance=e,this.priv=t,this.GridSettings=n,this.dataSource=this.instance.getSettings().data,this.cachedLength=null,this.skipCache=!1,this.latestSourceRowsCount=0,this.dataSource&amp;&amp;this.dataSource[0]?this.duckSchema=this.recursiveDuckSchema(this.dataSource[0]):this.duckSchema={},this.createMap(),this.interval=O.create(function(){return o.clearLengthCache()},&quot;15fps&quot;),this.instance.addHook(&quot;skipLengthCache&quot;,function(e){return o.onSkipLengthCache(e)})}Object.defineProperties(n,{DataMap:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d,h,f=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,p=(i=e(&quot;SheetClip&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,m=(s=e(&quot;helpers/data&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).cellMethodLookupFactory,g=(a=e(&quot;helpers/setting&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).columnFactory,w=(l=e(&quot;helpers/object&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),v=w.createObjectPropListener,y=w.duckSchema,b=w.deepExtend,C=w.deepClone,_=w.isObject,R=w.deepObjectSize,M=(u=e(&quot;helpers/array&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}),S=M.extendArray,E=M.to2dArray,O=(c=e(&quot;utils/interval&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).Interval,T=(d=e(&quot;helpers/number&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).rangeEach,k=(h=e(&quot;multiMap&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).MultiMap;o.prototype.DESTINATION_RENDERER=1,o.prototype.DESTINATION_CLIPBOARD_GENERATOR=2,o.prototype.recursiveDuckSchema=function(e){return y(e)},o.prototype.recursiveDuckColumns=function(e,t,n){var o,r;if(&quot;undefined&quot;==typeof t&amp;&amp;(t=0,n=&quot;&quot;),&quot;object&quot;==typeof e&amp;&amp;!Array.isArray(e))for(r in e)e.hasOwnProperty(r)&amp;&amp;(null===e[r]?(o=n+r,this.colToPropCache.push(o),this.propToColCache.set(o,t),t++):t=this.recursiveDuckColumns(e[r],t,r+&quot;.&quot;));return t},o.prototype.createMap=function(){var e,t=this.getSchema();if(&quot;undefined&quot;==typeof t)throw new Error(&quot;trying to create `columns` definition but you didn't provide `schema` nor `data`&quot;);this.colToPropCache=[],this.propToColCache=new k;var n=this.instance.getSettings().columns;if(n){var o=n.length,r=0,i=!1,s=R(t);for(&quot;function&quot;==typeof n&amp;&amp;(o=s&gt;0?s:this.instance.countSourceCols(),i=!0),e=0;e&lt;o;e++){var a=i?n(e):n[e];if(_(a)){if(&quot;undefined&quot;!=typeof a.data){var l=i?r:e;this.colToPropCache[l]=a.data,this.propToColCache.set(a.data,l)}r++}}}else this.recursiveDuckColumns(t)},o.prototype.colToProp=function(e){return e=f.hooks.run(this.instance,&quot;modifyCol&quot;,e),this.colToPropCache&amp;&amp;&quot;undefined&quot;!=typeof this.colToPropCache[e]?this.colToPropCache[e]:e},o.prototype.propToCol=function(e){var t;return t=&quot;undefined&quot;==typeof this.propToColCache.get(e)?e:this.propToColCache.get(e),t=f.hooks.run(this.instance,&quot;unmodifyCol&quot;,t)},o.prototype.getSchema=function(){var e=this.instance.getSettings().dataSchema;return e?&quot;function&quot;==typeof e?e():e:this.duckSchema},o.prototype.createRow=function(e,t,n){var o,r,i=this.instance.countCols(),s=0;t||(t=1),(&quot;number&quot;!=typeof e||e&gt;=this.instance.countSourceRows())&amp;&amp;(e=this.instance.countSourceRows()),f.hooks.run(this.instance,&quot;beforeCreateRow&quot;,e,t,n),r=e;for(var a=this.instance.getSettings().maxRows;s&lt;t&amp;&amp;this.instance.countSourceRows()&lt;a;)&quot;array&quot;===this.instance.dataType?this.instance.getSettings().dataSchema?o=C(this.getSchema()):(o=[],T(i-1,function(){return o.push(null)})):&quot;function&quot;===this.instance.dataType?o=this.instance.getSettings().dataSchema(e):(o={},b(o,this.getSchema())),e===this.instance.countSourceRows()?this.dataSource.push(o):this.spliceData(e,0,o),s++,r++;return f.hooks.run(this.instance,&quot;afterCreateRow&quot;,e,s,n),this.instance.forceFullRender=!0,s},o.prototype.createCol=function(e,t,n){if(!this.instance.isColumnModificationAllowed())throw new Error(&quot;Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting.If you want to be able to add new columns, you have to use array datasource.&quot;);var o,r,i=this.instance.countSourceRows(),s=this.dataSource,a=0;t||(t=1),(&quot;number&quot;!=typeof e||e&gt;=this.instance.countCols())&amp;&amp;(e=this.instance.countCols()),f.hooks.run(this.instance,&quot;beforeCreateCol&quot;,e,t,n),r=e;for(var l=this.instance.getSettings().maxCols;a&lt;t&amp;&amp;this.instance.countCols()&lt;l;){if(o=g(this.GridSettings,this.priv.columnsSettingConflicts),&quot;number&quot;!=typeof e||e&gt;=this.instance.countCols()){if(i&gt;0)for(var u=0;u&lt;i;u++)&quot;undefined&quot;==typeof s[u]&amp;&amp;(s[u]=[]),s[u].push(null);else s.push([null]);this.priv.columnSettings.push(o)}else{for(var u=0;u&lt;i;u++)s[u].splice(r,0,null);this.priv.columnSettings.splice(r,0,o)}a++,r++}return f.hooks.run(this.instance,&quot;afterCreateCol&quot;,e,a,n),this.instance.forceFullRender=!0,a},o.prototype.removeRow=function(e,t,n){t||(t=1),&quot;number&quot;!=typeof e&amp;&amp;(e=-t),t=f.hooks.run(this.instance,&quot;modifyRemovedAmount&quot;,t,e),e=(this.instance.countSourceRows()+e)%this.instance.countSourceRows();var o=this.physicalRowsToLogical(e,t),r=f.hooks.run(this.instance,&quot;beforeRemoveRow&quot;,e,t,o,n);if(r!==!1){var i,s=this.dataSource;i=this.filterData(e,t),i&amp;&amp;(s.length=0,Array.prototype.push.apply(s,i)),f.hooks.run(this.instance,&quot;afterRemoveRow&quot;,e,t,o,n),this.instance.forceFullRender=!0}},o.prototype.removeCol=function(e,t,n){if(&quot;object&quot;===this.instance.dataType||this.instance.getSettings().columns)throw new Error(&quot;cannot remove column with object data source or columns option specified&quot;);t||(t=1),&quot;number&quot;!=typeof e&amp;&amp;(e=-t),e=(this.instance.countCols()+e)%this.instance.countCols();var o=this.physicalColumnsToLogical(e,t),r=o.slice(0).sort(function(e,t){return t-e}),i=f.hooks.run(this.instance,&quot;beforeRemoveCol&quot;,e,t,o,n);if(i!==!1){for(var s=!0,a=r.length,l=this.dataSource,u=0;u&lt;a;u++)s&amp;&amp;o[0]!==o[u]-u&amp;&amp;(s=!1);if(s)for(var c=0,d=this.instance.countSourceRows();c&lt;d;c++)l[c].splice(o[0],t);else{for(var h=0,p=this.instance.countSourceRows();h&lt;p;h++)for(var m=0;m&lt;a;m++)l[h].splice(r[m],1);for(var g=0;g&lt;a;g++)this.priv.columnSettings.splice(o[g],1)}f.hooks.run(this.instance,&quot;afterRemoveCol&quot;,e,t,o,n),this.instance.forceFullRender=!0}},o.prototype.spliceCol=function(e,t,n){var o=4&lt;=arguments.length?[].slice.call(arguments,3):[],r=this.instance.getDataAtCol(e),i=r.slice(t,t+n),s=r.slice(t+n);S(o,s);for(var a=0;a&lt;n;)o.push(null),a++;return E(o),this.instance.populateFromArray(t,e,o,null,null,&quot;spliceCol&quot;),i},o.prototype.spliceRow=function(e,t,n){var o=4&lt;=arguments.length?[].slice.call(arguments,3):[],r=this.instance.getSourceDataAtRow(e),i=r.slice(t,t+n),s=r.slice(t+n);S(o,s);for(var a=0;a&lt;n;)o.push(null),a++;return this.instance.populateFromArray(e,t,[o],null,null,&quot;spliceRow&quot;),i},o.prototype.spliceData=function(e,t,n){var o=f.hooks.run(this.instance,&quot;beforeDataSplice&quot;,e,t,n);o!==!1&amp;&amp;this.dataSource.splice(e,t,n)},o.prototype.filterData=function(e,t){var n=this.physicalRowsToLogical(e,t),o=f.hooks.run(this.instance,&quot;beforeDataFilter&quot;,e,t,n);if(o!==!1){var r=this.dataSource.filter(function(e,t){return n.indexOf(t)==-1});return r}},o.prototype.get=function(e,t){e=f.hooks.run(this.instance,&quot;modifyRow&quot;,e);var n=this.dataSource[e],o=f.hooks.run(this.instance,&quot;modifyRowData&quot;,e);n=isNaN(o)?o:n;var r=null;if(n&amp;&amp;n.hasOwnProperty&amp;&amp;n.hasOwnProperty(t))r=n[t];else if(&quot;string&quot;==typeof t&amp;&amp;t.indexOf(&quot;.&quot;)&gt;-1){var i=t.split(&quot;.&quot;),s=n;if(!s)return null;for(var a=0,l=i.length;a&lt;l;a++)if(s=s[i[a]],&quot;undefined&quot;==typeof s)return null;r=s}else&quot;function&quot;==typeof t&amp;&amp;(r=t(this.dataSource.slice(e,e+1)[0]));if(f.hooks.has(&quot;modifyData&quot;,this.instance)){var u=v(r);f.hooks.run(this.instance,&quot;modifyData&quot;,e,this.propToCol(t),u,&quot;get&quot;),u.isTouched()&amp;&amp;(r=u.value)}return r};var x=m(&quot;copyable&quot;,!1);o.prototype.getCopyable=function(e,t){return x.call(this.instance,e,this.propToCol(t))?this.get(e,t):&quot;&quot;},o.prototype.set=function(e,t,n,o){e=f.hooks.run(this.instance,&quot;modifyRow&quot;,e,o||&quot;datamapGet&quot;);var r=this.dataSource[e],i=f.hooks.run(this.instance,&quot;modifyRowData&quot;,e);if(r=isNaN(i)?i:r,f.hooks.has(&quot;modifyData&quot;,this.instance)){var s=v(n);f.hooks.run(this.instance,&quot;modifyData&quot;,e,this.propToCol(t),s,&quot;set&quot;),s.isTouched()&amp;&amp;(n=s.value)}if(r&amp;&amp;r.hasOwnProperty&amp;&amp;r.hasOwnProperty(t))r[t]=n;else if(&quot;string&quot;==typeof t&amp;&amp;t.indexOf(&quot;.&quot;)&gt;-1){for(var a=t.split(&quot;.&quot;),l=r,u=0,c=a.length-1;u&lt;c;u++)&quot;undefined&quot;==typeof l[a[u]]&amp;&amp;(l[a[u]]={}),l=l[a[u]];l[a[u]]=n}else&quot;function&quot;==typeof t?t(this.dataSource.slice(e,e+1)[0],n):r[t]=n},o.prototype.physicalRowsToLogical=function(e,t){for(var n,o=this.instance.countSourceRows(),r=(o+e)%o,i=[],s=t;r&lt;o&amp;&amp;s;)n=f.hooks.run(this.instance,&quot;modifyRow&quot;,r),i.push(n),s--,r++;return i},o.prototype.physicalColumnsToLogical=function(e,t){for(var n=this.instance.countCols(),o=(n+e)%n,r=[],i=t;o&lt;n&amp;&amp;i;){var s=f.hooks.run(this.instance,&quot;modifyCol&quot;,o);r.push(s),i--,o++}return r},o.prototype.clear=function(){for(var e=0;e&lt;this.instance.countSourceRows();e++)for(var t=0;t&lt;this.instance.countCols();t++)this.set(e,this.colToProp(t),&quot;&quot;)},o.prototype.clearLengthCache=function(){this.cachedLength=null},o.prototype.getLength=function(){var e,t=this,n=this.instance.getSettings().maxRows;e=n&lt;0||0===n?0:n||1/0;var o=this.instance.countSourceRows();if(f.hooks.has(&quot;modifyRow&quot;,this.instance)){var r=this.skipCache;this.interval.start(),o!==this.latestSourceRowsCount&amp;&amp;(r=!0),this.latestSourceRowsCount=o,null===this.cachedLength||r?(T(o-1,function(e){e=f.hooks.run(t.instance,&quot;modifyRow&quot;,e),null===e&amp;&amp;--o}),this.cachedLength=o):o=this.cachedLength}else this.interval.stop();return Math.min(o,e)},o.prototype.getAll=function(){var e={row:0,col:0},t=this.instance.getSettings().maxRows;if(0===t)return[];var n={row:Math.min(Math.max(t-1,0),Math.max(this.instance.countSourceRows()-1,0)),col:Math.max(this.instance.countCols()-1,0)};return e.row-n.row!==0||this.instance.countSourceRows()?this.getRange(e,n,o.prototype.DESTINATION_RENDERER):[]},o.prototype.getRange=function(e,t,n){var o,r,i,s,a,l=[],u=n===this.DESTINATION_CLIPBOARD_GENERATOR?this.getCopyable:this.get;for(r=Math.max(e.row,t.row),s=Math.max(e.col,t.col),o=Math.min(e.row,t.row);o&lt;=r;o++){a=[];var c=f.hooks.run(this.instance,&quot;modifyRow&quot;,o);for(i=Math.min(e.col,t.col);i&lt;=s&amp;&amp;null!==c;i++)a.push(u.call(this,o,this.colToProp(i)));null!==c&amp;&amp;l.push(a)}return l},o.prototype.getText=function(e,t){return p.stringify(this.getRange(e,t,this.DESTINATION_RENDERER))},o.prototype.getCopyableText=function(e,t){return p.stringify(this.getRange(e,t,this.DESTINATION_CLIPBOARD_GENERATOR))},o.prototype.onSkipLengthCache=function(e){var t=this;this.skipCache=!0,setTimeout(function(){t.skipCache=!1},e)},o.prototype.destroy=function(){this.interval.stop(),this.interval=null,this.instance=null,this.priv=null,this.GridSettings=null,this.dataSource=null,this.cachedLength=null,this.duckSchema=null}},{SheetClip:&quot;SheetClip&quot;,browser:24,&quot;helpers/array&quot;:43,&quot;helpers/data&quot;:45,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;helpers/setting&quot;:54,multiMap:59,&quot;utils/interval&quot;:129}],28:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{DataSource:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;helpers/object&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).getProperty,a=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayEach,l=(i=e(&quot;helpers/number&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).rangeEach,u=function(e){var t=void 0!==arguments[1]?arguments[1]:[];this.hot=e,this.data=t,this.dataType=&quot;array&quot;,this.colToProp=function(){},this.propToCol=function(){}};$traceurRuntime.createClass(u,{getData:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0],t=this.data;return e&amp;&amp;(t=this.getByRange({row:0,col:0},{row:Math.max(this.countRows()-1,0),col:Math.max(this.countColumns()-1,0)},!0)),t},setData:function(e){this.data=e},getAtColumn:function(e){var t=this,n=[];return a(this.data,function(o){var r=t.colToProp(e);o=&quot;string&quot;==typeof r?s(o,r):o[r],n.push(o)}),n},getAtRow:function(e){return this.data[e]},getAtCell:function(e,t){var n=null,o=this.hot.runHooks(&quot;modifyRowData&quot;,e),r=isNaN(o)?o:this.data[e];if(r){var i=this.colToProp(t);n=&quot;string&quot;==typeof i?s(r,i):&quot;function&quot;==typeof i?i(this.data.slice(e,e+1)[0]):r[i]}return n},getByRange:function(e,t){var n=void 0!==arguments[2]&amp;&amp;arguments[2],o=this,r=Math.min(e.row,t.row),i=Math.min(e.col,t.col),s=Math.max(e.row,t.row),a=Math.max(e.col,t.col),u=[];return l(r,s,function(e){var t,r=o.getAtRow(e);&quot;array&quot;===o.dataType?t=r.slice(i,a+1):&quot;object&quot;===o.dataType&amp;&amp;(t=n?[]:{},l(i,a,function(e){var i=o.colToProp(e);n?t.push(r[i]):t[i]=r[i]})),u.push(t)}),u},countRows:function(){return Array.isArray(this.data)?this.data.length:0},countColumns:function(){var e=0;return Array.isArray(this.data)&amp;&amp;(&quot;array&quot;===this.dataType?e=this.data[0].length:&quot;object&quot;===this.dataType&amp;&amp;(e=Object.keys(this.data[0]).length)),e},destroy:function(){this.data=null,this.hot=null}},{})},{&quot;helpers/array&quot;:43,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53}],29:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n){function o(e){var o=&quot;function&quot;==typeof t.settings.enterMoves?t.settings.enterMoves(event):t.settings.enterMoves;e?n.transformStart(-o.row,-o.col):n.transformStart(o.row,o.col,!0)}function r(e){e?n.transformEnd(-1,0):n.transformStart(-1,0)}function i(e){e?n.transformEnd(1,0):n.transformStart(1,0)}function s(e){e?n.transformEnd(0,1):n.transformStart(0,1)}function a(e){e?n.transformEnd(0,-1):n.transformStart(0,-1)}function l(l){var u,h;if(e.isListening()&amp;&amp;(c.hooks.run(e,&quot;beforeKeyDown&quot;,l),!_&amp;&amp;!y(l)&amp;&amp;(t.lastKeyCode=l.keyCode,n.isSelected()))){if(u=(l.ctrlKey||l.metaKey)&amp;&amp;!l.altKey,g&amp;&amp;!g.isWaiting()&amp;&amp;!(p(l.keyCode)||m(l.keyCode)||u||C.isEditorOpened()))return void C.openEditor(&quot;&quot;,l);switch(h=l.shiftKey?n.setRangeEnd:n.setRangeStart,l.keyCode){case f.A:!C.isEditorOpened()&amp;&amp;u&amp;&amp;(n.selectAll(),l.preventDefault(),w(l));break;case f.ARROW_UP:C.isEditorOpened()&amp;&amp;!g.isWaiting()&amp;&amp;C.closeEditorAndSaveChanges(u),r(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_DOWN:C.isEditorOpened()&amp;&amp;!g.isWaiting()&amp;&amp;C.closeEditorAndSaveChanges(u),i(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_RIGHT:C.isEditorOpened()&amp;&amp;!g.isWaiting()&amp;&amp;C.closeEditorAndSaveChanges(u),s(l.shiftKey),l.preventDefault(),w(l);break;case f.ARROW_LEFT:C.isEditorOpened()&amp;&amp;!g.isWaiting()&amp;&amp;C.closeEditorAndSaveChanges(u),a(l.shiftKey),l.preventDefault(),w(l);break;case f.TAB:var b=&quot;function&quot;==typeof t.settings.tabMoves?t.settings.tabMoves(l):t.settings.tabMoves;l.shiftKey?n.transformStart(-b.row,-b.col):n.transformStart(b.row,b.col,!0),l.preventDefault(),w(l);break;case f.BACKSPACE:case f.DELETE:n.empty(l),C.prepareEditor(),l.preventDefault();break;case f.F2:C.openEditor(null,l),g&amp;&amp;g.enableFullEditMode(),l.preventDefault();break;case f.ENTER:C.isEditorOpened()?(g&amp;&amp;g.state!==c.EditorState.WAITING&amp;&amp;C.closeEditorAndSaveChanges(u),o(l.shiftKey)):e.getSettings().enterBeginsEditing?(C.openEditor(null,l),g&amp;&amp;g.enableFullEditMode()):o(l.shiftKey),l.preventDefault(),v(l);break;case f.ESCAPE:C.isEditorOpened()&amp;&amp;C.closeEditorAndRestoreOriginalValue(u),l.preventDefault();break;case f.HOME:h(l.ctrlKey||l.metaKey?new d(0,t.selRange.from.col):new d(t.selRange.from.row,0)),l.preventDefault(),w(l);break;case f.END:h(l.ctrlKey||l.metaKey?new d(e.countRows()-1,t.selRange.from.col):new d(t.selRange.from.row,e.countCols()-1)),l.preventDefault(),w(l);break;case f.PAGE_UP:n.transformStart(-e.countVisibleRows(),0),l.preventDefault(),w(l);break;case f.PAGE_DOWN:n.transformStart(e.countVisibleRows(),0),l.preventDefault(),w(l)}}}function u(){function t(e,t,n){&quot;TD&quot;==n.nodeName&amp;&amp;(C.openEditor(),g&amp;&amp;g.enableFullEditMode())}e.addHook(&quot;afterDocumentKeyDown&quot;,l),h.addEventListener(document.documentElement,&quot;keydown&quot;,function(t){_||e.runHooks(&quot;afterDocumentKeyDown&quot;,t)}),e.view.wt.update(&quot;onCellDblClick&quot;,t),e.addHook(&quot;afterDestroy&quot;,function(){_=!0})}var h,g,C=this,_=!1;h=b(e),this.destroyEditor=function(e){this.closeEditor(e)},this.getActiveEditor=function(){return g},this.prepareEditor=function(){var n,o,r,i,s,a,l;return g&amp;&amp;g.isWaiting()?void this.closeEditor(!1,!1,function(e){e&amp;&amp;C.prepareEditor()}):(n=t.selRange.highlight.row,o=t.selRange.highlight.col,r=e.colToProp(o),i=e.getCell(n,o),s=e.getSourceDataAtCell(e.runHooks(&quot;modifyRow&quot;,n),o),a=e.getCellMeta(n,o),l=e.getCellEditor(a),void(l?(g=c.editors.getEditor(l,e),g.prepare(n,o,r,i,s,a)):g=void 0))},this.isEditorOpened=function(){return g&amp;&amp;g.isOpened()},this.openEditor=function(e,t){g&amp;&amp;!g.cellProperties.readOnly?g.beginEditing(e,t):g&amp;&amp;g.cellProperties.readOnly&amp;&amp;t&amp;&amp;t.keyCode===f.ENTER&amp;&amp;o()},this.closeEditor=function(e,t,n){g?g.finishEditing(e,t,n):n&amp;&amp;n(!1)},this.closeEditorAndSaveChanges=function(e){return this.closeEditor(!1,e)},this.closeEditorAndRestoreOriginalValue=function(e){return this.closeEditor(!0,e)},u()}Object.defineProperties(n,{EditorManager:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,d=(i=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).WalkontableCellCoords,h=(s=e(&quot;helpers/unicode&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),f=h.KEY_CODES,p=h.isMetaKey,m=h.isCtrlKey,g=(a=e(&quot;helpers/dom/event&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),w=g.stopPropagation,v=g.stopImmediatePropagation,y=g.isImmediatePropagationStopped,b=((l=e(&quot;editors&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).getEditor,(u=e(&quot;eventManager&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).eventManager);c.EditorManager=o},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,browser:24,editors:30,eventManager:42,&quot;helpers/dom/event&quot;:48,&quot;helpers/unicode&quot;:56}],30:[function(e,t,n){&quot;use strict&quot;;function o(e){var t,n;n={},t=e,this.getConstructor=function(){return e},this.getInstance=function(e){return e.guid in n||(n[e.guid]=new t(e)),n[e.guid]}}function r(e,t){var n=new o(t);&quot;string&quot;==typeof e&amp;&amp;(h[e]=n,c.editors[d(e)+&quot;Editor&quot;]=t),f.set(t,n)}function i(e,t){var n;if(&quot;function&quot;==typeof e)f.get(e)||r(null,e),n=f.get(e);else{if(&quot;string&quot;!=typeof e)throw Error('Only strings and functions can be passed as &quot;editor&quot; parameter ');n=h[e]}if(!n)throw Error('No editor registered under name &quot;'+e+'&quot;');return n.getInstance(t)}function s(e){var t;if(&quot;string&quot;!=typeof e)throw Error('Only strings and functions can be passed as &quot;editor&quot; parameter ');if(t=h[e],!t)throw Error('No editor registered under name &quot;'+e+'&quot;');return t.getConstructor()}function a(e){return!!h[e]}Object.defineProperties(n,{registerEditor:{get:function(){return r}},getEditor:{get:function(){return i}},hasEditor:{get:function(){return a}},getEditorConstructor:{get:function(){return s}},__esModule:{value:!0}});var l,u,c=(l=e(&quot;browser&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).default,d=(u=e(&quot;helpers/string&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).toUpperCaseFirst,h={},f=new WeakMap;c.editors=c.editors||{},c.editors.registerEditor=r,c.editors.getEditor=i},{browser:24,&quot;helpers/string&quot;:55}],31:[function(e,t,n){&quot;use strict&quot;;function o(e){this.instance=e,this.state=a.EditorState.VIRGIN,this._opened=!1,this._fullEditMode=!1,this._closeCallback=null,this.init()}Object.defineProperties(n,{BaseEditor:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,l=(i=e(&quot;helpers/mixed&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).stringify,u=(s=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).WalkontableCellCoords;a.editors=a.editors||{},a.editors.BaseEditor=o,a.EditorState={VIRGIN:&quot;STATE_VIRGIN&quot;,EDITING:&quot;STATE_EDITING&quot;,WAITING:&quot;STATE_WAITING&quot;,FINISHED:&quot;STATE_FINISHED&quot;},o.prototype._fireCallbacks=function(e){this._closeCallback&amp;&amp;(this._closeCallback(e),this._closeCallback=null)},o.prototype.init=function(){},o.prototype.getValue=function(){throw Error(&quot;Editor getValue() method unimplemented&quot;)},o.prototype.setValue=function(e){throw Error(&quot;Editor setValue() method unimplemented&quot;)},o.prototype.open=function(){throw Error(&quot;Editor open() method unimplemented&quot;)},o.prototype.close=function(){throw Error(&quot;Editor close() method unimplemented&quot;);
},o.prototype.prepare=function(e,t,n,o,r,i){this.TD=o,this.row=e,this.col=t,this.prop=n,this.originalValue=r,this.cellProperties=i;var s=!document.activeElement||document.activeElement&amp;&amp;void 0===document.activeElement.nodeName;this.instance.view.isMouseDown()&amp;&amp;document.activeElement&amp;&amp;document.activeElement!==document.body&amp;&amp;!s?document.activeElement.blur():s&amp;&amp;document.body.focus(),this.state=a.EditorState.VIRGIN},o.prototype.extend=function(){function e(){n.apply(this,arguments)}function t(e,t){function n(){}return n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e}var n=this.constructor;return t(e,n)},o.prototype.saveValue=function(e,t){var n,o;t?(n=this.instance.getSelected(),n[0]&gt;n[2]&amp;&amp;(o=n[0],n[0]=n[2],n[2]=o),n[1]&gt;n[3]&amp;&amp;(o=n[1],n[1]=n[3],n[3]=o)):n=[this.row,this.col,null,null],this.instance.populateFromArray(n[0],n[1],e,n[2],n[3],&quot;edit&quot;)},o.prototype.beginEditing=function(e,t){this.state==a.EditorState.VIRGIN&amp;&amp;(this.instance.view.scrollViewport(new u(this.row,this.col)),this.instance.view.render(),this.state=a.EditorState.EDITING,e=&quot;string&quot;==typeof e?e:this.originalValue,this.setValue(l(e)),this.open(t),this._opened=!0,this.focus(),this.instance.view.render(),this.instance.runHooks(&quot;afterBeginEditing&quot;,this.row,this.col))},o.prototype.finishEditing=function(e,t,n){var o,r=this;if(n){var i=this._closeCallback;this._closeCallback=function(e){i&amp;&amp;i(e),n(e),r.instance.view.render()}}if(!this.isWaiting()){if(this.state==a.EditorState.VIRGIN)return void this.instance._registerTimeout(setTimeout(function(){r._fireCallbacks(!0)},0));if(this.state==a.EditorState.EDITING){if(e)return this.cancelChanges(),void this.instance.view.render();var s=this.getValue();o=this.instance.getSettings().trimWhitespace?[[&quot;string&quot;==typeof s?String.prototype.trim.call(s||&quot;&quot;):s]]:[[s]],this.state=a.EditorState.WAITING,this.saveValue(o,t),this.instance.getCellValidator(this.cellProperties)?this.instance.addHookOnce(&quot;postAfterValidate&quot;,function(e){r.state=a.EditorState.FINISHED,r.discardEditor(e)}):(this.state=a.EditorState.FINISHED,this.discardEditor(!0))}}},o.prototype.cancelChanges=function(){this.state=a.EditorState.FINISHED,this.discardEditor()},o.prototype.discardEditor=function(e){this.state===a.EditorState.FINISHED&amp;&amp;(e===!1&amp;&amp;this.cellProperties.allowInvalid!==!0?(this.instance.selectCell(this.row,this.col),this.focus(),this.state=a.EditorState.EDITING,this._fireCallbacks(!1)):(this.close(),this._opened=!1,this._fullEditMode=!1,this.state=a.EditorState.VIRGIN,this._fireCallbacks(!0)))},o.prototype.enableFullEditMode=function(){this._fullEditMode=!0},o.prototype.isInFullEditMode=function(){return this._fullEditMode},o.prototype.isOpened=function(){return this._opened},o.prototype.isWaiting=function(){return this.state===a.EditorState.WAITING},o.prototype.checkEditorSection=function(){var e=this.instance.countRows(),t=&quot;&quot;;return this.row&lt;this.instance.getSettings().fixedRowsTop?t=this.col&lt;this.instance.getSettings().fixedColumnsLeft?&quot;top-left-corner&quot;:&quot;top&quot;:this.instance.getSettings().fixedRowsBottom&amp;&amp;this.row&gt;=e-this.instance.getSettings().fixedRowsBottom?t=this.col&lt;this.instance.getSettings().fixedColumnsLeft?&quot;bottom-left-corner&quot;:&quot;bottom&quot;:this.col&lt;this.instance.getSettings().fixedColumnsLeft&amp;&amp;(t=&quot;left&quot;),t}},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,browser:24,&quot;helpers/mixed&quot;:51}],32:[function(e,t,n){&quot;use strict&quot;;function o(e){H=!1;var t=this.getActiveEditor();if(f(e.keyCode)||e.keyCode===h.BACKSPACE||e.keyCode===h.DELETE||e.keyCode===h.INSERT){var n=0;if(e.keyCode===h.C&amp;&amp;(e.ctrlKey||e.metaKey))return;t.isOpened()||(n+=10),t.htEditor&amp;&amp;t.instance._registerTimeout(setTimeout(function(){t.queryChoices(t.TEXTAREA.value),H=!0},n))}}Object.defineProperties(n,{AutocompleteEditor:{get:function(){return D}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d=(r=e(&quot;helpers/unicode&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),h=d.KEY_CODES,f=d.isPrintableChar,p=(i=e(&quot;helpers/mixed&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).stringify,m=(s=e(&quot;helpers/string&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).stripTags,g=(a=e(&quot;helpers/array&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),w=g.pivot,v=(g.arrayFilter,g.arrayMap),y=(l=e(&quot;helpers/dom/element&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),b=y.addClass,C=y.getCaretPosition,_=y.getScrollbarWidth,R=y.getSelectionEndPosition,M=y.outerWidth,S=y.outerHeight,E=y.offset,O=y.getTrimmingContainer,T=y.setCaretPosition,k=(u=e(&quot;editors&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).registerEditor,x=(c=e(&quot;handsontableEditor&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).HandsontableEditor,D=x.prototype.extend();D.prototype.init=function(){x.prototype.init.apply(this,arguments),this.query=null,this.choices=[]},D.prototype.createElements=function(){x.prototype.createElements.apply(this,arguments),b(this.htContainer,&quot;autocompleteEditor&quot;),b(this.htContainer,window.navigator.platform.indexOf(&quot;Mac&quot;)===-1?&quot;&quot;:&quot;htMacScroll&quot;)};var H=!1;D.prototype.prepare=function(){this.instance.addHook(&quot;beforeKeyDown&quot;,o),x.prototype.prepare.apply(this,arguments)},D.prototype.open=function(){this.TEXTAREA_PARENT.style.overflow=&quot;auto&quot;,x.prototype.open.apply(this,arguments),this.TEXTAREA_PARENT.style.overflow=&quot;&quot;;var e=this.htEditor.getInstance(),t=this,n=void 0===this.cellProperties.trimDropdown||this.cellProperties.trimDropdown;this.TEXTAREA.style.visibility=&quot;visible&quot;,this.focus(),e.updateSettings({colWidths:n?[M(this.TEXTAREA)-2]:void 0,width:n?M(this.TEXTAREA)+_()+2:void 0,afterRenderer:function(e,n,o,r,i,s){var a,l,u=t.cellProperties,c=u.filteringCaseSensitive,d=u.allowHtml;i=p(i),i&amp;&amp;!d&amp;&amp;(a=c===!0?i.indexOf(this.query):i.toLowerCase().indexOf(t.query.toLowerCase()),a!==-1&amp;&amp;(l=i.substr(a,t.query.length),i=i.replace(l,&quot;&lt;strong&gt;&quot;+l+&quot;&lt;/strong&gt;&quot;))),e.innerHTML=i},autoColumnSize:!0,modifyColWidth:function(e,t){var o=this.getPlugin(&quot;autoColumnSize&quot;).widths;return o[t]&amp;&amp;(e=o[t]),n?e:e+15}}),this.htEditor.view.wt.wtTable.holder.parentNode.style[&quot;padding-right&quot;]=_()+2+&quot;px&quot;,H&amp;&amp;(H=!1),t.instance._registerTimeout(setTimeout(function(){t.queryChoices(t.TEXTAREA.value)},0))},D.prototype.close=function(){x.prototype.close.apply(this,arguments)},D.prototype.queryChoices=function(e){var t=this;this.query=e;var n=this.cellProperties,o=n.source,r=(n.filter,n.filteringCaseSensitive,n.allowHtml),i=function(e){return v(e,function(e){return m(e)})};&quot;function&quot;==typeof o?o.call(this.cellProperties,e,function(e){t.updateChoicesList(r?e:i(e))}):Array.isArray(o)?this.updateChoicesList(r?o:i(o)):this.updateChoicesList([])},D.prototype.updateChoicesList=function(e){var t=C(this.TEXTAREA),n=R(this.TEXTAREA),o=this.cellProperties.sortByRelevance,r=this.cellProperties.filter,i=null,s=null;o&amp;&amp;(i=D.sortByRelevance(this.getValue(),e,this.cellProperties.filteringCaseSensitive));var a=Array.isArray(i)?i.length:0;if(r===!1)a&amp;&amp;(s=i[0]);else{for(var l=[],u=0,c=e.length;u&lt;c&amp;&amp;!(o&amp;&amp;a&lt;=u);u++)a?l.push(e[i[u]]):l.push(e[u]);s=0,e=l}this.choices=e,this.htEditor.loadData(w([e])),this.updateDropdownHeight(),this.flipDropdownIfNeeded(),this.cellProperties.strict===!0&amp;&amp;this.highlightBestMatchingChoice(s),this.instance.listen(),this.TEXTAREA.focus(),T(this.TEXTAREA,t,t===n?void 0:n)},D.prototype.flipDropdownIfNeeded=function(){var e=E(this.TEXTAREA),t=S(this.TEXTAREA),n=this.getDropdownHeight(),o=O(this.instance.view.wt.wtTable.TABLE),r=o.scrollTop,i=S(this.instance.view.wt.wtTable.THEAD),s={row:0,col:0};o!==window&amp;&amp;(s=E(o));var a=e.top-s.top-i+r,l=o.scrollHeight-a-i-t,u=n&gt;l&amp;&amp;a&gt;l;return u?this.flipDropdown(n):this.unflipDropdown(),this.limitDropdownIfNeeded(u?a:l,n),u},D.prototype.limitDropdownIfNeeded=function(e,t){if(t&gt;e){var n=0,o=0,r=0,i=null;do r=this.htEditor.getRowHeight(o)||this.htEditor.view.wt.wtSettings.settings.defaultRowHeight,n+=r,o++;while(n&lt;e);i=n-r,this.htEditor.flipped&amp;&amp;(this.htEditor.rootElement.style.top=parseInt(this.htEditor.rootElement.style.top,10)+t-i+&quot;px&quot;),this.setDropdownHeight(n-r)}},D.prototype.flipDropdown=function(e){var t=this.htEditor.rootElement.style;t.position=&quot;absolute&quot;,t.top=-e+&quot;px&quot;,this.htEditor.flipped=!0},D.prototype.unflipDropdown=function(){var e=this.htEditor.rootElement.style;&quot;absolute&quot;===e.position&amp;&amp;(e.position=&quot;&quot;,e.top=&quot;&quot;),this.htEditor.flipped=void 0},D.prototype.updateDropdownHeight=function(){var e=this.htEditor.getColWidth(0)+_()+2,t=this.cellProperties.trimDropdown;this.htEditor.updateSettings({height:this.getDropdownHeight(),width:t?void 0:e}),this.htEditor.view.wt.wtTable.alignOverlaysWithTrimmingContainer()},D.prototype.setDropdownHeight=function(e){this.htEditor.updateSettings({height:e})},D.prototype.finishEditing=function(e){e||this.instance.removeHook(&quot;beforeKeyDown&quot;,o),x.prototype.finishEditing.apply(this,arguments)},D.prototype.highlightBestMatchingChoice=function(e){&quot;number&quot;==typeof e?this.htEditor.selectCell(e,0):this.htEditor.deselectCell()},D.sortByRelevance=function(e,t,n){var o,r,i,s,a=[],l=e.length,u=[],c=t.length;if(0===l){for(s=0;s&lt;c;s++)u.push(s);return u}for(s=0;s&lt;c;s++)o=m(p(t[s])),r=n?o.indexOf(e):o.toLowerCase().indexOf(e.toLowerCase()),r!=-1&amp;&amp;(i=o.length-r-l,a.push({baseIndex:s,index:r,charsLeft:i,value:o}));for(a.sort(function(e,t){return t.index===-1?-1:e.index===-1?1:e.index&lt;t.index?-1:t.index&lt;e.index?1:e.index===t.index?e.charsLeft&lt;t.charsLeft?-1:e.charsLeft&gt;t.charsLeft?1:0:void 0}),s=0,c=a.length;s&lt;c;s++)u.push(a[s].baseIndex);return u},D.prototype.getDropdownHeight=function(){var e=this.htEditor.getInstance().getRowHeight(0)||23,t=this.cellProperties.visibleRows;return this.choices.length&gt;=t?t*e:this.choices.length*e+8},D.prototype.allowKeyEventPropagation=function(e){var t={row:this.htEditor.getSelectedRange()?this.htEditor.getSelectedRange().from.row:-1},n=!1;return e===h.ARROW_DOWN&amp;&amp;t.row&gt;0&amp;&amp;t.row&lt;this.htEditor.countRows()-1&amp;&amp;(n=!0),e===h.ARROW_UP&amp;&amp;t.row&gt;-1&amp;&amp;(n=!0),n},D.prototype.discardEditor=function(e){x.prototype.discardEditor.apply(this,arguments),this.instance.view.render()},k(&quot;autocomplete&quot;,D)},{editors:30,handsontableEditor:36,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/mixed&quot;:51,&quot;helpers/string&quot;:55,&quot;helpers/unicode&quot;:56}],33:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{CheckboxEditor:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;editors&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).registerEditor,a=(r=e(&quot;_baseEditor&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).BaseEditor,l=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).hasClass,u=function(){$traceurRuntime.superConstructor(c).apply(this,arguments)},c=u;$traceurRuntime.createClass(u,{beginEditing:function(e,t){if(void 0===t){var n=this.TD.querySelector('input[type=&quot;checkbox&quot;]');l(n,&quot;htBadValue&quot;)||n.click()}},finishEditing:function(){},init:function(){},open:function(){},close:function(){},getValue:function(){},setValue:function(){},focus:function(){}},{},a),s(&quot;checkbox&quot;,u)},{_baseEditor:31,editors:30,&quot;helpers/dom/element&quot;:47}],34:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{DateEditor:{get:function(){return E}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,p=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),m=p.addClass,g=p.outerHeight,w=(i=e(&quot;helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).deepExtend,v=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).EventManager,y=(a=e(&quot;editors&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),b=(y.getEditor,y.registerEditor),C=(l=e(&quot;helpers/unicode&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).isMetaKey,_=(u=e(&quot;helpers/dom/event&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).stopPropagation,R=(c=e(&quot;textEditor&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).TextEditor,M=(d=e(&quot;moment&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).default,S=(h=e(&quot;pikaday&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).default,E=function(e){this.$datePicker=null,this.datePicker=null,this.datePickerStyle=null,this.defaultDateFormat=&quot;DD/MM/YYYY&quot;,this.isCellEdited=!1,this.parentDestroyed=!1,$traceurRuntime.superConstructor(O).call(this,e)},O=E;$traceurRuntime.createClass(E,{init:function(){var e=this;if(&quot;function&quot;!=typeof M)throw new Error(&quot;You need to include moment.js to your project.&quot;);if(&quot;function&quot;!=typeof S)throw new Error(&quot;You need to include Pikaday to your project.&quot;);$traceurRuntime.superGet(this,O.prototype,&quot;init&quot;).call(this),this.instance.addHook(&quot;afterDestroy&quot;,function(){e.parentDestroyed=!0,e.destroyElements()})},createElements:function(){$traceurRuntime.superGet(this,O.prototype,&quot;createElements&quot;).call(this),this.datePicker=document.createElement(&quot;DIV&quot;),this.datePickerStyle=this.datePicker.style,this.datePickerStyle.position=&quot;absolute&quot;,this.datePickerStyle.top=0,this.datePickerStyle.left=0,this.datePickerStyle.zIndex=9999,m(this.datePicker,&quot;htDatepickerHolder&quot;),document.body.appendChild(this.datePicker),this.$datePicker=new S(this.getDatePickerConfig());var e=new v(this);e.addEventListener(this.datePicker,&quot;mousedown&quot;,function(e){return _(e)}),this.hideDatepicker()},destroyElements:function(){this.$datePicker.destroy()},prepare:function(e,t,n,o,r,i){this._opened=!1,$traceurRuntime.superGet(this,O.prototype,&quot;prepare&quot;).call(this,e,t,n,o,r,i)},open:function(){var e=void 0!==arguments[0]?arguments[0]:null;$traceurRuntime.superGet(this,O.prototype,&quot;open&quot;).call(this),this.showDatepicker(e)},close:function(){var e=this;this._opened=!1,this.instance._registerTimeout(setTimeout(function(){e.instance.selection.refreshBorders()},0)),$traceurRuntime.superGet(this,O.prototype,&quot;close&quot;).call(this)},finishEditing:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0],t=void 0!==arguments[1]&amp;&amp;arguments[1];if(e){var n=this.originalValue;void 0!==n&amp;&amp;this.setValue(n)}this.hideDatepicker(),$traceurRuntime.superGet(this,O.prototype,&quot;finishEditing&quot;).call(this,e,t)},showDatepicker:function(e){this.$datePicker.config(this.getDatePickerConfig());var t,n=this.TD.getBoundingClientRect(),o=this.cellProperties.dateFormat||this.defaultDateFormat,r=this.$datePicker.config(),i=this.instance.view.isMouseDown(),s=!!e&amp;&amp;C(e.keyCode);this.datePickerStyle.top=window.pageYOffset+n.top+g(this.TD)+&quot;px&quot;,this.datePickerStyle.left=window.pageXOffset+n.left+&quot;px&quot;,this.$datePicker._onInputFocus=function(){},r.format=o,this.originalValue?(t=this.originalValue,M(t,o,!0).isValid()&amp;&amp;this.$datePicker.setMoment(M(t,o),!0),this.getValue()!==this.originalValue&amp;&amp;this.setValue(this.originalValue),s||i||this.setValue(&quot;&quot;)):this.cellProperties.defaultDate?(t=this.cellProperties.defaultDate,r.defaultDate=t,M(t,o,!0).isValid()&amp;&amp;this.$datePicker.setMoment(M(t,o),!0),s||i||this.setValue(&quot;&quot;)):this.$datePicker.gotoToday(),this.datePickerStyle.display=&quot;block&quot;,this.$datePicker.show()},hideDatepicker:function(){this.datePickerStyle.display=&quot;none&quot;,this.$datePicker.hide()},getDatePickerConfig:function(){var e=this,t=this.TEXTAREA,n={};this.cellProperties&amp;&amp;this.cellProperties.datePickerConfig&amp;&amp;w(n,this.cellProperties.datePickerConfig);var o=n.onSelect,r=n.onClose;return n.field=t,n.trigger=t,n.container=this.datePicker,n.bound=!1,n.format=n.format||this.defaultDateFormat,n.reposition=n.reposition||!1,n.onSelect=function(t){isNaN(t.getTime())||(t=M(t).format(e.cellProperties.dateFormat||e.defaultDateFormat)),e.setValue(t),e.hideDatepicker(),o&amp;&amp;o()},n.onClose=function(){e.parentDestroyed||e.finishEditing(!1),r&amp;&amp;r()},n}},{},R),f.editors=f.editors||{},f.editors.DateEditor=E,b(&quot;date&quot;,E)},{browser:24,editors:30,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/object&quot;:53,&quot;helpers/unicode&quot;:56,moment:&quot;moment&quot;,pikaday:&quot;pikaday&quot;,textEditor:41}],35:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{DropdownEditor:{get:function(){return c}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,a=(r=e(&quot;editors&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),l=(a.getEditor,a.registerEditor),u=(a.getEditorConstructor,(i=e(&quot;autocompleteEditor&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).AutocompleteEditor),c=function(){$traceurRuntime.superConstructor(d).apply(this,arguments)},d=c;$traceurRuntime.createClass(c,{prepare:function(e,t,n,o,r,i){$traceurRuntime.superGet(this,d.prototype,&quot;prepare&quot;).call(this,e,t,n,o,r,i),this.cellProperties.filter=!1,this.cellProperties.strict=!0}},{},u),s.hooks.add(&quot;beforeValidate&quot;,function(e,t,n,o){var r=this.getCellMeta(t,this.propToCol(n));r.editor===s.editors.DropdownEditor&amp;&amp;void 0===r.strict&amp;&amp;(r.filter=!1,r.strict=!0)}),l(&quot;dropdown&quot;,c)},{autocompleteEditor:32,browser:24,editors:30}],36:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{HandsontableEditor:{get:function(){return b}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,d=(r=e(&quot;helpers/unicode&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).KEY_CODES,h=(i=e(&quot;helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).extend,f=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).setCaretPosition,p=(a=e(&quot;helpers/dom/event&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),m=p.stopImmediatePropagation,g=p.isImmediatePropagationStopped,w=(l=e(&quot;editors&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),v=(w.getEditor,w.registerEditor),y=(u=e(&quot;textEditor&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).TextEditor,b=y.prototype.extend();b.prototype.createElements=function(){y.prototype.createElements.apply(this,arguments);var e=document.createElement(&quot;DIV&quot;);e.className=&quot;handsontableEditor&quot;,this.TEXTAREA_PARENT.appendChild(e),this.htContainer=e,this.assignHooks()},b.prototype.prepare=function(e,t,n,o,r,i){y.prototype.prepare.apply(this,arguments);var s=this,a={startRows:0,startCols:0,minRows:0,minCols:0,className:&quot;listbox&quot;,copyPaste:!1,autoColumnSize:!1,autoRowSize:!1,readOnly:!0,fillHandle:!1,afterOnCellMouseDown:function(){var e=this.getValue();void 0!==e&amp;&amp;s.setValue(e),s.instance.destroyEditor()}};this.cellProperties.handsontable&amp;&amp;h(a,i.handsontable),this.htOptions=a};var C=function(e){if(!g(e)){var t,n=this.getActiveEditor(),o=n.htEditor.getInstance();if(e.keyCode==d.ARROW_DOWN)if(o.getSelected()||o.flipped){if(o.getSelected())if(o.flipped)t=o.getSelected()[0]+1;else if(!o.flipped){var r=o.getSelected()[0],i=o.countRows()-1;t=Math.min(i,r+1)}}else t=0;else if(e.keyCode==d.ARROW_UP)if(!o.getSelected()&amp;&amp;o.flipped)t=o.countRows()-1;else if(o.getSelected())if(o.flipped){var r=o.getSelected()[0];t=Math.max(0,r-1)}else{var r=o.getSelected()[0];t=r-1}void 0!==t&amp;&amp;(t&lt;0||o.flipped&amp;&amp;t&gt;o.countRows()-1?o.deselectCell():o.selectCell(t,0),o.getData().length&amp;&amp;(e.preventDefault(),m(e),n.instance.listen(),n.TEXTAREA.focus()))}};b.prototype.open=function(){this.instance.addHook(&quot;beforeKeyDown&quot;,C),y.prototype.open.apply(this,arguments),this.htEditor&amp;&amp;this.htEditor.destroy(),this.htEditor=new c(this.htContainer,this.htOptions),this.cellProperties.strict?(this.htEditor.selectCell(0,0),this.TEXTAREA.style.visibility=&quot;hidden&quot;):(this.htEditor.deselectCell(),this.TEXTAREA.style.visibility=&quot;visible&quot;),f(this.TEXTAREA,0,this.TEXTAREA.value.length)},b.prototype.close=function(){this.instance.removeHook(&quot;beforeKeyDown&quot;,C),this.instance.listen(),y.prototype.close.apply(this,arguments)},b.prototype.focus=function(){this.instance.listen(),y.prototype.focus.apply(this,arguments)},b.prototype.beginEditing=function(e){var t=this.instance.getSettings().onBeginEditing;t&amp;&amp;t()===!1||y.prototype.beginEditing.apply(this,arguments)},b.prototype.finishEditing=function(e,t){if(this.htEditor&amp;&amp;this.htEditor.isListening()&amp;&amp;this.instance.listen(),this.htEditor&amp;&amp;this.htEditor.getSelected()){var n=this.htEditor.getInstance().getValue();void 0!==n&amp;&amp;this.setValue(n)}return y.prototype.finishEditing.apply(this,arguments)},b.prototype.assignHooks=function(){var e=this;this.instance.addHook(&quot;afterDestroy&quot;,function(){e.htEditor&amp;&amp;e.htEditor.destroy()})},v(&quot;handsontable&quot;,b)},{browser:24,editors:30,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/object&quot;:53,&quot;helpers/unicode&quot;:56,textEditor:41}],37:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{MobileTextEditor:{get:function(){return k}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=((o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,(r=e(&quot;helpers/unicode&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).KEY_CODES),d=(i=e(&quot;helpers/dom/event&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),h=d.stopImmediatePropagation,f=d.isImmediatePropagationStopped,p=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),m=p.addClass,g=p.getScrollLeft,w=p.getScrollTop,v=p.hasClass,y=p.isChildOf,b=p.offset,C=p.outerHeight,_=p.outerWidth,R=p.removeClass,M=p.setCaretPosition,S=(a=e(&quot;editors&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),E=(S.getEditor,S.registerEditor),O=(l=e(&quot;_baseEditor&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).BaseEditor,T=(u=e(&quot;eventManager&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).eventManager,k=O.prototype.extend(),x={},D=function(){this.controls={},this.controls.leftButton=document.createElement(&quot;DIV&quot;),this.controls.leftButton.className=&quot;leftButton&quot;,this.controls.rightButton=document.createElement(&quot;DIV&quot;),this.controls.rightButton.className=&quot;rightButton&quot;,this.controls.upButton=document.createElement(&quot;DIV&quot;),this.controls.upButton.className=&quot;upButton&quot;,this.controls.downButton=document.createElement(&quot;DIV&quot;),this.controls.downButton.className=&quot;downButton&quot;;for(var e in this.controls)this.controls.hasOwnProperty(e)&amp;&amp;this.positionControls.appendChild(this.controls[e])};k.prototype.valueChanged=function(){return this.initValue!=this.getValue()},k.prototype.init=function(){var e=this;this.eventManager=T(this.instance),this.createElements(),this.bindEvents(),this.instance.addHook(&quot;afterDestroy&quot;,function(){e.destroy()})},k.prototype.getValue=function(){return this.TEXTAREA.value},k.prototype.setValue=function(e){this.initValue=e,this.TEXTAREA.value=e},k.prototype.createElements=function(){this.editorContainer=document.createElement(&quot;DIV&quot;),this.editorContainer.className=&quot;htMobileEditorContainer&quot;,this.cellPointer=document.createElement(&quot;DIV&quot;),this.cellPointer.className=&quot;cellPointer&quot;,this.moveHandle=document.createElement(&quot;DIV&quot;),this.moveHandle.className=&quot;moveHandle&quot;,this.inputPane=document.createElement(&quot;DIV&quot;),this.inputPane.className=&quot;inputs&quot;,this.positionControls=document.createElement(&quot;DIV&quot;),this.positionControls.className=&quot;positionControls&quot;,this.TEXTAREA=document.createElement(&quot;TEXTAREA&quot;),m(this.TEXTAREA,&quot;handsontableInput&quot;),this.inputPane.appendChild(this.TEXTAREA),this.editorContainer.appendChild(this.cellPointer),this.editorContainer.appendChild(this.moveHandle),this.editorContainer.appendChild(this.inputPane),this.editorContainer.appendChild(this.positionControls),D.call(this),document.body.appendChild(this.editorContainer)},k.prototype.onBeforeKeyDown=function(e){var t=this,n=t.getActiveEditor();if(e.target===n.TEXTAREA&amp;&amp;!f(e))switch(e.keyCode){case c.ENTER:n.close(),e.preventDefault();break;case c.BACKSPACE:h(e)}},k.prototype.open=function(){this.instance.addHook(&quot;beforeKeyDown&quot;,this.onBeforeKeyDown),m(this.editorContainer,&quot;active&quot;),R(this.cellPointer,&quot;hidden&quot;),this.updateEditorPosition()},k.prototype.focus=function(){this.TEXTAREA.focus(),M(this.TEXTAREA,this.TEXTAREA.value.length)},k.prototype.close=function(){this.TEXTAREA.blur(),this.instance.removeHook(&quot;beforeKeyDown&quot;,this.onBeforeKeyDown),R(this.editorContainer,&quot;active&quot;)},k.prototype.scrollToView=function(){var e=this.instance.getSelectedRange().highlight;this.instance.view.scrollViewport(e)},k.prototype.hideCellPointer=function(){v(this.cellPointer,&quot;hidden&quot;)||m(this.cellPointer,&quot;hidden&quot;)},k.prototype.updateEditorPosition=function(e,t){if(e&amp;&amp;t)e=parseInt(e,10),t=parseInt(t,10),this.editorContainer.style.top=t+&quot;px&quot;,this.editorContainer.style.left=e+&quot;px&quot;;else{var n=this.instance.getSelected(),o=this.instance.getCell(n[0],n[1]);if(x.cellPointer||(x.cellPointer={height:C(this.cellPointer),width:_(this.cellPointer)}),x.editorContainer||(x.editorContainer={width:_(this.editorContainer)}),void 0!==o){var r=this.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer==window?0:g(this.instance.view.wt.wtOverlays.leftOverlay.holder),i=this.instance.view.wt.wtOverlays.topOverlay.trimmingContainer==window?0:w(this.instance.view.wt.wtOverlays.topOverlay.holder),s=b(o),a=_(o),l={x:r,y:i};this.editorContainer.style.top=parseInt(s.top+C(o)-l.y+x.cellPointer.height,10)+&quot;px&quot;,this.editorContainer.style.left=parseInt(window.innerWidth/2-x.editorContainer.width/2,10)+&quot;px&quot;,s.left+a/2&gt;parseInt(this.editorContainer.style.left,10)+x.editorContainer.width?this.editorContainer.style.left=window.innerWidth-x.editorContainer.width+&quot;px&quot;:s.left+a/2&lt;parseInt(this.editorContainer.style.left,10)+20&amp;&amp;(this.editorContainer.style.left=&quot;0px&quot;),this.cellPointer.style.left=parseInt(s.left-x.cellPointer.width/2-b(this.editorContainer).left+a/2-l.x,10)+&quot;px&quot;}}},k.prototype.updateEditorData=function(){var e=this.instance.getSelected(),t=this.instance.getDataAtCell(e[0],e[1]);this.row=e[0],this.col=e[1],this.setValue(t),this.updateEditorPosition()},k.prototype.prepareAndSave=function(){var e;return!this.valueChanged()||(e=this.instance.getSettings().trimWhitespace?[[String.prototype.trim.call(this.getValue())]]:[[this.getValue()]],void this.saveValue(e))},k.prototype.bindEvents=function(){var e=this;this.eventManager.addEventListener(this.controls.leftButton,&quot;touchend&quot;,function(t){e.prepareAndSave(),e.instance.selection.transformStart(0,-1,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.rightButton,&quot;touchend&quot;,function(t){e.prepareAndSave(),e.instance.selection.transformStart(0,1,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.upButton,&quot;touchend&quot;,function(t){e.prepareAndSave(),e.instance.selection.transformStart(-1,0,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.controls.downButton,&quot;touchend&quot;,function(t){e.prepareAndSave(),e.instance.selection.transformStart(1,0,null,!0),e.updateEditorData(),t.preventDefault()}),this.eventManager.addEventListener(this.moveHandle,&quot;touchstart&quot;,function(t){if(1==t.touches.length){var n=t.touches[0],o={x:e.editorContainer.offsetLeft,y:e.editorContainer.offsetTop},r={x:n.pageX-o.x,y:n.pageY-o.y};e.eventManager.addEventListener(this,&quot;touchmove&quot;,function(t){var n=t.touches[0];e.updateEditorPosition(n.pageX-r.x,n.pageY-r.y),e.hideCellPointer(),t.preventDefault()})}}),this.eventManager.addEventListener(document.body,&quot;touchend&quot;,function(t){y(t.target,e.editorContainer)||y(t.target,e.instance.rootElement)||e.close()}),this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.leftOverlay.holder,&quot;scroll&quot;,function(t){e.instance.view.wt.wtOverlays.leftOverlay.trimmingContainer!=window&amp;&amp;e.hideCellPointer()}),this.eventManager.addEventListener(this.instance.view.wt.wtOverlays.topOverlay.holder,&quot;scroll&quot;,function(t){e.instance.view.wt.wtOverlays.topOverlay.trimmingContainer!=window&amp;&amp;e.hideCellPointer()})},k.prototype.destroy=function(){this.eventManager.clear(),this.editorContainer.parentNode.removeChild(this.editorContainer)},E(&quot;mobile&quot;,k)},{_baseEditor:31,browser:24,editors:30,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/unicode&quot;:56}],38:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{NumericEditor:{get:function(){return u}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;numbro&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,a=(r=e(&quot;editors&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).registerEditor,l=(i=e(&quot;textEditor&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).TextEditor,u=function(){$traceurRuntime.superConstructor(c).apply(this,arguments)},c=u;$traceurRuntime.createClass(u,{beginEditing:function(e){if(&quot;undefined&quot;==typeof e&amp;&amp;this.originalValue){&quot;undefined&quot;!=typeof this.cellProperties.language&amp;&amp;s.culture(this.cellProperties.language);var t=s.cultureData().delimiters.decimal;e=(&quot;&quot;+this.originalValue).replace(&quot;.&quot;,t)}$traceurRuntime.superGet(this,c.prototype,&quot;beginEditing&quot;).call(this,e)}},{},l),a(&quot;numeric&quot;,u)},{editors:30,numbro:&quot;numbro&quot;,textEditor:41}],39:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{PasswordEditor:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=((o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).empty),l=(i=e(&quot;editors&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),u=(l.getEditor,l.registerEditor),c=(s=e(&quot;textEditor&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).TextEditor,d=function(){$traceurRuntime.superConstructor(h).apply(this,arguments)},h=d;$traceurRuntime.createClass(d,{createElements:function(){$traceurRuntime.superGet(this,h.prototype,&quot;createElements&quot;).call(this),this.TEXTAREA=document.createElement(&quot;input&quot;),this.TEXTAREA.setAttribute(&quot;type&quot;,&quot;password&quot;),this.TEXTAREA.className=&quot;handsontableInput&quot;,this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,a(this.TEXTAREA_PARENT),this.TEXTAREA_PARENT.appendChild(this.TEXTAREA)}},{},c),u(&quot;password&quot;,d)},{browser:24,editors:30,&quot;helpers/dom/element&quot;:47,textEditor:41}],40:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{SelectEditor:{get:function(){return E}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),d=c.addClass,h=c.empty,f=c.fastInnerHTML,p=c.getComputedStyle,m=c.getCssTransform,g=c.getScrollableElement,w=c.offset,v=c.outerHeight,y=c.outerWidth,b=c.resetCssTransform,C=(i=e(&quot;helpers/dom/event&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).stopImmediatePropagation,_=(s=e(&quot;helpers/unicode&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).KEY_CODES,R=(a=e(&quot;editors&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),M=(R.getEditor,R.registerEditor),S=(l=e(&quot;_baseEditor&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).BaseEditor,E=S.prototype.extend();E.prototype.init=function(){this.select=document.createElement(&quot;SELECT&quot;),d(this.select,&quot;htSelectEditor&quot;),this.select.style.display=&quot;none&quot;,this.instance.rootElement.appendChild(this.select),this.registerHooks()},E.prototype.registerHooks=function(){var e=this;this.instance.addHook(&quot;afterScrollHorizontally&quot;,function(){return e.refreshDimensions()}),this.instance.addHook(&quot;afterScrollVertically&quot;,function(){return e.refreshDimensions()}),this.instance.addHook(&quot;afterColumnResize&quot;,function(){return e.refreshDimensions()}),this.instance.addHook(&quot;afterRowResize&quot;,function(){return e.refreshDimensions()})},E.prototype.prepare=function(){S.prototype.prepare.apply(this,arguments);var e,t=this.cellProperties.selectOptions;e=&quot;function&quot;==typeof t?this.prepareOptions(t(this.row,this.col,this.prop)):this.prepareOptions(t),h(this.select);for(var n in e)if(e.hasOwnProperty(n)){var o=document.createElement(&quot;OPTION&quot;);o.value=n,f(o,e[n]),this.select.appendChild(o)}},E.prototype.prepareOptions=function(e){var t={};if(Array.isArray(e))for(var n=0,o=e.length;n&lt;o;n++)t[e[n]]=e[n];else&quot;object&quot;==typeof e&amp;&amp;(t=e);return t},E.prototype.getValue=function(){return this.select.value},E.prototype.setValue=function(e){this.select.value=e};var O=function(e){var t=this,n=t.getActiveEditor();switch(e.keyCode){case _.ARROW_UP:var o=n.select.selectedIndex-1;o&gt;=0&amp;&amp;(n.select[o].selected=!0),C(e),e.preventDefault();break;case _.ARROW_DOWN:var r=n.select.selectedIndex+1;r&lt;=n.select.length-1&amp;&amp;(n.select[r].selected=!0),C(e),e.preventDefault()}};E.prototype.open=function(){this._opened=!0,this.refreshDimensions(),this.select.style.display=&quot;&quot;,this.instance.addHook(&quot;beforeKeyDown&quot;,O)},E.prototype.close=function(){this._opened=!1,this.select.style.display=&quot;none&quot;,this.instance.removeHook(&quot;beforeKeyDown&quot;,O)},E.prototype.focus=function(){this.select.focus()},E.prototype.refreshValue=function(){var e=this.instance.getSourceDataAtCell(this.row,this.prop);this.originalValue=e,this.setValue(e),this.refreshDimensions()},E.prototype.refreshDimensions=function(){if(this.state===u.EditorState.EDITING){if(this.TD=this.getEditedCell(),!this.TD)return void this.close();var e,t=y(this.TD)+1,n=v(this.TD)+1,o=w(this.TD),r=w(this.instance.rootElement),i=g(this.TD),s=o.top-r.top-1-(i.scrollTop||0),a=o.left-r.left-1-(i.scrollLeft||0),l=this.checkEditorSection(),c=this.instance.getSettings();c.rowHeaders?1:0,c.colHeaders?1:0;switch(l){case&quot;top&quot;:e=m(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case&quot;left&quot;:e=m(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);
break;case&quot;top-left-corner&quot;:e=m(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case&quot;bottom-left-corner&quot;:e=m(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case&quot;bottom&quot;:e=m(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode)}0===this.instance.getSelected()[0]&amp;&amp;(s+=1),0===this.instance.getSelected()[1]&amp;&amp;(a+=1);var d=this.select.style;e&amp;&amp;e!=-1?d[e[0]]=e[1]:b(this.select);var h=p(this.TD);parseInt(h.borderTopWidth,10)&gt;0&amp;&amp;(n-=1),parseInt(h.borderLeftWidth,10)&gt;0&amp;&amp;(t-=1),d.height=n+&quot;px&quot;,d.minWidth=t+&quot;px&quot;,d.top=s+&quot;px&quot;,d.left=a+&quot;px&quot;,d.margin=&quot;0px&quot;}},E.prototype.getEditedCell=function(){var e,t=this.checkEditorSection();switch(t){case&quot;top&quot;:e=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=101;break;case&quot;corner&quot;:e=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=103;break;case&quot;left&quot;:e=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.select.style.zIndex=102;break;default:e=this.instance.getCell(this.row,this.col),this.select.style.zIndex=&quot;&quot;}return e!=-1&amp;&amp;e!=-2?e:void 0},M(&quot;select&quot;,E)},{_baseEditor:31,browser:24,editors:30,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/unicode&quot;:56}],41:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{TextEditor:{get:function(){return N}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,h=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),f=h.addClass,p=h.getCaretPosition,m=h.getComputedStyle,g=h.getCssTransform,w=h.getScrollableElement,v=h.getScrollbarWidth,y=h.innerWidth,b=h.offset,C=h.resetCssTransform,_=h.setCaretPosition,R=h.hasVerticalScrollbar,M=h.hasHorizontalScrollbar,S=(i=e(&quot;autoResize&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,E=(s=e(&quot;_baseEditor&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).BaseEditor,O=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).eventManager,T=(l=e(&quot;editors&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),k=(T.getEditor,T.registerEditor),x=(u=e(&quot;helpers/unicode&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).KEY_CODES,D=(c=e(&quot;helpers/dom/event&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),H=D.stopPropagation,A=D.stopImmediatePropagation,P=D.isImmediatePropagationStopped,N=E.prototype.extend();N.prototype.init=function(){var e=this;this.createElements(),this.eventManager=O(this),this.bindEvents(),this.autoResize=S(),this.instance.addHook(&quot;afterDestroy&quot;,function(){e.destroy()})},N.prototype.getValue=function(){return this.TEXTAREA.value},N.prototype.setValue=function(e){this.TEXTAREA.value=e};var L=function(e){var t,n=this,o=n.getActiveEditor();if(t=(e.ctrlKey||e.metaKey)&amp;&amp;!e.altKey,e.target===o.TEXTAREA&amp;&amp;!P(e)){if(17===e.keyCode||224===e.keyCode||91===e.keyCode||93===e.keyCode)return void A(e);switch(e.keyCode){case x.ARROW_RIGHT:o.isInFullEditMode()&amp;&amp;(!o.isWaiting()&amp;&amp;!o.allowKeyEventPropagation||!o.isWaiting()&amp;&amp;o.allowKeyEventPropagation&amp;&amp;!o.allowKeyEventPropagation(e.keyCode))&amp;&amp;A(e);break;case x.ARROW_LEFT:o.isInFullEditMode()&amp;&amp;(!o.isWaiting()&amp;&amp;!o.allowKeyEventPropagation||!o.isWaiting()&amp;&amp;o.allowKeyEventPropagation&amp;&amp;!o.allowKeyEventPropagation(e.keyCode))&amp;&amp;A(e);break;case x.ARROW_UP:case x.ARROW_DOWN:o.isInFullEditMode()&amp;&amp;(!o.isWaiting()&amp;&amp;!o.allowKeyEventPropagation||!o.isWaiting()&amp;&amp;o.allowKeyEventPropagation&amp;&amp;!o.allowKeyEventPropagation(e.keyCode))&amp;&amp;A(e);break;case x.ENTER:var r=o.instance.getSelected(),i=!(r[0]===r[2]&amp;&amp;r[1]===r[3]);if(t&amp;&amp;!i||e.altKey){if(o.isOpened()){var s=p(o.TEXTAREA),a=o.getValue(),l=a.slice(0,s)+&quot;\n&quot;+a.slice(s);o.setValue(l),_(o.TEXTAREA,s+1)}else o.beginEditing(o.originalValue+&quot;\n&quot;);A(e)}e.preventDefault();break;case x.A:case x.X:case x.C:case x.V:t&amp;&amp;A(e);break;case x.BACKSPACE:case x.DELETE:case x.HOME:case x.END:A(e)}[x.ARROW_UP,x.ARROW_RIGHT,x.ARROW_DOWN,x.ARROW_LEFT].indexOf(e.keyCode)===-1&amp;&amp;o.autoResize.resize(String.fromCharCode(e.keyCode))}};N.prototype.open=function(){this.refreshDimensions(),this.instance.addHook(&quot;beforeKeyDown&quot;,L)},N.prototype.close=function(e){this.textareaParentStyle.display=&quot;none&quot;,this.autoResize.unObserve(),document.activeElement===this.TEXTAREA&amp;&amp;this.instance.listen(),this.instance.removeHook(&quot;beforeKeyDown&quot;,L)},N.prototype.focus=function(){this.TEXTAREA.focus(),_(this.TEXTAREA,this.TEXTAREA.value.length)},N.prototype.createElements=function(){this.TEXTAREA=document.createElement(&quot;TEXTAREA&quot;),f(this.TEXTAREA,&quot;handsontableInput&quot;),this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,this.TEXTAREA_PARENT=document.createElement(&quot;DIV&quot;),f(this.TEXTAREA_PARENT,&quot;handsontableInputHolder&quot;),this.textareaParentStyle=this.TEXTAREA_PARENT.style,this.textareaParentStyle.top=0,this.textareaParentStyle.left=0,this.textareaParentStyle.display=&quot;none&quot;,this.TEXTAREA_PARENT.appendChild(this.TEXTAREA),this.instance.rootElement.appendChild(this.TEXTAREA_PARENT);var e=this;this.instance._registerTimeout(setTimeout(function(){e.refreshDimensions()},0))},N.prototype.getEditedCell=function(){var e,t=this.checkEditorSection();switch(t){case&quot;top&quot;:e=this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=101;break;case&quot;top-left-corner&quot;:e=this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=103;break;case&quot;bottom-left-corner&quot;:e=this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=103;break;case&quot;left&quot;:e=this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=102;break;case&quot;bottom&quot;:e=this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=102;break;default:e=this.instance.getCell(this.row,this.col),this.textareaParentStyle.zIndex=&quot;&quot;}return e!=-1&amp;&amp;e!=-2?e:void 0},N.prototype.refreshValue=function(){var e=this.instance.getSourceDataAtCell(this.row,this.prop);this.originalValue=e,this.setValue(e),this.refreshDimensions()},N.prototype.refreshDimensions=function(){if(this.state===d.EditorState.EDITING){if(this.TD=this.getEditedCell(),!this.TD)return void this.close(!0);var e,t=b(this.TD),n=b(this.instance.rootElement),o=w(this.TD),r=this.instance.countRows(),i=t.top===n.top?0:1,s=t.top-n.top-i-(o.scrollTop||0),a=t.left-n.left-1-(o.scrollLeft||0),l=this.instance.getSettings(),u=(this.instance.hasRowHeaders(),this.instance.hasColHeaders()),c=this.checkEditorSection(),h=this.TD.style.backgroundColor;switch(c){case&quot;top&quot;:e=g(this.instance.view.wt.wtOverlays.topOverlay.clone.wtTable.holder.parentNode);break;case&quot;left&quot;:e=g(this.instance.view.wt.wtOverlays.leftOverlay.clone.wtTable.holder.parentNode);break;case&quot;top-left-corner&quot;:e=g(this.instance.view.wt.wtOverlays.topLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case&quot;bottom-left-corner&quot;:e=g(this.instance.view.wt.wtOverlays.bottomLeftCornerOverlay.clone.wtTable.holder.parentNode);break;case&quot;bottom&quot;:e=g(this.instance.view.wt.wtOverlays.bottomOverlay.clone.wtTable.holder.parentNode)}(u&amp;&amp;0===this.instance.getSelected()[0]||l.fixedRowsBottom&amp;&amp;this.instance.getSelected()[0]===r-l.fixedRowsBottom)&amp;&amp;(s+=1),0===this.instance.getSelected()[1]&amp;&amp;(a+=1),e&amp;&amp;e!=-1?this.textareaParentStyle[e[0]]=e[1]:C(this.TEXTAREA_PARENT),this.textareaParentStyle.top=s+&quot;px&quot;,this.textareaParentStyle.left=a+&quot;px&quot;;var f=this.instance.view.wt.wtViewport.rowsRenderCalculator.startPosition,p=this.instance.view.wt.wtViewport.columnsRenderCalculator.startPosition,_=this.instance.view.wt.wtOverlays.leftOverlay.getScrollPosition(),S=this.instance.view.wt.wtOverlays.topOverlay.getScrollPosition(),E=v(),O=this.TD.offsetTop+f-S,T=this.TD.offsetLeft+p-_,k=y(this.TD)-8,x=R(o)?E:0,D=M(o)?E:0,H=this.instance.view.maximumVisibleElementWidth(T)-9-x,A=this.TD.scrollHeight+1,P=Math.max(this.instance.view.maximumVisibleElementHeight(O)-D,23),N=m(this.TD);this.TEXTAREA.style.fontSize=N.fontSize,this.TEXTAREA.style.fontFamily=N.fontFamily,this.TEXTAREA.style.backgroundColor=&quot;&quot;,this.TEXTAREA.style.backgroundColor=h?h:m(this.TEXTAREA).backgroundColor,this.autoResize.init(this.TEXTAREA,{minHeight:Math.min(A,P),maxHeight:P,minWidth:Math.min(k,H),maxWidth:H},!0),this.textareaParentStyle.display=&quot;block&quot;}},N.prototype.bindEvents=function(){var e=this;this.eventManager.addEventListener(this.TEXTAREA,&quot;cut&quot;,function(e){H(e)}),this.eventManager.addEventListener(this.TEXTAREA,&quot;paste&quot;,function(e){H(e)}),this.instance.addHook(&quot;afterScrollHorizontally&quot;,function(){e.refreshDimensions()}),this.instance.addHook(&quot;afterScrollVertically&quot;,function(){e.refreshDimensions()}),this.instance.addHook(&quot;afterColumnResize&quot;,function(){e.refreshDimensions(),e.focus()}),this.instance.addHook(&quot;afterRowResize&quot;,function(){e.refreshDimensions(),e.focus()}),this.instance.addHook(&quot;afterDestroy&quot;,function(){e.eventManager.destroy()})},N.prototype.destroy=function(){this.eventManager.destroy()},k(&quot;text&quot;,N)},{_baseEditor:31,autoResize:&quot;autoResize&quot;,browser:24,editors:30,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/unicode&quot;:56}],42:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n,o,r,i,s,a,l=&quot;HOT-TABLE&quot;;if(t.isTargetWebComponent=!1,t.realTarget=t.target,a=t.stopImmediatePropagation,t.stopImmediatePropagation=function(){a.apply(this),p(this)},!u.eventManager.isHotTableEnv)return t;for(t=d(t),s=t.path?t.path.length:0;s--;){if(t.path[s].nodeName===l)n=!0;else if(n&amp;&amp;t.path[s].shadowRoot){i=t.path[s];break}0!==s||i||(i=t.path[s])}return i||(i=t.target),t.isTargetWebComponent=!0,f()?t.realTarget=t.srcElement||t.toElement:(e instanceof u.Core||e instanceof Walkontable)&amp;&amp;(e instanceof u.Core?o=e.view?e.view.wt.wtTable.TABLE:null:e instanceof Walkontable&amp;&amp;(o=e.wtTable.TABLE.parentNode.parentNode),r=h(t.target,[l],o),r?t.realTarget=o.querySelector(l)||t.target:t.realTarget=t.target),Object.defineProperty(t,&quot;target&quot;,{get:function(){return d(i)},enumerable:!0,configurable:!0}),t}function r(e){return new m(e)}Object.defineProperties(n,{EventManager:{get:function(){return m}},eventManager:{get:function(){return r}},__esModule:{value:!0}});var i,s,a,l,u=(i=e(&quot;browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,c=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),d=c.polymerWrap,h=c.closest,f=(a=e(&quot;helpers/feature&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).isWebComponentSupportedNatively,p=(l=e(&quot;helpers/dom/event&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).stopImmediatePropagation,m=function(){var e=void 0!==arguments[0]?arguments[0]:null;this.context=e||this,this.context.eventListeners||(this.context.eventListeners=[])};$traceurRuntime.createClass(m,{addEventListener:function(e,t,n){function r(e){e=o(s,e),n.call(this,e)}var i=this,s=this.context;return this.context.eventListeners.push({element:e,event:t,callback:n,callbackProxy:r}),window.addEventListener?e.addEventListener(t,r,!1):e.attachEvent(&quot;on&quot;+t,r),u.countEventManagerListeners++,function(){i.removeEventListener(e,t,n)}},removeEventListener:function(e,t,n){for(var o,r=this.context.eventListeners.length;r--;)if(o=this.context.eventListeners[r],o.event==t&amp;&amp;o.element==e){if(n&amp;&amp;n!=o.callback)continue;this.context.eventListeners.splice(r,1),o.element.removeEventListener?o.element.removeEventListener(o.event,o.callbackProxy,!1):o.element.detachEvent(&quot;on&quot;+o.event,o.callbackProxy),u.countEventManagerListeners--}},clearEvents:function(){if(this.context)for(var e=this.context.eventListeners.length;e--;){var t=this.context.eventListeners[e];t&amp;&amp;this.removeEventListener(t.element,t.event,t.callback)}},clear:function(){this.clearEvents()},destroy:function(){this.clearEvents(),this.context=null},fireEvent:function(e,t){var n,o={bubbles:!0,cancelable:&quot;mousemove&quot;!==t,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};document.createEvent?(n=document.createEvent(&quot;MouseEvents&quot;),n.initMouseEvent(t,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget||document.body.parentNode)):n=document.createEventObject(),e.dispatchEvent?e.dispatchEvent(n):e.fireEvent(&quot;on&quot;+t,n)}},{}),u.countEventManagerListeners=0,u.eventManager=r},{browser:24,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/feature&quot;:49}],43:[function(e,t,n){&quot;use strict&quot;;function o(e){for(var t=0,n=e.length;t&lt;n;)e[t]=[e[t]],t++}function r(e,t){for(var n=0,o=t.length;n&lt;o;)e.push(t[n]),n++}function i(e){var t=[];if(!e||0===e.length||!e[0]||0===e[0].length)return t;for(var n=e.length,o=e[0].length,r=0;r&lt;n;r++)for(var i=0;i&lt;o;i++)t[i]||(t[i]=[]),t[i][r]=e[r][i];return t}function s(e,t,n,o){var r=-1,i=e.length;for(o&amp;&amp;i&amp;&amp;(n=e[++r]);++r&lt;i;)n=t(n,e[r],r,e);return n}function a(e,t){for(var n=-1,o=e.length,r=-1,i=[];++n&lt;o;){var s=e[n];t(s,n,e)&amp;&amp;(i[++r]=s)}return i}function l(e,t){for(var n=-1,o=e.length,r=-1,i=[];++n&lt;o;){var s=e[n];i[++r]=t(s,n,e)}return i}function u(e,t){for(var n=-1,o=e.length;++n&lt;o&amp;&amp;t(e[n],n,e)!==!1;);return e}function c(e){return s(e,function(e,t){return e+t},0)}function d(e){return s(e,function(e,t){return e&gt;t?e:t},Array.isArray(e)?e[0]:void 0)}function h(e){return s(e,function(e,t){return e&lt;t?e:t},Array.isArray(e)?e[0]:void 0)}function f(e){return e.length?c(e)/e.length:0}function p(e){return s(e,function(e,t){return e.concat(Array.isArray(t)?p(t):t)},[])}function m(e){var t=[];return u(e,function(e){t.indexOf(e)===-1&amp;&amp;t.push(e)}),t}function g(e,t,n){if(null==e)throw new TypeError('&quot;array&quot; is null or not defined');var o=Object(e),r=o.length&gt;&gt;&gt;0;if(0===r)return!1;for(var i=0|n,s=Math.max(i&gt;=0?i:r-Math.abs(i),0);s&lt;r;){if(o[s]===t)return!0;s++}return!1}Object.defineProperties(n,{to2dArray:{get:function(){return o}},extendArray:{get:function(){return r}},pivot:{get:function(){return i}},arrayReduce:{get:function(){return s}},arrayFilter:{get:function(){return a}},arrayMap:{get:function(){return l}},arrayEach:{get:function(){return u}},arraySum:{get:function(){return c}},arrayMax:{get:function(){return d}},arrayMin:{get:function(){return h}},arrayAvg:{get:function(){return f}},arrayFlatten:{get:function(){return p}},arrayUnique:{get:function(){return m}},arrayIncludes:{get:function(){return g}},__esModule:{value:!0}})},{}],44:[function(e,t,n){&quot;use strict&quot;;function o(){return l}function r(){return u}function i(){return c}function s(){return d}function a(e){return e||(e=navigator.userAgent),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)}Object.defineProperties(n,{isIE8:{get:function(){return o}},isIE9:{get:function(){return r}},isSafari:{get:function(){return i}},isChrome:{get:function(){return s}},isMobileBrowser:{get:function(){return a}},__esModule:{value:!0}});var l=!document.createTextNode(&quot;test&quot;).textContent,u=!!document.documentMode,c=/Safari/.test(navigator.userAgent)&amp;&amp;/Apple Computer/.test(navigator.vendor),d=/Chrome/.test(navigator.userAgent)&amp;&amp;/Google/.test(navigator.vendor)},{}],45:[function(e,t,n){&quot;use strict&quot;;function o(e){for(var t,n=e+1,o=&quot;&quot;;n&gt;0;)t=(n-1)%m,o=String.fromCharCode(65+t)+o,n=parseInt((n-t)/m,10);return o}function r(e){var t=0;if(e)for(var n=0,o=e.length-1;n&lt;e.length;n+=1,o-=1)t+=Math.pow(m,o)*(p.indexOf(e[n])+1);return--t,t}function i(){var e,t,n=void 0!==arguments[0]?arguments[0]:100,r=void 0!==arguments[1]?arguments[1]:4,i=[];for(e=0;e&lt;n;e++){var s=[];for(t=0;t&lt;r;t++)s.push(o(t)+(e+1));i.push(s)}return i}function s(){var e,t,n=void 0!==arguments[0]?arguments[0]:100,r=void 0!==arguments[1]?arguments[1]:4,i=[];for(e=0;e&lt;n;e++){var s={};for(t=0;t&lt;r;t++)s[&quot;prop&quot;+t]=o(t)+(e+1);i.push(s)}return i}function a(e,t){for(var n,o=[],r=0;r&lt;e;r++){n=[];for(var i=0;i&lt;t;i++)n.push(&quot;&quot;);o.push(n)}return o}function l(e){var t,n,o,r,i=[],s=0;for(t=0,n=e.length;t&lt;n;t++)for(o=0,r=e[t].length;o&lt;r;o++)o==s&amp;&amp;(i.push([]),s++),i[o].push(e[t][o]);return i}function u(e,t){function n(e){var t=h.cellTypes[e];if(&quot;undefined&quot;==typeof t)throw new Error('You declared cell type &quot;'+e+'&quot; as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');return t}return t=&quot;undefined&quot;==typeof t||t,function(o,r){return function o(r){if(r){if(r.hasOwnProperty(e)&amp;&amp;void 0!==r[e])return r[e];if(r.hasOwnProperty(&quot;type&quot;)&amp;&amp;r.type){var i;if(&quot;string&quot;!=typeof r.type)throw new Error(&quot;Cell type must be a string &quot;);if(i=n(r.type),i.hasOwnProperty(e))return i[e];if(t)return}return o(f(r))}}(&quot;number&quot;==typeof o?this.getCellMeta(o,r):o)}}Object.defineProperties(n,{spreadsheetColumnLabel:{get:function(){return o}},spreadsheetColumnIndex:{get:function(){return r}},createSpreadsheetData:{get:function(){return i}},createSpreadsheetObjectData:{get:function(){return s}},createEmptySpreadsheetData:{get:function(){return a}},translateRowsToColumns:{get:function(){return l}},cellMethodLookupFactory:{get:function(){return u}},__esModule:{value:!0}});var c,d,h=(c=e(&quot;browser&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).default,f=(d=e(&quot;object&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).getPrototypeOf,p=&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;,m=p.length},{browser:24,object:53}],46:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=new Date(e);return isNaN(new Date(e+&quot;T00:00&quot;).getDate())?t:new Date(t.getTime()+6e4*t.getTimezoneOffset())}Object.defineProperties(n,{getNormalizedDate:{get:function(){return o}},__esModule:{value:!0}})},{}],47:[function(e,t,n){&quot;use strict&quot;;function o(e){for(var t=void 0!==arguments[1]?arguments[1]:0,n=-1,o=null;null!=e;){if(n===t){o=e;break}e.host&amp;&amp;e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e=e.host:(n++,e=e.parentNode)}return o}function r(e,t,n){for(;null!=e&amp;&amp;e!==n;){if(e.nodeType===Node.ELEMENT_NODE&amp;&amp;(t.indexOf(e.nodeName)&gt;-1||t.indexOf(e)&gt;-1))return e;e=e.host&amp;&amp;e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.host:e.parentNode}return null}function i(e,t,n){for(var o=[];e&amp;&amp;(e=r(e,t,n),e&amp;&amp;(!n||n.contains(e)));)o.push(e),e=e.host&amp;&amp;e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?e.host:e.parentNode;var i=o.length;return i?o[i-1]:null}function s(e,t){var n=e.parentNode,o=[];for(&quot;string&quot;==typeof t?o=Array.prototype.slice.call(document.querySelectorAll(t),0):o.push(t);null!=n;){if(o.indexOf(n)&gt;-1)return!0;n=n.parentNode}return!1}function a(e){function t(e){return e.nodeType===Node.ELEMENT_NODE&amp;&amp;e.nodeName===o.toUpperCase()}var n,o=&quot;hot-table&quot;,r=!1;for(n=l(e);null!=n;){if(t(n)){r=!0;break}if(n.host&amp;&amp;n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){if(r=t(n.host))break;n=n.host}n=n.parentNode}return r}function l(e){return&quot;undefined&quot;!=typeof Polymer&amp;&amp;&quot;function&quot;==typeof wrap?wrap(e):e}function u(e){return&quot;undefined&quot;!=typeof Polymer&amp;&amp;&quot;function&quot;==typeof unwrap?unwrap(e):e}function c(e){var t=0;if(e.previousSibling)for(;e=e.previousSibling;)++t;return t}function d(e,t){var n=document.querySelector(&quot;.ht_clone_&quot;+e);return n?n.contains(t):null}function h(e){var t=0,n=[];if(!e||!e.length)return n;for(;e[t];)n.push(e[t]),t++;return n}function f(e,t){return Z(e,t)}function p(e,t){return J(e,t)}function m(e,t){return Q(e,t)}function g(e,t){if(3===e.nodeType)t.removeChild(e);else if([&quot;TABLE&quot;,&quot;THEAD&quot;,&quot;TBODY&quot;,&quot;TFOOT&quot;,&quot;TR&quot;].indexOf(e.nodeName)&gt;-1)for(var n=e.childNodes,o=n.length-1;o&gt;=0;o--)g(n[o],e)}function w(e){for(var t;t=e.lastChild;)e.removeChild(t)}function v(e,t){ue.test(t)?e.innerHTML=t:y(e,t)}function y(e,t){var n=e.firstChild;n&amp;&amp;3===n.nodeType&amp;&amp;null===n.nextSibling?ce?n.textContent=t:n.data=t:(w(e),e.appendChild(document.createTextNode(t)))}function b(e){for(var t=e;u(t)!==document.documentElement;){if(null===t)return!1;if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){if(t.host){if(t.host.impl)return b(t.host.impl);if(t.host)return b(t.host);throw new Error(&quot;Lost in Web Components world&quot;)}return!1}if(&quot;none&quot;===t.style.display)return!1;t=t.parentNode}return!0}function C(e){var t,n,o,r,i;if(r=document.documentElement,re()&amp;&amp;e.firstChild&amp;&amp;&quot;CAPTION&quot;===e.firstChild.nodeName)return i=e.getBoundingClientRect(),{top:i.top+(window.pageYOffset||r.scrollTop)-(r.clientTop||0),left:i.left+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0)};for(t=e.offsetLeft,n=e.offsetTop,o=e;(e=e.offsetParent)&amp;&amp;e!==document.body;)t+=e.offsetLeft,n+=e.offsetTop,o=e;return o&amp;&amp;&quot;fixed&quot;===o.style.position&amp;&amp;(t+=window.pageXOffset||r.scrollLeft,n+=window.pageYOffset||r.scrollTop),{left:t,top:n}}function _(){var e=window.scrollY;return void 0===e&amp;&amp;(e=document.documentElement.scrollTop),e}function R(){var e=window.scrollX;return void 0===e&amp;&amp;(e=document.documentElement.scrollLeft),e}function M(e){return e===window?_():e.scrollTop}function S(e){return e===window?R():e.scrollLeft}function E(e){for(var t,n,o,r=e.parentNode,i=[&quot;auto&quot;,&quot;scroll&quot;],s=&quot;&quot;,a=&quot;&quot;,l=&quot;&quot;,u=&quot;&quot;;r&amp;&amp;r.style&amp;&amp;document.body!==r;){if(t=r.style.overflow,n=r.style.overflowX,o=r.style.overflowY,&quot;scroll&quot;==t||&quot;scroll&quot;==n||&quot;scroll&quot;==o)return r;if(window.getComputedStyle&amp;&amp;(s=window.getComputedStyle(r),a=s.getPropertyValue(&quot;overflow&quot;),l=s.getPropertyValue(&quot;overflow-y&quot;),u=s.getPropertyValue(&quot;overflow-x&quot;),&quot;scroll&quot;===a||&quot;scroll&quot;===u||&quot;scroll&quot;===l))return r;if(r.clientHeight&lt;=r.scrollHeight&amp;&amp;(i.indexOf(o)!==-1||i.indexOf(t)!==-1||i.indexOf(a)!==-1||i.indexOf(l)!==-1))return r;if(r.clientWidth&lt;=r.scrollWidth&amp;&amp;(i.indexOf(n)!==-1||i.indexOf(t)!==-1||i.indexOf(a)!==-1||i.indexOf(u)!==-1))return r;r=r.parentNode}return window}function O(e){for(var t=e.parentNode;t&amp;&amp;t.style&amp;&amp;document.body!==t;){if(&quot;visible&quot;!==t.style.overflow&amp;&amp;&quot;&quot;!==t.style.overflow)return t;if(window.getComputedStyle){var n=window.getComputedStyle(t);if(&quot;visible&quot;!==n.getPropertyValue(&quot;overflow&quot;)&amp;&amp;&quot;&quot;!==n.getPropertyValue(&quot;overflow&quot;))return t}t=t.parentNode}return window}function T(e,t){if(e){if(e!==window){var n,o=e.style[t];return&quot;&quot;!==o&amp;&amp;void 0!==o?o:(n=k(e),&quot;&quot;!==n[t]&amp;&amp;void 0!==n[t]?n[t]:void 0)}if(&quot;width&quot;===t)return window.innerWidth+&quot;px&quot;;if(&quot;height&quot;===t)return window.innerHeight+&quot;px&quot;}}function k(e){return e.currentStyle||document.defaultView.getComputedStyle(e)}function x(e){return e.offsetWidth}function D(e){return re()&amp;&amp;e.firstChild&amp;&amp;&quot;CAPTION&quot;===e.firstChild.nodeName?e.offsetHeight+e.firstChild.offsetHeight:e.offsetHeight}function H(e){return e.clientHeight||e.innerHeight}function A(e){return e.clientWidth||e.innerWidth}function P(e,t,n){window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent(&quot;on&quot;+t,n)}function N(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent(&quot;on&quot;+t,n)}function L(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),o=n.duplicate();return n.moveToBookmark(t.getBookmark()),o.setEndPoint(&quot;EndToStart&quot;,n),o.text.length}return 0}function I(e){if(e.selectionEnd)return e.selectionEnd;if(document.selection){var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange();return n.text.indexOf(t.text)+t.text.length}}function W(){var e=&quot;&quot;;return window.getSelection?e=window.getSelection().toString():document.selection&amp;&amp;&quot;Control&quot;!==document.selection.type&amp;&amp;(e=document.selection.createRange().text),e}function j(e,t,n){if(void 0===n&amp;&amp;(n=t),e.setSelectionRange){e.focus();try{e.setSelectionRange(t,n)}catch(i){var o=e.parentNode,r=o.style.display;o.style.display=&quot;block&quot;,e.setSelectionRange(t,n),o.style.display=r}}else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd(&quot;character&quot;,n),i.moveStart(&quot;character&quot;,t),i.select()}}function V(){var e=document.createElement(&quot;div&quot;);e.style.height=&quot;200px&quot;,e.style.width=&quot;100%&quot;;var t=document.createElement(&quot;div&quot;);t.style.boxSizing=&quot;content-box&quot;,t.style.height=&quot;150px&quot;,t.style.left=&quot;0px&quot;,t.style.overflow=&quot;hidden&quot;,t.style.position=&quot;absolute&quot;,t.style.top=&quot;0px&quot;,t.style.width=&quot;200px&quot;,t.style.visibility=&quot;hidden&quot;,t.appendChild(e),(document.body||document.documentElement).appendChild(t);var n=e.offsetWidth;t.style.overflow=&quot;scroll&quot;;var o=e.offsetWidth;return n==o&amp;&amp;(o=t.clientWidth),(document.body||document.documentElement).removeChild(t),n-o}function B(){return void 0===le&amp;&amp;(le=V()),le}function F(e){return e.offsetWidth!==e.clientWidth}function z(e){return e.offsetHeight!==e.clientHeight}function Y(e,t,n){te()||ne()?(e.style.top=n,e.style.left=t):oe()?e.style[&quot;-webkit-transform&quot;]=&quot;translate3d(&quot;+t+&quot;,&quot;+n+&quot;,0)&quot;:e.style.transform=&quot;translate3d(&quot;+t+&quot;,&quot;+n+&quot;,0)&quot;}function U(e){var t;return e.style.transform&amp;&amp;&quot;&quot;!==(t=e.style.transform)?[&quot;transform&quot;,t]:e.style[&quot;-webkit-transform&quot;]&amp;&amp;&quot;&quot;!==(t=e.style[&quot;-webkit-transform&quot;])?[&quot;-webkit-transform&quot;,t]:-1}function G(e){e.style.transform&amp;&amp;&quot;&quot;!==e.style.transform?e.style.transform=&quot;&quot;:e.style[&quot;-webkit-transform&quot;]&amp;&amp;&quot;&quot;!==e.style[&quot;-webkit-transform&quot;]&amp;&amp;(e.style[&quot;-webkit-transform&quot;]=&quot;&quot;)}function $(e){var t=[&quot;INPUT&quot;,&quot;SELECT&quot;,&quot;TEXTAREA&quot;];return e&amp;&amp;(t.indexOf(e.nodeName)&gt;-1||&quot;true&quot;===e.contentEditable)}function K(e){return $(e)&amp;&amp;e.className.indexOf(&quot;handsontableInput&quot;)==-1&amp;&amp;e.className.indexOf(&quot;copyPaste&quot;)==-1}Object.defineProperties(n,{getParent:{get:function(){return o}},closest:{get:function(){return r}},closestDown:{get:function(){return i}},isChildOf:{get:function(){return s}},isChildOfWebComponentTable:{get:function(){return a}},polymerWrap:{get:function(){return l}},polymerUnwrap:{get:function(){return u}},index:{get:function(){return c}},overlayContainsElement:{get:function(){return d}},hasClass:{get:function(){return f}},addClass:{get:function(){return p}},removeClass:{get:function(){return m}},removeTextNodes:{get:function(){return g}},empty:{get:function(){return w}},HTML_CHARACTERS:{get:function(){return ue}},fastInnerHTML:{get:function(){return v}},fastInnerText:{get:function(){return y}},isVisible:{get:function(){return b}},offset:{get:function(){return C}},getWindowScrollTop:{get:function(){return _}},getWindowScrollLeft:{get:function(){return R}},getScrollTop:{get:function(){return M}},getScrollLeft:{get:function(){return S}},getScrollableElement:{get:function(){return E}},getTrimmingContainer:{get:function(){return O}},getStyle:{get:function(){return T}},getComputedStyle:{get:function(){return k}},outerWidth:{get:function(){return x}},outerHeight:{get:function(){return D}},innerHeight:{get:function(){return H}},innerWidth:{get:function(){return A}},addEvent:{get:function(){return P}},removeEvent:{get:function(){return N}},getCaretPosition:{get:function(){return L}},getSelectionEndPosition:{get:function(){return I}},getSelectionText:{get:function(){return W}},setCaretPosition:{get:function(){return j}},getScrollbarWidth:{get:function(){return B}},hasVerticalScrollbar:{get:function(){return F}},hasHorizontalScrollbar:{get:function(){return z}},setOverlayPosition:{get:function(){return Y}},getCssTransform:{get:function(){return U}},resetCssTransform:{get:function(){return G}},isInput:{get:function(){return $}},isOutsideInput:{get:function(){return K}},__esModule:{value:!0}});var X,q,Z,J,Q,ee=(X=e(&quot;../browser&quot;),X&amp;&amp;X.__esModule&amp;&amp;X||{default:X}),te=ee.isIE8,ne=ee.isIE9,oe=ee.isSafari,re=(q=e(&quot;../feature&quot;),q&amp;&amp;q.__esModule&amp;&amp;q||{default:q}).hasCaptionProblem,ie=!!document.documentElement.classList;if(ie){var se=function(){var e=document.createElement(&quot;div&quot;);return e.classList.add(&quot;test&quot;,&quot;test2&quot;),e.classList.contains(&quot;test2&quot;)}();Z=function(e,t){return&quot;&quot;!==t&amp;&amp;e.classList.contains(t)},J=function(e,t){var n=0;if(&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;)),t=h(t),se)e.classList.add.apply(e.classList,t);else for(;t&amp;&amp;t[n];)e.classList.add(t[n]),n++},Q=function(e,t){var n=0;if(&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;)),t=h(t),se)e.classList.remove.apply(e.classList,t);else for(;t&amp;&amp;t[n];)e.classList.remove(t[n]),n++}}else{var ae=function(e){return new RegExp(&quot;(\\s|^)&quot;+e+&quot;(\\s|$)&quot;)};Z=function(e,t){return!!e.className.match(ae(t))},J=function(e,t){var n=0,o=e.className;if(&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;)),&quot;&quot;===o)o=t.join(&quot; &quot;);else for(;t&amp;&amp;t[n];)ae(t[n]).test(o)||(o+=&quot; &quot;+t[n]),n++;e.className=o},Q=function(e,t){var n=0,o=e.className;for(&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;));t&amp;&amp;t[n];)o=o.replace(ae(t[n]),&quot; &quot;).trim(),n++;e.className!==o&amp;&amp;(e.className=o)}}var le,ue=/(&lt;(.*)&gt;|&amp;(.*);)/,ce=!!document.createTextNode(&quot;test&quot;).textContent},{&quot;../browser&quot;:44,&quot;../feature&quot;:49}],48:[function(e,t,n){&quot;use strict&quot;;function o(e){e.isImmediatePropagationEnabled=!1,e.cancelBubble=!0}function r(e){return e.isImmediatePropagationEnabled===!1}function i(e){&quot;function&quot;==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function s(e){return e.pageX?e.pageX:e.clientX+f()}function a(e){return e.pageY?e.pageY:e.clientY+h()}function l(e){return 2===e.button}function u(e){return 0===e.button}Object.defineProperties(n,{stopImmediatePropagation:{get:function(){return o}},isImmediatePropagationStopped:{get:function(){return r}},stopPropagation:{get:function(){return i}},pageX:{get:function(){return s}},pageY:{get:function(){return a}},isRightClick:{get:function(){return l}},isLeftClick:{get:function(){return u}},__esModule:{value:!0}});var c,d=(c=e(&quot;element&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),h=d.getWindowScrollTop,f=d.getWindowScrollLeft},{element:47}],49:[function(e,t,n){&quot;use strict&quot;;function o(e){return h.call(window,e)}function r(e){f.call(window,e)}function i(){return&quot;ontouchstart&quot;in window}function s(){var e=document.createElement(&quot;div&quot;);return!(!e.createShadowRoot||!e.createShadowRoot.toString().match(/\[native code\]/))}function a(){var e=document.createElement(&quot;TABLE&quot;);e.style.borderSpacing=0,e.style.borderWidth=0,e.style.padding=0;var t=document.createElement(&quot;TBODY&quot;);e.appendChild(t),t.appendChild(document.createElement(&quot;TR&quot;)),t.firstChild.appendChild(document.createElement(&quot;TD&quot;)),t.firstChild.firstChild.innerHTML=&quot;&lt;tr&gt;&lt;td&gt;t&lt;br&gt;t&lt;/td&gt;&lt;/tr&gt;&quot;;var n=document.createElement(&quot;CAPTION&quot;);n.innerHTML=&quot;c&lt;br&gt;c&lt;br&gt;c&lt;br&gt;c&quot;,n.style.padding=0,n.style.margin=0,e.insertBefore(n,t),document.body.appendChild(e),m=e.offsetHeight&lt;2*e.lastChild.offsetHeight,document.body.removeChild(e)}function l(){return void 0===m&amp;&amp;a(),m}function u(e){var t=void 0!==arguments[1]?arguments[1]:{};return g?g:g=&quot;object&quot;==typeof Intl?new Intl.Collator(e,t).compare:&quot;function&quot;==typeof String.prototype.localeCompare?function(e,t){return(e+&quot;&quot;).localeCompare(t)}:function(e,t){return e===t?0:e&gt;t?-1:1}}Object.defineProperties(n,{requestAnimationFrame:{get:function(){return o}},cancelAnimationFrame:{get:function(){return r}},isTouchSupported:{get:function(){return i}},isWebComponentSupportedNatively:{get:function(){return s}},hasCaptionProblem:{get:function(){return l}},getComparisonFunction:{get:function(){return u}},__esModule:{value:!0}});for(var c=0,d=[&quot;ms&quot;,&quot;moz&quot;,&quot;webkit&quot;,&quot;o&quot;],h=window.requestAnimationFrame,f=window.cancelAnimationFrame,p=0;p&lt;d.length&amp;&amp;!h;++p)h=window[d[p]+&quot;RequestAnimationFrame&quot;],f=window[d[p]+&quot;CancelAnimationFrame&quot;]||window[d[p]+&quot;CancelRequestAnimationFrame&quot;];h||(h=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-c)),o=window.setTimeout(function(){e(t+n)},n);return c=t+n,o}),f||(f=function(e){clearTimeout(e)});var m,g},{}],50:[function(e,t,n){&quot;use strict&quot;;function o(e){return&quot;function&quot;==typeof e}function r(e,t){return function(){return e.apply(t,arguments)}}function i(e){function t(){var t=this,s=arguments,a=Date.now(),l=!1;r.lastCallThrottled=!0,o||(o=a,l=!0);var u=n-(a-o);return l?(r.lastCallThrottled=!1,e.apply(this,s)):(i&amp;&amp;clearTimeout(i),i=setTimeout(function(){r.lastCallThrottled=!1,e.apply(t,s),o=0,i=void 0},u)),r}var n=void 0!==arguments[1]?arguments[1]:200,o=0,r={lastCallThrottled:!0},i=null;return t}function s(e){function t(){a=r}function n(){return a?(a--,e.apply(this,arguments)):s.apply(this,arguments)}var o=void 0!==arguments[1]?arguments[1]:200,r=void 0!==arguments[2]?arguments[2]:10,s=i(e,o),a=r;return n.clearHits=t,n}function a(e){function t(){var t=this,i=arguments;return r&amp;&amp;clearTimeout(r),r=setTimeout(function(){n=e.apply(t,i)},o),n}var n,o=void 0!==arguments[1]?arguments[1]:200,r=null;return t}function l(){for(var e=[],t=0;t&lt;arguments.length;t++)e[t]=arguments[t];var n=e,o=n[0],r=Array.prototype.slice.call(n,1);
return function(){return f(r,function(e,t){return t(e)},o.apply(this,arguments))}}function u(e){for(var t=[],n=1;n&lt;arguments.length;n++)t[n-1]=arguments[n];return function(){for(var n=[],o=0;o&lt;arguments.length;o++)n[o]=arguments[o];return e.apply(this,t.concat(n))}}function c(e){function t(o){return function(){for(var r=[],i=0;i&lt;arguments.length;i++)r[i]=arguments[i];var s,a=o.concat(r);return s=a.length&gt;=n?e.apply(this,a):t(a)}}var n=e.length;return t([])}function d(e){function t(o){return function(){for(var r=[],i=0;i&lt;arguments.length;i++)r[i]=arguments[i];var s,a=o.concat(r.reverse());return s=a.length&gt;=n?e.apply(this,a):t(a)}}var n=e.length;return t([])}Object.defineProperties(n,{isFunction:{get:function(){return o}},proxy:{get:function(){return r}},throttle:{get:function(){return i}},throttleAfterHits:{get:function(){return s}},debounce:{get:function(){return a}},pipe:{get:function(){return l}},partial:{get:function(){return u}},curry:{get:function(){return c}},curryRight:{get:function(){return d}},__esModule:{value:!0}});var h,f=(h=e(&quot;array&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).arrayReduce},{array:43}],51:[function(e,t,n){&quot;use strict&quot;;function o(e){switch(typeof e){case&quot;string&quot;:case&quot;number&quot;:return e+&quot;&quot;;case&quot;object&quot;:return null===e?&quot;&quot;:e.toString();case&quot;undefined&quot;:return&quot;&quot;;default:return e.toString()}}function r(e){return&quot;undefined&quot;!=typeof e}function i(e){return&quot;undefined&quot;==typeof e}function s(e){return null===e||&quot;&quot;===e||i(e)}Object.defineProperties(n,{stringify:{get:function(){return o}},isDefined:{get:function(){return r}},isUndefined:{get:function(){return i}},isEmpty:{get:function(){return s}},__esModule:{value:!0}})},{}],52:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=typeof e;return&quot;number&quot;==t?!isNaN(e)&amp;&amp;isFinite(e):&quot;string&quot;==t?!!e.length&amp;&amp;(1==e.length?/\d/.test(e):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(e)):&quot;object&quot;==t&amp;&amp;!(!e||&quot;number&quot;!=typeof e.valueOf()||e instanceof Date)}function r(e,t,n){var o=-1;for(&quot;function&quot;==typeof t?(n=t,t=e):o=e-1;++o&lt;=t&amp;&amp;n(o)!==!1;);}function i(e,t,n){var o=e+1;for(&quot;function&quot;==typeof t&amp;&amp;(n=t,t=0);--o&gt;=t&amp;&amp;n(o)!==!1;);}function s(e,t){return t=parseInt(t.toString().replace(&quot;%&quot;,&quot;&quot;),10),t=parseInt(e*t/100)}Object.defineProperties(n,{isNumeric:{get:function(){return o}},rangeEach:{get:function(){return r}},rangeEachReverse:{get:function(){return i}},valueAccordingPercent:{get:function(){return s}},__esModule:{value:!0}})},{}],53:[function(e,t,n){&quot;use strict&quot;;function o(e){var t;return Array.isArray(e)?t=[]:(t={},p(e,function(e,n){&quot;__children&quot;!==n&amp;&amp;(e&amp;&amp;&quot;object&quot;==typeof e&amp;&amp;!Array.isArray(e)?t[n]=o(e):Array.isArray(e)?e.length&amp;&amp;&quot;object&quot;==typeof e[0]&amp;&amp;!Array.isArray(e[0])?t[n]=[o(e[0])]:t[n]=[]:t[n]=null)})),t}function r(e,t){return t.prototype.constructor=t,e.prototype=new t,e.prototype.constructor=e,e}function i(e,t){return p(t,function(t,n){e[n]=t}),e}function s(e,t){p(t,function(n,o){t[o]&amp;&amp;&quot;object&quot;==typeof t[o]?(e[o]||(Array.isArray(t[o])?e[o]=[]:&quot;[object Date]&quot;===Object.prototype.toString.call(t[o])?e[o]=t[o]:e[o]={}),s(e[o],t[o])):e[o]=t[o]})}function a(e){return&quot;object&quot;==typeof e?JSON.parse(JSON.stringify(e)):e}function l(e){var t={};return p(e,function(e,n){t[n]=e}),t}function u(e){for(var t=[],n=1;n&lt;arguments.length;n++)t[n-1]=arguments[n];return e.MIXINS||(e.MIXINS=[]),y(t,function(t){e.MIXINS.push(t.MIXIN_NAME),p(t,function(t,n){if(void 0!==e.prototype[n])throw new Error(&quot;Mixin conflict. Property '&quot;+n+&quot;' already exist and cannot be overwritten.&quot;);if(&quot;function&quot;==typeof t)e.prototype[n]=t;else{var o=function(e,t){e=&quot;_&quot;+e;var n=function(e){return(Array.isArray(e)||d(e))&amp;&amp;(e=a(e)),e};return function(){return void 0===this[e]&amp;&amp;(this[e]=n(t)),this[e]}},r=function(e){return e=&quot;_&quot;+e,function(t){this[e]=t}};Object.defineProperty(e.prototype,n,{get:o(n,t),set:r(n),configurable:!0})}})}),e}function c(e,t){return JSON.stringify(e)===JSON.stringify(t)}function d(e){return&quot;[object Object]&quot;==Object.prototype.toString.call(e)}function h(e){var t;if(&quot;object&quot;==typeof e.__proto__)t=e.__proto__;else{var n,o=e.constructor;&quot;function&quot;==typeof e.constructor&amp;&amp;(n=o,delete e.constructor&amp;&amp;(o=e.constructor,e.constructor=n)),t=o?o.prototype:null}return t}function f(e,t,n,o){o.value=n,o.writable=o.writable!==!1,o.enumerable=o.enumerable!==!1,o.configurable=o.configurable!==!1,Object.defineProperty(e,t,o)}function p(e,t){for(var n in e)if((!e.hasOwnProperty||e.hasOwnProperty&amp;&amp;e.hasOwnProperty(n))&amp;&amp;t(e[n],n,e)===!1)break;return e}function m(e,t){var n=t.split(&quot;.&quot;),o=e;return p(n,function(e){if(o=o[e],void 0===o)return o=void 0,!1}),o}function g(e){if(!d(e))return 0;var t=function(e){var n=0;return d(e)?p(e,function(e){n+=t(e)}):n++,n};return t(e)}function w(e){var t,n=void 0!==arguments[1]?arguments[1]:&quot;value&quot;,o=&quot;_&quot;+n,r=(t={},Object.defineProperty(t,&quot;_touched&quot;,{value:!1,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,o,{value:e,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,&quot;isTouched&quot;,{value:function(){return this._touched},configurable:!0,enumerable:!0,writable:!0}),t);return Object.defineProperty(r,n,{get:function(){return this[o]},set:function(e){this._touched=!0,this[o]=e},enumerable:!0,configurable:!0}),r}Object.defineProperties(n,{duckSchema:{get:function(){return o}},inherit:{get:function(){return r}},extend:{get:function(){return i}},deepExtend:{get:function(){return s}},deepClone:{get:function(){return a}},clone:{get:function(){return l}},mixin:{get:function(){return u}},isObjectEquals:{get:function(){return c}},isObject:{get:function(){return d}},getPrototypeOf:{get:function(){return h}},defineGetter:{get:function(){return f}},objectEach:{get:function(){return p}},getProperty:{get:function(){return m}},deepObjectSize:{get:function(){return g}},createObjectPropListener:{get:function(){return w}},__esModule:{value:!0}});var v,y=(v=e(&quot;array&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}).arrayEach},{array:43}],54:[function(e,t,n){&quot;use strict&quot;;function o(e,t){function n(){}i(n,e);for(var o=0,r=t.length;o&lt;r;o++)n.prototype[t[o]]=void 0;return n}Object.defineProperties(n,{columnFactory:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).inherit},{object:53}],55:[function(e,t,n){&quot;use strict&quot;;function o(e){return e[0].toUpperCase()+e.substr(1)}function r(e,t){var n=!0;return m(t.length-1,function(o){if(e.charAt(o)!==t.charAt(o))return n=!1,!1}),n}function i(e,t){var n=!0,o=t.length-1,r=e.length-1;return m(o,function(i){var s=r-i,a=o-i;if(e.charAt(s)!==t.charAt(a))return n=!1,!1}),n}function s(){for(var e=[],t=0;t&lt;arguments.length;t++)e[t]=arguments[t];for(var n=[],o=e.length;o--;){var r=p(e[o]).toLowerCase();n.indexOf(r)===-1&amp;&amp;n.push(r)}return 1===n.length}function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()}function l(e){return/^([0-9][0-9]?\%$)|(^100\%$)/.test(e)}function u(e){var t=void 0!==arguments[1]?arguments[1]:{};return(e+&quot;&quot;).replace(/(?:\\)?\[([^\[\]]+)]/g,function(e,n){return&quot;\\&quot;===e.charAt(0)?e.substr(1,e.length-1):void 0===t[n]?&quot;&quot;:t[n]})}function c(e,t){var n=void 0!==arguments[2]?arguments[2]:&quot; &quot;;if(e+=&quot;&quot;,e.length&gt;=t)return e;n=String(n);var o=n.length;o||(n=&quot; &quot;);var r=t-e.length,i=Math.ceil(r/n.length),s=&quot;&quot;;return m(i,function(e){s+=n}),s=s.slice(0,r),s+e}function d(e){return e+=&quot;&quot;,e.replace(g,&quot;&quot;)}Object.defineProperties(n,{toUpperCaseFirst:{get:function(){return o}},startsWith:{get:function(){return r}},endsWith:{get:function(){return i}},equalsIgnoreCase:{get:function(){return s}},randomString:{get:function(){return a}},isPercentValue:{get:function(){return l}},substitute:{get:function(){return u}},padStart:{get:function(){return c}},stripTags:{get:function(){return d}},__esModule:{value:!0}});var h,f,p=(h=e(&quot;mixed&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).stringify,m=(f=e(&quot;number&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).rangeEach,g=/&lt;\/?\w+\/?&gt;|&lt;\w+[\s|\/][^&gt;]*&gt;/gi},{mixed:51,number:52}],56:[function(e,t,n){&quot;use strict&quot;;function o(e){return 32==e||e&gt;=48&amp;&amp;e&lt;=57||e&gt;=96&amp;&amp;e&lt;=111||e&gt;=186&amp;&amp;e&lt;=192||e&gt;=219&amp;&amp;e&lt;=222||e&gt;=226||e&gt;=65&amp;&amp;e&lt;=90}function r(e){var t=[u.ARROW_DOWN,u.ARROW_UP,u.ARROW_LEFT,u.ARROW_RIGHT,u.HOME,u.END,u.DELETE,u.BACKSPACE,u.F1,u.F2,u.F3,u.F4,u.F5,u.F6,u.F7,u.F8,u.F9,u.F10,u.F11,u.F12,u.TAB,u.PAGE_DOWN,u.PAGE_UP,u.ENTER,u.ESCAPE,u.SHIFT,u.CAPS_LOCK,u.ALT];return t.indexOf(e)!==-1}function i(e){return[u.CONTROL_LEFT,224,u.COMMAND_LEFT,u.COMMAND_RIGHT].indexOf(e)!==-1}function s(e,t){var n=t.split(&quot;|&quot;),o=!1;return l(n,function(t){if(e===u[t])return o=!0,!1}),o}Object.defineProperties(n,{KEY_CODES:{get:function(){return u}},isPrintableChar:{get:function(){return o}},isMetaKey:{get:function(){return r}},isCtrlKey:{get:function(){return i}},isKey:{get:function(){return s}},__esModule:{value:!0}});var a,l=(a=e(&quot;array&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).arrayEach,u={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,A:65,X:88,C:67,V:86}},{array:43}],57:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{arrayMapper:{get:function(){return m}},__esModule:{value:!0}});var o,r,i,s,a=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,l=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),u=(l.arrayEach,l.arrayReduce),c=l.arrayMap,d=l.arrayMax,h=(i=e(&quot;helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).defineGetter,f=(s=e(&quot;helpers/number&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).rangeEach,p=&quot;arrayMapper&quot;,m={_arrayMap:[],getValueByIndex:function(e){var t;return void 0===(t=this._arrayMap[e])?null:t},getIndexByValue:function(e){var t;return(t=this._arrayMap.indexOf(e))===-1?null:t},insertItems:function(e){var t=void 0!==arguments[1]?arguments[1]:1,n=this,o=d(this._arrayMap)+1,r=[];return f(t-1,function(t){r.push(n._arrayMap.splice(e+t,0,o+t))}),r},removeItems:function(e){var t=void 0!==arguments[1]?arguments[1]:1,n=this,o=[];if(Array.isArray(e)){var r=[].concat(this._arrayMap);e.sort(function(e,t){return t-e}),o=u(e,function(e,t){return n._arrayMap.splice(t,1),e.concat(r.slice(t,t+1))},[])}else o=this._arrayMap.splice(e,t);return o},unshiftItems:function(e){function t(e){return u(o,function(t,n){return e&gt;n&amp;&amp;t++,t},0)}var n=void 0!==arguments[1]?arguments[1]:1,o=this.removeItems(e,n);this._arrayMap=c(this._arrayMap,function(e,n){var o=t(e);return o&amp;&amp;(e-=o),e})},shiftItems:function(e){var t=void 0!==arguments[1]?arguments[1]:1,n=this;this._arrayMap=c(this._arrayMap,function(n){return n&gt;=e&amp;&amp;(n+=t),n}),f(t-1,function(t){n._arrayMap.splice(e+t,0,e+t)})},clearMap:function(){this._arrayMap.length=0}};h(m,&quot;MIXIN_NAME&quot;,p,{writable:!1,enumerable:!1}),a.utils.arrayMapper=m},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53}],58:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{localHooks:{get:function(){return c}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,a=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayEach,l=(i=e(&quot;helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).defineGetter,u=&quot;localHooks&quot;,c={_localHooks:Object.create(null),addLocalHook:function(e,t){this._localHooks[e]||(this._localHooks[e]=[]),this._localHooks[e].push(t)},runLocalHooks:function(e){for(var t=[],n=1;n&lt;arguments.length;n++)t[n-1]=arguments[n];var o=this;this._localHooks[e]&amp;&amp;a(this._localHooks[e],function(e){return e.apply(o,t)})},clearLocalHooks:function(){this._localHooks={}}};l(c,&quot;MIXIN_NAME&quot;,u,{writable:!1,enumerable:!1}),s.utils.localHooks=c},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/object&quot;:53}],59:[function(e,t,n){&quot;use strict&quot;;function o(){function e(e){return null!==e&amp;&amp;!n(e)&amp;&amp;(&quot;string&quot;==typeof e||&quot;number&quot;==typeof e)}function t(e){return null!==e&amp;&amp;(&quot;object&quot;==typeof e||&quot;function&quot;==typeof e)}function n(e){return e!==e}var o={arrayMap:[],weakMap:new WeakMap};return{get:function(n){return e(n)?o.arrayMap[n]:t(n)?o.weakMap.get(n):void 0},set:function(n,r){if(e(n))o.arrayMap[n]=r;else{if(!t(n))throw new Error(&quot;Invalid key type&quot;);o.weakMap.set(n,r)}},delete:function(n){e(n)?delete o.arrayMap[n]:t(n)&amp;&amp;o.weakMap.delete(n)}}}Object.defineProperties(n,{MultiMap:{get:function(){return o}},__esModule:{value:!0}}),window.MultiMap=o},{}],60:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{Hooks:{get:function(){return l}},__esModule:{value:!0}});var o,r,i=[&quot;afterCellMetaReset&quot;,&quot;afterChange&quot;,&quot;afterChangesObserved&quot;,&quot;afterContextMenuDefaultOptions&quot;,&quot;beforeContextMenuSetItems&quot;,&quot;afterDropdownMenuDefaultOptions&quot;,&quot;beforeDropdownMenuSetItems&quot;,&quot;afterContextMenuHide&quot;,&quot;afterContextMenuShow&quot;,&quot;afterCopyLimit&quot;,&quot;beforeCreateCol&quot;,&quot;afterCreateCol&quot;,&quot;beforeCreateRow&quot;,&quot;afterCreateRow&quot;,&quot;afterDeselect&quot;,&quot;afterDestroy&quot;,&quot;afterDocumentKeyDown&quot;,&quot;afterGetCellMeta&quot;,&quot;afterGetColHeader&quot;,&quot;afterGetRowHeader&quot;,&quot;afterInit&quot;,&quot;afterLoadData&quot;,&quot;afterMomentumScroll&quot;,&quot;afterOnCellCornerMouseDown&quot;,&quot;afterOnCellCornerDblClick&quot;,&quot;afterOnCellMouseDown&quot;,&quot;afterOnCellMouseOver&quot;,&quot;afterRemoveCol&quot;,&quot;afterRemoveRow&quot;,&quot;afterRender&quot;,&quot;beforeRenderer&quot;,&quot;afterRenderer&quot;,&quot;afterScrollHorizontally&quot;,&quot;afterScrollVertically&quot;,&quot;afterSelection&quot;,&quot;afterSelectionByProp&quot;,&quot;afterSelectionEnd&quot;,&quot;afterSelectionEndByProp&quot;,&quot;afterSetCellMeta&quot;,&quot;afterSetDataAtCell&quot;,&quot;afterSetDataAtRowProp&quot;,&quot;afterUpdateSettings&quot;,&quot;afterValidate&quot;,&quot;beforeAutofill&quot;,&quot;beforeCellAlignment&quot;,&quot;beforeChange&quot;,&quot;beforeChangeRender&quot;,&quot;beforeDrawBorders&quot;,&quot;beforeGetCellMeta&quot;,&quot;beforeInit&quot;,&quot;beforeInitWalkontable&quot;,&quot;beforeKeyDown&quot;,&quot;beforeOnCellMouseDown&quot;,&quot;beforeOnCellMouseOver&quot;,&quot;beforeRemoveCol&quot;,&quot;beforeRemoveRow&quot;,&quot;beforeRender&quot;,&quot;beforeSetRangeStart&quot;,&quot;beforeSetRangeEnd&quot;,&quot;beforeTouchScroll&quot;,&quot;beforeValidate&quot;,&quot;beforeValueRender&quot;,&quot;construct&quot;,&quot;init&quot;,&quot;modifyCol&quot;,&quot;unmodifyCol&quot;,&quot;unmodifyRow&quot;,&quot;modifyColHeader&quot;,&quot;modifyColWidth&quot;,&quot;modifyRow&quot;,&quot;modifyRowHeader&quot;,&quot;modifyRowHeight&quot;,&quot;modifyData&quot;,&quot;modifyRowData&quot;,&quot;persistentStateLoad&quot;,&quot;persistentStateReset&quot;,&quot;persistentStateSave&quot;,&quot;beforeColumnSort&quot;,&quot;afterColumnSort&quot;,&quot;modifyAutofillRange&quot;,&quot;modifyCopyableRange&quot;,&quot;beforeColumnMove&quot;,&quot;afterColumnMove&quot;,&quot;beforeRowMove&quot;,&quot;afterRowMove&quot;,&quot;beforeColumnResize&quot;,&quot;afterColumnResize&quot;,&quot;beforeRowResize&quot;,&quot;afterRowResize&quot;,&quot;afterGetColumnHeaderRenderers&quot;,&quot;afterGetRowHeaderRenderers&quot;,&quot;beforeStretchingColumnWidth&quot;,&quot;beforeFilter&quot;,&quot;afterFilter&quot;,&quot;modifyColumnHeaderHeight&quot;,&quot;beforeUndo&quot;,&quot;afterUndo&quot;,&quot;beforeRedo&quot;,&quot;afterRedo&quot;,&quot;modifyRowHeaderWidth&quot;,&quot;beforeAutofillInsidePopulate&quot;,&quot;modifyTransformStart&quot;,&quot;modifyTransformEnd&quot;,&quot;afterModifyTransformStart&quot;,&quot;afterModifyTransformEnd&quot;,&quot;beforeValueRender&quot;,&quot;afterViewportRowCalculatorOverride&quot;,&quot;afterViewportColumnCalculatorOverride&quot;,&quot;afterPluginsInitialized&quot;,&quot;manualRowHeights&quot;,&quot;skipLengthCache&quot;,&quot;afterTrimRow&quot;,&quot;afterUntrimRow&quot;,&quot;afterDropdownMenuShow&quot;,&quot;afterDropdownMenuHide&quot;,&quot;hiddenRow&quot;,&quot;hiddenColumn&quot;,&quot;beforeAddChild&quot;,&quot;afterAddChild&quot;,&quot;beforeDetachChild&quot;,&quot;afterDetachChild&quot;,&quot;afterBeginEditing&quot;],s=(o=e(&quot;helpers/array&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).arrayEach,a=(r=e(&quot;helpers/object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).objectEach,l=function(){this.globalBucket=this.createEmptyBucket()};$traceurRuntime.createClass(l,{createEmptyBucket:function(){var e=Object.create(null);return s(i,function(t){return e[t]=[]}),e},getBucket:function(){var e=void 0!==arguments[0]?arguments[0]:null;return e?(e.pluginHookBucket||(e.pluginHookBucket=this.createEmptyBucket()),e.pluginHookBucket):this.globalBucket},add:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this;if(Array.isArray(t))s(t,function(t){return o.add(e,t,n)});else{var r=this.getBucket(n);&quot;undefined&quot;==typeof r[e]&amp;&amp;(this.register(e),r[e]=[]),t.skip=!1,r[e].indexOf(t)===-1&amp;&amp;r[e].push(t)}return this},once:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this;Array.isArray(t)?s(t,function(t){return o.once(e,t,n)}):(t.runOnce=!0,this.add(e,t,n))},remove:function(e,t){var n=void 0!==arguments[2]?arguments[2]:null,o=this.getBucket(n);return&quot;undefined&quot;!=typeof o[e]&amp;&amp;o[e].indexOf(t)&gt;=0&amp;&amp;(t.skip=!0,!0)},has:function(e){var t=void 0!==arguments[1]?arguments[1]:null,n=this.getBucket(t);return!(void 0===n[e]||!n[e].length)},run:function(e,t,n,o,r,i,s,a){var l=this.globalBucket[t],u=-1,c=l?l.length:0;if(c)for(;++u&lt;c;)if(l[u]&amp;&amp;!l[u].skip){var d=l[u].call(e,n,o,r,i,s,a);void 0!==d&amp;&amp;(n=d),l[u]&amp;&amp;l[u].runOnce&amp;&amp;this.remove(t,l[u])}var h=this.getBucket(e)[t],f=-1,p=h?h.length:0;if(p)for(;++f&lt;p;)if(h[f]&amp;&amp;!h[f].skip){var m=h[f].call(e,n,o,r,i,s,a);void 0!==m&amp;&amp;(n=m),h[f]&amp;&amp;h[f].runOnce&amp;&amp;this.remove(t,h[f],e)}return n},destroy:function(){var e=void 0!==arguments[0]?arguments[0]:null;a(this.getBucket(e),function(e,t,n){return n[t].length=0})},register:function(e){this.isRegistered(e)||i.push(e)},deregister:function(e){this.isRegistered(e)&amp;&amp;i.splice(i.indexOf(e),1)},isRegistered:function(e){return i.indexOf(e)&gt;=0},getRegistered:function(){return i}},{})},{&quot;helpers/array&quot;:43,&quot;helpers/object&quot;:53}],61:[function(e,t,n){&quot;use strict&quot;;function o(e,t){e=h(e),c.plugins[e]=t,c.hooks.add(&quot;construct&quot;,function(){var n;f.has(this)||f.set(this,{}),n=f.get(this),n[e]||(n[e]=new t(this))}),c.hooks.add(&quot;afterDestroy&quot;,function(){if(f.has(this)){var e=f.get(this);d(e,function(e){return e.destroy()}),f.delete(this)}})}function r(e,t){if(&quot;string&quot;!=typeof t)throw Error('Only strings can be passed as &quot;plugin&quot; parameter');var n=h(t);if(f.has(e)&amp;&amp;f.get(e)[n])return f.get(e)[n]}function i(e){return f.has(e)?Object.keys(f.get(e)):[]}function s(e,t){var n=null;return f.has(e)&amp;&amp;d(f.get(e),function(e,o){e===t&amp;&amp;(n=o)}),n}Object.defineProperties(n,{registerPlugin:{get:function(){return o}},getPlugin:{get:function(){return r}},getRegistredPluginNames:{get:function(){return i}},getPluginName:{get:function(){return s}},__esModule:{value:!0}});var a,l,u,c=(a=e(&quot;browser&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).default,d=(l=e(&quot;helpers/object&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).objectEach,h=(u=e(&quot;helpers/string&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).toUpperCaseFirst,f=new WeakMap},{browser:24,&quot;helpers/object&quot;:53,&quot;helpers/string&quot;:55}],62:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{default:{get:function(){return C}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,u=(r=e(&quot;helpers/object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),c=u.defineGetter,d=u.objectEach,h=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,f=(s=e(&quot;utils/recordTranslator&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),p=(f.registerIdentity,f.getTranslator),m=(a=e(&quot;plugins&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),g=m.getRegistredPluginNames,w=m.getPluginName,v=new WeakMap,y=null,b=function(e){var t=this;c(this,&quot;hot&quot;,e,{writable:!1}),c(this,&quot;t&quot;,p(e),{writable:!1}),v.set(this,{hooks:{}}),y=null,this.pluginName=null,this.pluginsInitializedCallbacks=[],this.isPluginsReady=!1,this.enabled=!1,this.initialized=!1,this.hot.addHook(&quot;afterPluginsInitialized&quot;,function(){return t.onAfterPluginsInitialized()}),this.hot.addHook(&quot;afterUpdateSettings&quot;,function(){return t.onUpdateSettings()}),this.hot.addHook(&quot;beforeInit&quot;,function(){return t.init()})};$traceurRuntime.createClass(b,{init:function(){this.pluginName=w(this.hot,this),this.isEnabled&amp;&amp;this.isEnabled()&amp;&amp;this.enablePlugin(),y||(y=g(this.hot)),y.indexOf(this.pluginName)&gt;=0&amp;&amp;y.splice(y.indexOf(this.pluginName),1),y.length||this.hot.runHooks(&quot;afterPluginsInitialized&quot;),this.initialized=!0},enablePlugin:function(){this.enabled=!0},disablePlugin:function(){this.eventManager&amp;&amp;this.eventManager.clear(),this.clearHooks(),this.enabled=!1},addHook:function(e,t){var n=v.get(this).hooks[e]=v.get(this).hooks[e]||[];this.hot.addHook(e,t),n.push(t),v.get(this).hooks[e]=n},removeHooks:function(e){var t=this;h(v.get(this).hooks[e]||[],function(n){t.hot.removeHook(e,n)})},clearHooks:function(){var e=this,t=v.get(this).hooks;d(t,function(t,n){return e.removeHooks(n)}),t.length=0},callOnPluginsReady:function(e){this.isPluginsReady?e():this.pluginsInitializedCallbacks.push(e)},onAfterPluginsInitialized:function(){h(this.pluginsInitializedCallbacks,function(e){return e()}),this.pluginsInitializedCallbacks.length=0,this.isPluginsReady=!0},onUpdateSettings:function(){this.isEnabled&amp;&amp;(this.enabled&amp;&amp;!this.isEnabled()&amp;&amp;this.disablePlugin(),!this.enabled&amp;&amp;this.isEnabled()&amp;&amp;this.enablePlugin(),this.enabled&amp;&amp;this.isEnabled()&amp;&amp;this.updatePlugin())},updatePlugin:function(){},destroy:function(){var e=this;this.eventManager&amp;&amp;this.eventManager.destroy(),this.clearHooks(),d(this,function(t,n){&quot;hot&quot;!==n&amp;&amp;&quot;t&quot;!==n&amp;&amp;(e[n]=null)}),delete this.t,delete this.hot}},{});var C=b;l.plugins.BasePlugin=b},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/object&quot;:53,plugins:61,&quot;utils/recordTranslator&quot;:130}],63:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{AutoColumnSize:{get:function(){return N}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,m=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),g=m.arrayEach,w=m.arrayFilter,v=m.arrayReduce,y=m.arrayMap,b=(i=e(&quot;helpers/feature&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),C=b.cancelAnimationFrame,_=b.requestAnimationFrame,R=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isVisible,M=(a=e(&quot;utils/ghostTable&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).GhostTable,S=(l=e(&quot;helpers/object&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),E=S.isObject,O=(S.objectEach,u=e(&quot;helpers/number&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}),T=O.valueAccordingPercent,k=O.rangeEach,x=(c=e(&quot;plugins&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).registerPlugin,D=(d=e(&quot;utils/samplesGenerator&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).SamplesGenerator,H=(h=e(&quot;helpers/string&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).isPercentValue,A=(f=e(&quot;3rdparty/walkontable/src/calculator/viewportColumns&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).WalkontableViewportColumnsCalculator,P=new WeakMap,N=function(e){var t=this;$traceurRuntime.superConstructor(L).call(this,e),P.set(this,{cachedColumnHeaders:[]}),this.widths=[],this.ghostTable=new M(this.hot),this.samplesGenerator=new D(function(e,n){return t.hot.getDataAtCell(e,n)}),this.firstCalculation=!0,this.inProgress=!1,this.addHook(&quot;beforeColumnResize&quot;,function(e,n,o){return t.onBeforeColumnResize(e,n,o)})},L=N;$traceurRuntime.createClass(N,{isEnabled:function(){return this.hot.getSettings().autoColumnSize!==!1&amp;&amp;!this.hot.getSettings().colWidths},enablePlugin:function(){var e=this;if(!this.enabled){var t=this.hot.getSettings().autoColumnSize;t&amp;&amp;null!=t.useHeaders&amp;&amp;this.ghostTable.setSetting(&quot;useHeaders&quot;,t.useHeaders),this.addHook(&quot;afterLoadData&quot;,function(){return e.onAfterLoadData()}),this.addHook(&quot;beforeChange&quot;,function(t){return e.onBeforeChange(t)}),this.addHook(&quot;beforeRender&quot;,function(t){return e.onBeforeRender(t)}),this.addHook(&quot;modifyColWidth&quot;,function(t,n){return e.getColumnWidth(n,t)}),this.addHook(&quot;afterInit&quot;,function(){return e.onAfterInit()}),$traceurRuntime.superGet(this,L.prototype,&quot;enablePlugin&quot;).call(this)}},updatePlugin:function(){var e=this.findColumnsWhereHeaderWasChanged();e.length&amp;&amp;this.clearCache(e),$traceurRuntime.superGet(this,L.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){$traceurRuntime.superGet(this,L.prototype,&quot;disablePlugin&quot;).call(this)},calculateColumnsWidth:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countCols()-1},t=void 0!==arguments[1]?arguments[1]:{from:0,to:this.hot.countRows()-1},n=void 0!==arguments[2]&amp;&amp;arguments[2],o=this;&quot;number&quot;==typeof e&amp;&amp;(e={from:e,to:e}),&quot;number&quot;==typeof t&amp;&amp;(t={from:t,to:t}),k(e.from,e.to,function(e){if(n||void 0===o.widths[e]&amp;&amp;!o.hot._getColWidthFromSettings(e)){var r=o.samplesGenerator.generateColumnSamples(e,t);r.forEach(function(e,t){return o.ghostTable.addColumn(t,e)})}}),this.ghostTable.columns.length&amp;&amp;(this.ghostTable.getWidths(function(e,t){return o.widths[e]=t}),this.ghostTable.clean())},calculateAllColumnsWidth:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countRows()-1},t=this,n=0,o=this.hot.countCols()-1,r=null;this.inProgress=!0;var i=function(){return t.hot?(t.calculateColumnsWidth({from:n,to:Math.min(n+L.CALCULATION_STEP,o)},e),n=n+L.CALCULATION_STEP+1,void(n&lt;o?r=_(i):(C(r),t.inProgress=!1,t.hot.view.wt.wtOverlays.adjustElementsSize(!0),t.hot.view.wt.wtOverlays.leftOverlay.needFullRender&amp;&amp;t.hot.view.wt.wtOverlays.leftOverlay.clone.draw()))):(C(r),void(t.inProgress=!1))};this.firstCalculation&amp;&amp;this.getSyncCalculationLimit()&amp;&amp;(this.calculateColumnsWidth({from:0,to:this.getSyncCalculationLimit()},e),this.firstCalculation=!1,n=this.getSyncCalculationLimit()+1),n&lt;o?i():this.inProgress=!1},setSamplingOptions:function(){var e=this.hot.getSettings().autoColumnSize,t=e&amp;&amp;e.hasOwnProperty(&quot;samplingRatio&quot;)?this.hot.getSettings().autoColumnSize.samplingRatio:void 0,n=e&amp;&amp;e.hasOwnProperty(&quot;allowSampleDuplicates&quot;)?this.hot.getSettings().autoColumnSize.allowSampleDuplicates:void 0;t&amp;&amp;!isNaN(t)&amp;&amp;this.samplesGenerator.setSampleCount(parseInt(t,10)),n&amp;&amp;this.samplesGenerator.setAllowDuplicates(n)},recalculateAllColumnsWidth:function(){this.hot.view&amp;&amp;R(this.hot.view.wt.wtTable.TABLE)&amp;&amp;(this.clearCache(),this.calculateAllColumnsWidth())},getSyncCalculationLimit:function(){var e=L.SYNC_CALCULATION_LIMIT,t=this.hot.countCols()-1;return E(this.hot.getSettings().autoColumnSize)&amp;&amp;(e=this.hot.getSettings().autoColumnSize.syncLimit,H(e)?e=T(t,e):e&gt;&gt;=0),Math.min(e,t)},getColumnWidth:function(e){var t=arguments[1],n=void 0===arguments[2]||arguments[2],o=t;return void 0===o&amp;&amp;(o=this.widths[e],n&amp;&amp;&quot;number&quot;==typeof o&amp;&amp;(o=Math.max(o,A.DEFAULT_WIDTH))),o},getFirstVisibleColumn:function(){var e=this.hot.view.wt;return e.wtViewport.columnsVisibleCalculator?e.wtTable.getFirstVisibleColumn():e.wtViewport.columnsRenderCalculator?e.wtTable.getFirstRenderedColumn():-1},getLastVisibleColumn:function(){var e=this.hot.view.wt;return e.wtViewport.columnsVisibleCalculator?e.wtTable.getLastVisibleColumn():e.wtViewport.columnsRenderCalculator?e.wtTable.getLastRenderedColumn():-1},findColumnsWhereHeaderWasChanged:function(){var e=this.hot.getColHeader(),t=P.get(this).cachedColumnHeaders,n=v(e,function(e,n,o){var r=t.length;return(r-1&lt;o||t[o]!==n)&amp;&amp;e.push(o),r-1&lt;o?t.push(n):t[o]=n,e},[]);return n},clearCache:function(){var e=void 0!==arguments[0]?arguments[0]:[],t=this;e.length?g(e,function(e){return t.widths[e]=void 0}):this.widths.length=0},isNeedRecalculate:function(){return!!w(this.widths,function(e){return void 0===e}).length},onBeforeRender:function(){var e=this.hot.renderCall,t=this.hot.countRows();t&amp;&amp;(this.calculateColumnsWidth({from:this.getFirstVisibleColumn(),to:this.getLastVisibleColumn()},void 0,e),this.isNeedRecalculate()&amp;&amp;!this.inProgress&amp;&amp;this.calculateAllColumnsWidth())},onAfterLoadData:function(){var e=this;this.hot.view?this.recalculateAllColumnsWidth():setTimeout(function(){e.hot&amp;&amp;e.recalculateAllColumnsWidth()},0)},onBeforeChange:function(e){var t=this,n=y(e,function(e){var n=e,o=(n[0],n[1]);return t.hot.propToCol(o)});this.clearCache(n)},onBeforeColumnResize:function(e,t,n){return n&amp;&amp;(this.calculateColumnsWidth(e,void 0,!0),t=this.getColumnWidth(e,void 0,!1)),t},onAfterInit:function(){P.get(this).cachedColumnHeaders=this.hot.getColHeader()},destroy:function(){this.ghostTable.clean(),$traceurRuntime.superGet(this,L.prototype,&quot;destroy&quot;).call(this)}},{get CALCULATION_STEP(){return 50},get SYNC_CALCULATION_LIMIT(){return 50}},p),x(&quot;autoColumnSize&quot;,N)},{&quot;3rdparty/walkontable/src/calculator/viewportColumns&quot;:4,_base:62,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/feature&quot;:49,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;helpers/string&quot;:55,plugins:61,&quot;utils/ghostTable&quot;:128,&quot;utils/samplesGenerator&quot;:131}],64:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{AutoRowSize:{get:function(){return k}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,p=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),m=(p.arrayEach,p.arrayFilter),g=(i=e(&quot;helpers/feature&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),w=g.cancelAnimationFrame,v=g.requestAnimationFrame,y=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isVisible,b=(a=e(&quot;utils/ghostTable&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).GhostTable,C=(l=e(&quot;helpers/object&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),_=C.isObject,R=(C.objectEach,u=e(&quot;helpers/number&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}),M=R.valueAccordingPercent,S=R.rangeEach,E=(c=e(&quot;plugins&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).registerPlugin,O=(d=e(&quot;utils/samplesGenerator&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).SamplesGenerator,T=(h=e(&quot;helpers/string&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).isPercentValue,k=function(e){var t=this;$traceurRuntime.superConstructor(x).call(this,e),this.heights=[],this.ghostTable=new b(this.hot),this.samplesGenerator=new O(function(e,n){return e&gt;=0?t.hot.getDataAtCell(e,n):e===-1?t.hot.getColHeader(n):null}),this.firstCalculation=!0,this.inProgress=!1,this.addHook(&quot;beforeRowResize&quot;,function(e,n,o){return t.onBeforeRowResize(e,n,o)})},x=k;$traceurRuntime.createClass(k,{isEnabled:function(){return this.hot.getSettings().autoRowSize===!0||_(this.hot.getSettings().autoRowSize)},enablePlugin:function(){var e=this;this.enabled||(this.setSamplingOptions(),this.addHook(&quot;afterLoadData&quot;,function(){return e.onAfterLoadData()}),this.addHook(&quot;beforeChange&quot;,function(t){return e.onBeforeChange(t)}),this.addHook(&quot;beforeColumnMove&quot;,function(){return e.recalculateAllRowsHeight()}),this.addHook(&quot;beforeColumnResize&quot;,function(){return e.recalculateAllRowsHeight()}),this.addHook(&quot;beforeColumnSort&quot;,function(){return e.clearCache()}),this.addHook(&quot;beforeRender&quot;,function(t){return e.onBeforeRender(t)}),this.addHook(&quot;beforeRowMove&quot;,function(t,n){return e.onBeforeRowMove(t,n)}),this.addHook(&quot;modifyRowHeight&quot;,function(t,n){return e.getRowHeight(n,t)}),this.addHook(&quot;modifyColumnHeaderHeight&quot;,function(){return e.getColumnHeaderHeight()}),$traceurRuntime.superGet(this,x.prototype,&quot;enablePlugin&quot;).call(this))},disablePlugin:function(){$traceurRuntime.superGet(this,x.prototype,&quot;disablePlugin&quot;).call(this)},calculateRowsHeight:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countRows()-1},t=void 0!==arguments[1]?arguments[1]:{from:0,to:this.hot.countCols()-1},n=void 0!==arguments[2]&amp;&amp;arguments[2],o=this;if(&quot;number&quot;==typeof e&amp;&amp;(e={from:e,to:e}),&quot;number&quot;==typeof t&amp;&amp;(t={from:t,to:t}),null!==this.hot.getColHeader(0)){var r=this.samplesGenerator.generateRowSamples(-1,t);this.ghostTable.addColumnHeadersRow(r.get(-1))}S(e.from,e.to,function(e){if(n||void 0===o.heights[e]){var r=o.samplesGenerator.generateRowSamples(e,t);r.forEach(function(e,t){return o.ghostTable.addRow(t,e)})}}),this.ghostTable.rows.length&amp;&amp;(this.ghostTable.getHeights(function(e,t){return o.heights[e]=t}),this.ghostTable.clean())},calculateAllRowsHeight:function(){var e=void 0!==arguments[0]?arguments[0]:{from:0,to:this.hot.countCols()-1},t=this,n=0,o=this.hot.countRows()-1,r=null;this.inProgress=!0;var i=function(){return t.hot?(t.calculateRowsHeight({from:n,to:Math.min(n+x.CALCULATION_STEP,o)},e),n=n+x.CALCULATION_STEP+1,void(n&lt;o?r=v(i):(w(r),t.inProgress=!1,t.hot.view.wt.wtOverlays.adjustElementsSize(!0),t.hot.view.wt.wtOverlays.leftOverlay.needFullRender&amp;&amp;t.hot.view.wt.wtOverlays.leftOverlay.clone.draw()))):(w(r),void(t.inProgress=!1))};this.firstCalculation&amp;&amp;this.getSyncCalculationLimit()&amp;&amp;(this.calculateRowsHeight({from:0,to:this.getSyncCalculationLimit()},e),this.firstCalculation=!1,n=this.getSyncCalculationLimit()+1),n&lt;o?i():(this.inProgress=!1,this.hot.view.wt.wtOverlays.adjustElementsSize(!1))},setSamplingOptions:function(){var e=this.hot.getSettings().autoRowSize,t=e&amp;&amp;e.hasOwnProperty(&quot;samplingRatio&quot;)?this.hot.getSettings().autoRowSize.samplingRatio:void 0,n=e&amp;&amp;e.hasOwnProperty(&quot;allowSampleDuplicates&quot;)?this.hot.getSettings().autoRowSize.allowSampleDuplicates:void 0;t&amp;&amp;!isNaN(t)&amp;&amp;this.samplesGenerator.setSampleCount(parseInt(t,10)),n&amp;&amp;this.samplesGenerator.setAllowDuplicates(n)},recalculateAllRowsHeight:function(){y(this.hot.view.wt.wtTable.TABLE)&amp;&amp;(this.clearCache(),this.calculateAllRowsHeight());
},getSyncCalculationLimit:function(){var e=x.SYNC_CALCULATION_LIMIT,t=this.hot.countRows()-1;return _(this.hot.getSettings().autoRowSize)&amp;&amp;(e=this.hot.getSettings().autoRowSize.syncLimit,T(e)?e=M(t,e):e&gt;&gt;=0),Math.min(e,t)},getRowHeight:function(e){var t=arguments[1],n=t;return void 0!==this.heights[e]&amp;&amp;this.heights[e]&gt;(t||0)&amp;&amp;(n=this.heights[e]),n},getColumnHeaderHeight:function(){return this.heights[-1]},getFirstVisibleRow:function(){var e=this.hot.view.wt;return e.wtViewport.rowsVisibleCalculator?e.wtTable.getFirstVisibleRow():e.wtViewport.rowsRenderCalculator?e.wtTable.getFirstRenderedRow():-1},getLastVisibleRow:function(){var e=this.hot.view.wt;return e.wtViewport.rowsVisibleCalculator?e.wtTable.getLastVisibleRow():e.wtViewport.rowsRenderCalculator?e.wtTable.getLastRenderedRow():-1},clearCache:function(){this.heights.length=0,this.heights[-1]=void 0},clearCacheByRange:function(e){var t=this;&quot;number&quot;==typeof e&amp;&amp;(e={from:e,to:e}),S(Math.min(e.from,e.to),Math.max(e.from,e.to),function(e){return t.heights[e]=void 0})},isNeedRecalculate:function(){return!!m(this.heights,function(e){return void 0===e}).length},onBeforeRender:function(){var e=this.hot.renderCall;this.calculateRowsHeight({from:this.getFirstVisibleRow(),to:this.getLastVisibleRow()},void 0,e);var t=this.hot.getSettings().fixedRowsBottom;if(t){var n=this.hot.countRows()-1;this.calculateRowsHeight({from:n-t,to:n})}this.isNeedRecalculate()&amp;&amp;!this.inProgress&amp;&amp;this.calculateAllRowsHeight()},onBeforeRowMove:function(e,t){this.clearCacheByRange({from:e,to:t}),this.calculateAllRowsHeight()},onBeforeRowResize:function(e,t,n){return n&amp;&amp;(this.calculateRowsHeight(e,void 0,!0),t=this.getRowHeight(e)),t},onAfterLoadData:function(){var e=this;this.hot.view?this.recalculateAllRowsHeight():setTimeout(function(){e.hot&amp;&amp;e.recalculateAllRowsHeight()},0)},onBeforeChange:function(e){var t=null;1===e.length?t=e[0][0]:e.length&gt;1&amp;&amp;(t={from:e[0][0],to:e[e.length-1][0]}),null!==t&amp;&amp;this.clearCacheByRange(t)},destroy:function(){this.ghostTable.clean(),$traceurRuntime.superGet(this,x.prototype,&quot;destroy&quot;).call(this)}},{get CALCULATION_STEP(){return 50},get SYNC_CALCULATION_LIMIT(){return 500}},f),E(&quot;autoRowSize&quot;,k)},{_base:62,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/feature&quot;:49,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;helpers/string&quot;:55,plugins:61,&quot;utils/ghostTable&quot;:128,&quot;utils/samplesGenerator&quot;:131}],65:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{Autofill:{get:function(){return T}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,h=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,f=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayIncludes,p=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),m=p.offset,g=p.outerHeight,w=p.outerWidth,v=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).eventManager,y=(l=e(&quot;plugins&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).registerPlugin,b=(u=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).WalkontableCellCoords,C=(c=e(&quot;utils&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),_=C.getDeltas,R=C.getDragDirectionAndRange,M=C.DIRECTIONS,S=C.getMappedFillHandleSetting,E=&quot;insert_row&quot;,O=200,T=function(e){$traceurRuntime.superConstructor(k).call(this,e),this.eventManager=v(this),this.addingStarted=!1,this.mouseDownOnCellCorner=!1,this.mouseDragOutside=!1,this.handleDraggedCells=0,this.directions=[],this.autoInsertRow=!1},k=T;$traceurRuntime.createClass(T,{isEnabled:function(){return this.hot.getSettings().fillHandle},enablePlugin:function(){var e=this;this.enabled||(this.mapSettings(),this.registerEvents(),this.addHook(&quot;afterOnCellCornerMouseDown&quot;,function(t){return e.onAfterCellCornerMouseDown(t)}),this.addHook(&quot;afterOnCellCornerDblClick&quot;,function(t){return e.onCellCornerDblClick(t)}),this.addHook(&quot;beforeOnCellMouseOver&quot;,function(t,n,o){return e.onBeforeCellMouseOver(n)}),$traceurRuntime.superGet(this,k.prototype,&quot;enablePlugin&quot;).call(this))},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,k.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){this.clearMappedSettings(),$traceurRuntime.superGet(this,k.prototype,&quot;disablePlugin&quot;).call(this)},getSelectionData:function(){var e={from:this.hot.getSelectedRange().from,to:this.hot.getSelectedRange().to};return this.hot.getData(e.from.row,e.from.col,e.to.row,e.to.col)},fillIn:function(){if(this.hot.view.wt.selections.fill.isEmpty())return!1;var e=this.hot.view.wt.selections.fill.getCorners();this.resetSelectionOfDraggedArea();var t=this.getCornersOfSelectedCells(),n=R(t,e),o=n.directionOfDrag,r=n.startOfDragCoords,i=n.endOfDragCoords;if(this.hot.runHooks(&quot;modifyAutofillRange&quot;,t,e),r&amp;&amp;r.row&gt;-1&amp;&amp;r.col&gt;-1){var s=this.getSelectionData(),a=_(r,i,s,o);this.hot.runHooks(&quot;beforeAutofill&quot;,r,i,s),this.hot.populateFromArray(r.row,r.col,s,i.row,i.col,this.pluginName+&quot;.fill&quot;,null,o,a),this.setSelection(e)}else this.hot.selection.refreshBorders();return!0},reduceSelectionAreaIfNeeded:function(e){return e.row&lt;0&amp;&amp;(e.row=0),e.col&lt;0&amp;&amp;(e.col=0),e},getCoordsOfDragAndDropBorders:function(e){var t,n=this.hot.getSelectedRange().getTopLeftCorner(),o=this.hot.getSelectedRange().getBottomRightCorner();if(f(this.directions,M.vertical)&amp;&amp;(o.row&lt;e.row||n.row&gt;e.row))t=new b(e.row,o.col);else{if(!f(this.directions,M.horizontal))return;t=new b(o.row,e.col)}return this.reduceSelectionAreaIfNeeded(t)},showBorder:function(e){var t=this.getCoordsOfDragAndDropBorders(e);t&amp;&amp;this.redrawBorders(t)},addRow:function(){var e=this;this.hot._registerTimeout(setTimeout(function(){e.hot.alter(E,void 0,1,e.pluginName+&quot;.fill&quot;),e.addingStarted=!1},O))},addNewRowIfNeeded:function(){if(this.hot.view.wt.selections.fill.cellRange&amp;&amp;this.addingStarted===!1&amp;&amp;this.autoInsertRow){var e=this.hot.getSelected(),t=this.hot.view.wt.selections.fill.getCorners(),n=this.hot.countRows();e[2]&lt;n-1&amp;&amp;t[2]===n-1&amp;&amp;(this.addingStarted=!0,this.addRow())}},getCornersOfSelectedCells:function(){return this.hot.selection.isMultiple()?this.hot.view.wt.selections.area.getCorners():this.hot.view.wt.selections.current.getCorners()},getIndexOfLastAdjacentFilledInRow:function(e){for(var t,n=this.hot.getData(),o=this.hot.countRows(),r=e[2]+1;r&lt;o;r++){for(var i=e[1];i&lt;=e[3];i++){var s=n[r][i];if(s)return-1}var a=n[r][e[1]-1],l=n[r][e[3]+1];(a||l)&amp;&amp;(t=r)}return t},addSelectionFromStartAreaToSpecificRowIndex:function(e,t){this.hot.view.wt.selections.fill.clear(),this.hot.view.wt.selections.fill.add(new b(e[0],e[1])),this.hot.view.wt.selections.fill.add(new b(t,e[3]))},setSelection:function(e){this.hot.selection.setRangeStart(new b(e[0],e[1])),this.hot.selection.setRangeEnd(new b(e[2],e[3]))},selectAdjacent:function(){var e=this.getCornersOfSelectedCells(),t=this.getIndexOfLastAdjacentFilledInRow(e);return t!==-1&amp;&amp;(this.addSelectionFromStartAreaToSpecificRowIndex(e,t),!0)},resetSelectionOfDraggedArea:function(){this.handleDraggedCells=0,this.hot.view.wt.selections.fill.clear()},redrawBorders:function(e){this.hot.view.wt.selections.fill.clear(),this.hot.view.wt.selections.fill.add(this.hot.getSelectedRange().from),this.hot.view.wt.selections.fill.add(this.hot.getSelectedRange().to),this.hot.view.wt.selections.fill.add(e),this.hot.view.render()},getIfMouseWasDraggedOutside:function(e){var t=m(this.hot.table).top-(window.pageYOffset||document.documentElement.scrollTop)+g(this.hot.table),n=m(this.hot.table).left-(window.pageXOffset||document.documentElement.scrollLeft)+w(this.hot.table);return e.clientY&gt;t&amp;&amp;e.clientX&lt;=n},registerEvents:function(){var e=this;this.eventManager.addEventListener(document.documentElement,&quot;mouseup&quot;,function(){return e.onMouseUp()}),this.eventManager.addEventListener(document.documentElement,&quot;mousemove&quot;,function(t){return e.onMouseMove(t)})},onCellCornerDblClick:function(){var e=this.selectAdjacent();e&amp;&amp;this.fillIn()},onAfterCellCornerMouseDown:function(){this.handleDraggedCells=1,this.mouseDownOnCellCorner=!0},onBeforeCellMouseOver:function(e){this.mouseDownOnCellCorner&amp;&amp;!this.hot.view.isMouseDown()&amp;&amp;this.handleDraggedCells&amp;&amp;(this.handleDraggedCells++,this.showBorder(e),this.addNewRowIfNeeded())},onMouseUp:function(){this.handleDraggedCells&amp;&amp;(this.handleDraggedCells&gt;1&amp;&amp;this.fillIn(),this.handleDraggedCells=0,this.mouseDownOnCellCorner=!1)},onMouseMove:function(e){var t=this.getIfMouseWasDraggedOutside(e);this.addingStarted===!1&amp;&amp;this.handleDraggedCells&gt;0&amp;&amp;t?(this.mouseDragOutside=!0,this.addingStarted=!0):this.mouseDragOutside=!1,this.mouseDragOutside&amp;&amp;this.autoInsertRow&amp;&amp;this.addRow()},clearMappedSettings:function(){this.directions.length=0,this.autoInsertRow=!1},mapSettings:function(){var e=S(this.hot.getSettings().fillHandle);this.directions=e.directions,this.autoInsertRow=e.autoInsertRow},destroy:function(){$traceurRuntime.superGet(this,k.prototype,&quot;destroy&quot;).call(this)}},{},d),y(&quot;autofill&quot;,T),h.hooks.register(&quot;modifyAutofillRange&quot;),h.hooks.register(&quot;beforeAutofill&quot;)},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,_base:62,browser:24,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,plugins:61,utils:66}],66:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o){var r=n.length,i=n?n[0].length:0,s=[],a=t.row-e.row,l=t.col-e.col;if([&quot;down&quot;,&quot;up&quot;].indexOf(o)!==-1){for(var u=[],c=0;c&lt;=l;c++){var d=parseInt(n[0][c],10),h=parseInt(n[r-1][c],10),f=(&quot;down&quot;===o?h-d:d-h)/(r-1)||0;u.push(f)}s.push(u)}if([&quot;right&quot;,&quot;left&quot;].indexOf(o)!==-1)for(var p=0;p&lt;=a;p++){var m=parseInt(n[p][0],10),g=parseInt(n[p][i-1],10),w=(&quot;right&quot;===o?g-m:m-g)/(i-1)||0;s.push([w])}return s}function r(e,t){var n,o,r;return t[0]===e[0]&amp;&amp;t[1]&lt;e[1]?(r=&quot;left&quot;,n=new WalkontableCellCoords(t[0],t[1]),o=new WalkontableCellCoords(t[2],e[1]-1)):t[0]===e[0]&amp;&amp;t[3]&gt;e[3]?(r=&quot;right&quot;,n=new WalkontableCellCoords(t[0],e[3]+1),o=new WalkontableCellCoords(t[2],t[3])):t[0]&lt;e[0]&amp;&amp;t[1]===e[1]?(r=&quot;up&quot;,n=new WalkontableCellCoords(t[0],t[1]),o=new WalkontableCellCoords(e[0]-1,t[3])):t[2]&gt;e[2]&amp;&amp;t[1]===e[1]&amp;&amp;(r=&quot;down&quot;,n=new WalkontableCellCoords(e[2]+1,t[1]),o=new WalkontableCellCoords(t[2],t[3])),{directionOfDrag:r,startOfDragCoords:n,endOfDragCoords:o}}function i(e){var t={};return e===!0?(t.directions=Object.keys(c),t.autoInsertRow=!0):l(e)?(u(e.autoInsertRow)?e.direction===c.horizontal?t.autoInsertRow=!1:t.autoInsertRow=e.autoInsertRow:t.autoInsertRow=!1,u(e.direction)?t.directions=[e.direction]:t.directions=Object.keys(c)):&quot;string&quot;==typeof e?(t.directions=[e],t.autoInsertRow=!0):(t.directions=[],t.autoInsertRow=!1),t}Object.defineProperties(n,{DIRECTIONS:{get:function(){return c}},getDeltas:{get:function(){return o}},getDragDirectionAndRange:{get:function(){return r}},getMappedFillHandleSetting:{get:function(){return i}},__esModule:{value:!0}});var s,a,l=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isObject,u=(a=e(&quot;helpers/mixed&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).isDefined,c={horizontal:&quot;horizontal&quot;,vertical:&quot;vertical&quot;}},{&quot;helpers/mixed&quot;:51,&quot;helpers/object&quot;:53}],67:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ColumnSorting:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,h=(r=e(&quot;moment&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,f=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=(s=e(&quot;helpers/array&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),v=w.arrayMap,y=w.arrayReduce,b=(a=e(&quot;helpers/mixed&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).isEmpty,C=(l=e(&quot;_base&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).default,_=(u=e(&quot;plugins&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).registerPlugin,R=(c=e(&quot;utils/sortingAlgorithms/mergeSort&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).mergeSort;d.hooks.register(&quot;beforeColumnSort&quot;),d.hooks.register(&quot;afterColumnSort&quot;);var M=function(e){$traceurRuntime.superConstructor(S).call(this,e),this.sortIndicators=[],this.lastSortedColumn=null,this.sortEmptyCells=!1},S=M;$traceurRuntime.createClass(M,{isEnabled:function(){return!!this.hot.getSettings().columnSorting},enablePlugin:function(){var e=this;if(!this.enabled){this.setPluginOptions();var t=this;this.hot.sortIndex=[],this.hot.sort=function(){var e=Array.prototype.slice.call(arguments);return t.sortByColumn.apply(t,e)},&quot;undefined&quot;==typeof this.hot.getSettings().observeChanges&amp;&amp;this.enableObserveChangesPlugin(),this.addHook(&quot;afterTrimRow&quot;,function(t){return e.sort()}),this.addHook(&quot;afterUntrimRow&quot;,function(t){return e.sort()}),this.addHook(&quot;modifyRow&quot;,function(t){return e.translateRow(t)}),this.addHook(&quot;unmodifyRow&quot;,function(t){return e.untranslateRow(t)}),this.addHook(&quot;afterUpdateSettings&quot;,function(){return e.onAfterUpdateSettings()}),this.addHook(&quot;afterGetColHeader&quot;,function(t,n){return e.getColHeader(t,n)}),this.addHook(&quot;afterOnCellMouseDown&quot;,function(t,n){return e.onAfterOnCellMouseDown(t,n)}),this.addHook(&quot;afterCreateRow&quot;,function(){t.afterCreateRow.apply(t,arguments)}),this.addHook(&quot;afterRemoveRow&quot;,function(){t.afterRemoveRow.apply(t,arguments)}),this.addHook(&quot;afterInit&quot;,function(){return e.sortBySettings()}),this.addHook(&quot;afterLoadData&quot;,function(){e.hot.sortIndex=[],e.hot.view&amp;&amp;e.sortBySettings()}),this.hot.view&amp;&amp;this.sortBySettings(),$traceurRuntime.superGet(this,S.prototype,&quot;enablePlugin&quot;).call(this)}},disablePlugin:function(){this.hot.sort=void 0,$traceurRuntime.superGet(this,S.prototype,&quot;disablePlugin&quot;).call(this)},onAfterUpdateSettings:function(){this.sortBySettings()},sortBySettings:function(){var e,t,n=this.hot.getSettings().columnSorting,o=this.loadSortingState();&quot;undefined&quot;==typeof o?(e=n.column,t=n.sortOrder):(e=o.sortColumn,t=o.sortOrder),&quot;number&quot;==typeof e&amp;&amp;(this.lastSortedColumn=e,this.sortByColumn(e,t))},setSortingColumn:function(e,t){return&quot;undefined&quot;==typeof e?(this.hot.sortColumn=void 0,void(this.hot.sortOrder=void 0)):(this.hot.sortColumn===e&amp;&amp;&quot;undefined&quot;==typeof t?this.hot.sortOrder===!1?this.hot.sortOrder=void 0:this.hot.sortOrder=!this.hot.sortOrder:this.hot.sortOrder=&quot;undefined&quot;==typeof t||t,void(this.hot.sortColumn=e))},sortByColumn:function(e,t){if(this.setSortingColumn(e,t),&quot;undefined&quot;!=typeof this.hot.sortColumn){var n=d.hooks.run(this.hot,&quot;beforeColumnSort&quot;,this.hot.sortColumn,this.hot.sortOrder);n!==!1&amp;&amp;this.sort(),this.updateOrderClass(),this.updateSortIndicator(),d.hooks.run(this.hot,&quot;afterColumnSort&quot;,this.hot.sortColumn,this.hot.sortOrder),this.hot.render(),this.saveSortingState()}},saveSortingState:function(){var e={};&quot;undefined&quot;!=typeof this.hot.sortColumn&amp;&amp;(e.sortColumn=this.hot.sortColumn),&quot;undefined&quot;!=typeof this.hot.sortOrder&amp;&amp;(e.sortOrder=this.hot.sortOrder),(e.hasOwnProperty(&quot;sortColumn&quot;)||e.hasOwnProperty(&quot;sortOrder&quot;))&amp;&amp;d.hooks.run(this.hot,&quot;persistentStateSave&quot;,&quot;columnSorting&quot;,e)},loadSortingState:function(){var e={};return d.hooks.run(this.hot,&quot;persistentStateLoad&quot;,&quot;columnSorting&quot;,e),e.value},updateOrderClass:function(){var e;this.hot.sortOrder===!0?e=&quot;ascending&quot;:this.hot.sortOrder===!1&amp;&amp;(e=&quot;descending&quot;),this.sortOrderClass=e},enableObserveChangesPlugin:function(){var e=this;this.hot._registerTimeout(setTimeout(function(){e.hot.updateSettings({observeChanges:!0})},0))},defaultSort:function(e,t){return function(n,o){return&quot;string&quot;==typeof n[1]&amp;&amp;(n[1]=n[1].toLowerCase()),&quot;string&quot;==typeof o[1]&amp;&amp;(o[1]=o[1].toLowerCase()),n[1]===o[1]?0:b(n[1])?b(o[1])?0:t.columnSorting.sortEmptyCells&amp;&amp;e?-1:1:b(o[1])?b(n[1])?0:t.columnSorting.sortEmptyCells&amp;&amp;e?1:-1:isNaN(n[1])&amp;&amp;!isNaN(o[1])?e?1:-1:!isNaN(n[1])&amp;&amp;isNaN(o[1])?e?-1:1:(isNaN(n[1])||isNaN(o[1])||(n[1]=parseFloat(n[1]),o[1]=parseFloat(o[1])),n[1]&lt;o[1]?e?-1:1:n[1]&gt;o[1]?e?1:-1:0)}},dateSort:function(e,t){return function(n,o){if(n[1]===o[1])return 0;if(b(n[1]))return b(o[1])?0:t.columnSorting.sortEmptyCells&amp;&amp;e?-1:1;if(b(o[1]))return b(n[1])?0:t.columnSorting.sortEmptyCells&amp;&amp;e?1:-1;var r=h(n[1],t.dateFormat),i=h(o[1],t.dateFormat);return r.isValid()?i.isValid()?i.isAfter(r)?e?-1:1:i.isBefore(r)?e?1:-1:0:-1:1}},numericSort:function(e,t){return function(n,o){var r=parseFloat(n[1]),i=parseFloat(o[1]);if(r===i||isNaN(r)&amp;&amp;isNaN(i))return 0;if(t.columnSorting.sortEmptyCells){if(b(n[1]))return e?-1:1;if(b(o[1]))return e?1:-1}return isNaN(r)?1:isNaN(i)?-1:r&lt;i?e?-1:1:r&gt;i?e?1:-1:0}},sort:function(){if(&quot;undefined&quot;==typeof this.hot.sortOrder)return void(this.hot.sortIndex.length=0);var e,t,n=this.hot.getCellMeta(0,this.hot.sortColumn),o=this.hot.countEmptyRows();this.hot.sortingEnabled=!1,this.hot.sortIndex.length=0,&quot;undefined&quot;==typeof n.columnSorting.sortEmptyCells&amp;&amp;(n.columnSorting={sortEmptyCells:this.sortEmptyCells}),t=this.hot.getSettings().maxRows===Number.POSITIVE_INFINITY?this.hot.countRows()-this.hot.getSettings().minSpareRows:this.hot.countRows()-o;for(var r=0,i=t;r&lt;i;r++)this.hot.sortIndex.push([r,this.hot.getDataAtCell(r,this.hot.sortColumn)]);if(n.sortFunction)e=n.sortFunction;else switch(n.type){case&quot;date&quot;:e=this.dateSort;break;case&quot;numeric&quot;:e=this.numericSort;break;default:e=this.defaultSort}R(this.hot.sortIndex,e(this.hot.sortOrder,n));for(var s=this.hot.sortIndex.length;s&lt;this.hot.countRows();s++)this.hot.sortIndex.push([s,this.hot.getDataAtCell(s,this.hot.sortColumn)]);this.hot.sortingEnabled=!0},updateSortIndicator:function(){if(&quot;undefined&quot;!=typeof this.hot.sortOrder){var e=this.hot.getCellMeta(0,this.hot.sortColumn);this.sortIndicators[this.hot.sortColumn]=e.sortIndicator}},translateRow:function(e){return this.hot.sortingEnabled&amp;&amp;&quot;undefined&quot;!=typeof this.hot.sortOrder&amp;&amp;this.hot.sortIndex&amp;&amp;this.hot.sortIndex.length&amp;&amp;this.hot.sortIndex[e]?this.hot.sortIndex[e][0]:e},untranslateRow:function(e){if(this.hot.sortingEnabled&amp;&amp;this.hot.sortIndex&amp;&amp;this.hot.sortIndex.length)for(var t=0;t&lt;this.hot.sortIndex.length;t++)if(this.hot.sortIndex[t][0]==e)return t},getColHeader:function(e,t){if(e&lt;0||!t.parentNode)return!1;var n=t.querySelector(&quot;.colHeader&quot;),o=(t.getAttribute(&quot;colspan&quot;),t.parentNode.parentNode.childNodes),r=Array.prototype.indexOf.call(o,t.parentNode);r-=o.length,n&amp;&amp;(this.hot.getSettings().columnSorting&amp;&amp;e&gt;=0&amp;&amp;r===-1&amp;&amp;p(n,&quot;columnSorting&quot;),g(n,&quot;descending&quot;),g(n,&quot;ascending&quot;),this.sortIndicators[e]&amp;&amp;e===this.hot.sortColumn&amp;&amp;(&quot;ascending&quot;===this.sortOrderClass?p(n,&quot;ascending&quot;):&quot;descending&quot;===this.sortOrderClass&amp;&amp;p(n,&quot;descending&quot;)))},isSorted:function(){return&quot;undefined&quot;!=typeof this.hot.sortColumn},afterCreateRow:function(e,t){if(this.isSorted()){for(var n=0;n&lt;this.hot.sortIndex.length;n++)this.hot.sortIndex[n][0]&gt;=e&amp;&amp;(this.hot.sortIndex[n][0]+=t);for(var n=0;n&lt;t;n++)this.hot.sortIndex.splice(e+n,0,[e+n,this.hot.getSourceData()[e+n][this.hot.sortColumn+this.hot.colOffset()]]);this.saveSortingState()}},afterRemoveRow:function(e,t){function n(e){return y(o,function(t,n){return e&gt;n&amp;&amp;t++,t},0)}if(this.isSorted()){var o=this.hot.sortIndex.splice(e,t);o=v(o,function(e){return e[0]}),this.hot.sortIndex=v(this.hot.sortIndex,function(e,t){var o=n(e[0]);return o&amp;&amp;(e[0]-=o),e}),this.saveSortingState()}},setPluginOptions:function(){var e=this.hot.getSettings().columnSorting;&quot;object&quot;==typeof e?this.sortEmptyCells=e.sortEmptyCells||!1:this.sortEmptyCells=!1},onAfterOnCellMouseDown:function(e,t){t.row&gt;-1||m(e.realTarget,&quot;columnSorting&quot;)&amp;&amp;(t.col!==this.lastSortedColumn&amp;&amp;(this.hot.sortOrder=!0),this.lastSortedColumn=t.col,this.sortByColumn(t.col))}},{},C),_(&quot;columnSorting&quot;,M)},{_base:62,browser:24,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/mixed&quot;:51,moment:&quot;moment&quot;,plugins:61,&quot;utils/sortingAlgorithms/mergeSort&quot;:132}],68:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{CommentEditor:{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=e(&quot;helpers/dom/element&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).addClass,i=function(){this.editor=this.createEditor(),this.editorStyle=this.editor.style,this.hidden=!0,this.hide()},s=i;$traceurRuntime.createClass(i,{setPosition:function(e,t){this.editorStyle.left=e+&quot;px&quot;,this.editorStyle.top=t+&quot;px&quot;},setSize:function(e,t){if(e&amp;&amp;t){var n=this.getInputElement();n.style.width=e+&quot;px&quot;,n.style.height=t+&quot;px&quot;}},resetSize:function(){var e=this.getInputElement();e.style.width=&quot;&quot;,e.style.height=&quot;&quot;},setReadOnlyState:function(e){var t=this.getInputElement();t.readOnly=e},show:function(){this.editorStyle.display=&quot;block&quot;,this.hidden=!1},hide:function(){this.editorStyle.display=&quot;none&quot;,this.hidden=!0},isVisible:function(){return&quot;block&quot;===this.editorStyle.display},setValue:function(){var e=void 0!==arguments[0]?arguments[0]:&quot;&quot;;e=e||&quot;&quot;,this.getInputElement().value=e},getValue:function(){return this.getInputElement().value},isFocused:function(){return document.activeElement===this.getInputElement()},focus:function(){this.getInputElement().focus()},createEditor:function(){var e,t,n=document.querySelector(&quot;.&quot;+s.CLASS_EDITOR_CONTAINER);return n||(n=document.createElement(&quot;div&quot;),r(n,s.CLASS_EDITOR_CONTAINER),document.body.appendChild(n)),e=document.createElement(&quot;div&quot;),r(e,s.CLASS_EDITOR),t=document.createElement(&quot;textarea&quot;),r(t,s.CLASS_INPUT),e.appendChild(t),n.appendChild(e),e},getInputElement:function(){return this.editor.querySelector(&quot;.&quot;+s.CLASS_INPUT)},destroy:function(){this.editor.parentNode.removeChild(this.editor),this.editor=null,this.editorStyle=null}},{get CLASS_EDITOR_CONTAINER(){return&quot;htCommentsContainer&quot;},get CLASS_EDITOR(){return&quot;htComments&quot;},get CLASS_INPUT(){return&quot;htCommentTextArea&quot;},get CLASS_CELL(){return&quot;htCommentCell&quot;}})},{&quot;helpers/dom/element&quot;:47}],69:[function(e,t,n){&quot;use strict&quot;;var o;Object.defineProperties(n,{Comments:{get:function(){return B}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d,h,f,p=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,m=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),g=m.addClass,w=m.closest,v=m.isChildOf,y=m.hasClass,b=m.offset,C=m.outerWidth,_=m.outerHeight,R=m.getScrollableElement,M=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),S=M.deepClone,E=M.deepExtend,O=(a=e(&quot;helpers/function&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).debounce,T=(l=e(&quot;eventManager&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).EventManager,k=(u=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).WalkontableCellCoords,x=(c=e(&quot;plugins&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).registerPlugin,D=(d=e(&quot;_base&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).default,H=(h=e(&quot;commentEditor&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).CommentEditor,A=(f=e(&quot;contextMenu/utils&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),P=A.checkSelectionConsistency,N=A.markLabelAsSelected,L=new WeakMap,I=&quot;comment&quot;,W=&quot;value&quot;,j=&quot;style&quot;,V=&quot;readOnly&quot;,B=function(e){$traceurRuntime.superConstructor(F).call(this,e),this.editor=null,this.eventManager=null,this.range={},this.mouseDown=!1,this.contextMenuEvent=!1,this.timer=null,this.displayDelay=250,L.set(this,{tempEditorDimensions:{},cellBelowCursor:null})},F=B;$traceurRuntime.createClass(B,(o={},Object.defineProperty(o,&quot;isEnabled&quot;,{value:function(){return!!this.hot.getSettings().comments},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;enablePlugin&quot;,{value:function(){var e=this;this.enabled||(this.editor||(this.editor=new H),this.eventManager||(this.eventManager=new T(this)),this.addHook(&quot;afterContextMenuDefaultOptions&quot;,function(t){return e.addToContextMenu(t)}),this.addHook(&quot;afterRenderer&quot;,function(t,n,o,r,i,s){return e.onAfterRenderer(t,s)}),this.addHook(&quot;afterScrollHorizontally&quot;,function(){return e.hide()}),this.addHook(&quot;afterScrollVertically&quot;,function(){return e.hide()}),this.addHook(&quot;afterBeginEditing&quot;,function(t){return e.onAfterBeginEditing(t)}),this.registerListeners(),$traceurRuntime.superGet(this,F.prototype,&quot;enablePlugin&quot;).call(this))},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;disablePlugin&quot;,{value:function(){$traceurRuntime.superGet(this,F.prototype,&quot;disablePlugin&quot;).call(this)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;registerListeners&quot;,{value:function(){var e=this;this.eventManager.addEventListener(document,&quot;mouseover&quot;,function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(document,&quot;mousedown&quot;,function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(document,&quot;mouseup&quot;,function(t){return e.onMouseUp(t)}),this.eventManager.addEventListener(this.editor.getInputElement(),&quot;blur&quot;,function(t){return e.onEditorBlur(t)}),this.eventManager.addEventListener(this.editor.getInputElement(),&quot;mousedown&quot;,function(t){return e.onEditorMouseDown(t)}),this.eventManager.addEventListener(this.editor.getInputElement(),&quot;mouseup&quot;,function(t){return e.onEditorMouseUp(t)})},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;setRange&quot;,{value:function(e){this.range=e},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;clearRange&quot;,{value:function(){this.range={}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;targetIsCellWithComment&quot;,{value:function(e){var t=w(e.target,&quot;TD&quot;,&quot;TBODY&quot;);return!!(t&amp;&amp;y(t,&quot;htCommentCell&quot;)&amp;&amp;w(t,[this.hot.rootElement]))},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;targetIsCommentTextArea&quot;,{value:function(e){return this.editor.getInputElement()===e.target},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;setComment&quot;,{value:function(e){var t;if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin(&quot;comment&quot;).setRange())');var n=this.editor.getValue(),o=&quot;&quot;;null!=e?o=e:null!=n&amp;&amp;(o=n);var r=this.range.from.row,i=this.range.from.col;this.updateCommentMeta(r,i,(t={},Object.defineProperty(t,W,{value:o,configurable:!0,enumerable:!0,writable:!0}),t)),this.hot.render()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;setCommentAtCell&quot;,{value:function(e,t,n){this.setRange({from:new k(e,t)}),this.setComment(n)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;removeComment&quot;,{value:function(){var e=void 0===arguments[0]||arguments[0];if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin(&quot;comment&quot;).setRange())');this.hot.setCellMeta(this.range.from.row,this.range.from.col,I,void 0),e&amp;&amp;this.hot.render(),this.hide()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;removeCommentAtCell&quot;,{value:function(e,t){var n=void 0===arguments[2]||arguments[2];this.setRange({from:new k(e,t)}),this.removeComment(n)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;getComment&quot;,{value:function(){var e=this.range.from.row,t=this.range.from.col;return this.getCommentMeta(e,t,W)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;getCommentAtCell&quot;,{value:function(e,t){return this.getCommentMeta(e,t,W)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;show&quot;,{value:function(){if(!this.range.from)throw new Error('Before using this method, first set cell range (hot.getPlugin(&quot;comment&quot;).setRange())');var e=this.hot.getCellMeta(this.range.from.row,this.range.from.col);return this.refreshEditor(!0),this.editor.setValue(e[I]?e[I][W]:&quot;&quot;),this.editor.hidden&amp;&amp;this.editor.show(),!0},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;showAtCell&quot;,{value:function(e,t){return this.setRange({from:new k(e,t)}),this.show()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;hide&quot;,{value:function(){this.editor.hidden||this.editor.hide()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;refreshEditor&quot;,{value:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];if(e||this.range.from&amp;&amp;this.editor.isVisible()){var t=R(this.hot.view.wt.wtTable.TABLE),n=this.hot.view.wt.wtTable.getCell(this.range.from),o=this.range.from.row,r=this.range.from.col,i=b(n),s=this.hot.view.wt.wtTable.getStretchedColumnWidth(r),a=i.top&lt;0?0:i.top,l=i.left;this.hot.view.wt.wtViewport.hasVerticalScroll()&amp;&amp;t!==window&amp;&amp;(a-=this.hot.view.wt.wtOverlays.topOverlay.getScrollPosition()),this.hot.view.wt.wtViewport.hasHorizontalScroll()&amp;&amp;t!==window&amp;&amp;(l-=this.hot.view.wt.wtOverlays.leftOverlay.getScrollPosition());var u=l+s,c=a,d=this.getCommentMeta(o,r,j),h=this.getCommentMeta(o,r,V);d?this.editor.setSize(d.width,d.height):this.editor.resetSize(),this.editor.setReadOnlyState(h),this.editor.setPosition(u,c)}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;checkSelectionCommentsConsistency&quot;,{value:function(){var e=this.hot.getSelectedRange();if(!e)return!1;var t=!1,n=e.from;return this.getCommentMeta(n.row,n.col,W)&amp;&amp;(t=!0),t},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;updateCommentMeta&quot;,{value:function(e,t,n){var o,r=this.hot.getCellMeta(e,t)[I];r?(o=S(r),E(o,n)):o=n,this.hot.setCellMeta(e,t,I,o)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;getCommentMeta&quot;,{value:function(e,t,n){var o=this.hot.getCellMeta(e,t);if(o[I])return o[I][n]},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onMouseDown&quot;,{value:function(e){if(this.mouseDown=!0,this.hot.view&amp;&amp;this.hot.view.wt){if(!this.contextMenuEvent&amp;&amp;!this.targetIsCommentTextArea(e)){var t=w(e.target,&quot;TD&quot;,&quot;TBODY&quot;),n=null;t&amp;&amp;(n=this.hot.view.wt.wtTable.getCoords(t)),(!t||this.range.from&amp;&amp;n&amp;&amp;(this.range.from.row!==n.row||this.range.from.col!==n.col))&amp;&amp;this.hide()}this.contextMenuEvent=!1}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onMouseOver&quot;,{value:function(e){var t=this;if(!this.mouseDown&amp;&amp;!this.editor.isFocused()){var n=L.get(this);n.cellBelowCursor=document.elementFromPoint(e.clientX,e.clientY),O(function(){if(!y(e.target,&quot;wtBorder&quot;)&amp;&amp;n.cellBelowCursor===e.target&amp;&amp;t.editor)if(t.targetIsCellWithComment(e)){var o=t.hot.view.wt.wtTable.getCoords(e.target),r={from:new k(o.row,o.col)};t.setRange(r),t.show()}else!v(e.target,document)||t.targetIsCommentTextArea(e)||t.editor.isFocused()||t.hide()},this.displayDelay)()}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onMouseUp&quot;,{value:function(e){this.mouseDown=!1},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onAfterRenderer&quot;,{value:function(e,t){t[I]&amp;&amp;t[I][W]&amp;&amp;g(e,t.commentedCellClassName)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onEditorBlur&quot;,{value:function(e){this.setComment()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onEditorMouseDown&quot;,{value:function(e){var t=L.get(this);t.tempEditorDimensions={width:C(e.target),height:_(e.target)}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onEditorMouseUp&quot;,{value:function(e){var t,n=L.get(this),o=C(e.target),r=_(e.target);o===n.tempEditorDimensions.width+1&amp;&amp;r===n.tempEditorDimensions.height+2||this.updateCommentMeta(this.range.from.row,this.range.from.col,(t={},Object.defineProperty(t,j,{value:{width:o,height:r},configurable:!0,enumerable:!0,writable:!0}),t))},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onContextMenuAddComment&quot;,{value:function(){var e=this,t=this.hot.getSelectedRange();this.contextMenuEvent=!0,this.setRange({from:t.from}),this.show(),setTimeout(function(){e.hot&amp;&amp;(e.hot.deselectCell(),e.editor.focus())},10)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onContextMenuRemoveComment&quot;,{value:function(e){this.contextMenuEvent=!0;for(var t=e.start.row;t&lt;=e.end.row;t++)for(var n=e.start.col;n&lt;=e.end.col;n++)this.removeCommentAtCell(t,n,!1);this.hot.render()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onContextMenuMakeReadOnly&quot;,{value:function(e){var t;this.contextMenuEvent=!0;for(var n=e.start.row;n&lt;=e.end.row;n++)for(var o=e.start.col;o&lt;=e.end.col;o++){var r=!!this.getCommentMeta(n,o,V);this.updateCommentMeta(n,o,(t={},Object.defineProperty(t,V,{value:!r,configurable:!0,enumerable:!0,writable:!0}),t))}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;addToContextMenu&quot;,{value:function(e){var t=this;e.items.push(p.plugins.ContextMenu.SEPARATOR,{key:&quot;commentsAddEdit&quot;,name:function(){return t.checkSelectionCommentsConsistency()?&quot;Edit comment&quot;:&quot;Add comment&quot;},callback:function(){return t.onContextMenuAddComment()},disabled:function(){return!(this.getSelected()&amp;&amp;!this.selection.selectedHeader.corner)}},{key:&quot;commentsRemove&quot;,name:function(){return&quot;Delete comment&quot;},callback:function(e,n){return t.onContextMenuRemoveComment(n);
},disabled:function(){return t.hot.selection.selectedHeader.corner}},{key:&quot;commentsReadOnly&quot;,name:function(){var e=this,t=&quot;Read only comment&quot;,n=P(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n)[I];if(o&amp;&amp;(o=o[V]),o)return!0});return n&amp;&amp;(t=N(t)),t},callback:function(e,n){return t.onContextMenuMakeReadOnly(n)},disabled:function(){return t.hot.selection.selectedHeader.corner||!t.checkSelectionCommentsConsistency()}})},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;onAfterBeginEditing&quot;,{value:function(e,t){this.hide()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;destroy&quot;,{value:function(){this.editor&amp;&amp;this.editor.destroy(),$traceurRuntime.superGet(this,F.prototype,&quot;destroy&quot;).call(this)},configurable:!0,enumerable:!0,writable:!0}),o),{},D),x(&quot;comments&quot;,B)},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,_base:62,browser:24,commentEditor:68,&quot;contextMenu/utils&quot;:88,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/function&quot;:50,&quot;helpers/object&quot;:53,plugins:61}],70:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n;return i(t,function(t){var o=t.key?t.key.split(&quot;:&quot;):null;if(Array.isArray(o)&amp;&amp;o[1]===e)return n=t,!1}),n}Object.defineProperties(n,{CommandExecutor:{get:function(){return s}},__esModule:{value:!0}});var r,i=(r=e(&quot;helpers/array&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayEach,s=function(e){this.hot=e,this.commands={},this.commonCallback=null};$traceurRuntime.createClass(s,{registerCommand:function(e,t){this.commands[e]=t},setCommonCallback:function(e){this.commonCallback=e},execute:function(e){for(var t=[],n=1;n&lt;arguments.length;n++)t[n-1]=arguments[n];var r=this,s=e.split(&quot;:&quot;);e=s[0];var a=2===s.length?s[1]:null,l=this.commands[e];if(!l)throw new Error(&quot;Menu command '&quot;+e+&quot;' not exists.&quot;);if(a&amp;&amp;l.submenu&amp;&amp;(l=o(a,l.submenu.items)),l.disabled!==!0&amp;&amp;(&quot;function&quot;!=typeof l.disabled||l.disabled.call(this.hot)!==!0)&amp;&amp;!l.hasOwnProperty(&quot;submenu&quot;)){var u=[];&quot;function&quot;==typeof l.callback&amp;&amp;u.push(l.callback),&quot;function&quot;==typeof this.commonCallback&amp;&amp;u.push(this.commonCallback),t.unshift(s.join(&quot;:&quot;)),i(u,function(e){return e.apply(r.hot,t)})}}},{})},{&quot;helpers/array&quot;:43}],71:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ContextMenu:{get:function(){return F}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,l,f,p=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,m=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,g=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,w=(s=e(&quot;commandExecutor&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).CommandExecutor,v=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).EventManager,y=(l=e(&quot;helpers/dom/element&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).hasClass,b=(u=e(&quot;itemsFactory&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).ItemsFactory,C=(c=e(&quot;menu&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).Menu,_=(d=e(&quot;plugins&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).registerPlugin,R=(h=e(&quot;helpers/dom/event&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}),M=R.stopPropagation,S=R.pageX,E=R.pageY,O=(l=e(&quot;helpers/dom/element&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),T=O.getWindowScrollLeft,k=O.getWindowScrollTop,x=(f=e(&quot;predefinedItems&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),D=x.ROW_ABOVE,H=x.ROW_BELOW,A=x.COLUMN_LEFT,P=x.COLUMN_RIGHT,N=x.REMOVE_ROW,L=x.REMOVE_COLUMN,I=x.UNDO,W=x.REDO,j=x.READ_ONLY,V=x.ALIGNMENT,B=x.SEPARATOR,F=function(e){$traceurRuntime.superConstructor(z).call(this,e),this.eventManager=new v(this),this.commandExecutor=new w(this.hot),this.itemsFactory=null,this.menu=null},z=F;$traceurRuntime.createClass(F,{isEnabled:function(){return this.hot.getSettings().contextMenu},enablePlugin:function(){var e=this;if(!this.enabled){this.itemsFactory=new b(this.hot,z.DEFAULT_ITEMS);var t=this.hot.getSettings().contextMenu,n={items:this.itemsFactory.getItems(t)};this.registerEvents(),&quot;function&quot;==typeof t.callback&amp;&amp;this.commandExecutor.setCommonCallback(t.callback),$traceurRuntime.superGet(this,z.prototype,&quot;enablePlugin&quot;).call(this),this.callOnPluginsReady(function(){e.hot.runHooks(&quot;afterContextMenuDefaultOptions&quot;,n),e.itemsFactory.setPredefinedItems(n.items);var o=e.itemsFactory.getItems(t);e.menu=new C(e.hot,{className:&quot;htContextMenu&quot;,keepInViewport:!0}),e.hot.runHooks(&quot;beforeContextMenuSetItems&quot;,o),e.menu.setMenuItems(o),e.menu.addLocalHook(&quot;afterOpen&quot;,function(){return e.onMenuAfterOpen()}),e.menu.addLocalHook(&quot;afterClose&quot;,function(){return e.onMenuAfterClose()}),e.menu.addLocalHook(&quot;executeCommand&quot;,function(){for(var t=[],n=0;n&lt;arguments.length;n++)t[n]=arguments[n];return e.executeCommand.apply(e,t)}),g(o,function(t){return e.commandExecutor.registerCommand(t.key,t)})})}},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,z.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){this.close(),this.menu&amp;&amp;(this.menu.destroy(),this.menu=null),$traceurRuntime.superGet(this,z.prototype,&quot;disablePlugin&quot;).call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,&quot;contextmenu&quot;,function(t){return e.onContextMenu(t)})},open:function(e){this.menu&amp;&amp;(this.menu.open(),this.menu.setPosition({top:parseInt(E(e),10)-k(),left:parseInt(S(e),10)-T()}),this.menu.hotMenu.isHotTableEnv=this.hot.isHotTableEnv,p.eventManager.isHotTableEnv=this.hot.isHotTableEnv)},close:function(){this.menu&amp;&amp;this.menu.close()},executeCommand:function(){for(var e=[],t=0;t&lt;arguments.length;t++)e[t]=arguments[t];this.commandExecutor.execute.apply(this.commandExecutor,e)},onContextMenu:function(e){function t(e){return&quot;TD&quot;===e.nodeName||&quot;TD&quot;===e.parentNode.nodeName}var n=this.hot.getSettings(),o=n.rowHeaders,r=n.colHeaders,i=e.realTarget;this.close(),y(i,&quot;handsontableInput&quot;)||(e.preventDefault(),M(e),(o||r||t(i)||y(i,&quot;current&quot;)&amp;&amp;y(i,&quot;wtBorder&quot;))&amp;&amp;this.open(e))},onMenuAfterOpen:function(){this.hot.runHooks(&quot;afterContextMenuShow&quot;,this)},onMenuAfterClose:function(){this.hot.listen(),this.hot.runHooks(&quot;afterContextMenuHide&quot;,this)},destroy:function(){this.close(),this.menu&amp;&amp;this.menu.destroy(),$traceurRuntime.superGet(this,z.prototype,&quot;destroy&quot;).call(this)}},{get DEFAULT_ITEMS(){return[D,H,B,A,P,B,N,L,B,I,W,B,j,B,V]}},m),F.SEPARATOR={name:B},p.hooks.register(&quot;afterContextMenuDefaultOptions&quot;),p.hooks.register(&quot;afterContextMenuShow&quot;),p.hooks.register(&quot;afterContextMenuHide&quot;),p.hooks.register(&quot;afterContextMenuExecute&quot;),_(&quot;contextMenu&quot;,F)},{_base:62,browser:24,commandExecutor:70,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,itemsFactory:73,menu:74,plugins:61,predefinedItems:75}],72:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{Cursor:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,a=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),l=a.getWindowScrollLeft,u=a.getWindowScrollTop,c=(i=e(&quot;helpers/dom/event&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),d=c.pageX,h=c.pageY,f=function(e){var t,n,o,r,i,s,a=u(),c=l();this.type=this.getSourceType(e),&quot;literal&quot;===this.type?(t=parseInt(e.top,10),o=parseInt(e.left,10),i=e.height||0,s=e.width||0,n=t,r=o,t+=a,o+=c):&quot;event&quot;===this.type&amp;&amp;(t=parseInt(h(e),10),o=parseInt(d(e),10),i=e.target.clientHeight,s=e.target.clientWidth,n=t-a,r=o-c),this.top=t,this.topRelative=n,this.left=o,this.leftRelative=r,this.scrollTop=a,this.scrollLeft=c,this.cellHeight=i,this.cellWidth=s};$traceurRuntime.createClass(f,{getSourceType:function(e){var t=&quot;literal&quot;;return e instanceof Event&amp;&amp;(t=&quot;event&quot;),t},fitsAbove:function(e){return this.topRelative&gt;=e.offsetHeight},fitsBelow:function(e){var t=void 0!==arguments[1]?arguments[1]:window.innerHeight;return this.topRelative+e.offsetHeight&lt;=t},fitsOnRight:function(e){var t=void 0!==arguments[1]?arguments[1]:window.innerWidth;return this.leftRelative+this.cellWidth+e.offsetWidth&lt;=t},fitsOnLeft:function(e){return this.leftRelative&gt;=e.offsetWidth}},{}),s.plugins.utils=s.plugins.utils||{},s.plugins.utils.Cursor=f},{browser:24,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48}],73:[function(e,t,n){&quot;use strict&quot;;function o(){var e=void 0!==arguments[0]?arguments[0]:null,t=void 0!==arguments[1]?arguments[1]:[],n=void 0!==arguments[2]?arguments[2]:{},o=[];return e&amp;&amp;e.items?e=e.items:Array.isArray(e)||(e=t),u(e)?l(e,function(e,t){var r=n[&quot;string&quot;==typeof e?e:t];r||(r=e),u(e)?c(r,e):&quot;string&quot;==typeof r&amp;&amp;(r={name:r}),void 0===r.key&amp;&amp;(r.key=t),o.push(r)}):d(e,function(e,t){var r=n[e];!r&amp;&amp;p.indexOf(e)&gt;=0||(r||(r={name:e,key:t+&quot;&quot;}),u(e)&amp;&amp;c(r,e),void 0===r.key&amp;&amp;(r.key=t),o.push(r))}),o}Object.defineProperties(n,{ItemsFactory:{get:function(){return g}},__esModule:{value:!0}});var r,i,s,a=(r=e(&quot;helpers/object&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),l=a.objectEach,u=a.isObject,c=a.extend,d=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,h=(s=e(&quot;predefinedItems&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),f=h.SEPARATOR,p=h.ITEMS,m=h.predefinedItems,g=function(e){var t=void 0!==arguments[1]?arguments[1]:null;this.hot=e,this.predefinedItems=m(),this.defaultOrderPattern=t};$traceurRuntime.createClass(g,{setPredefinedItems:function(e){var t=this,n={};this.defaultOrderPattern.length=0,l(e,function(e,o){var r=&quot;&quot;;e.name===f?(n[f]=e,r=f):isNaN(parseInt(o,10))?(e.key=void 0===e.key?o:e.key,n[o]=e,r=e.key):(n[e.key]=e,r=e.key),t.defaultOrderPattern.push(r)}),this.predefinedItems=n},getItems:function(){var e=void 0!==arguments[0]?arguments[0]:null;return o(e,this.defaultOrderPattern,this.predefinedItems)}},{})},{&quot;helpers/array&quot;:43,&quot;helpers/object&quot;:53,predefinedItems:75}],74:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{Menu:{get:function(){return z}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f,p,m=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,g=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),w=g.addClass,v=g.empty,y=g.fastInnerHTML,b=g.getScrollbarWidth,C=g.isChildOf,_=g.removeClass,R=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),M=R.arrayEach,S=R.arrayFilter,E=R.arrayReduce,O=(s=e(&quot;cursor&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).Cursor,T=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).EventManager,k=(l=e(&quot;helpers/object&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).mixin,x=(u=e(&quot;helpers/function&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).debounce,D=(c=e(&quot;utils&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),H=D.filterSeparators,A=D.hasSubMenu,P=D.isDisabled,N=D.isItemHidden,L=D.isSeparator,I=D.isSelectionDisabled,W=D.normalizeSelection,j=(d=e(&quot;helpers/unicode&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).KEY_CODES,V=(h=e(&quot;mixins/localHooks&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).localHooks,B=(f=e(&quot;predefinedItems&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).SEPARATOR,F=(p=e(&quot;helpers/dom/event&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}).stopImmediatePropagation,z=function(e,t){this.hot=e,this.options=t||{parent:null,name:null,className:&quot;&quot;,keepInViewport:!0,standalone:!1},this.eventManager=new T(this),this.container=this.createContainer(this.options.name),this.hotMenu=null,this.hotSubMenus={},this.parentMenu=this.options.parent||null,this.menuItems=null,this.origOutsideClickDeselects=null,this.offset={above:0,below:0,left:0,right:0},this._afterScrollCallback=null,this.registerEvents()},Y=z;$traceurRuntime.createClass(z,{registerEvents:function(){var e=this;this.eventManager.addEventListener(document.documentElement,&quot;mousedown&quot;,function(t){return e.onDocumentMouseDown(t)})},setMenuItems:function(e){this.menuItems=e},setOffset:function(e){var t=void 0!==arguments[1]?arguments[1]:0;this.offset[e]=t},isSubMenu:function(){return null!==this.parentMenu},open:function(){var e=this;this.container.removeAttribute(&quot;style&quot;),this.container.style.display=&quot;block&quot;;var t=x(function(t){return e.openSubMenu(t)},300),n=S(this.menuItems,function(t){return N(t,e.hot)});n=H(n,B);var o={data:n,colHeaders:!1,colWidths:[200],autoRowSize:!1,readOnly:!0,copyPaste:!1,columns:[{data:&quot;name&quot;,renderer:function(t,n,o,r,i,s){return e.menuItemRenderer(t,n,o,r,i,s)}}],renderAllRows:!0,fragmentSelection:&quot;cell&quot;,disableVisualSelection:&quot;area&quot;,beforeKeyDown:function(t){return e.onBeforeKeyDown(t)},afterOnCellMouseOver:function(n,o,r){e.isAllSubMenusClosed()?t(o.row):e.openSubMenu(o.row)}};this.origOutsideClickDeselects=this.hot.getSettings().outsideClickDeselects,this.hot.getSettings().outsideClickDeselects=!1,this.hotMenu=new m.Core(this.container,o),this.hotMenu.addHook(&quot;afterInit&quot;,function(){return e.onAfterInit()}),this.hotMenu.init(),this.hotMenu.listen(),this.blockMainTableCallbacks(),this.runLocalHooks(&quot;afterOpen&quot;)},close:function(){var e=void 0!==arguments[0]&amp;&amp;arguments[0];this.isOpened()&amp;&amp;(e&amp;&amp;this.parentMenu?this.parentMenu.close():(this.closeAllSubMenus(),this.container.style.display=&quot;none&quot;,this.releaseMainTableCallbacks(),this.hotMenu.destroy(),this.hotMenu=null,this.hot.getSettings().outsideClickDeselects=this.origOutsideClickDeselects,this.runLocalHooks(&quot;afterClose&quot;),this.parentMenu&amp;&amp;this.parentMenu.hotMenu.listen()))},openSubMenu:function(e){if(!this.hotMenu)return!1;var t=this.hotMenu.getCell(e,0);if(this.closeAllSubMenus(),!t||!A(t))return!1;var n=this.hotMenu.getSourceDataAtRow(e),o=new Y(this.hot,{parent:this,name:n.name,className:this.options.className,keepInViewport:!0});return o.setMenuItems(n.submenu.items),o.open(),o.setPosition(t.getBoundingClientRect()),this.hotSubMenus[n.key]=o,o},closeSubMenu:function(e){var t=this.hotMenu.getSourceDataAtRow(e),n=this.hotSubMenus[t.key];n&amp;&amp;(n.destroy(),delete this.hotSubMenus[t.key])},closeAllSubMenus:function(){var e=this;M(this.hotMenu.getData(),function(t,n){return e.closeSubMenu(n)})},isAllSubMenusClosed:function(){return 0===Object.keys(this.hotSubMenus).length},destroy:function(){this.clearLocalHooks(),this.close(),this.parentMenu=null,this.eventManager.destroy()},isOpened:function(){return null!==this.hotMenu},executeCommand:function(e){if(this.isOpened()&amp;&amp;this.hotMenu.getSelected()){var t=this.hotMenu.getSourceDataAtRow(this.hotMenu.getSelected()[0]);if(this.runLocalHooks(&quot;select&quot;,t,e),t.isCommand!==!1&amp;&amp;t.name!==B){var n=this.hot.getSelectedRange(),o=n?W(n):{},r=!0;(t.disabled===!0||&quot;function&quot;==typeof t.disabled&amp;&amp;t.disabled.call(this.hot)===!0||t.submenu)&amp;&amp;(r=!1),this.runLocalHooks(&quot;executeCommand&quot;,t.key,o,e),this.isSubMenu()&amp;&amp;this.parentMenu.runLocalHooks(&quot;executeCommand&quot;,t.key,o,e),r&amp;&amp;this.close(!0)}}},setPosition:function(e){var t=new O(e);this.options.keepInViewport?(t.fitsBelow(this.container)?this.setPositionBelowCursor(t):t.fitsAbove(this.container)?this.setPositionAboveCursor(t):this.setPositionBelowCursor(t),t.fitsOnRight(this.container)?this.setPositionOnRightOfCursor(t):this.setPositionOnLeftOfCursor(t)):(this.setPositionBelowCursor(t),this.setPositionOnRightOfCursor(t))},setPositionAboveCursor:function(e){var t=this.offset.above+e.top-this.container.offsetHeight;this.isSubMenu()&amp;&amp;(t=e.top+e.cellHeight-this.container.offsetHeight+3),this.container.style.top=t+&quot;px&quot;},setPositionBelowCursor:function(e){var t=this.offset.below+e.top;this.isSubMenu()&amp;&amp;(t=e.top-1),this.container.style.top=t+&quot;px&quot;},setPositionOnRightOfCursor:function(e){var t;t=this.isSubMenu()?1+e.left+e.cellWidth:this.offset.right+1+e.left,this.container.style.left=t+&quot;px&quot;},setPositionOnLeftOfCursor:function(e){var t=this.offset.left+e.left-this.container.offsetWidth+b()+4;this.container.style.left=t+&quot;px&quot;},selectFirstCell:function(){var e=this.hotMenu.getCell(0,0);L(e)||P(e)||I(e)?this.selectNextCell(0,0):this.hotMenu.selectCell(0,0)},selectLastCell:function(){var e=this.hotMenu.countRows()-1,t=this.hotMenu.getCell(e,0);L(t)||P(t)||I(t)?this.selectPrevCell(e,0):this.hotMenu.selectCell(e,0)},selectNextCell:function(e,t){var n=e+1,o=n&lt;this.hotMenu.countRows()?this.hotMenu.getCell(n,t):null;o&amp;&amp;(L(o)||P(o)||I(o)?this.selectNextCell(n,t):this.hotMenu.selectCell(n,t))},selectPrevCell:function(e,t){var n=e-1,o=n&gt;=0?this.hotMenu.getCell(n,t):null;o&amp;&amp;(L(o)||P(o)||I(o)?this.selectPrevCell(n,t):this.hotMenu.selectCell(n,t))},menuItemRenderer:function(e,t,n,o,r,i){var s=this,a=e.getSourceDataAtRow(n),l=document.createElement(&quot;div&quot;),u=function(e){return e.hasOwnProperty(&quot;submenu&quot;)},c=function(e){return new RegExp(B,&quot;i&quot;).test(e.name)},d=function(e){return e.disabled===!0||&quot;function&quot;==typeof e.disabled&amp;&amp;e.disabled.call(s.hot)===!0},h=function(e){return e.disableSelection};&quot;function&quot;==typeof i&amp;&amp;(i=i.call(this.hot)),v(t),w(l,&quot;htItemWrapper&quot;),t.appendChild(l),c(a)?w(t,&quot;htSeparator&quot;):&quot;function&quot;==typeof a.renderer?(w(t,&quot;htCustomMenuRenderer&quot;),t.appendChild(a.renderer(e,l,n,o,r,i))):y(l,i),d(a)?(w(t,&quot;htDisabled&quot;),this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.deselectCell()})):h(a)?(w(t,&quot;htSelectionDisabled&quot;),this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.deselectCell()})):u(a)?(w(t,&quot;htSubmenu&quot;),h(a)?this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.deselectCell()}):this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.selectCell(n,o,void 0,void 0,!1,!1)})):(_(t,&quot;htSubmenu&quot;),_(t,&quot;htDisabled&quot;),h(a)?this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.deselectCell()}):this.eventManager.addEventListener(t,&quot;mouseenter&quot;,function(){return e.selectCell(n,o,void 0,void 0,!1,!1)}))},createContainer:function(){var e=void 0!==arguments[0]?arguments[0]:null;e&amp;&amp;(e=e.replace(/ /g,&quot;_&quot;),e=this.options.className+&quot;Sub_&quot;+e);var t;return t=e?document.querySelector(&quot;.&quot;+this.options.className+&quot;.&quot;+e):document.querySelector(&quot;.&quot;+this.options.className),t||(t=document.createElement(&quot;div&quot;),w(t,&quot;htMenu &quot;+this.options.className),e&amp;&amp;w(t,e),document.getElementsByTagName(&quot;body&quot;)[0].appendChild(t)),t},blockMainTableCallbacks:function(){this._afterScrollCallback=function(){},this.hot.addHook(&quot;afterScrollVertically&quot;,this._afterScrollCallback),this.hot.addHook(&quot;afterScrollHorizontally&quot;,this._afterScrollCallback)},releaseMainTableCallbacks:function(){this._afterScrollCallback&amp;&amp;(this.hot.removeHook(&quot;afterScrollVertically&quot;,this._afterScrollCallback),this.hot.removeHook(&quot;afterScrollHorizontally&quot;,this._afterScrollCallback),this._afterScrollCallback=null)},onBeforeKeyDown:function(e){var t=this.hotMenu.getSelected(),n=!1;switch(e.keyCode){case j.ESCAPE:this.close(),n=!0;break;case j.ENTER:t&amp;&amp;(this.hotMenu.getSourceDataAtRow(t[0]).submenu?n=!0:(this.executeCommand(e),this.close(!0)));break;case j.ARROW_DOWN:t?this.selectNextCell(t[0],t[1]):this.selectFirstCell(),n=!0;break;case j.ARROW_UP:t?this.selectPrevCell(t[0],t[1]):this.selectLastCell(),n=!0;break;case j.ARROW_RIGHT:if(t){var o=this.openSubMenu(t[0]);o&amp;&amp;o.selectFirstCell()}n=!0;break;case j.ARROW_LEFT:t&amp;&amp;this.isSubMenu()&amp;&amp;(this.close(),this.parentMenu&amp;&amp;this.parentMenu.hotMenu.listen(),n=!0)}n&amp;&amp;(e.preventDefault(),F(e))},onAfterInit:function(){var e=this.hotMenu.getSettings().data,t=this.hotMenu.view.wt.wtTable.hider.style,n=this.hotMenu.view.wt.wtTable.holder.style,o=parseInt(t.width,10),r=E(e,function(e,t){return e+(t.name===B?1:26)},0);n.width=o+22+&quot;px&quot;,n.height=r+4+&quot;px&quot;,t.height=n.height},onDocumentMouseDown:function(e){this.isOpened()&amp;&amp;(this.container&amp;&amp;C(e.target,this.container)&amp;&amp;this.executeCommand(e),this.options.standalone&amp;&amp;this.hotMenu&amp;&amp;!C(e.target,this.hotMenu.rootElement)?this.close(!0):(this.isAllSubMenusClosed()||this.isSubMenu())&amp;&amp;!C(e.target,&quot;.htMenu&quot;)&amp;&amp;C(e.target,document)&amp;&amp;this.close(!0))}},{}),k(z,V)},{browser:24,cursor:72,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/function&quot;:50,&quot;helpers/object&quot;:53,&quot;helpers/unicode&quot;:56,&quot;mixins/localHooks&quot;:58,predefinedItems:75,utils:88}],75:[function(e,t,n){&quot;use strict&quot;;function o(){var e={};return y(oe,function(t,n){return e[n]=t()}),e}function r(e,t){ne.indexOf(e)===-1&amp;&amp;(oe[e]=t)}var i;Object.defineProperties(n,{ALIGNMENT:{get:function(){return a.KEY}},CLEAR_COLUMN:{get:function(){return l.KEY}},COLUMN_LEFT:{get:function(){return u.KEY}},COLUMN_RIGHT:{get:function(){return c.KEY}},READ_ONLY:{get:function(){return d.KEY}},REDO:{get:function(){return h.KEY}},REMOVE_COLUMN:{get:function(){return f.KEY}},REMOVE_ROW:{get:function(){return p.KEY}},ROW_ABOVE:{get:function(){return m.KEY}},ROW_BELOW:{get:function(){return g.KEY}},SEPARATOR:{get:function(){return w.KEY}},UNDO:{get:function(){return v.KEY}},ITEMS:{get:function(){return ne}},predefinedItems:{get:function(){return o}},addItem:{get:function(){return r}},__esModule:{value:!0}});var s,a,l,u,c,d,h,f,p,m,g,w,v,a,l,u,c,d,h,f,p,m,g,w,v,y=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).objectEach,b=(a=e(&quot;predefinedItems/alignment&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),C=b.alignmentItem,_=b.KEY,R=(l=e(&quot;predefinedItems/clearColumn&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),M=R.clearColumnItem,S=R.KEY,E=(u=e(&quot;predefinedItems/columnLeft&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}),O=E.columnLeftItem,T=E.KEY,k=(c=e(&quot;predefinedItems/columnRight&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),x=k.columnRightItem,D=k.KEY,H=(d=e(&quot;predefinedItems/readOnly&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}),A=H.readOnlyItem,P=H.KEY,N=(h=e(&quot;predefinedItems/redo&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}),L=N.redoItem,I=N.KEY,W=(f=e(&quot;predefinedItems/removeColumn&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),j=W.removeColumnItem,V=W.KEY,B=(p=e(&quot;predefinedItems/removeRow&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}),F=B.removeRowItem,z=B.KEY,Y=(m=e(&quot;predefinedItems/rowAbove&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}),U=Y.rowAboveItem,G=Y.KEY,$=(g=e(&quot;predefinedItems/rowBelow&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}),K=$.rowBelowItem,X=$.KEY,q=(w=e(&quot;predefinedItems/separator&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}),Z=q.separatorItem,J=q.KEY,Q=(v=e(&quot;predefinedItems/undo&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}),ee=Q.undoItem,te=Q.KEY,a=(a=e(&quot;predefinedItems/alignment&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),l=(l=e(&quot;predefinedItems/clearColumn&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),u=(u=e(&quot;predefinedItems/columnLeft&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}),c=(c=e(&quot;predefinedItems/columnRight&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}),d=(d=e(&quot;predefinedItems/readOnly&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}),h=(h=e(&quot;predefinedItems/redo&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}),f=(f=e(&quot;predefinedItems/removeColumn&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}),p=(p=e(&quot;predefinedItems/removeRow&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}),m=(m=e(&quot;predefinedItems/rowAbove&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}),g=(g=e(&quot;predefinedItems/rowBelow&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}),w=(w=e(&quot;predefinedItems/separator&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}),v=(v=e(&quot;predefinedItems/undo&quot;),v&amp;&amp;v.__esModule&amp;&amp;v||{default:v}),ne=[G,X,T,D,S,z,V,te,I,P,_,J],oe=(i={},Object.defineProperty(i,J,{value:Z,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,G,{value:U,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,X,{value:K,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,T,{value:O,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,D,{value:x,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,S,{value:M,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,z,{value:F,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,V,{value:j,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,te,{value:ee,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,I,{value:L,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,P,{value:A,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(i,_,{value:C,configurable:!0,enumerable:!0,writable:!0}),i)},{&quot;helpers/object&quot;:53,&quot;predefinedItems/alignment&quot;:76,&quot;predefinedItems/clearColumn&quot;:77,&quot;predefinedItems/columnLeft&quot;:78,&quot;predefinedItems/columnRight&quot;:79,&quot;predefinedItems/readOnly&quot;:80,&quot;predefinedItems/redo&quot;:81,&quot;predefinedItems/removeColumn&quot;:82,&quot;predefinedItems/removeRow&quot;:83,&quot;predefinedItems/rowAbove&quot;:84,&quot;predefinedItems/rowBelow&quot;:85,&quot;predefinedItems/separator&quot;:86,&quot;predefinedItems/undo&quot;:87}],76:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:h,name:&quot;Alignment&quot;,disabled:function(){return!(this.getSelectedRange()&amp;&amp;!this.selection.selectedHeader.corner)},submenu:{items:[{key:h+&quot;:left&quot;,name:function(){var e=this,t=&quot;Left&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htLeft&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;horizontal&quot;,r=&quot;htLeft&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+&quot;:center&quot;,name:function(){var e=this,t=&quot;Center&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htCenter&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;horizontal&quot;,r=&quot;htCenter&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+&quot;:right&quot;,name:function(){var e=this,t=&quot;Right&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htRight&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;horizontal&quot;,r=&quot;htRight&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+&quot;:justify&quot;,name:function(){var e=this,t=&quot;Justify&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htJustify&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;horizontal&quot;,r=&quot;htJustify&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{name:d},{key:h+&quot;:top&quot;,name:function(){var e=this,t=&quot;Top&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htTop&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;vertical&quot;,r=&quot;htTop&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+&quot;:middle&quot;,name:function(){var e=this,t=&quot;Middle&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htMiddle&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;vertical&quot;,r=&quot;htMiddle&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1},{key:h+&quot;:bottom&quot;,name:function(){var e=this,t=&quot;Bottom&quot;,n=u(this.getSelectedRange(),function(t,n){var o=e.getCellMeta(t,n).className;if(o&amp;&amp;o.indexOf(&quot;htBottom&quot;)!==-1)return!0});return n&amp;&amp;(t=c(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=l(t,function(t,n){return e.getCellMeta(t,n).className}),o=&quot;vertical&quot;,r=&quot;htBottom&quot;;this.runHooks(&quot;beforeCellAlignment&quot;,n,t,o,r),a(t,o,r,function(t,n){return e.getCellMeta(t,n)}),this.render()},disabled:!1}]}}}Object.defineProperties(n,{KEY:{get:function(){return h}},alignmentItem:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),a=s.align,l=s.getAlignmentClasses,u=s.checkSelectionConsistency,c=s.markLabelAsSelected,d=(i=e(&quot;separator&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).KEY,h=&quot;alignment&quot;},{separator:86,utils:88}],77:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Clear column&quot;,callback:function(e,t){var n=t.start.col;this.countRows()&amp;&amp;this.populateFromArray(0,n,[[null]],Math.max(t.start.row,t.end.row),n,&quot;ContextMenu.clearColumn&quot;)},disabled:function(){var e=i(this);if(!e)return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(&quot;,&quot;)==e.join(&quot;,&quot;);return e[1]&lt;0||this.countCols()&gt;=this.getSettings().maxCols||n}}}Object.defineProperties(n,{KEY:{get:function(){return s}},clearColumnItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;clear_column&quot;},{utils:88}],78:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Insert column on the left&quot;,callback:function(e,t){this.alter(&quot;insert_col&quot;,t.start.col,1,&quot;ContextMenu.columnLeft&quot;)},disabled:function(){var e=i(this);if(!e)return!0;if(!this.isColumnModificationAllowed())return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(&quot;,&quot;)==e.join(&quot;,&quot;),o=1===this.countCols();return e[1]&lt;0||this.countCols()&gt;=this.getSettings().maxCols||!o&amp;&amp;n},hidden:function(){return!this.getSettings().allowInsertColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},columnLeftItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;col_left&quot;},{utils:88}],79:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Insert column on the right&quot;,callback:function(e,t){this.alter(&quot;insert_col&quot;,t.end.col+1,1,&quot;ContextMenu.columnRight&quot;)},disabled:function(){var e=i(this);if(!e)return!0;if(!this.isColumnModificationAllowed())return!0;var t=[e[0],0,e[0],this.countCols()-1],n=t.join(&quot;,&quot;)==e.join(&quot;,&quot;),o=1===this.countCols();return e[1]&lt;0||this.countCols()&gt;=this.getSettings().maxCols||!o&amp;&amp;n},hidden:function(){return!this.getSettings().allowInsertColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},columnRightItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;col_right&quot;},{utils:88}],80:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:l,name:function(){var e=this,t=&quot;Read only&quot;,n=s(this.getSelectedRange(),function(t,n){return e.getCellMeta(t,n).readOnly});return n&amp;&amp;(t=a(t)),t},callback:function(){var e=this,t=this.getSelectedRange(),n=s(t,function(t,n){return e.getCellMeta(t,n).readOnly});t.forAll(function(t,o){e.setCellMeta(t,o,&quot;readOnly&quot;,!n)}),this.render()},disabled:function(){return!(this.getSelectedRange()&amp;&amp;!this.selection.selectedHeader.corner)}}}Object.defineProperties(n,{KEY:{get:function(){return l}},readOnlyItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),s=i.checkSelectionConsistency,a=i.markLabelAsSelected,l=&quot;make_read_only&quot;},{utils:88}],81:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:r,name:&quot;Redo&quot;,callback:function(){this.redo()},disabled:function(){return this.undoRedo&amp;&amp;!this.undoRedo.isRedoAvailable()}}}Object.defineProperties(n,{KEY:{get:function(){return r}},redoItem:{get:function(){return o}},__esModule:{value:!0}});var r=&quot;redo&quot;},{}],82:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Remove column&quot;,callback:function(e,t){var n=t.end.col-t.start.col+1;this.alter(&quot;remove_col&quot;,t.start.col,n,&quot;ContextMenu.removeColumn&quot;)},disabled:function(){var e=i(this),t=this.countCols();return!e||this.selection.selectedHeader.rows||this.selection.selectedHeader.corner||!this.isColumnModificationAllowed()||!t},hidden:function(){return!this.getSettings().allowRemoveColumn}}}Object.defineProperties(n,{KEY:{get:function(){return s}},removeColumnItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;remove_col&quot;},{utils:88}],83:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Remove row&quot;,callback:function(e,t){var n=t.end.row-t.start.row+1;this.alter(&quot;remove_row&quot;,t.start.row,n,&quot;ContextMenu.removeRow&quot;)},disabled:function(){var e=i(this),t=this.countRows();return!e||this.selection.selectedHeader.cols||this.selection.selectedHeader.corner||!t},hidden:function(){return!this.getSettings().allowRemoveRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},removeRowItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;remove_row&quot;},{utils:88}],84:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Insert row above&quot;,callback:function(e,t){this.alter(&quot;insert_row&quot;,t.start.row,1,&quot;ContextMenu.rowAbove&quot;);
},disabled:function(){var e=i(this);return!e||this.selection.selectedHeader.cols||this.countRows()&gt;=this.getSettings().maxRows},hidden:function(){return!this.getSettings().allowInsertRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},rowAboveItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;row_above&quot;},{utils:88}],85:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:s,name:&quot;Insert row below&quot;,callback:function(e,t){this.alter(&quot;insert_row&quot;,t.end.row+1,1,&quot;ContextMenu.rowBelow&quot;)},disabled:function(){var e=i(this);return!e||this.selection.selectedHeader.cols||this.countRows()&gt;=this.getSettings().maxRows},hidden:function(){return!this.getSettings().allowInsertRow}}}Object.defineProperties(n,{KEY:{get:function(){return s}},rowBelowItem:{get:function(){return o}},__esModule:{value:!0}});var r,i=(r=e(&quot;utils&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).getValidSelection,s=&quot;row_below&quot;},{utils:88}],86:[function(e,t,n){&quot;use strict&quot;;function o(){return{name:r}}Object.defineProperties(n,{KEY:{get:function(){return r}},separatorItem:{get:function(){return o}},__esModule:{value:!0}});var r=&quot;---------&quot;},{}],87:[function(e,t,n){&quot;use strict&quot;;function o(){return{key:r,name:&quot;Undo&quot;,callback:function(){this.undo()},disabled:function(){return this.undoRedo&amp;&amp;!this.undoRedo.isUndoAvailable()}}}Object.defineProperties(n,{KEY:{get:function(){return r}},undoItem:{get:function(){return o}},__esModule:{value:!0}});var r=&quot;undo&quot;},{}],88:[function(e,t,n){&quot;use strict&quot;;function o(e){return{start:e.getTopLeftCorner(),end:e.getBottomRightCorner()}}function r(e){return S(e,&quot;htSeparator&quot;)}function i(e){return S(e,&quot;htSubmenu&quot;)}function s(e){return S(e,&quot;htDisabled&quot;)}function a(e){return S(e,&quot;htSelectionDisabled&quot;)}function l(e){var t=e.getSelected();return t?t[0]&lt;0?null:t:null}function u(e,t){return e.indexOf(t)!=-1?e:(e=e.replace(&quot;htTop&quot;,&quot;&quot;).replace(&quot;htMiddle&quot;,&quot;&quot;).replace(&quot;htBottom&quot;,&quot;&quot;).replace(&quot;  &quot;,&quot;&quot;),e+=&quot; &quot;+t)}function c(e,t){return e.indexOf(t)!=-1?e:(e=e.replace(&quot;htLeft&quot;,&quot;&quot;).replace(&quot;htCenter&quot;,&quot;&quot;).replace(&quot;htRight&quot;,&quot;&quot;).replace(&quot;htJustify&quot;,&quot;&quot;).replace(&quot;  &quot;,&quot;&quot;),e+=&quot; &quot;+t)}function d(e,t){for(var n={},o=e.from.row;o&lt;=e.to.row;o++)for(var r=e.from.col;r&lt;=e.to.col;r++)n[o]||(n[o]=[]),n[o][r]=t(o,r);return n}function h(e,t,n,o){if(e.from.row==e.to.row&amp;&amp;e.from.col==e.to.col)f(e.from.row,e.from.col,t,n,o);else for(var r=e.from.row;r&lt;=e.to.row;r++)for(var i=e.from.col;i&lt;=e.to.col;i++)f(r,i,t,n,o)}function f(e,t,n,o,r){var i=r(e,t),s=o;i.className&amp;&amp;(s=&quot;vertical&quot;===n?u(i.className,o):c(i.className,o)),i.className=s}function p(e,t){var n=!1;return e&amp;&amp;e.forAll(function(e,o){if(t(e,o))return n=!0,!1}),n}function m(e){return'&lt;span class=&quot;selected&quot;&gt;'+String.fromCharCode(10003)+&quot;&lt;/span&gt;&quot;+e}function g(e,t){return!e.hidden||!(&quot;function&quot;==typeof e.hidden&amp;&amp;e.hidden.call(t))}function w(e,t){for(var n=e.slice(0),o=0;o&lt;n.length&amp;&amp;n[o].name===t;)n.shift();return n}function v(e,t){var n=e.slice(0);return n.reverse(),n=w(n,t),n.reverse(),n}function y(e){var t=[];return M(e,function(e,n){n&gt;0?t[t.length-1].name!==e.name&amp;&amp;t.push(e):t.push(e)}),t}function b(e){var t=void 0!==arguments[1]?arguments[1]:E,n=e.slice(0);return n=w(n,t),n=v(n,t),n=y(n)}Object.defineProperties(n,{normalizeSelection:{get:function(){return o}},isSeparator:{get:function(){return r}},hasSubMenu:{get:function(){return i}},isDisabled:{get:function(){return s}},isSelectionDisabled:{get:function(){return a}},getValidSelection:{get:function(){return l}},prepareVerticalAlignClass:{get:function(){return u}},prepareHorizontalAlignClass:{get:function(){return c}},getAlignmentClasses:{get:function(){return d}},align:{get:function(){return h}},checkSelectionConsistency:{get:function(){return p}},markLabelAsSelected:{get:function(){return m}},isItemHidden:{get:function(){return g}},filterSeparators:{get:function(){return b}},__esModule:{value:!0}});var C,_,R,M=(C=e(&quot;helpers/array&quot;),C&amp;&amp;C.__esModule&amp;&amp;C||{default:C}).arrayEach,S=(_=e(&quot;helpers/dom/element&quot;),_&amp;&amp;_.__esModule&amp;&amp;_||{default:_}).hasClass,E=(R=e(&quot;predefinedItems/separator&quot;),R&amp;&amp;R.__esModule&amp;&amp;R||{default:R}).KEY},{&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;predefinedItems/separator&quot;:86}],89:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ContextMenuCopyPaste:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,d=(r=e(&quot;zeroclipboard&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,h=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).removeClass,f=(s=e(&quot;helpers/array&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).arrayEach,p=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).EventManager,m=(l=e(&quot;plugins&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).registerPlugin,g=(u=e(&quot;contextMenu/predefinedItems&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).SEPARATOR,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.eventManager=new p(this),this.swfPath=null,this.outsideClickDeselectsCache=null},v=w;$traceurRuntime.createClass(w,{isEnabled:function(){return this.hot.getSettings().contextMenuCopyPaste},enablePlugin:function(){var e=this;if(!this.enabled){&quot;object&quot;==typeof this.hot.getSettings().contextMenuCopyPaste&amp;&amp;(this.swfPath=this.hot.getSettings().contextMenuCopyPaste.swfPath),&quot;undefined&quot;==typeof d&amp;&amp;console.error(&quot;To be able to use the Copy/Paste feature from the context menu, you need to manually include ZeroClipboard.js file to your website.&quot;);try{new ActiveXObject(&quot;ShockwaveFlash.ShockwaveFlash&quot;)}catch(e){&quot;undefined&quot;==typeof navigator.mimeTypes[&quot;application/x-shockwave-flash&quot;]&amp;&amp;console.error(&quot;To be able to use the Copy/Paste feature from the context menu, your browser needs to have Flash Plugin installed.&quot;)}this.swfPath&amp;&amp;d.config({swfPath:this.swfPath}),this.hot.addHook(&quot;afterContextMenuShow&quot;,function(){return e.onAfterContextMenuShow()}),this.hot.addHook(&quot;afterContextMenuDefaultOptions&quot;,function(t){return e.onAfterContextMenuDefaultOptions(t)}),this.registerEvents(),$traceurRuntime.superGet(this,v.prototype,&quot;enablePlugin&quot;).call(this)}},disablePlugin:function(){$traceurRuntime.superGet(this,v.prototype,&quot;disablePlugin&quot;).call(this)},registerEvents:function(){var e=this;this.eventManager.addEventListener(document,&quot;mouseenter&quot;,function(){return e.removeCurrentClass()}),this.eventManager.addEventListener(document,&quot;mouseleave&quot;,function(){return e.removeZeroClipboardClass()})},getCopyValue:function(){return this.hot.copyPaste.setCopyableText(),this.hot.copyPaste.copyPasteInstance.elTextarea.value},onAfterContextMenuDefaultOptions:function(e){e.items.unshift({key:&quot;copy&quot;,name:&quot;Copy&quot;,disabled:function(){return this.selection.selectedHeader.corner}},{key:&quot;paste&quot;,name:&quot;Paste&quot;,callback:function(){this.copyPaste.triggerPaste()},disabled:function(){return this.selection.selectedHeader.corner}},{name:g})},onAfterContextMenuShow:function(){var e=this,t=this.hot.getPlugin(&quot;contextMenu&quot;),n=t.menu.hotMenu.getSourceData();f(n,function(n,o){if(&quot;copy&quot;===n.key){var r=new d(t.menu.hotMenu.getCell(o,0));return r.off(),r.on(&quot;copy&quot;,function(t){var n=t.clipboardData;n.setData(&quot;text/plain&quot;,e.getCopyValue()),e.hot.getSettings().outsideClickDeselects=e.outsideClickDeselectsCache}),!1}})},removeCurrentClass:function(){var e=this.hot.getPlugin(&quot;contextMenu&quot;);if(e.enabled){if(e.menu.isOpened()){var t=e.menu.hotMenu.rootElement.querySelector(&quot;td.current&quot;);t&amp;&amp;h(t,&quot;current&quot;)}this.outsideClickDeselectsCache=this.hot.getSettings().outsideClickDeselects,this.hot.getSettings().outsideClickDeselects=!1}},removeZeroClipboardClass:function(){var e=this.hot.getPlugin(&quot;contextMenu&quot;);if(e.enabled){if(e.menu.isOpened()){var t=e.menu.hotMenu.rootElement.querySelector(&quot;td.zeroclipboard-is-hover&quot;);t&amp;&amp;h(t,&quot;zeroclipboard-is-hover&quot;)}this.hot.getSettings().outsideClickDeselects=this.outsideClickDeselectsCache}}},{},c),m(&quot;contextMenuCopyPaste&quot;,w)},{_base:62,&quot;contextMenu/predefinedItems&quot;:75,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,plugins:61,zeroclipboard:&quot;zeroclipboard&quot;}],90:[function(e,t,n){&quot;use strict&quot;;function o(e){function t(){e.isListening()&amp;&amp;e.selection.empty()}function n(t){var n,o,r,i,s,a,l,u,c,d;if(e.isListening()&amp;&amp;e.selection.isSelected()){n=t,o=y.parse(n),r=e.getSelected(),i=new x(r[0],r[1]),s=new x(r[2],r[3]),a=new D(i,i,s),l=a.getTopLeftCorner(),u=a.getBottomRightCorner(),c=l,d=new x(Math.max(u.row,o.length-1+l.row),Math.max(u.col,o[0].length-1+l.col));var h=s.row-i.row&gt;=o.length-1,f=s.col-i.col&gt;=o[0].length-1;e.addHookOnce(&quot;afterChange&quot;,function(t,n){var o=t?t.length:0;if(o){var r={row:0,col:0},i=-1;R(t,function(e,n){var s=o&gt;n+1?t[n+1]:null;s&amp;&amp;(h||(r.row=r.row+Math.max(s[0]-e[0]-1,0)),!f&amp;&amp;e[1]&gt;i&amp;&amp;(i=e[1],r.col=r.col+Math.max(s[1]-e[1]-1,0)))}),e.selectCell(c.row,c.col,d.row+r.row,d.col+r.col)}}),e.populateFromArray(c.row,c.col,o,d.row,d.col,&quot;CopyPaste.paste&quot;,e.getSettings().pasteMode)}}function o(t){if(e.getSelected()&amp;&amp;!(e.getActiveEditor()&amp;&amp;e.getActiveEditor().isOpened()||O(t))){if(_(t.keyCode)){if(e.getSettings().fragmentSelection&amp;&amp;T())return;return r.setCopyableText(),void E(t)}var n=(t.ctrlKey||t.metaKey)&amp;&amp;!t.altKey;t.keyCode==C.A&amp;&amp;n&amp;&amp;e._registerTimeout(setTimeout(k(r.setCopyableText,r),0))}}var r=this;this.copyPasteInstance=v(),this.copyPasteInstance.onCut(t),this.copyPasteInstance.onPaste(n),this.onPaste=n,e.addHook(&quot;beforeKeyDown&quot;,o),this.destroy=function(){this.copyPasteInstance&amp;&amp;(this.copyPasteInstance.removeCallback(t),this.copyPasteInstance.removeCallback(n),this.copyPasteInstance.destroy(),this.copyPasteInstance=null),e.removeHook(&quot;beforeKeyDown&quot;,o)},e.addHook(&quot;afterDestroy&quot;,k(this.destroy,this)),this.triggerPaste=k(this.copyPasteInstance.triggerPaste,this.copyPasteInstance),this.triggerCut=k(this.copyPasteInstance.triggerCut,this.copyPasteInstance),this.setCopyableText=function(){var t=e.getSettings(),n=t.copyRowsLimit,o=t.copyColsLimit,r=e.getSelectedRange(),i=r.getTopLeftCorner(),s=r.getBottomRightCorner(),a=i.row,l=i.col,u=s.row,c=s.col,d=Math.min(u,a+n-1),h=Math.min(c,l+o-1),f=[];f.push({startRow:a,startCol:l,endRow:d,endCol:h}),f=w.hooks.run(e,&quot;modifyCopyableRange&quot;,f);var p=this.getRangedCopyableData(f);e.copyPaste.copyPasteInstance.copyable(p),u===d&amp;&amp;c===h||w.hooks.run(e,&quot;afterCopyLimit&quot;,u-a+1,c-l+1,n,o)},this.getRangedCopyableData=function(t){var n=[],o=[],r=[];return R(t,function(e){M(e.startRow,e.endRow,function(e){o.indexOf(e)===-1&amp;&amp;o.push(e)}),M(e.startCol,e.endCol,function(e){r.indexOf(e)===-1&amp;&amp;r.push(e)})}),R(o,function(t){var o=[];R(r,function(n){o.push(e.getCopyableData(t,n))}),n.push(o)}),y.stringify(n)}}function r(){var e=this,t=e.getSettings().copyPaste!==!1;t&amp;&amp;!e.copyPaste?e.copyPaste=new o(e):!t&amp;&amp;e.copyPaste&amp;&amp;(e.copyPaste.destroy(),e.copyPaste=null)}Object.defineProperties(n,{CopyPastePlugin:{get:function(){return o}},__esModule:{value:!0}});var i,s,a,l,u,c,d,h,f,p,m,g,w=(i=e(&quot;browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,v=(s=e(&quot;copyPaste&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).default,y=(a=e(&quot;SheetClip&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).default,b=(l=e(&quot;helpers/unicode&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),C=b.KEY_CODES,_=b.isCtrlKey,R=(u=e(&quot;helpers/array&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).arrayEach,M=(c=e(&quot;helpers/number&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).rangeEach,S=(d=e(&quot;helpers/dom/event&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}),E=S.stopImmediatePropagation,O=S.isImmediatePropagationStopped,T=(h=e(&quot;helpers/dom/element&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).getSelectionText,k=(f=e(&quot;helpers/function&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).proxy,x=((p=e(&quot;plugins&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}).registerPlugin,(m=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).WalkontableCellCoords),D=(g=e(&quot;3rdparty/walkontable/src/cell/range&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}).WalkontableCellRange;w.hooks.add(&quot;afterInit&quot;,r),w.hooks.add(&quot;afterUpdateSettings&quot;,r),w.hooks.register(&quot;afterCopyLimit&quot;),w.hooks.register(&quot;modifyCopyableRange&quot;)},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,&quot;3rdparty/walkontable/src/cell/range&quot;:7,SheetClip:&quot;SheetClip&quot;,browser:24,copyPaste:&quot;copyPaste&quot;,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/function&quot;:50,&quot;helpers/number&quot;:52,&quot;helpers/unicode&quot;:56,plugins:61}],91:[function(e,t,n){&quot;use strict&quot;;function o(){}var r,i,s,a,l,u=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,c=((i=e(&quot;plugins&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).registerPlugin,(s=e(&quot;3rdparty/walkontable/src/cell/range&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).WalkontableCellRange),d=(a=e(&quot;3rdparty/walkontable/src/selection&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableSelection,h=function(e){return&quot;boolean&quot;==typeof e&amp;&amp;e===!0||&quot;object&quot;==typeof e&amp;&amp;e.length&gt;0},f=function(){h(this.getSettings().customBorders)&amp;&amp;(this.customBorders||(l=this,this.customBorders=new o))},p=function(e){for(var t=0;t&lt;l.view.wt.selections.length;t++)if(l.view.wt.selections[t].settings.className==e)return t;return-1},m=function(e){var t={row:e.row,col:e.col},n=new d(e,new c(t,t,t)),o=p(e.className);o&gt;=0?l.view.wt.selections[o]=n:l.view.wt.selections.push(n)},g=function(e,t,n){var o=_(e,t);o=R(o,n),this.setCellMeta(e,t,&quot;borders&quot;,o),m(o)},w=function(e){for(var t=e.range,n=t.from.row;n&lt;=t.to.row;n++)for(var o=t.from.col;o&lt;=t.to.col;o++){var r=_(n,o),i=0;n==t.from.row&amp;&amp;(i++,e.hasOwnProperty(&quot;top&quot;)&amp;&amp;(r.top=e.top)),n==t.to.row&amp;&amp;(i++,e.hasOwnProperty(&quot;bottom&quot;)&amp;&amp;(r.bottom=e.bottom)),o==t.from.col&amp;&amp;(i++,e.hasOwnProperty(&quot;left&quot;)&amp;&amp;(r.left=e.left)),o==t.to.col&amp;&amp;(i++,e.hasOwnProperty(&quot;right&quot;)&amp;&amp;(r.right=e.right)),i&gt;0&amp;&amp;(this.setCellMeta(n,o,&quot;borders&quot;,r),m(r))}},v=function(e,t){return&quot;border_row&quot;+e+&quot;col&quot;+t},y=function(){return{width:1,color:&quot;#000&quot;}},b=function(){return{hide:!0}},C=function(){return{width:1,color:&quot;#000&quot;,cornerVisible:!1}},_=function(e,t){return{className:v(e,t),border:C(),row:e,col:t,top:b(),right:b(),bottom:b(),left:b()}},R=function(e,t){return t.hasOwnProperty(&quot;border&quot;)&amp;&amp;(e.border=t.border),t.hasOwnProperty(&quot;top&quot;)&amp;&amp;(e.top=t.top),t.hasOwnProperty(&quot;right&quot;)&amp;&amp;(e.right=t.right),t.hasOwnProperty(&quot;bottom&quot;)&amp;&amp;(e.bottom=t.bottom),t.hasOwnProperty(&quot;left&quot;)&amp;&amp;(e.left=t.left),e},M=function(e){for(var t=document.querySelectorAll(&quot;.&quot;+e),n=0;n&lt;t.length;n++)if(t[n]&amp;&amp;&quot;TD&quot;!=t[n].nodeName){var o=t[n].parentNode;o.parentNode&amp;&amp;o.parentNode.removeChild(o)}},S=function(e,t){var n=v(e,t);M(n),this.removeCellMeta(e,t,&quot;borders&quot;)},E=function(e,t,n,o){var r=this.getCellMeta(e,t).borders;r&amp;&amp;void 0!=r.border||(r=_(e,t)),o?r[n]=b():r[n]=y(),this.setCellMeta(e,t,&quot;borders&quot;,r);var i=v(e,t);M(i),m(r),this.render()},O=function(e,t,n){if(e.from.row==e.to.row&amp;&amp;e.from.col==e.to.col)&quot;noBorders&quot;==t?S.call(this,e.from.row,e.from.col):E.call(this,e.from.row,e.from.col,t,n);else switch(t){case&quot;noBorders&quot;:for(var o=e.from.col;o&lt;=e.to.col;o++)for(var r=e.from.row;r&lt;=e.to.row;r++)S.call(this,r,o);break;case&quot;top&quot;:for(var i=e.from.col;i&lt;=e.to.col;i++)E.call(this,e.from.row,i,t,n);break;case&quot;right&quot;:for(var s=e.from.row;s&lt;=e.to.row;s++)E.call(this,s,e.to.col,t);break;case&quot;bottom&quot;:for(var a=e.from.col;a&lt;=e.to.col;a++)E.call(this,e.to.row,a,t);break;case&quot;left&quot;:for(var l=e.from.row;l&lt;=e.to.row;l++)E.call(this,l,e.from.col,t)}},T=function(e,t){var n=!1;return e.getSelectedRange().forAll(function(o,r){var i=e.getCellMeta(o,r).borders;if(i){if(!t)return n=!0,!1;if(!i[t].hasOwnProperty(&quot;hide&quot;))return n=!0,!1}}),n},k=function(e){return'&lt;span class=&quot;selected&quot;&gt;'+String.fromCharCode(10003)+&quot;&lt;/span&gt;&quot;+e},x=function(e){this.getSettings().customBorders&amp;&amp;(e.items.push(u.plugins.ContextMenu.SEPARATOR),e.items.push({key:&quot;borders&quot;,name:&quot;Borders&quot;,disabled:function(){return this.selection.selectedHeader.corner},submenu:{items:[{key:&quot;borders:top&quot;,name:function(){var e=&quot;Top&quot;,t=T(this,&quot;top&quot;);return t&amp;&amp;(e=k(e)),e},callback:function(){var e=T(this,&quot;top&quot;);O.call(this,this.getSelectedRange(),&quot;top&quot;,e)}},{key:&quot;borders:right&quot;,name:function(){var e=&quot;Right&quot;,t=T(this,&quot;right&quot;);return t&amp;&amp;(e=k(e)),e},callback:function(){var e=T(this,&quot;right&quot;);O.call(this,this.getSelectedRange(),&quot;right&quot;,e)}},{key:&quot;borders:bottom&quot;,name:function(){var e=&quot;Bottom&quot;,t=T(this,&quot;bottom&quot;);return t&amp;&amp;(e=k(e)),e},callback:function(){var e=T(this,&quot;bottom&quot;);O.call(this,this.getSelectedRange(),&quot;bottom&quot;,e)}},{key:&quot;borders:left&quot;,name:function(){var e=&quot;Left&quot;,t=T(this,&quot;left&quot;);return t&amp;&amp;(e=k(e)),e},callback:function(){var e=T(this,&quot;left&quot;);O.call(this,this.getSelectedRange(),&quot;left&quot;,e)}},{key:&quot;borders:no_borders&quot;,name:&quot;Remove border(s)&quot;,callback:function(){O.call(this,this.getSelectedRange(),&quot;noBorders&quot;)},disabled:function(){return!T(this)}}]}}))};u.hooks.add(&quot;beforeInit&quot;,f),u.hooks.add(&quot;afterContextMenuDefaultOptions&quot;,x),u.hooks.add(&quot;afterInit&quot;,function(){var e=this.getSettings().customBorders;if(e){for(var t=0;t&lt;e.length;t++)e[t].range?w.call(this,e[t]):g.call(this,e[t].row,e[t].col,e[t]);this.render(),this.view.wt.draw(!0)}}),u.CustomBorders=o},{&quot;3rdparty/walkontable/src/cell/range&quot;:7,&quot;3rdparty/walkontable/src/selection&quot;:19,browser:24,plugins:61}],92:[function(e,t,n){&quot;use strict&quot;;function o(){this.boundaries=null,this.callback=null}Object.defineProperties(n,{DragToScroll:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,l=(i=e(&quot;eventManager&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).eventManager;(s=e(&quot;plugins&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).registerPlugin;a.plugins.DragToScroll=o,o.prototype.setBoundaries=function(e){this.boundaries=e},o.prototype.setCallback=function(e){this.callback=e},o.prototype.check=function(e,t){var n=0,o=0;t&lt;this.boundaries.top?o=t-this.boundaries.top:t&gt;this.boundaries.bottom&amp;&amp;(o=t-this.boundaries.bottom),e&lt;this.boundaries.left?n=e-this.boundaries.left:e&gt;this.boundaries.right&amp;&amp;(n=e-this.boundaries.right),this.callback(n,o)};var u,c=function(e){e.dragToScrollListening=!1;var t=e.view.wt.wtTable.holder;u=new o,t!==window&amp;&amp;(u.setBoundaries(t.getBoundingClientRect()),u.setCallback(function(e,n){e&lt;0?t.scrollLeft-=50:e&gt;0&amp;&amp;(t.scrollLeft+=50),n&lt;0?t.scrollTop-=20:n&gt;0&amp;&amp;(t.scrollTop+=20)}),e.dragToScrollListening=!0)};a.hooks.add(&quot;afterInit&quot;,function(){var e=this,t=l(this);t.addEventListener(document,&quot;mouseup&quot;,function(){e.dragToScrollListening=!1}),t.addEventListener(document,&quot;mousemove&quot;,function(t){e.dragToScrollListening&amp;&amp;u.check(t.clientX,t.clientY)})}),a.hooks.add(&quot;afterDestroy&quot;,function(){l(this).clear()}),a.hooks.add(&quot;afterOnCellMouseDown&quot;,function(){c(this)}),a.hooks.add(&quot;afterOnCellCornerMouseDown&quot;,function(){c(this)}),a.plugins.DragToScroll=o},{browser:24,eventManager:42,plugins:61}],93:[function(e,t,n){&quot;use strict&quot;;function o(e){return{key:&quot;freeze_column&quot;,name:&quot;Freeze this column&quot;,callback:function(){var t=this.getSelectedRange().from.col;e.freezeColumn(t),this.render(),this.view.wt.wtOverlays.adjustElementsSize(!0)},hidden:function(){var e=this.getSelectedRange(),t=!1;return void 0===e?t=!0:(e.from.col!==e.to.col||e.from.col&lt;=this.getSettings().fixedColumnsLeft-1)&amp;&amp;(t=!0),t}}}Object.defineProperties(n,{freezeColumnItem:{get:function(){return o}},__esModule:{value:!0}})},{}],94:[function(e,t,n){&quot;use strict&quot;;function o(e){return{key:&quot;unfreeze_column&quot;,name:&quot;Unfreeze this column&quot;,callback:function(){var t=this.getSelectedRange().from.col;e.unfreezeColumn(t),this.render(),this.view.wt.wtOverlays.adjustElementsSize(!0)},hidden:function(){var e=this.getSelectedRange(),t=!1;return void 0===e?t=!0:(e.from.col!==e.to.col||e.from.col&gt;=this.getSettings().fixedColumnsLeft)&amp;&amp;(t=!0),t}}}Object.defineProperties(n,{unfreezeColumnItem:{get:function(){return o}},__esModule:{value:!0}})},{}],95:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ManualColumnFreeze:{get:function(){return g}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,d=(i=e(&quot;plugins&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).registerPlugin,h=(s=e(&quot;helpers/array&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).arrayEach,f=(a=e(&quot;contextMenuItem/freezeColumn&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).freezeColumnItem,p=(l=e(&quot;contextMenuItem/unfreezeColumn&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).unfreezeColumnItem,m=new WeakMap,g=function(e){$traceurRuntime.superConstructor(w).call(this,e),m.set(this,{moveByFreeze:!1,afterFirstUse:!1}),this.frozenColumnsBasePositions=[],this.manualColumnMovePlugin=void 0},w=g;$traceurRuntime.createClass(g,{isEnabled:function(){return!!this.hot.getSettings().manualColumnFreeze},enablePlugin:function(){var e=this;this.enabled||(this.addHook(&quot;afterContextMenuDefaultOptions&quot;,function(t){return e.addContextMenuEntry(t)}),this.addHook(&quot;afterInit&quot;,function(){return e.onAfterInit()}),this.addHook(&quot;beforeColumnMove&quot;,function(t,n){return e.onBeforeColumnMove(t,n)}),$traceurRuntime.superGet(this,w.prototype,&quot;enablePlugin&quot;).call(this))},disablePlugin:function(){var e=m.get(this);e.afterFirstUse=!1,e.moveByFreeze=!1,$traceurRuntime.superGet(this,w.prototype,&quot;disablePlugin&quot;).call(this)},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),$traceurRuntime.superGet(this,w.prototype,&quot;updatePlugin&quot;).call(this)},freezeColumn:function(e){var t=m.get(this),n=this.hot.getSettings();t.afterFirstUse||(t.afterFirstUse=!0),n.fixedColumnsLeft===this.hot.countCols()||e&lt;=n.fixedColumnsLeft-1||(t.moveByFreeze=!0,e!==this.getMovePlugin().columnsMapper.getValueByIndex(e)&amp;&amp;(this.frozenColumnsBasePositions[n.fixedColumnsLeft]=e),this.getMovePlugin().moveColumn(e,n.fixedColumnsLeft++))},unfreezeColumn:function(e){var t=m.get(this),n=this.hot.getSettings();if(t.afterFirstUse||(t.afterFirstUse=!0),!(n.fixedColumnsLeft&lt;=0||e&gt;n.fixedColumnsLeft-1)){var o=this.getBestColumnReturnPosition(e);t.moveByFreeze=!0,n.fixedColumnsLeft--,this.getMovePlugin().moveColumn(e,o+1)}},getMovePlugin:function(){return this.manualColumnMovePlugin||(this.manualColumnMovePlugin=this.hot.getPlugin(&quot;manualColumnMove&quot;)),this.manualColumnMovePlugin},getBestColumnReturnPosition:function(e){var t,n=this.getMovePlugin(),o=this.hot.getSettings(),r=o.fixedColumnsLeft,i=n.columnsMapper.getValueByIndex(r);if(null==this.frozenColumnsBasePositions[e])for(t=n.columnsMapper.getValueByIndex(e);i&lt;t;)r++,i=n.columnsMapper.getValueByIndex(r);else{for(t=this.frozenColumnsBasePositions[e],this.frozenColumnsBasePositions[e]=void 0;i&lt;=t;)r++,i=n.columnsMapper.getValueByIndex(r);r=i}return r-1},addContextMenuEntry:function(e){e.items.push(u.plugins.ContextMenu.SEPARATOR,f(this),p(this))},onAfterInit:function(){this.getMovePlugin().isEnabled()||this.getMovePlugin().enablePlugin()},onBeforeColumnMove:function(e,t){var n=m.get(this);if(n.afterFirstUse&amp;&amp;!n.moveByFreeze){var o=this.hot.getSettings().fixedColumnsLeft,r=t&lt;o;if(r||h(e,function(e,t,n){if(e&lt;o)return r=!0,!1}),r)return!1}n.moveByFreeze&amp;&amp;(n.moveByFreeze=!1)},destroy:function(){$traceurRuntime.superGet(this,w.prototype,&quot;destroy&quot;).call(this)}},{},c),d(&quot;manualColumnFreeze&quot;,g)},{_base:62,browser:24,&quot;contextMenuItem/freezeColumn&quot;:93,&quot;contextMenuItem/unfreezeColumn&quot;:94,&quot;helpers/array&quot;:43,plugins:61}],96:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ColumnsMapper:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,u=(r=e(&quot;mixins/arrayMapper&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayMapper,c=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayFilter,d=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).mixin,h=(a=e(&quot;helpers/number&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).rangeEach,f=function(e){this.manualColumnMove=e};$traceurRuntime.createClass(f,{createMap:function(e){var t=this,n=void 0===e?this._arrayMap.length:e;this._arrayMap.length=0,h(n-1,function(e){t._arrayMap[e]=e})},destroy:function(){this._arrayMap=null},moveColumn:function(e,t){var n=this._arrayMap[e];this._arrayMap[e]=null,this._arrayMap.splice(t,0,n)},clearNull:function(){this._arrayMap=c(this._arrayMap,function(e){return null!==e})}},{}),d(f,u),l.utils.ManualColumnMoveColumnsMapper=f},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;mixins/arrayMapper&quot;:57}],97:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ManualColumnMove:{get:function(){return D}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e(&quot;_base.js&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,p=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,m=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,g=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),w=g.addClass,v=g.removeClass,y=g.offset,b=(a=e(&quot;helpers/number&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).rangeEach,C=(l=e(&quot;eventManager&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).eventManager,_=(u=e(&quot;plugins&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).registerPlugin,R=(c=e(&quot;columnsMapper&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).ColumnsMapper,M=(d=e(&quot;ui/backlight&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).BacklightUI,S=(h=e(&quot;ui/guideline&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).GuidelineUI,E=new WeakMap,O=&quot;ht__manualColumnMove&quot;,T=&quot;show-ui&quot;,k=&quot;on-moving--columns&quot;,x=&quot;after-selection--columns&quot;,D=function(e){$traceurRuntime.superConstructor(H).call(this,e),E.set(this,{columnsToMove:[],countCols:0,fixedColumns:0,pressed:void 0,disallowMoving:void 0,target:{eventPageX:void 0,coords:void 0,TD:void 0,col:void 0}}),this.removedColumns=[],this.columnsMapper=new R(this),this.eventManager=C(this),this.backlight=new M(e),this.guideline=new S(e)},H=D;$traceurRuntime.createClass(D,{isEnabled:function(){return!!this.hot.getSettings().manualColumnMove},enablePlugin:function(){var e=this;this.enabled||(this.addHook(&quot;beforeOnCellMouseDown&quot;,function(t,n,o,r){return e.onBeforeOnCellMouseDown(t,n,o,r)}),this.addHook(&quot;beforeOnCellMouseOver&quot;,function(t,n,o,r){return e.onBeforeOnCellMouseOver(t,n,o,r)}),this.addHook(&quot;afterScrollVertically&quot;,function(){return e.onAfterScrollVertically()}),this.addHook(&quot;modifyCol&quot;,function(t,n){return e.onModifyCol(t,n)}),this.addHook(&quot;beforeRemoveCol&quot;,function(t,n){return e.onBeforeRemoveCol(t,n)}),this.addHook(&quot;afterRemoveCol&quot;,function(t,n){return e.onAfterRemoveCol(t,n)}),this.addHook(&quot;afterCreateCol&quot;,function(t,n){return e.onAfterCreateCol(t,n)}),this.addHook(&quot;unmodifyCol&quot;,function(t){return e.onUnmodifyCol(t)}),this.registerEvents(),w(this.hot.rootElement,O),$traceurRuntime.superGet(this,H.prototype,&quot;enablePlugin&quot;).call(this))},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),this.onAfterPluginsInitialized(),$traceurRuntime.superGet(this,H.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){var e=this.hot.getSettings().manualColumnMove;Array.isArray(e)&amp;&amp;this.columnsMapper.clearMap(),v(this.hot.rootElement,O),this.unregisterEvents(),this.backlight.destroy(),this.guideline.destroy(),$traceurRuntime.superGet(this,H.prototype,&quot;disablePlugin&quot;).call(this)},moveColumn:function(e,t){this.moveColumns([e],t)},moveColumns:function(e,t){var n=this,o=E.get(this),r=this.hot.runHooks(&quot;beforeColumnMove&quot;,e,t);o.disallowMoving=!r,r!==!1&amp;&amp;(m(e,function(e,t,o){o[t]=n.columnsMapper.getValueByIndex(e)}),m(e,function(e,o){var r=n.columnsMapper.getIndexByValue(e);r!==t&amp;&amp;n.columnsMapper.moveColumn(r,t+o)}),this.columnsMapper.clearNull()),this.hot.runHooks(&quot;afterColumnMove&quot;,e,t)},changeSelection:function(e,t){var n=this.hot.selection,o=this.hot.countRows()-1;n.setRangeStartOnly(new WalkontableCellCoords(0,e)),n.setRangeEnd(new WalkontableCellCoords(o,t),!1)},getColumnsWidth:function(e,t){for(var n=0,o=e;o&lt;t;o++){var r=0;r=o&lt;0?this.hot.view.wt.wtTable.getColumnWidth(o)||0:this.hot.view.wt.wtTable.getStretchedColumnWidth(o)||0,n+=r}return n},initialSettings:function(){var e=this.hot.getSettings().manualColumnMove;Array.isArray(e)?this.moveColumns(e,0):void 0!==e&amp;&amp;this.persistentStateLoad()},isFixedColumnsLeft:function(e){return e&lt;this.hot.getSettings().fixedColumnsLeft},persistentStateSave:function(){p.hooks.run(this.hot,&quot;persistentStateSave&quot;,&quot;manualColumnMove&quot;,this.columnsMapper._arrayMap)},persistentStateLoad:function(){var e={};p.hooks.run(this.hot,&quot;persistentStateLoad&quot;,&quot;manualColumnMove&quot;,e),e.value&amp;&amp;(this.columnsMapper._arrayMap=e.value)},prepareColumnsToMoving:function(e,t){var n=[];return b(e,t,function(e){n.push(e)}),n},refreshPositions:function(){var e=E.get(this),t=this.hot.view.wt.wtTable.getFirstVisibleColumn(),n=this.hot.view.wt.wtTable.getLastVisibleColumn(),o=this.hot.view.wt.wtTable,r=this.hot.view.wt.wtOverlays.scrollableElement,i=&quot;number&quot;==typeof r.scrollX?r.scrollX:r.scrollLeft,s=this.hot.view.THEAD.offsetLeft+this.getColumnsWidth(0,e.coordsColumn),a=e.target.eventPageX-(e.rootElementOffset-(void 0===r.scrollX?i:0)),l=o.hider.offsetWidth,u=o.TBODY.offsetLeft,c=this.backlight.getOffset().left,d=this.backlight.getSize().width,h=0;if(e.rootElementOffset+o.holder.offsetWidth+i&lt;e.target.eventPageX&amp;&amp;e.coordsColumn&lt;e.countCols&amp;&amp;e.coordsColumn++,e.hasRowHeaders&amp;&amp;(h=this.hot.view.wt.wtOverlays.leftOverlay.clone.wtTable.getColumnHeader(-1).offsetWidth),this.isFixedColumnsLeft(e.coordsColumn)&amp;&amp;(s+=i),s+=h,e.coordsColumn&lt;0)e.fixedColumns&gt;0?e.target.col=0:e.target.col=t&gt;0?t-1:t;else if(e.target.TD.offsetWidth/2+s&lt;=a){var f=e.coordsColumn&gt;=e.countCols?e.countCols-1:e.coordsColumn;e.target.col=f+1,s+=e.target.TD.offsetWidth,e.target.col&gt;n&amp;&amp;this.hot.scrollViewportTo(void 0,n+1,void 0,!0)}else e.target.col=e.coordsColumn,e.target.col&lt;=t&amp;&amp;e.target.col&gt;=e.fixedColumns&amp;&amp;this.hot.scrollViewportTo(void 0,t-1);e.target.col&lt;=t&amp;&amp;e.target.col&gt;=e.fixedColumns&amp;&amp;this.hot.scrollViewportTo(void 0,t-1);var p=a,m=s;a+d+c&gt;=l?p=l-d-c:a+c&lt;u+h&amp;&amp;(p=u+h+Math.abs(c)),s&gt;=l-1?m=l-1:0===m?m=1:void 0!==r.scrollX&amp;&amp;e.coordsColumn&lt;e.fixedColumns&amp;&amp;(m-=e.rootElementOffset&lt;=r.scrollX?e.rootElementOffset:0),this.backlight.setPosition(null,p),this.guideline.setPosition(null,m)},registerEvents:function(){var e=this;this.eventManager.addEventListener(document.documentElement,&quot;mousemove&quot;,function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(document.documentElement,&quot;mouseup&quot;,function(){return e.onMouseUp()})},unregisterEvents:function(){this.eventManager.clear()},onBeforeOnCellMouseDown:function(e,t,n,o){var r=this.hot.view.wt.wtTable,i=this.hot.selection.selectedHeader.cols,s=this.hot.getSelectedRange(),a=E.get(this),l=e.realTarget.className.indexOf(&quot;columnSorting&quot;)&gt;-1;if(!s||!i||a.pressed||0!==e.button||l)return a.pressed=!1,a.columnsToMove.length=0,void v(this.hot.rootElement,[k,T]);var u=this.guideline.isBuilt()&amp;&amp;!this.guideline.isAppended(),c=this.backlight.isBuilt()&amp;&amp;!this.backlight.isAppended();u&amp;&amp;c&amp;&amp;(this.guideline.appendTo(r.hider),this.backlight.appendTo(r.hider));var d=s,h=d.from,f=d.to,p=Math.min(h.col,f.col),m=Math.max(h.col,f.col);if(t.row&lt;0&amp;&amp;t.col&gt;=p&amp;&amp;t.col&lt;=m){o.column=!0,a.pressed=!0,a.target.eventPageX=e.pageX,a.coordsColumn=t.col,a.target.TD=n,a.target.col=t.col,a.columnsToMove=this.prepareColumnsToMoving(p,m),a.hasRowHeaders=!!this.hot.getSettings().rowHeaders,a.countCols=this.hot.countCols(),a.fixedColumns=this.hot.getSettings().fixedColumnsLeft,a.rootElementOffset=y(this.hot.rootElement).left;var g=a.hasRowHeaders?-1:0,b=r.holder.scrollTop+r.getColumnHeaderHeight(0)+1,C=t.col&lt;a.fixedColumns,_=this.hot.view.wt.wtOverlays.scrollableElement,R=_.scrollX?_.scrollX-a.rootElementOffset:0,M=e.layerX-(C?R:0),S=Math.abs(this.getColumnsWidth(p,t.col)+M);this.backlight.setPosition(b,this.getColumnsWidth(g,p)+S),this.backlight.setSize(this.getColumnsWidth(p,m+1),r.hider.offsetHeight-b),this.backlight.setOffset(null,S*-1),w(this.hot.rootElement,k)}else v(this.hot.rootElement,x),a.pressed=!1,a.columnsToMove.length=0},onMouseMove:function(e){var t=E.get(this);if(t.pressed){if(e.realTarget===this.backlight.element){var n=this.backlight.getSize().width;this.backlight.setSize(0),setTimeout(function(){this.backlight.setPosition(n)})}t.target.eventPageX=e.pageX,this.refreshPositions()}},onBeforeOnCellMouseOver:function(e,t,n,o){var r=this.hot.getSelectedRange(),i=E.get(this);r&amp;&amp;i.pressed&amp;&amp;(i.columnsToMove.indexOf(t.col)&gt;-1?v(this.hot.rootElement,T):w(this.hot.rootElement,T),o.row=!0,o.column=!0,o.cell=!0,i.coordsColumn=t.col,i.target.TD=n)},onMouseUp:function(){var e=E.get(this);if(e.coordsColumn=void 0,e.pressed=!1,e.backlightWidth=0,v(this.hot.rootElement,[k,T,x]),this.hot.selection.selectedHeader.cols&amp;&amp;w(this.hot.rootElement,x),!(e.columnsToMove.length&lt;1||void 0===e.target.col||e.columnsToMove.indexOf(e.target.col)&gt;-1)){
if(this.moveColumns(e.columnsToMove,e.target.col),this.persistentStateSave(),this.hot.render(),this.hot.view.wt.wtOverlays.adjustElementsSize(!0),!e.disallowMoving){var t=this.columnsMapper.getIndexByValue(e.columnsToMove[0]),n=this.columnsMapper.getIndexByValue(e.columnsToMove[e.columnsToMove.length-1]);this.changeSelection(t,n)}e.columnsToMove.length=0}},onAfterScrollVertically:function(){var e=this.hot.view.wt.wtTable,t=e.getColumnHeaderHeight(0)+1,n=e.holder.scrollTop,o=t+n;this.backlight.setPosition(o),this.backlight.setSize(null,e.hider.offsetHeight-o)},onAfterCreateCol:function(e,t){this.columnsMapper.shiftItems(e,t)},onBeforeRemoveCol:function(e,t){var n=this;this.removedColumns.length=0,e!==!1&amp;&amp;b(e,e+t-1,function(e){n.removedColumns.push(n.hot.runHooks(&quot;modifyCol&quot;,e,n.pluginName))})},onAfterRemoveCol:function(e,t){this.columnsMapper.unshiftItems(this.removedColumns)},onModifyCol:function(e,t){if(t!==this.pluginName){var n=this.columnsMapper.getValueByIndex(e);e=null===n?e:n}return e},onUnmodifyCol:function(e){var t=this.columnsMapper.getIndexByValue(e);return e=null===t?e:t},onAfterPluginsInitialized:function(){var e=this.hot.countCols(),t=this.columnsMapper._arrayMap.length;if(0===t)this.columnsMapper.createMap(this.hot.countSourceCols()||this.hot.getSettings().startCols);else if(t&lt;e){var n=e-t;this.columnsMapper.insertItems(t,n)}else if(t&gt;e){var o=e-1,r=[];m(this.columnsMapper._arrayMap,function(e,t,n){e&gt;o&amp;&amp;r.push(t)}),this.columnsMapper.removeItems(r)}this.initialSettings(),this.backlight.build(),this.guideline.build()},destroy:function(){this.backlight.destroy(),this.guideline.destroy(),$traceurRuntime.superGet(this,H.prototype,&quot;destroy&quot;).call(this)}},{},f),_(&quot;ManualColumnMove&quot;,D),p.hooks.register(&quot;beforeColumnMove&quot;),p.hooks.register(&quot;afterColumnMove&quot;),p.hooks.register(&quot;unmodifyCol&quot;)},{&quot;_base.js&quot;:62,browser:24,columnsMapper:96,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/number&quot;:52,plugins:61,&quot;ui/backlight&quot;:99,&quot;ui/guideline&quot;:100}],98:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{BaseUI:{get:function(){return u}},__esModule:{value:!0}});var o,r=(o=e(&quot;helpers/number&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).isNumeric,i=0,s=1,a=2,l=&quot;px&quot;,u=function(e){this.hot=e,this._element=null,this.state=i};$traceurRuntime.createClass(u,{appendTo:function(e){e.appendChild(this._element),this.state=a},build:function(){this._element=document.createElement(&quot;div&quot;),this.state=s},destroy:function(){this.isAppended()&amp;&amp;this._element.parentElement.removeChild(this._element),this._element=null,this.state=i},isAppended:function(){return this.state===a},isBuilt:function(){return this.state&gt;=s},setPosition:function(e,t){r(e)&amp;&amp;(this._element.style.top=e+l),r(t)&amp;&amp;(this._element.style.left=t+l)},getPosition:function(){return{top:this._element.style.top?parseInt(this._element.style.top,10):0,left:this._element.style.left?parseInt(this._element.style.left,10):0}},setSize:function(e,t){r(e)&amp;&amp;(this._element.style.width=e+l),r(t)&amp;&amp;(this._element.style.height=t+l)},getSize:function(){return{width:this._element.style.width?parseInt(this._element.style.width,10):0,height:this._element.style.height?parseInt(this._element.style.height,10):0}},setOffset:function(e,t){r(e)&amp;&amp;(this._element.style.marginTop=e+l),r(t)&amp;&amp;(this._element.style.marginLeft=t+l)},getOffset:function(){return{top:this._element.style.marginTop?parseInt(this._element.style.marginTop,10):0,left:this._element.style.marginLeft?parseInt(this._element.style.marginLeft,10):0}}},{})},{&quot;helpers/number&quot;:52}],99:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{BacklightUI:{get:function(){return l}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).BaseUI,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).addClass,a=&quot;ht__manualColumnMove--backlight&quot;,l=function(e){$traceurRuntime.superConstructor(u).call(this,e)},u=l;$traceurRuntime.createClass(l,{build:function(){$traceurRuntime.superGet(this,u.prototype,&quot;build&quot;).call(this),s(this._element,a)}},{},i)},{_base:98,&quot;helpers/dom/element&quot;:47}],100:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{GuidelineUI:{get:function(){return l}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).BaseUI,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).addClass,a=&quot;ht__manualColumnMove--guideline&quot;,l=function(e){$traceurRuntime.superConstructor(u).call(this,e)},u=l;$traceurRuntime.createClass(l,{build:function(){$traceurRuntime.superGet(this,u.prototype,&quot;build&quot;).call(this),s(this._element,a)}},{},i)},{_base:98,&quot;helpers/dom/element&quot;:47}],101:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ManualColumnResize:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,h=(r=e(&quot;_base.js&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,f=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerHeight,v=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).eventManager,y=(a=e(&quot;helpers/dom/event&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),b=y.pageX,C=(y.pageY,(l=e(&quot;helpers/array&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).arrayEach),_=(u=e(&quot;helpers/number&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).rangeEach,R=(c=e(&quot;plugins&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).registerPlugin,M=function(e){$traceurRuntime.superConstructor(S).call(this,e),this.currentTH=null,this.currentCol=null,this.selectedCols=[],this.currentWidth=null,this.newSize=null,this.startY=null,this.startWidth=null,this.startOffset=null,this.handle=document.createElement(&quot;DIV&quot;),this.guide=document.createElement(&quot;DIV&quot;),this.eventManager=v(this),this.pressed=null,this.dblclick=0,this.autoresizeTimeout=null,this.manualColumnWidths=[],p(this.handle,&quot;manualColumnResizer&quot;),p(this.guide,&quot;manualColumnResizerGuide&quot;)},S=M;$traceurRuntime.createClass(M,{isEnabled:function(){return this.hot.getSettings().manualColumnResize},enablePlugin:function(){var e=this;if(!this.enabled){this.manualColumnWidths=[];var t=this.hot.getSettings().manualColumnResize,n=this.loadManualColumnWidths();this.addHook(&quot;modifyColWidth&quot;,function(t,n){return e.onModifyColWidth(t,n)}),this.addHook(&quot;beforeStretchingColumnWidth&quot;,function(t,n){return e.onBeforeStretchingColumnWidth(t,n)}),this.addHook(&quot;beforeColumnResize&quot;,function(t,n,o){return e.onBeforeColumnResize(t,n,o)}),&quot;undefined&quot;!=typeof n?this.manualColumnWidths=n:Array.isArray(t)?this.manualColumnWidths=t:this.manualColumnWidths=[],d.hooks.register(&quot;beforeColumnResize&quot;),d.hooks.register(&quot;afterColumnResize&quot;),this.bindEvents(),$traceurRuntime.superGet(this,S.prototype,&quot;enablePlugin&quot;).call(this)}},updatePlugin:function(){var e=this.hot.getSettings().manualColumnResize;Array.isArray(e)?this.manualColumnWidths=e:e||(this.manualColumnWidths=[])},disablePlugin:function(){$traceurRuntime.superGet(this,S.prototype,&quot;disablePlugin&quot;).call(this)},saveManualColumnWidths:function(){this.hot.runHooks(&quot;persistentStateSave&quot;,&quot;manualColumnWidths&quot;,this.manualColumnWidths)},loadManualColumnWidths:function(){var e={};return this.hot.runHooks(&quot;persistentStateLoad&quot;,&quot;manualColumnWidths&quot;,e),e.value},setupHandlePosition:function(e){var t=this;if(!e.parentNode)return!1;this.currentTH=e;var n=this.hot.view.wt.wtTable.getCoords(e).col,o=w(this.currentTH);if(n&gt;=0){var r=this.currentTH.getBoundingClientRect();if(this.currentCol=n,this.selectedCols=[],this.hot.selection.isSelected()&amp;&amp;this.hot.selection.selectedHeader.cols){var i=this.hot.getSelectedRange(),s=i.from,a=i.to,l=s.col,u=a.col;l&gt;=u&amp;&amp;(l=a.col,u=s.col),this.currentCol&gt;=l&amp;&amp;this.currentCol&lt;=u?_(l,u,function(e){return t.selectedCols.push(e)}):this.selectedCols.push(this.currentCol)}else this.selectedCols.push(this.currentCol);this.startOffset=r.left-6,this.startWidth=parseInt(r.width,10),this.handle.style.top=r.top+&quot;px&quot;,this.handle.style.left=this.startOffset+this.startWidth+&quot;px&quot;,this.handle.style.height=o+&quot;px&quot;,this.hot.rootElement.appendChild(this.handle)}},refreshHandlePosition:function(){this.handle.style.left=this.startOffset+this.currentWidth+&quot;px&quot;},setupGuidePosition:function(){var e=parseInt(w(this.handle),10),t=parseInt(this.handle.style.top,10)+e,n=parseInt(this.hot.view.maximumVisibleElementHeight(0),10);p(this.handle,&quot;active&quot;),p(this.guide,&quot;active&quot;),this.guide.style.top=t+&quot;px&quot;,this.guide.style.left=this.handle.style.left,this.guide.style.height=n-e+&quot;px&quot;,this.hot.rootElement.appendChild(this.guide)},refreshGuidePosition:function(){this.guide.style.left=this.handle.style.left},hideHandleAndGuide:function(){g(this.handle,&quot;active&quot;),g(this.guide,&quot;active&quot;)},checkIfColumnHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return&quot;THEAD&quot;===t.tagName||this.checkIfColumnHeader(t)}return!1},getTHFromTargetElement:function(e){return&quot;TABLE&quot;!=e.tagName?&quot;TH&quot;==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},onMouseOver:function(e){if(this.checkIfColumnHeader(e.target)){var t=this.getTHFromTargetElement(e.target);if(!t)return;var n=t.getAttribute(&quot;colspan&quot;);!t||null!==n&amp;&amp;1!==n||this.pressed||this.setupHandlePosition(t)}},afterMouseDownTimeout:function(){var e=this,t=function(){e.hot.forceFullRender=!0,e.hot.view.render(),e.hot.view.wt.wtOverlays.adjustElementsSize(!0)},n=function(n,o){var r=e.hot.runHooks(&quot;beforeColumnResize&quot;,n,e.newSize,!0);void 0!==r&amp;&amp;(e.newSize=r),&quot;all&quot;===e.hot.getSettings().stretchH?e.clearManualSize(n):e.setManualSize(n,e.newSize),o&amp;&amp;t(),e.saveManualColumnWidths(),e.hot.runHooks(&quot;afterColumnResize&quot;,n,e.newSize,!0)};if(this.dblclick&gt;=2){var o=this.selectedCols.length;o&gt;1?(C(this.selectedCols,function(e){n(e)}),t()):C(this.selectedCols,function(e){n(e,!0)})}this.dblclick=0,this.autoresizeTimeout=null},onMouseDown:function(e){var t=this;m(e.target,&quot;manualColumnResizer&quot;)&amp;&amp;(this.setupGuidePosition(),this.pressed=this.hot,null===this.autoresizeTimeout&amp;&amp;(this.autoresizeTimeout=setTimeout(function(){return t.afterMouseDownTimeout()},500),this.hot._registerTimeout(this.autoresizeTimeout)),this.dblclick++,this.startX=b(e),this.newSize=this.startWidth)},onMouseMove:function(e){var t=this;this.pressed&amp;&amp;(this.currentWidth=this.startWidth+(b(e)-this.startX),C(this.selectedCols,function(e){t.newSize=t.setManualSize(e,t.currentWidth)}),this.refreshHandlePosition(),this.refreshGuidePosition())},onMouseUp:function(e){var t=this,n=function(){t.hot.forceFullRender=!0,t.hot.view.render(),t.hot.view.wt.wtOverlays.adjustElementsSize(!0)},o=function(e,o){t.hot.runHooks(&quot;beforeColumnResize&quot;,e,t.newSize),o&amp;&amp;n(),t.saveManualColumnWidths(),t.hot.runHooks(&quot;afterColumnResize&quot;,e,t.newSize)};if(this.pressed){if(this.hideHandleAndGuide(),this.pressed=!1,this.newSize!=this.startWidth){var r=this.selectedCols.length;r&gt;1?(C(this.selectedCols,function(e){o(e)}),n()):C(this.selectedCols,function(e){o(e,!0)})}this.setupHandlePosition(this.currentTH)}},bindEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,&quot;mouseover&quot;,function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,&quot;mousedown&quot;,function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,&quot;mousemove&quot;,function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,&quot;mouseup&quot;,function(t){return e.onMouseUp(t)})},setManualSize:function(e,t){return t=Math.max(t,20),e=this.hot.runHooks(&quot;modifyCol&quot;,e),this.manualColumnWidths[e]=t,t},clearManualSize:function(e){e=this.hot.runHooks(&quot;modifyCol&quot;,e),this.manualColumnWidths[e]=void 0},onModifyColWidth:function(e,t){return this.enabled&amp;&amp;(t=this.hot.runHooks(&quot;modifyCol&quot;,t),this.hot.getSettings().manualColumnResize&amp;&amp;this.manualColumnWidths[t])?this.manualColumnWidths[t]:e},onBeforeStretchingColumnWidth:function(e,t){var n=this.manualColumnWidths[t];return void 0===n&amp;&amp;(n=e),n},onBeforeColumnResize:function(){this.hot.view.wt.wtViewport.hasOversizedColumnHeadersMarked={}}},{},h),R(&quot;manualColumnResize&quot;,M)},{&quot;_base.js&quot;:62,browser:24,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/number&quot;:52,plugins:61}],102:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ManualRowMove:{get:function(){return D}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d,h,f=(o=e(&quot;_base.js&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,p=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,m=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,g=(s=e(&quot;helpers/dom/element&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),w=g.addClass,v=g.removeClass,y=g.offset,b=(a=e(&quot;helpers/number&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).rangeEach,C=(l=e(&quot;eventManager&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).eventManager,_=(u=e(&quot;plugins&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).registerPlugin,R=(c=e(&quot;rowsMapper&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).RowsMapper,M=(d=e(&quot;ui/backlight&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).BacklightUI,S=(h=e(&quot;ui/guideline&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).GuidelineUI,E=new WeakMap,O=&quot;ht__manualRowMove&quot;,T=&quot;show-ui&quot;,k=&quot;on-moving--rows&quot;,x=&quot;after-selection--rows&quot;,D=function(e){$traceurRuntime.superConstructor(H).call(this,e),E.set(this,{rowsToMove:[],pressed:void 0,disallowMoving:void 0,target:{eventPageY:void 0,coords:void 0,TD:void 0,row:void 0}}),this.removedRows=[],this.rowsMapper=new R(this),this.eventManager=C(this),this.backlight=new M(e),this.guideline=new S(e)},H=D;$traceurRuntime.createClass(D,{isEnabled:function(){return!!this.hot.getSettings().manualRowMove},enablePlugin:function(){var e=this;this.enabled||(this.addHook(&quot;beforeOnCellMouseDown&quot;,function(t,n,o,r){return e.onBeforeOnCellMouseDown(t,n,o,r)}),this.addHook(&quot;beforeOnCellMouseOver&quot;,function(t,n,o,r){return e.onBeforeOnCellMouseOver(t,n,o,r)}),this.addHook(&quot;afterScrollHorizontally&quot;,function(){return e.onAfterScrollHorizontally()}),this.addHook(&quot;modifyRow&quot;,function(t,n){return e.onModifyRow(t,n)}),this.addHook(&quot;beforeRemoveRow&quot;,function(t,n){return e.onBeforeRemoveRow(t,n)}),this.addHook(&quot;afterRemoveRow&quot;,function(t,n){return e.onAfterRemoveRow(t,n)}),this.addHook(&quot;afterCreateRow&quot;,function(t,n){return e.onAfterCreateRow(t,n)}),this.addHook(&quot;afterLoadData&quot;,function(t){return e.onAfterLoadData(t)}),this.addHook(&quot;beforeColumnSort&quot;,function(t,n){return e.onBeforeColumnSort(t,n)}),this.addHook(&quot;unmodifyRow&quot;,function(t){return e.onUnmodifyRow(t)}),this.registerEvents(),w(this.hot.rootElement,O),$traceurRuntime.superGet(this,H.prototype,&quot;enablePlugin&quot;).call(this))},updatePlugin:function(){this.disablePlugin(),this.enablePlugin(),this.onAfterPluginsInitialized(),$traceurRuntime.superGet(this,H.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){var e=this.hot.getSettings().manualRowMove;Array.isArray(e)&amp;&amp;this.rowsMapper.clearMap(),v(this.hot.rootElement,O),this.unregisterEvents(),this.backlight.destroy(),this.guideline.destroy(),$traceurRuntime.superGet(this,H.prototype,&quot;disablePlugin&quot;).call(this)},moveRow:function(e,t){this.moveRows([e],t)},moveRows:function(e,t){var n=this,o=E.get(this),r=this.hot.runHooks(&quot;beforeRowMove&quot;,e,t);o.disallowMoving=r===!1,o.disallowMoving||(m(e,function(e,t,o){o[t]=n.rowsMapper.getValueByIndex(e)}),m(e,function(e,o){var r=n.rowsMapper.getIndexByValue(e);r!==t&amp;&amp;n.rowsMapper.moveRow(r,t+o)}),this.rowsMapper.clearNull()),this.hot.runHooks(&quot;afterRowMove&quot;,e,t)},changeSelection:function(e,t){var n=this.hot.selection,o=this.hot.countCols()-1;n.setRangeStartOnly(new WalkontableCellCoords(e,0)),n.setRangeEnd(new WalkontableCellCoords(t,o),!1)},getRowsHeight:function(e,t){for(var n=0,o=e;o&lt;t;o++){var r=this.hot.view.wt.wtTable.getRowHeight(o)||23;n+=r}return n},initialSettings:function(){var e=this.hot.getSettings().manualRowMove;if(Array.isArray(e))this.moveRows(e,0);else if(void 0!==e){var t=this.persistentStateLoad();t.length&amp;&amp;this.moveRows(t,0)}},isFixedRowTop:function(e){return e&lt;this.hot.getSettings().fixedRowsTop},isFixedRowBottom:function(e){return e&gt;this.hot.getSettings().fixedRowsBottom},persistentStateSave:function(){p.hooks.run(this.hot,&quot;persistentStateSave&quot;,&quot;manualRowMove&quot;,this.rowsMapper._arrayMap)},persistentStateLoad:function(){var e={};return p.hooks.run(this.hot,&quot;persistentStateLoad&quot;,&quot;manualRowMove&quot;,e),e.value?e.value:[]},prepareRowsToMoving:function(){var e=this.hot.getSelectedRange(),t=[];if(!e)return t;var n=e,o=n.from,r=n.to,i=Math.min(o.row,r.row),s=Math.max(o.row,r.row);return b(i,s,function(e){t.push(e)}),t},refreshPositions:function(){var e=E.get(this),t=e.target.coords,n=this.hot.view.wt.wtTable.getFirstVisibleRow(),o=this.hot.view.wt.wtTable.getLastVisibleRow(),r=this.hot.getSettings().fixedRowsTop,i=this.hot.countRows();t.row&lt;r&amp;&amp;n&gt;0&amp;&amp;this.hot.scrollViewportTo(n-1),t.row&gt;=o&amp;&amp;o&lt;i&amp;&amp;this.hot.scrollViewportTo(o+1,void 0,!0);var s=this.hot.view.wt.wtTable,a=e.target.TD,l=y(this.hot.rootElement),u=this.hot.view.THEAD.offsetHeight+this.getRowsHeight(0,t.row),c=e.target.eventPageY-l.top+s.holder.scrollTop,d=s.hider.offsetHeight,h=s.TBODY.offsetTop,f=this.backlight.getOffset().top,p=this.backlight.getSize().height;l.top+s.holder.offsetHeight&lt;e.target.eventPageY&amp;&amp;e.target.coords.row++,this.isFixedRowTop(t.row)&amp;&amp;(u+=s.holder.scrollTop),t.row&lt;0?e.target.row=n&gt;0?n-1:n:a.offsetHeight/2+u&lt;=c?(e.target.row=t.row+1,u+=0===t.row?a.offsetHeight-1:a.offsetHeight):e.target.row=t.row;var m=c,g=u;c+p+f&gt;=d?m=d-p-f:c+f&lt;h&amp;&amp;(m=h+Math.abs(f)),u&gt;=d-1&amp;&amp;(g=d-1);var w=0;this.hot.view.wt.wtOverlays.topOverlay&amp;&amp;(w=this.hot.view.wt.wtOverlays.topOverlay.clone.wtTable.TABLE.offsetHeight),t.row&gt;=r&amp;&amp;g-s.holder.scrollTop&lt;w&amp;&amp;this.hot.scrollViewportTo(t.row),this.backlight.setPosition(m),this.guideline.setPosition(g)},updateRowsMapper:function(){var e=this.hot.countSourceRows(),t=this.rowsMapper._arrayMap.length;if(0===t)this.rowsMapper.createMap(e||this.hot.getSettings().startRows);else if(t&lt;e){var n=e-t;this.rowsMapper.insertItems(t,n)}else if(t&gt;e){var o=e-1,r=[];m(this.rowsMapper._arrayMap,function(e,t,n){e&gt;o&amp;&amp;r.push(t)}),this.rowsMapper.removeItems(r)}},registerEvents:function(){var e=this;this.eventManager.addEventListener(document.documentElement,&quot;mousemove&quot;,function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(document.documentElement,&quot;mouseup&quot;,function(){return e.onMouseUp()})},unregisterEvents:function(){this.eventManager.clear()},onBeforeColumnSort:function(e,t){var n=E.get(this);n.disallowMoving=void 0!==t},onBeforeOnCellMouseDown:function(e,t,n,o){var r=this.hot.view.wt.wtTable,i=this.hot.selection.selectedHeader.rows,s=this.hot.getSelectedRange(),a=E.get(this);if(!s||!i||a.pressed||0!==e.button)return a.pressed=!1,a.rowsToMove.length=0,void v(this.hot.rootElement,[k,T]);var l=this.guideline.isBuilt()&amp;&amp;!this.guideline.isAppended(),u=this.backlight.isBuilt()&amp;&amp;!this.backlight.isAppended();l&amp;&amp;u&amp;&amp;(this.guideline.appendTo(r.hider),this.backlight.appendTo(r.hider));var c=s,d=c.from,h=c.to,f=Math.min(d.row,h.row),p=Math.max(d.row,h.row);if(t.col&lt;0&amp;&amp;t.row&gt;=f&amp;&amp;t.row&lt;=p){o.row=!0,a.pressed=!0,a.target.eventPageY=e.pageY,a.target.coords=t,a.target.TD=n,a.rowsToMove=this.prepareRowsToMoving();var m=r.holder.scrollLeft+r.getColumnWidth(-1);this.backlight.setPosition(null,m),this.backlight.setSize(r.hider.offsetWidth-m,this.getRowsHeight(f,p+1)),this.backlight.setOffset((this.getRowsHeight(f,t.row)+e.layerY)*-1,null),w(this.hot.rootElement,k),this.refreshPositions()}else v(this.hot.rootElement,x),a.pressed=!1,a.rowsToMove.length=0},onMouseMove:function(e){var t=E.get(this);if(t.pressed){if(e.realTarget===this.backlight.element){var n=this.backlight.getSize().height;this.backlight.setSize(null,0),setTimeout(function(){this.backlight.setPosition(null,n)})}t.target.eventPageY=e.pageY,this.refreshPositions()}},onBeforeOnCellMouseOver:function(e,t,n,o){var r=this.hot.getSelectedRange(),i=E.get(this);r&amp;&amp;i.pressed&amp;&amp;(i.rowsToMove.indexOf(t.row)&gt;-1?v(this.hot.rootElement,T):w(this.hot.rootElement,T),o.row=!0,o.column=!0,o.cell=!0,i.target.coords=t,i.target.TD=n)},onMouseUp:function(){var e=E.get(this),t=e.target.row,n=e.rowsToMove.length;if(e.pressed=!1,e.backlightHeight=0,v(this.hot.rootElement,[k,T,x]),this.hot.selection.selectedHeader.rows&amp;&amp;w(this.hot.rootElement,x),!(n&lt;1||void 0===t||e.rowsToMove.indexOf(t)&gt;-1||e.rowsToMove[n-1]===t-1)){if(this.moveRows(e.rowsToMove,t),this.persistentStateSave(),this.hot.render(),!e.disallowMoving){var o=this.rowsMapper.getIndexByValue(e.rowsToMove[0]),r=this.rowsMapper.getIndexByValue(e.rowsToMove[n-1]);this.changeSelection(o,r)}e.rowsToMove.length=0}},onAfterScrollHorizontally:function(){var e=this.hot.view.wt.wtTable,t=e.getColumnWidth(-1),n=e.holder.scrollLeft,o=t+n;this.backlight.setPosition(null,o),this.backlight.setSize(e.hider.offsetWidth-o)},onAfterCreateRow:function(e,t){this.rowsMapper.shiftItems(e,t)},onBeforeRemoveRow:function(e,t){var n=this;this.removedRows.length=0,e!==!1&amp;&amp;b(e,e+t-1,function(e){n.removedRows.push(n.hot.runHooks(&quot;modifyRow&quot;,e,n.pluginName))})},onAfterRemoveRow:function(e,t){this.rowsMapper.unshiftItems(this.removedRows)},onAfterLoadData:function(e){this.updateRowsMapper()},onModifyRow:function(e,t){if(t!==this.pluginName){var n=this.rowsMapper.getValueByIndex(e);e=null===n?e:n}return e},onUnmodifyRow:function(e){var t=this.rowsMapper.getIndexByValue(e);return null===t?e:t},onAfterPluginsInitialized:function(){this.updateRowsMapper(),this.initialSettings(),this.backlight.build(),this.guideline.build()},destroy:function(){this.backlight.destroy(),this.guideline.destroy(),$traceurRuntime.superGet(this,H.prototype,&quot;destroy&quot;).call(this)}},{},f),_(&quot;ManualRowMove&quot;,D),p.hooks.register(&quot;beforeRowMove&quot;),p.hooks.register(&quot;afterRowMove&quot;),p.hooks.register(&quot;unmodifyRow&quot;)},{&quot;_base.js&quot;:62,browser:24,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/number&quot;:52,plugins:61,rowsMapper:103,&quot;ui/backlight&quot;:105,&quot;ui/guideline&quot;:106}],103:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{RowsMapper:{get:function(){return f}},__esModule:{value:!0}});var o,r,i,s,a,l=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,u=(r=e(&quot;mixins/arrayMapper&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).arrayMapper,c=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayFilter,d=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).mixin,h=(a=e(&quot;helpers/number&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).rangeEach,f=function(e){this.manualRowMove=e};$traceurRuntime.createClass(f,{createMap:function(e){var t=this,n=void 0===e?this._arrayMap.length:e;this._arrayMap.length=0,h(n-1,function(e){t._arrayMap[e]=e})},destroy:function(){this._arrayMap=null},moveRow:function(e,t){var n=this._arrayMap[e];this._arrayMap[e]=null,this._arrayMap.splice(t,0,n)},clearNull:function(){this._arrayMap=c(this._arrayMap,function(e){return null!==e})}},{}),d(f,u),l.utils.ManualRowMoveRowsMapper=f},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53,&quot;mixins/arrayMapper&quot;:57}],104:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{BaseUI:{get:function(){return a}},__esModule:{value:!0}});var o=0,r=1,i=2,s=&quot;px&quot;,a=function(e){this.hot=e,this._element=null,this.state=o};$traceurRuntime.createClass(a,{appendTo:function(e){e.appendChild(this._element),this.state=i},build:function(){this._element=document.createElement(&quot;div&quot;),this.state=r},destroy:function(){this.isAppended()&amp;&amp;this._element.parentElement.removeChild(this._element),this._element=null,this.state=o},isAppended:function(){return this.state===i},isBuilt:function(){return this.state&gt;=r},setPosition:function(e,t){e&amp;&amp;(this._element.style.top=e+s),t&amp;&amp;(this._element.style.left=t+s)},getPosition:function(){return{top:this._element.style.top?parseInt(this._element.style.top,10):0,left:this._element.style.left?parseInt(this._element.style.left,10):0}},setSize:function(e,t){e&amp;&amp;(this._element.style.width=e+s),t&amp;&amp;(this._element.style.height=t+s)},getSize:function(){return{width:this._element.style.width?parseInt(this._element.style.width,10):0,height:this._element.style.height?parseInt(this._element.style.height,10):0}},setOffset:function(e,t){e&amp;&amp;(this._element.style.marginTop=e+s),t&amp;&amp;(this._element.style.marginLeft=t+s)},getOffset:function(){return{top:this._element.style.marginTop?parseInt(this._element.style.marginTop,10):0,left:this._element.style.marginLeft?parseInt(this._element.style.marginLeft,10):0}}},{})},{}],105:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{BacklightUI:{get:function(){return l}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).BaseUI,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).addClass,a=&quot;ht__manualRowMove--backlight&quot;,l=function(e){$traceurRuntime.superConstructor(u).call(this,e)},u=l;$traceurRuntime.createClass(l,{build:function(){$traceurRuntime.superGet(this,u.prototype,&quot;build&quot;).call(this),s(this._element,a)}},{},i)},{_base:104,&quot;helpers/dom/element&quot;:47}],106:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{GuidelineUI:{get:function(){return l}},__esModule:{value:!0}});var o,r,i=(o=e(&quot;_base&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).BaseUI,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).addClass,a=&quot;ht__manualRowMove--guideline&quot;,l=function(e){$traceurRuntime.superConstructor(u).call(this,e)},u=l;$traceurRuntime.createClass(l,{build:function(){$traceurRuntime.superGet(this,u.prototype,&quot;build&quot;).call(this),s(this._element,a)}},{},i)},{_base:104,&quot;helpers/dom/element&quot;:47}],107:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ManualRowResize:{get:function(){return M}},__esModule:{value:!0}});var o,r,i,s,a,l,u,c,d=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,h=(r=e(&quot;_base.js&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,f=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),p=f.addClass,m=f.hasClass,g=f.removeClass,w=f.outerWidth,v=(s=e(&quot;eventManager&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).eventManager,y=(a=e(&quot;helpers/dom/event&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),b=(y.pageX,y.pageY),C=(l=e(&quot;helpers/array&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).arrayEach,_=(u=e(&quot;helpers/number&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).rangeEach,R=(c=e(&quot;plugins&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).registerPlugin,M=function(e){$traceurRuntime.superConstructor(S).call(this,e),this.currentTH=null,this.currentRow=null,this.selectedRows=[],this.currentHeight=null,this.newSize=null,this.startY=null,this.startHeight=null,this.startOffset=null,this.handle=document.createElement(&quot;DIV&quot;),this.guide=document.createElement(&quot;DIV&quot;),this.eventManager=v(this),this.pressed=null,this.dblclick=0,this.autoresizeTimeout=null,this.manualRowHeights=[],p(this.handle,&quot;manualRowResizer&quot;),p(this.guide,&quot;manualRowResizerGuide&quot;)},S=M;$traceurRuntime.createClass(M,{isEnabled:function(){return this.hot.getSettings().manualRowResize},enablePlugin:function(){var e=this;if(!this.enabled){this.manualRowHeights=[];var t=this.hot.getSettings().manualRowResize,n=this.loadManualRowHeights();&quot;undefined&quot;!=typeof n?this.manualRowHeights=n:Array.isArray(t)?this.manualRowHeights=t:this.manualRowHeights=[],this.addHook(&quot;modifyRowHeight&quot;,function(t,n){return e.onModifyRowHeight(t,n)}),d.hooks.register(&quot;beforeRowResize&quot;),d.hooks.register(&quot;afterRowResize&quot;),this.bindEvents(),$traceurRuntime.superGet(this,S.prototype,&quot;enablePlugin&quot;).call(this)}},updatePlugin:function(){var e=this.hot.getSettings().manualRowResize;Array.isArray(e)?this.manualRowHeights=e:e||(this.manualRowHeights=[])},disablePlugin:function(){$traceurRuntime.superGet(this,S.prototype,&quot;disablePlugin&quot;).call(this)},saveManualRowHeights:function(){this.hot.runHooks(&quot;persistentStateSave&quot;,&quot;manualRowHeights&quot;,this.manualRowHeights)},loadManualRowHeights:function(){var e={};return this.hot.runHooks(&quot;persistentStateLoad&quot;,&quot;manualRowHeights&quot;,e),e.value},setupHandlePosition:function(e){var t=this;this.currentTH=e;var n=this.hot.view.wt.wtTable.getCoords(e).row,o=w(this.currentTH);if(n&gt;=0){var r=this.currentTH.getBoundingClientRect();if(this.currentRow=n,this.selectedRows=[],this.hot.selection.isSelected()&amp;&amp;this.hot.selection.selectedHeader.rows){var i=this.hot.getSelectedRange(),s=i.from,a=i.to,l=s.row,u=a.row;l&gt;=u&amp;&amp;(l=a.row,u=s.row),this.currentRow&gt;=l&amp;&amp;this.currentRow&lt;=u?_(l,u,function(e){return t.selectedRows.push(e)}):this.selectedRows.push(this.currentRow)}else this.selectedRows.push(this.currentRow);this.startOffset=r.top-6,this.startHeight=parseInt(r.height,10),this.handle.style.left=r.left+&quot;px&quot;,this.handle.style.top=this.startOffset+this.startHeight+&quot;px&quot;,this.handle.style.width=o+&quot;px&quot;,this.hot.rootElement.appendChild(this.handle)}},refreshHandlePosition:function(){this.handle.style.top=this.startOffset+this.currentHeight+&quot;px&quot;},setupGuidePosition:function(){var e=parseInt(w(this.handle),10),t=parseInt(this.handle.style.left,10)+e,n=parseInt(this.hot.view.maximumVisibleElementWidth(0),10);p(this.handle,&quot;active&quot;),p(this.guide,&quot;active&quot;),this.guide.style.top=this.handle.style.top,this.guide.style.left=t+&quot;px&quot;,this.guide.style.width=n-e+&quot;px&quot;,this.hot.rootElement.appendChild(this.guide)},refreshGuidePosition:function(){this.guide.style.top=this.handle.style.top},hideHandleAndGuide:function(){g(this.handle,&quot;active&quot;),g(this.guide,&quot;active&quot;)},checkIfRowHeader:function(e){if(e!=this.hot.rootElement){var t=e.parentNode;return&quot;TBODY&quot;===t.tagName||this.checkIfRowHeader(t)}return!1},getTHFromTargetElement:function(e){return&quot;TABLE&quot;!=e.tagName?&quot;TH&quot;==e.tagName?e:this.getTHFromTargetElement(e.parentNode):null},onMouseOver:function(e){if(this.checkIfRowHeader(e.target)){var t=this.getTHFromTargetElement(e.target);t&amp;&amp;(this.pressed||this.setupHandlePosition(t))}},afterMouseDownTimeout:function(){var e=this,t=function(){e.hot.forceFullRender=!0,e.hot.view.render(),e.hot.view.wt.wtOverlays.adjustElementsSize(!0)},n=function(n,o){var r=e.hot.runHooks(&quot;beforeRowResize&quot;,n,e.newSize,!0);void 0!==r&amp;&amp;(e.newSize=r),e.setManualSize(n,e.newSize),o&amp;&amp;t(),e.hot.runHooks(&quot;afterRowResize&quot;,n,e.newSize,!0)};if(this.dblclick&gt;=2){var o=this.selectedRows.length;o&gt;1?(C(this.selectedRows,function(e){n(e)}),t()):C(this.selectedRows,function(e){n(e,!0)})}this.dblclick=0,this.autoresizeTimeout=null},onMouseDown:function(e){var t=this;m(e.target,&quot;manualRowResizer&quot;)&amp;&amp;(this.setupGuidePosition(),this.pressed=this.hot,null==this.autoresizeTimeout&amp;&amp;(this.autoresizeTimeout=setTimeout(function(){return t.afterMouseDownTimeout()},500),this.hot._registerTimeout(this.autoresizeTimeout)),this.dblclick++,this.startY=b(e),this.newSize=this.startHeight)},onMouseMove:function(e){var t=this;this.pressed&amp;&amp;(this.currentHeight=this.startHeight+(b(e)-this.startY),C(this.selectedRows,function(e){t.newSize=t.setManualSize(e,t.currentHeight)}),this.refreshHandlePosition(),this.refreshGuidePosition())},onMouseUp:function(e){var t=this,n=function(){t.hot.forceFullRender=!0,t.hot.view.render(),t.hot.view.wt.wtOverlays.adjustElementsSize(!0)},o=function(e,o){t.hot.runHooks(&quot;beforeRowResize&quot;,e,t.newSize),o&amp;&amp;n(),t.saveManualRowHeights(),t.hot.runHooks(&quot;afterRowResize&quot;,e,t.newSize)};if(this.pressed){if(this.hideHandleAndGuide(),this.pressed=!1,this.newSize!=this.startHeight){var r=this.selectedRows.length;r&gt;1?(C(this.selectedRows,function(e){o(e)}),n()):C(this.selectedRows,function(e){o(e,!0)})}this.setupHandlePosition(this.currentTH)}},bindEvents:function(){var e=this;this.eventManager.addEventListener(this.hot.rootElement,&quot;mouseover&quot;,function(t){return e.onMouseOver(t)}),this.eventManager.addEventListener(this.hot.rootElement,&quot;mousedown&quot;,function(t){return e.onMouseDown(t)}),this.eventManager.addEventListener(window,&quot;mousemove&quot;,function(t){return e.onMouseMove(t)}),this.eventManager.addEventListener(window,&quot;mouseup&quot;,function(t){return e.onMouseUp(t)})},setManualSize:function(e,t){return e=this.hot.runHooks(&quot;modifyRow&quot;,e),this.manualRowHeights[e]=t,t},onModifyRowHeight:function(e,t){if(this.enabled){var n=this.hot.getPlugin(&quot;autoRowSize&quot;),o=n?n.heights[t]:null;t=this.hot.runHooks(&quot;modifyRow&quot;,t);var r=this.manualRowHeights[t];if(void 0!==r&amp;&amp;(r===o||r&gt;(e||0)))return r}return e}},{},h),R(&quot;manualRowResize&quot;,M)},{&quot;_base.js&quot;:62,browser:24,eventManager:42,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/number&quot;:52,plugins:61}],108:[function(e,t,n){&quot;use strict&quot;;function o(){var e=[];return e.getInfo=function(e,t){
for(var n=0,o=this.length;n&lt;o;n++)if(this[n].row&lt;=e&amp;&amp;this[n].row+this[n].rowspan-1&gt;=e&amp;&amp;this[n].col&lt;=t&amp;&amp;this[n].col+this[n].colspan-1&gt;=t)return this[n]},e.setInfo=function(e){for(var t=0,n=this.length;t&lt;n;t++)if(this[t].row===e.row&amp;&amp;this[t].col===e.col)return void(this[t]=e);this.push(e)},e.removeInfo=function(e,t){for(var n=0,o=this.length;n&lt;o;n++)if(this[n].row===e&amp;&amp;this[n].col===t){this.splice(n,1);break}},e}function r(e){if(this.mergedCellInfoCollection=new o,Array.isArray(e))for(var t=0,n=e.length;t&lt;n;t++)this.mergedCellInfoCollection.setInfo(e[t])}function i(e,t){var n=this.getSettings().mergeCells;if(n&amp;&amp;!this.selection.isMultiple()){var o=this.mergeCells.mergedCellInfoCollection.getInfo(e[0],e[1]);o&amp;&amp;(e[0]=o.row,e[1]=o.col,e[2]=o.row+o.rowspan-1,e[3]=o.col+o.colspan-1)}}function s(e,t){this.mergeCells&amp;&amp;this.mergeCells.shiftCollection(&quot;right&quot;,e,t)}function a(e,t){this.mergeCells&amp;&amp;this.mergeCells.shiftCollection(&quot;left&quot;,e,t)}function l(e,t){this.mergeCells&amp;&amp;this.mergeCells.shiftCollection(&quot;down&quot;,e,t)}function u(e,t){this.mergeCells&amp;&amp;this.mergeCells.shiftCollection(&quot;up&quot;,e,t)}Object.defineProperties(n,{MergeCells:{get:function(){return r}},__esModule:{value:!0}});var c,d,h,f,p,m,g=(c=e(&quot;browser&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).default,w=((d=e(&quot;plugins&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).registerPlugin,(h=e(&quot;helpers/dom/event&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).stopImmediatePropagation),v=(f=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).WalkontableCellCoords,y=(p=e(&quot;3rdparty/walkontable/src/cell/range&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}).WalkontableCellRange,b=(m=e(&quot;3rdparty/walkontable/src/table&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).WalkontableTable;r.prototype.canMergeRange=function(e){return!e.isSingle()},r.prototype.mergeRange=function(e){if(this.canMergeRange(e)){var t=e.getTopLeftCorner(),n=e.getBottomRightCorner(),o={};o.row=t.row,o.col=t.col,o.rowspan=n.row-t.row+1,o.colspan=n.col-t.col+1,this.mergedCellInfoCollection.setInfo(o)}},r.prototype.mergeOrUnmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.from.row,e.from.col);t?this.unmergeSelection(e.from):this.mergeSelection(e)},r.prototype.mergeSelection=function(e){this.mergeRange(e)},r.prototype.unmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.row,e.col);this.mergedCellInfoCollection.removeInfo(t.row,t.col)},r.prototype.applySpanProperties=function(e,t,n){var o=this.mergedCellInfoCollection.getInfo(t,n);o?o.row===t&amp;&amp;o.col===n?(e.setAttribute(&quot;rowspan&quot;,o.rowspan),e.setAttribute(&quot;colspan&quot;,o.colspan)):(e.removeAttribute(&quot;rowspan&quot;),e.removeAttribute(&quot;colspan&quot;),e.style.display=&quot;none&quot;):(e.removeAttribute(&quot;rowspan&quot;),e.removeAttribute(&quot;colspan&quot;))},r.prototype.modifyTransform=function(e,t,n){var o=function(e,t){return t.row&gt;=e.row&amp;&amp;t.row&lt;=e.row+e.rowspan-1},r=function(e,t){return t.col&gt;=e.col&amp;&amp;t.col&lt;=e.col+e.colspan-1},i=function(e){return new v(t.to.row+e.row,t.to.col+e.col)},s={row:n.row,col:n.col};if(&quot;modifyTransformStart&quot;==e){this.lastDesiredCoords||(this.lastDesiredCoords=new v(null,null));for(var a,l=new v(t.highlight.row,t.highlight.col),u=this.mergedCellInfoCollection.getInfo(l.row,l.col),c=0,d=this.mergedCellInfoCollection.length;c&lt;d;c++){var h=this.mergedCellInfoCollection[c];if(h=new v(h.row+h.rowspan-1,h.col+h.colspan-1),t.includes(h)){a=!0;break}}if(u){var f=new v(u.row,u.col),p=new v(u.row+u.rowspan-1,u.col+u.colspan-1),m=new y(f,f,p);m.includes(this.lastDesiredCoords)||(this.lastDesiredCoords=new v(null,null)),s.row=this.lastDesiredCoords.row?this.lastDesiredCoords.row-l.row:s.row,s.col=this.lastDesiredCoords.col?this.lastDesiredCoords.col-l.col:s.col,n.row&gt;0?s.row=u.row+u.rowspan-1-l.row+n.row:n.row&lt;0&amp;&amp;(s.row=l.row-u.row+n.row),n.col&gt;0?s.col=u.col+u.colspan-1-l.col+n.col:n.col&lt;0&amp;&amp;(s.col=l.col-u.col+n.col)}var g=new v(t.highlight.row+s.row,t.highlight.col+s.col),w=this.mergedCellInfoCollection.getInfo(g.row,g.col);w&amp;&amp;(this.lastDesiredCoords=g,s={row:w.row-l.row,col:w.col-l.col})}else if(&quot;modifyTransformEnd&quot;==e)for(var c=0,d=this.mergedCellInfoCollection.length;c&lt;d;c++){var b=this.mergedCellInfoCollection[c],f=new v(b.row,b.col),p=new v(b.row+b.rowspan-1,b.col+b.colspan-1),C=new y(f,f,p),_=t.getBordersSharedWith(C);if(C.isEqual(t))t.setDirection(&quot;NW-SE&quot;);else if(_.length&gt;0){var R=t.highlight.isEqual(C.from);_.indexOf(&quot;top&quot;)&gt;-1?t.to.isSouthEastOf(C.from)&amp;&amp;R?t.setDirection(&quot;NW-SE&quot;):t.to.isSouthWestOf(C.from)&amp;&amp;R&amp;&amp;t.setDirection(&quot;NE-SW&quot;):_.indexOf(&quot;bottom&quot;)&gt;-1&amp;&amp;(t.to.isNorthEastOf(C.from)&amp;&amp;R?t.setDirection(&quot;SW-NE&quot;):t.to.isNorthWestOf(C.from)&amp;&amp;R&amp;&amp;t.setDirection(&quot;SE-NW&quot;))}var g=i(s),M=o(b,g),S=r(b,g);t.includesRange(C)&amp;&amp;(C.includes(g)||M||S)&amp;&amp;(M&amp;&amp;(s.row&lt;0?s.row-=b.rowspan-1:s.row&gt;0&amp;&amp;(s.row+=b.rowspan-1)),S&amp;&amp;(s.col&lt;0?s.col-=b.colspan-1:s.col&gt;0&amp;&amp;(s.col+=b.colspan-1)))}0!==s.row&amp;&amp;(n.row=s.row),0!==s.col&amp;&amp;(n.col=s.col)},r.prototype.shiftCollection=function(e,t,n){var o=[0,0];switch(e){case&quot;right&quot;:o[0]+=1;break;case&quot;left&quot;:o[0]-=1;break;case&quot;down&quot;:o[1]+=1;break;case&quot;up&quot;:o[1]-=1}for(var r=0;r&lt;this.mergedCellInfoCollection.length;r++){var i=this.mergedCellInfoCollection[r];&quot;right&quot;===e||&quot;left&quot;===e?t&lt;=i.col&amp;&amp;(i.col+=o[0]):t&lt;=i.row&amp;&amp;(i.row+=o[1])}};var C=function(){var e=this,t=e.getSettings().mergeCells;t&amp;&amp;(e.mergeCells||(e.mergeCells=new r(t)))},_=function(){var e=this;e.mergeCells&amp;&amp;(e.view.wt.wtTable.getCell=function(t){if(e.getSettings().mergeCells){var n=e.mergeCells.mergedCellInfoCollection.getInfo(t.row,t.col);n&amp;&amp;(t=n)}return b.prototype.getCell.call(this,t)})},R=function(){var e=this,t=e.getSettings().mergeCells;if(t)if(e.mergeCells){if(e.mergeCells.mergedCellInfoCollection=new o,Array.isArray(t))for(var n=0,i=t.length;n&lt;i;n++)e.mergeCells.mergedCellInfoCollection.setInfo(t[n])}else e.mergeCells=new r(t);else e.mergeCells&amp;&amp;(e.mergeCells.mergedCellInfoCollection=new o)},M=function(e){if(this.mergeCells){var t=(e.ctrlKey||e.metaKey)&amp;&amp;!e.altKey;t&amp;&amp;77===e.keyCode&amp;&amp;(this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render(),w(e))}},S=function(e){this.getSettings().mergeCells&amp;&amp;(e.items.push(g.plugins.ContextMenu.SEPARATOR),e.items.push({key:&quot;mergeCells&quot;,name:function(){var e=this.getSelected(),t=this.mergeCells.mergedCellInfoCollection.getInfo(e[0],e[1]);return t?&quot;Unmerge cells&quot;:&quot;Merge cells&quot;},callback:function(){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render()},disabled:function(){return this.selection.selectedHeader.corner}}))},E=function(e,t,n,o,r,i){this.mergeCells&amp;&amp;this.mergeCells.applySpanProperties(e,t,n)},O=function(e){return function(t){var n=this.getSettings().mergeCells;if(n){var o=this.getSelectedRange();if(this.mergeCells.modifyTransform(e,o,t),&quot;modifyTransformEnd&quot;===e){var r=this.countRows(),i=this.countCols();o.from.row&lt;0?o.from.row=0:o.from.row&gt;0&amp;&amp;o.from.row&gt;=r&amp;&amp;(o.from.row=o.from-1),o.from.col&lt;0?o.from.col=0:o.from.col&gt;0&amp;&amp;o.from.col&gt;=i&amp;&amp;(o.from.col=i-1)}}}},T=function(e){this.lastDesiredCoords=null;var t=this.getSettings().mergeCells;if(t){var n=this.getSelectedRange();n.highlight=new v(n.highlight.row,n.highlight.col),n.to=e;var o=!1;do{o=!1;for(var r=0,i=this.mergeCells.mergedCellInfoCollection.length;r&lt;i;r++){var s=this.mergeCells.mergedCellInfoCollection[r],a=new v(s.row,s.col),l=new v(s.row+s.rowspan-1,s.col+s.colspan-1),u=new y(a,a,l);n.expandByRange(u)&amp;&amp;(e.row=n.to.row,e.col=n.to.col,o=!0)}}while(o)}},k=function(e,t){if(t&amp;&amp;&quot;area&quot;==t){var n=this.getSettings().mergeCells;if(n)for(var o=this.getSelectedRange(),r=new y(o.from,o.from,o.from),i=new y(o.to,o.to,o.to),s=0,a=this.mergeCells.mergedCellInfoCollection.length;s&lt;a;s++){var l=this.mergeCells.mergedCellInfoCollection[s],u=new v(l.row,l.col),c=new v(l.row+l.rowspan-1,l.col+l.colspan-1),d=new y(u,u,c);r.expandByRange(d)&amp;&amp;(e[0]=r.from.row,e[1]=r.from.col),i.expandByRange(d)&amp;&amp;(e[2]=i.from.row,e[3]=i.from.col)}}},x=function(e,t,n){var o=this.getSettings().mergeCells;if(o){var r=this.mergeCells.mergedCellInfoCollection.getInfo(e,t);!r||r.row==e&amp;&amp;r.col==t||(n.copyable=!1)}},D=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countCols(),r=0;r&lt;o;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.startRow,r),n&amp;&amp;n.row&lt;e.startRow)return e.startRow=n.row,D.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.endRow,r)){var i=n.row+n.rowspan-1;if(i&gt;e.endRow)return e.endRow=i,D.call(this,e)}}},H=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countRows(),r=0;r&lt;o;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.startColumn),n&amp;&amp;n.col&lt;e.startColumn)return e.startColumn=n.col,H.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.endColumn)){var i=n.col+n.colspan-1;if(i&gt;e.endColumn)return e.endColumn=i,H.call(this,e)}}},A=function(e){if(e&amp;&amp;this.mergeCells){var t=this.mergeCells.mergedCellInfoCollection,n=this.getSelectedRange();for(var o in t)if(n.highlight.row==t[o].row&amp;&amp;n.highlight.col==t[o].col&amp;&amp;n.to.row==t[o].row+t[o].rowspan-1&amp;&amp;n.to.col==t[o].col+t[o].colspan-1)return!1}return e};g.hooks.add(&quot;beforeInit&quot;,C),g.hooks.add(&quot;afterInit&quot;,_),g.hooks.add(&quot;afterUpdateSettings&quot;,R),g.hooks.add(&quot;beforeKeyDown&quot;,M),g.hooks.add(&quot;modifyTransformStart&quot;,O(&quot;modifyTransformStart&quot;)),g.hooks.add(&quot;modifyTransformEnd&quot;,O(&quot;modifyTransformEnd&quot;)),g.hooks.add(&quot;beforeSetRangeEnd&quot;,T),g.hooks.add(&quot;beforeDrawBorders&quot;,k),g.hooks.add(&quot;afterIsMultipleSelection&quot;,A),g.hooks.add(&quot;afterRenderer&quot;,E),g.hooks.add(&quot;afterContextMenuDefaultOptions&quot;,S),g.hooks.add(&quot;afterGetCellMeta&quot;,x),g.hooks.add(&quot;afterViewportRowCalculatorOverride&quot;,D),g.hooks.add(&quot;afterViewportColumnCalculatorOverride&quot;,H),g.hooks.add(&quot;modifyAutofillRange&quot;,i),g.hooks.add(&quot;afterCreateCol&quot;,s),g.hooks.add(&quot;afterRemoveCol&quot;,a),g.hooks.add(&quot;afterCreateRow&quot;,l),g.hooks.add(&quot;afterRemoveRow&quot;,u),g.MergeCells=r},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,&quot;3rdparty/walkontable/src/cell/range&quot;:7,&quot;3rdparty/walkontable/src/table&quot;:21,browser:24,&quot;helpers/dom/event&quot;:48,plugins:61}],109:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{MultipleSelectionHandles:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l,u=((o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),c=u.getWindowScrollTop,d=u.hasClass,h=u.getWindowScrollLeft,f=(i=e(&quot;helpers/browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).isMobileBrowser,p=(s=e(&quot;_base&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).default,m=(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).EventManager,g=(l=e(&quot;plugins&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).registerPlugin,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.dragged=[],this.eventManager=null,this.lastSetCell=null},v=w;$traceurRuntime.createClass(w,{isEnabled:function(){return f()},enablePlugin:function(){this.enabled||(this.eventManager||(this.eventManager=new m(this)),this.registerListeners(),$traceurRuntime.superGet(this,v.prototype,&quot;enablePlugin&quot;).call(this))},registerListeners:function(){function e(e){if(1===t.dragged.length)return t.dragged.splice(0,t.dragged.length),!0;var n=t.dragged.indexOf(e);return n!=-1&amp;&amp;void(0===n?t.dragged=t.dragged.slice(0,1):1==n&amp;&amp;(t.dragged=t.dragged.slice(-1)))}var t=this;this.eventManager.addEventListener(this.hot.rootElement,&quot;touchstart&quot;,function(e){var n;return d(e.target,&quot;topLeftSelectionHandle-HitArea&quot;)?(n=t.hot.getSelectedRange(),t.dragged.push(&quot;topLeft&quot;),t.touchStartRange={width:n.getWidth(),height:n.getHeight(),direction:n.getDirection()},e.preventDefault(),!1):d(e.target,&quot;bottomRightSelectionHandle-HitArea&quot;)?(n=t.hot.getSelectedRange(),t.dragged.push(&quot;bottomRight&quot;),t.touchStartRange={width:n.getWidth(),height:n.getHeight(),direction:n.getDirection()},e.preventDefault(),!1):void 0}),this.eventManager.addEventListener(this.hot.rootElement,&quot;touchend&quot;,function(n){return d(n.target,&quot;topLeftSelectionHandle-HitArea&quot;)?(e.call(t,&quot;topLeft&quot;),t.touchStartRange=void 0,n.preventDefault(),!1):d(n.target,&quot;bottomRightSelectionHandle-HitArea&quot;)?(e.call(t,&quot;bottomRight&quot;),t.touchStartRange=void 0,n.preventDefault(),!1):void 0}),this.eventManager.addEventListener(this.hot.rootElement,&quot;touchmove&quot;,function(e){var n,o,r,i,s,a,l,u=c(),d=h();0!==t.dragged.length&amp;&amp;(n=document.elementFromPoint(e.touches[0].screenX-d,e.touches[0].screenY-u),n&amp;&amp;n!==t.lastSetCell&amp;&amp;(&quot;TD&quot;!=n.nodeName&amp;&amp;&quot;TH&quot;!=n.nodeName||(o=t.hot.getCoords(n),o.col==-1&amp;&amp;(o.col=0),r=t.hot.getSelectedRange(),i=r.getWidth(),s=r.getHeight(),a=r.getDirection(),1==i&amp;&amp;1==s&amp;&amp;t.hot.selection.setRangeEnd(o),l=t.getCurrentRangeCoords(r,o,t.touchStartRange.direction,a,t.dragged[0]),null!==l.start&amp;&amp;t.hot.selection.setRangeStart(l.start),t.hot.selection.setRangeEnd(l.end),t.lastSetCell=n),e.preventDefault()))})},getCurrentRangeCoords:function(e,t,n,o,r){var i=e.getTopLeftCorner(),s=e.getBottomRightCorner(),a=e.getBottomLeftCorner(),l=e.getTopRightCorner(),u={start:null,end:null};switch(n){case&quot;NE-SW&quot;:switch(o){case&quot;NE-SW&quot;:case&quot;NW-SE&quot;:u=&quot;topLeft&quot;==r?{start:new WalkontableCellCoords(t.row,e.highlight.col),end:new WalkontableCellCoords(a.row,t.col)}:{start:new WalkontableCellCoords(e.highlight.row,t.col),end:new WalkontableCellCoords(t.row,i.col)};break;case&quot;SE-NW&quot;:&quot;bottomRight&quot;==r&amp;&amp;(u={start:new WalkontableCellCoords(s.row,t.col),end:new WalkontableCellCoords(t.row,i.col)})}break;case&quot;NW-SE&quot;:switch(o){case&quot;NE-SW&quot;:&quot;topLeft&quot;==r?u={start:t,end:a}:u.end=t;break;case&quot;NW-SE&quot;:&quot;topLeft&quot;==r?u={start:t,end:s}:u.end=t;break;case&quot;SE-NW&quot;:&quot;topLeft&quot;==r?u={start:t,end:i}:u.end=t;break;case&quot;SW-NE&quot;:&quot;topLeft&quot;==r?u={start:t,end:l}:u.end=t}break;case&quot;SW-NE&quot;:switch(o){case&quot;NW-SE&quot;:u=&quot;bottomRight&quot;==r?{start:new WalkontableCellCoords(t.row,i.col),end:new WalkontableCellCoords(a.row,t.col)}:{start:new WalkontableCellCoords(i.row,t.col),end:new WalkontableCellCoords(t.row,s.col)};break;case&quot;SW-NE&quot;:u=&quot;topLeft&quot;==r?{start:new WalkontableCellCoords(e.highlight.row,t.col),end:new WalkontableCellCoords(t.row,s.col)}:{start:new WalkontableCellCoords(t.row,i.col),end:new WalkontableCellCoords(i.row,t.col)};break;case&quot;SE-NW&quot;:&quot;bottomRight&quot;==r?u={start:new WalkontableCellCoords(t.row,l.col),end:new WalkontableCellCoords(i.row,t.col)}:&quot;topLeft&quot;==r&amp;&amp;(u={start:a,end:t})}break;case&quot;SE-NW&quot;:switch(o){case&quot;NW-SE&quot;:case&quot;NE-SW&quot;:case&quot;SW-NE&quot;:&quot;topLeft&quot;==r&amp;&amp;(u.end=t);break;case&quot;SE-NW&quot;:&quot;topLeft&quot;==r?u.end=t:u={start:t,end:i}}}return u},isDragged:function(){return this.dragged.length&gt;0}},{},p),g(&quot;multipleSelectionHandles&quot;,w)},{_base:62,browser:24,eventManager:42,&quot;helpers/browser&quot;:44,&quot;helpers/dom/element&quot;:47,plugins:61}],110:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{DataObserver:{get:function(){return d}},__esModule:{value:!0}});var o,r,i,s,a=(o=e(&quot;jsonpatch&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,l=(r=e(&quot;../../mixins/localHooks&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).localHooks,u=(i=e(&quot;../../helpers/object&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).mixin,c=(s=e(&quot;utils&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).cleanPatches,d=function(e){this.observedData=null,this.observer=null,this.paused=!1,this.setObservedData(e)};$traceurRuntime.createClass(d,{setObservedData:function(e){var t=this;this.observer&amp;&amp;a.unobserve(this.observedData,this.observer),this.observedData=e,this.observer=a.observe(this.observedData,function(e){return t.onChange(e)})},isPaused:function(){return this.paused},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onChange:function(e){this.runLocalHooks(&quot;change&quot;,c(e))},destroy:function(){a.unobserve(this.observedData,this.observer),this.observedData=null,this.observer=null}},{}),u(d,l)},{&quot;../../helpers/object&quot;:53,&quot;../../mixins/localHooks&quot;:58,jsonpatch:&quot;jsonpatch&quot;,utils:112}],111:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{ObserveChanges:{get:function(){return p}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;_base&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,d=((i=e(&quot;jsonpatch&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,(s=e(&quot;dataObserver&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).DataObserver),h=(a=e(&quot;helpers/array&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).arrayEach,f=(l=e(&quot;plugins&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).registerPlugin;u.hooks.register(&quot;afterChangesObserved&quot;);var p=function(e){$traceurRuntime.superConstructor(m).call(this,e),this.observer=null},m=p;$traceurRuntime.createClass(p,{isEnabled:function(){return this.hot.getSettings().observeChanges},enablePlugin:function(){var e=this;this.enabled||(this.observer||(this.observer=new d(this.hot.getSourceData()),this._exposePublicApi()),this.observer.addLocalHook(&quot;change&quot;,function(t){return e.onDataChange(t)}),this.addHook(&quot;afterCreateRow&quot;,function(){return e.onAfterTableAlter()}),this.addHook(&quot;afterRemoveRow&quot;,function(){return e.onAfterTableAlter()}),this.addHook(&quot;afterCreateCol&quot;,function(){return e.onAfterTableAlter()}),this.addHook(&quot;afterRemoveCol&quot;,function(){return e.onAfterTableAlter()}),this.addHook(&quot;afterChange&quot;,function(t,n){return e.onAfterTableAlter(n)}),this.addHook(&quot;afterLoadData&quot;,function(t){return e.onAfterLoadData(t)}),$traceurRuntime.superGet(this,m.prototype,&quot;enablePlugin&quot;).call(this))},disablePlugin:function(){this.observer&amp;&amp;(this.observer.destroy(),this.observer=null,this._deletePublicApi()),$traceurRuntime.superGet(this,m.prototype,&quot;disablePlugin&quot;).call(this)},onDataChange:function(e){var t=this;if(!this.observer.isPaused()){var n=this.pluginName+&quot;.change&quot;,o={add:function(e){isNaN(e.col)?t.hot.runHooks(&quot;afterCreateRow&quot;,e.row,1,n):t.hot.runHooks(&quot;afterCreateCol&quot;,e.col,1,n)},remove:function(e){isNaN(e.col)?t.hot.runHooks(&quot;afterRemoveRow&quot;,e.row,1,n):t.hot.runHooks(&quot;afterRemoveCol&quot;,e.col,1,n)},replace:function(e){t.hot.runHooks(&quot;afterChange&quot;,[e.row,e.col,null,e.value],n)}};h(e,function(e){o[e.op]&amp;&amp;o[e.op](e)}),this.hot.render()}this.hot.runHooks(&quot;afterChangesObserved&quot;)},onAfterTableAlter:function(e){var t=this;&quot;loadData&quot;!==e&amp;&amp;(this.observer.pause(),this.hot.addHookOnce(&quot;afterChangesObserved&quot;,function(){return t.observer.resume()}))},onAfterLoadData:function(e){e||this.observer.setObservedData(this.hot.getSourceData())},destroy:function(){this.observer&amp;&amp;(this.observer.destroy(),this._deletePublicApi()),$traceurRuntime.superGet(this,m.prototype,&quot;destroy&quot;).call(this)},_exposePublicApi:function(){var e=this,t=this.hot;t.pauseObservingChanges=function(){return e.observer.pause()},t.resumeObservingChanges=function(){return e.observer.resume()},t.isPausedObservingChanges=function(){return e.observer.isPaused()}},_deletePublicApi:function(){var e=this.hot;delete e.pauseObservingChanges,delete e.resumeObservingChanges,delete e.isPausedObservingChanges}},{},c),f(&quot;observeChanges&quot;,p)},{_base:62,browser:24,dataObserver:110,&quot;helpers/array&quot;:43,jsonpatch:&quot;jsonpatch&quot;,plugins:61}],112:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=[];return e=a(e,function(e){return!/[\/]length/gi.test(e.path)&amp;&amp;!!r(e.path)}),e=l(e,function(e){var t=r(e.path);return e.row=t.row,e.col=t.col,e}),e=a(e,function(e){if([&quot;add&quot;,&quot;remove&quot;].indexOf(e.op)!==-1&amp;&amp;!isNaN(e.col)){if(t.indexOf(e.col)!==-1)return!1;t.push(e.col)}return!0}),t.length=0,e}function r(e){var t=e.match(/^\/(\d+)\/?(.*)?$/);if(!t)return null;var n=t,o=n[1],r=n[2];return{row:parseInt(o,10),col:/^\d*$/.test(r)?parseInt(r,10):r}}Object.defineProperties(n,{cleanPatches:{get:function(){return o}},parsePath:{get:function(){return r}},__esModule:{value:!0}});var i,s=(i=e(&quot;../../helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),a=s.arrayFilter,l=s.arrayMap},{&quot;../../helpers/array&quot;:43}],113:[function(e,t,n){&quot;use strict&quot;;function o(e){var t,n=function(){window.localStorage[e+&quot;__persistentStateKeys&quot;]=JSON.stringify(t)},o=function(){var n=window.localStorage[e+&quot;__persistentStateKeys&quot;],o=&quot;string&quot;==typeof n?JSON.parse(n):void 0;t=o?o:[]},r=function(){t=[],n()};o(),this.saveValue=function(o,r){window.localStorage[e+&quot;_&quot;+o]=JSON.stringify(r),t.indexOf(o)==-1&amp;&amp;(t.push(o),n())},this.loadValue=function(t,n){t=&quot;undefined&quot;==typeof t?n:t;var o=window.localStorage[e+&quot;_&quot;+t];return&quot;undefined&quot;==typeof o?void 0:JSON.parse(o)},this.reset=function(t){window.localStorage.removeItem(e+&quot;_&quot;+t)},this.resetAll=function(){for(var n=0;n&lt;t.length;n++)window.localStorage.removeItem(e+&quot;_&quot;+t[n]);r()}}function r(){function e(){var e=this;for(var t in r)r.hasOwnProperty(t)&amp;&amp;e.addHook(t,r[t])}function t(){var e=this;for(var t in r)r.hasOwnProperty(t)&amp;&amp;e.removeHook(t,r[t])}var n=this;this.init=function(){var r=this,i=r.getSettings().persistentState;return n.enabled=!!i,n.enabled?(r.storage||(r.storage=new o(r.rootElement.id)),r.resetState=n.resetValue,void e.call(r)):void t.call(r)},this.saveValue=function(e,t){var n=this;n.storage.saveValue(e,t)},this.loadValue=function(e,t){var n=this;t.value=n.storage.loadValue(e)},this.resetValue=function(e){var t=this;&quot;undefined&quot;==typeof e?t.storage.resetAll():t.storage.reset(e)};var r={persistentStateSave:n.saveValue,persistentStateLoad:n.loadValue,persistentStateReset:n.resetValue};for(var i in r)r.hasOwnProperty(i)&amp;&amp;a.hooks.register(i)}Object.defineProperties(n,{HandsontablePersistentState:{get:function(){return r}},__esModule:{value:!0}});var i,s,a=(i=e(&quot;browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,l=((s=e(&quot;plugins&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).registerPlugin,new r);a.hooks.add(&quot;beforeInit&quot;,l.init),a.hooks.add(&quot;afterUpdateSettings&quot;,l.init)},{browser:24,plugins:61}],114:[function(e,t,n){&quot;use strict&quot;;function o(){var e=this,t=!!e.getSettings().search;t?e.search=new a.Search(e):delete e.search}var r,i,s,a=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,l=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),u=l.addClass,c=l.removeClass,d=(s=e(&quot;renderers&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),h=d.registerRenderer,f=d.getRenderer;a.Search=function(e){this.query=function(t,n,o){var r=e.countRows(),i=e.countCols(),s=[];n||(n=a.Search.global.getDefaultCallback()),o||(o=a.Search.global.getDefaultQueryMethod());for(var l=0;l&lt;r;l++)for(var u=0;u&lt;i;u++){var c=e.getDataAtCell(l,u),d=e.getCellMeta(l,u),h=d.search.callback||n,f=d.search.queryMethod||o,p=f(t,c);if(p){var m={row:l,col:u,data:c};s.push(m)}h&amp;&amp;h(e,l,u,c,p)}return s}},a.Search.DEFAULT_CALLBACK=function(e,t,n,o,r){e.getCellMeta(t,n).isSearchResult=r},a.Search.DEFAULT_QUERY_METHOD=function(e,t){return!(&quot;undefined&quot;==typeof e||null==e||!e.toLowerCase||0===e.length)&amp;&amp;(&quot;undefined&quot;!=typeof t&amp;&amp;null!=t&amp;&amp;t.toString().toLowerCase().indexOf(e.toLowerCase())!=-1)},a.Search.DEFAULT_SEARCH_RESULT_CLASS=&quot;htSearchResult&quot;,a.Search.global=function(){var e=a.Search.DEFAULT_CALLBACK,t=a.Search.DEFAULT_QUERY_METHOD,n=a.Search.DEFAULT_SEARCH_RESULT_CLASS;return{getDefaultCallback:function(){return e},setDefaultCallback:function(t){e=t},getDefaultQueryMethod:function(){return t},setDefaultQueryMethod:function(e){t=e},getDefaultSearchResultClass:function(){return n},setDefaultSearchResultClass:function(e){n=e}}}(),a.SearchCellDecorator=function(e,t,n,o,r,i,s){var l=null!==s.search&amp;&amp;&quot;object&quot;==typeof s.search&amp;&amp;s.search.searchResultClass||a.Search.global.getDefaultSearchResultClass();s.isSearchResult?u(t,l):c(t,l)};var p=f(&quot;base&quot;);h(&quot;base&quot;,function(e,t,n,o,r,i,s){p.apply(this,arguments),a.SearchCellDecorator.apply(this,arguments)}),a.hooks.add(&quot;afterInit&quot;,o),a.hooks.add(&quot;afterUpdateSettings&quot;,o)},{browser:24,&quot;helpers/dom/element&quot;:47,renderers:117}],115:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{TouchScroll:{get:function(){return w}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),d=c.addClass,h=c.removeClass,f=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,p=(s=e(&quot;_base&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).default,m=(a=e(&quot;plugins&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).registerPlugin,g=(l=e(&quot;helpers/feature&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).isTouchSupported,w=function(e){$traceurRuntime.superConstructor(v).call(this,e),this.scrollbars=[],this.clones=[],this.lockedCollection=!1},v=w;$traceurRuntime.createClass(w,{isEnabled:function(){return g()},enablePlugin:function(){var e=this;this.enabled||(this.addHook(&quot;afterRender&quot;,function(){return e.onAfterRender()}),this.registerEvents(),$traceurRuntime.superGet(this,v.prototype,&quot;enablePlugin&quot;).call(this))},updatePlugin:function(){this.lockedCollection=!1,$traceurRuntime.superGet(this,v.prototype,&quot;updatePlugin&quot;).call(this)},disablePlugin:function(){$traceurRuntime.superGet(this,v.prototype,&quot;disablePlugin&quot;).call(this)},registerEvents:function(){var e=this;this.addHook(&quot;beforeTouchScroll&quot;,function(){return e.onBeforeTouchScroll()}),this.addHook(&quot;afterMomentumScroll&quot;,function(){return e.onAfterMomentumScroll()})},onAfterRender:function(){if(!this.lockedCollection){var e=this.hot.view.wt.wtOverlays,t=e.topOverlay,n=e.bottomOverlay,o=e.leftOverlay,r=e.topLeftCornerOverlay,i=e.bottomLeftCornerOverlay;this.lockedCollection=!0,this.scrollbars.length=0,this.scrollbars.push(t),n.clone&amp;&amp;this.scrollbars.push(n),this.scrollbars.push(o),r&amp;&amp;this.scrollbars.push(r),i&amp;&amp;i.clone&amp;&amp;this.scrollbars.push(i),this.clones.length=0,t.needFullRender&amp;&amp;this.clones.push(t.clone.wtTable.holder.parentNode),n.needFullRender&amp;&amp;this.clones.push(n.clone.wtTable.holder.parentNode),o.needFullRender&amp;&amp;this.clones.push(o.clone.wtTable.holder.parentNode),r&amp;&amp;this.clones.push(r.clone.wtTable.holder.parentNode),i&amp;&amp;i.clone&amp;&amp;this.clones.push(i.clone.wtTable.holder.parentNode)}},onBeforeTouchScroll:function(){u.freezeOverlays=!0,f(this.clones,function(e){d(e,&quot;hide-tween&quot;)})},onAfterMomentumScroll:function(){var e=this;u.freezeOverlays=!1,f(this.clones,function(e){h(e,&quot;hide-tween&quot;),d(e,&quot;show-tween&quot;)}),setTimeout(function(){f(e.clones,function(e){h(e,&quot;show-tween&quot;)})},400),f(this.scrollbars,function(e){e.refresh(),e.resetFixedPosition()}),this.hot.view.wt.wtOverlays.syncScrollWithMaster()}},{},p),m(&quot;touchScroll&quot;,w)},{_base:62,browser:24,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/feature&quot;:49,plugins:61}],116:[function(e,t,n){&quot;use strict&quot;;function o(){var e=this,t=&quot;undefined&quot;==typeof e.getSettings().undo||e.getSettings().undo;t?e.undoRedo||(e.undoRedo=new f.UndoRedo(e),s(e),e.addHook(&quot;beforeKeyDown&quot;,r),e.addHook(&quot;afterChange&quot;,i)):e.undoRedo&amp;&amp;(delete e.undoRedo,a(e),e.removeHook(&quot;beforeKeyDown&quot;,r),e.removeHook(&quot;afterChange&quot;,i))}function r(e){var t=this,n=(e.ctrlKey||e.metaKey)&amp;&amp;!e.altKey;n&amp;&amp;(89===e.keyCode||e.shiftKey&amp;&amp;90===e.keyCode?(t.undoRedo.redo(),y(e)):90===e.keyCode&amp;&amp;(t.undoRedo.undo(),y(e)))}function i(e,t){var n=this;if(&quot;loadData&quot;===t)return n.undoRedo.clear()}function s(e){e.undo=function(){return e.undoRedo.undo()},e.redo=function(){return e.undoRedo.redo()},e.isUndoAvailable=function(){return e.undoRedo.isUndoAvailable()},e.isRedoAvailable=function(){return e.undoRedo.isRedoAvailable()},e.clearUndo=function(){return e.undoRedo.clear()}}function a(e){delete e.undo,delete e.redo,delete e.isUndoAvailable,delete e.isRedoAvailable,delete e.clearUndo}var l,u,c,d,h,f=(l=e(&quot;browser&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).default,p=(u=e(&quot;helpers/array&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).arrayMap,m=(c=e(&quot;helpers/number&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).rangeEach,g=(d=e(&quot;helpers/object&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}),w=g.inherit,v=g.deepClone,y=(h=e(&quot;helpers/dom/event&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).stopImmediatePropagation;f.UndoRedo=function(e){var t=this;this.instance=e,this.doneActions=[],this.undoneActions=[],this.ignoreNewActions=!1,e.addHook(&quot;afterChange&quot;,function(e,n){e&amp;&amp;&quot;UndoRedo.undo&quot;!==n&amp;&amp;&quot;UndoRedo.redo&quot;!==n&amp;&amp;t.done(new f.UndoRedo.ChangeAction(e))}),e.addHook(&quot;afterCreateRow&quot;,function(e,n,o){if(&quot;UndoRedo.undo&quot;!==o&amp;&amp;&quot;UndoRedo.undo&quot;!==o&amp;&amp;&quot;auto&quot;!==o){var r=new f.UndoRedo.CreateRowAction(e,n);t.done(r)}}),e.addHook(&quot;beforeRemoveRow&quot;,function(e,n,o,r){if(&quot;UndoRedo.undo&quot;!==r&amp;&amp;&quot;UndoRedo.redo&quot;!==r&amp;&amp;&quot;auto&quot;!==r){var i=t.instance.getSourceDataArray();e=(i.length+e)%i.length;var s=v(i.slice(e,e+n));t.done(new f.UndoRedo.RemoveRowAction(e,s))}}),e.addHook(&quot;afterCreateCol&quot;,function(e,n,o){&quot;UndoRedo.undo&quot;!==o&amp;&amp;&quot;UndoRedo.redo&quot;!==o&amp;&amp;&quot;auto&quot;!==o&amp;&amp;t.done(new f.UndoRedo.CreateColumnAction(e,n))}),e.addHook(&quot;beforeRemoveCol&quot;,function(n,o,r,i){if(&quot;UndoRedo.undo&quot;!==i&amp;&amp;&quot;UndoRedo.redo&quot;!==i&amp;&amp;&quot;auto&quot;!==i){var s=t.instance.getSourceDataArray();n=(t.instance.countCols()+n)%t.instance.countCols();var a=[],l=[],u=[];m(s.length-1,function(t){var r=[],i=s[t];m(n,n+(o-1),function(t){r.push(i[e.runHooks(&quot;modifyCol&quot;,t)])}),a.push(r)}),m(o-1,function(t){u.push(e.runHooks(&quot;modifyCol&quot;,n+t))}),Array.isArray(e.getSettings().colHeaders)&amp;&amp;m(o-1,function(t){l.push(e.getSettings().colHeaders[e.runHooks(&quot;modifyCol&quot;,n+t)]||null)});var c=t.instance.getPlugin(&quot;manualColumnMove&quot;),d=c.isEnabled()?c.columnsMapper.__arrayMap:[],h=new f.UndoRedo.RemoveColumnAction(n,u,a,l,d);t.done(h)}}),e.addHook(&quot;beforeCellAlignment&quot;,function(e,n,o,r){var i=new f.UndoRedo.CellAlignmentAction(e,n,o,r);t.done(i)}),e.addHook(&quot;beforeFilter&quot;,function(e){t.done(new f.UndoRedo.FiltersAction(e))}),e.addHook(&quot;beforeRowMove&quot;,function(e,n){e!==!1&amp;&amp;t.done(new f.UndoRedo.RowMoveAction(e,n))})},f.UndoRedo.prototype.done=function(e){this.ignoreNewActions||(this.doneActions.push(e),this.undoneActions.length=0)},f.UndoRedo.prototype.undo=function(){if(this.isUndoAvailable()){var e=this.doneActions.pop(),t=v(e),n=this.instance,o=n.runHooks(&quot;beforeUndo&quot;,t);if(o===!1)return;this.ignoreNewActions=!0;var r=this;e.undo(this.instance,function(){r.ignoreNewActions=!1,r.undoneActions.push(e)}),n.runHooks(&quot;afterUndo&quot;,t)}},f.UndoRedo.prototype.redo=function(){if(this.isRedoAvailable()){var e=this.undoneActions.pop(),t=v(e),n=this.instance,o=n.runHooks(&quot;beforeRedo&quot;,t);if(o===!1)return;this.ignoreNewActions=!0;var r=this;e.redo(this.instance,function(){r.ignoreNewActions=!1,r.doneActions.push(e)}),n.runHooks(&quot;afterRedo&quot;,t)}},f.UndoRedo.prototype.isUndoAvailable=function(){return this.doneActions.length&gt;0},f.UndoRedo.prototype.isRedoAvailable=function(){return this.undoneActions.length&gt;0},f.UndoRedo.prototype.clear=function(){this.doneActions.length=0,this.undoneActions.length=0},f.UndoRedo.Action=function(){},f.UndoRedo.Action.prototype.undo=function(){},f.UndoRedo.Action.prototype.redo=function(){},f.UndoRedo.ChangeAction=function(e){this.changes=e,this.actionType=&quot;change&quot;},w(f.UndoRedo.ChangeAction,f.UndoRedo.Action),f.UndoRedo.ChangeAction.prototype.undo=function(e,t){for(var n=v(this.changes),o=e.countEmptyRows(!0),r=e.countEmptyCols(!0),i=0,s=n.length;i&lt;s;i++)n[i].splice(3,1);e.addHookOnce(&quot;afterChange&quot;,t),e.setDataAtRowProp(n,null,null,&quot;UndoRedo.undo&quot;);for(var a=0,l=n.length;a&lt;l;a++)e.getSettings().minSpareRows&amp;&amp;n[a][0]+1+e.getSettings().minSpareRows===e.countRows()&amp;&amp;o==e.getSettings().minSpareRows&amp;&amp;(e.alter(&quot;remove_row&quot;,parseInt(n[a][0]+1,10),e.getSettings().minSpareRows),e.undoRedo.doneActions.pop()),e.getSettings().minSpareCols&amp;&amp;n[a][1]+1+e.getSettings().minSpareCols===e.countCols()&amp;&amp;r==e.getSettings().minSpareCols&amp;&amp;(e.alter(&quot;remove_col&quot;,parseInt(n[a][1]+1,10),e.getSettings().minSpareCols),e.undoRedo.doneActions.pop())},f.UndoRedo.ChangeAction.prototype.redo=function(e,t){for(var n=v(this.changes),o=0,r=n.length;o&lt;r;o++)n[o].splice(2,1);e.addHookOnce(&quot;afterChange&quot;,t),e.setDataAtRowProp(n,null,null,&quot;UndoRedo.redo&quot;)},f.UndoRedo.CreateRowAction=function(e,t){this.index=e,this.amount=t,this.actionType=&quot;insert_row&quot;},w(f.UndoRedo.CreateRowAction,f.UndoRedo.Action),f.UndoRedo.CreateRowAction.prototype.undo=function(e,t){var n=e.countRows(),o=e.getSettings().minSpareRows;this.index&gt;=n&amp;&amp;this.index-o&lt;n&amp;&amp;(this.index-=o),e.addHookOnce(&quot;afterRemoveRow&quot;,t),e.alter(&quot;remove_row&quot;,this.index,this.amount,&quot;UndoRedo.undo&quot;)},f.UndoRedo.CreateRowAction.prototype.redo=function(e,t){e.addHookOnce(&quot;afterCreateRow&quot;,t),e.alter(&quot;insert_row&quot;,this.index,this.amount,&quot;UndoRedo.redo&quot;)},f.UndoRedo.RemoveRowAction=function(e,t){this.index=e,this.data=t,this.actionType=&quot;remove_row&quot;},w(f.UndoRedo.RemoveRowAction,f.UndoRedo.Action),f.UndoRedo.RemoveRowAction.prototype.undo=function(e,t){e.alter(&quot;insert_row&quot;,this.index,this.data.length,&quot;UndoRedo.undo&quot;),e.addHookOnce(&quot;afterRender&quot;,t),e.populateFromArray(this.index,0,this.data,void 0,void 0,&quot;UndoRedo.undo&quot;)},f.UndoRedo.RemoveRowAction.prototype.redo=function(e,t){e.addHookOnce(&quot;afterRemoveRow&quot;,t),
e.alter(&quot;remove_row&quot;,this.index,this.data.length,&quot;UndoRedo.redo&quot;)},f.UndoRedo.CreateColumnAction=function(e,t){this.index=e,this.amount=t,this.actionType=&quot;insert_col&quot;},w(f.UndoRedo.CreateColumnAction,f.UndoRedo.Action),f.UndoRedo.CreateColumnAction.prototype.undo=function(e,t){e.addHookOnce(&quot;afterRemoveCol&quot;,t),e.alter(&quot;remove_col&quot;,this.index,this.amount,&quot;UndoRedo.undo&quot;)},f.UndoRedo.CreateColumnAction.prototype.redo=function(e,t){e.addHookOnce(&quot;afterCreateCol&quot;,t),e.alter(&quot;insert_col&quot;,this.index,this.amount,&quot;UndoRedo.redo&quot;)},f.UndoRedo.RemoveColumnAction=function(e,t,n,o,r){this.index=e,this.indexes=t,this.data=n,this.amount=this.data[0].length,this.headers=o,this.columnPositions=r.slice(0),this.actionType=&quot;remove_col&quot;},w(f.UndoRedo.RemoveColumnAction,f.UndoRedo.Action),f.UndoRedo.RemoveColumnAction.prototype.undo=function(e,t){var n,o=this,r=this.indexes.slice(0).sort(),i=function(e,t,n){return n[o.indexes.indexOf(r[t])]},s=[];m(this.data.length-1,function(e){s[e]=p(o.data[e],i)});var a=[];a=p(this.headers,i);var l=[];f.hooks.run(e,&quot;beforeCreateCol&quot;,this.indexes[0],this.indexes[this.indexes.length-1],&quot;UndoRedo.undo&quot;),m(this.data.length-1,function(t){n=e.getSourceDataAtRow(t),m(r.length-1,function(e){n.splice(r[e],0,s[t][e]),l.push([t,r[e],null,s[t][e]])})}),e.getPlugin(&quot;formulas&quot;)&amp;&amp;e.getPlugin(&quot;formulas&quot;).onAfterSetDataAtCell(l),&quot;undefined&quot;!=typeof this.headers&amp;&amp;m(a.length-1,function(t){e.getSettings().colHeaders.splice(r[t],0,a[t])}),e.getPlugin(&quot;manualColumnMove&quot;)&amp;&amp;(e.getPlugin(&quot;manualColumnMove&quot;).columnsMapper.__arrayMap=this.columnPositions),e.addHookOnce(&quot;afterRender&quot;,t),f.hooks.run(e,&quot;afterCreateCol&quot;,this.indexes[0],this.indexes[this.indexes.length-1],&quot;UndoRedo.undo&quot;),e.getPlugin(&quot;formulas&quot;)&amp;&amp;e.getPlugin(&quot;formulas&quot;).recalculateFull(),e.render()},f.UndoRedo.RemoveColumnAction.prototype.redo=function(e,t){e.addHookOnce(&quot;afterRemoveCol&quot;,t),e.alter(&quot;remove_col&quot;,this.index,this.amount,&quot;UndoRedo.redo&quot;)},f.UndoRedo.CellAlignmentAction=function(e,t,n,o){this.stateBefore=e,this.range=t,this.type=n,this.alignment=o},f.UndoRedo.CellAlignmentAction.prototype.undo=function(e,t){if(e.getPlugin(&quot;contextMenu&quot;).isEnabled()){for(var n=this.range.from.row;n&lt;=this.range.to.row;n++)for(var o=this.range.from.col;o&lt;=this.range.to.col;o++)e.setCellMeta(n,o,&quot;className&quot;,this.stateBefore[n][o]||&quot; htLeft&quot;);e.addHookOnce(&quot;afterRender&quot;,t),e.render()}},f.UndoRedo.CellAlignmentAction.prototype.redo=function(e,t){e.getPlugin(&quot;contextMenu&quot;).isEnabled()&amp;&amp;(e.selectCell(this.range.from.row,this.range.from.col,this.range.to.row,this.range.to.col),e.getPlugin(&quot;contextMenu&quot;).executeCommand(&quot;alignment:&quot;+this.alignment.replace(&quot;ht&quot;,&quot;&quot;).toLowerCase()),e.addHookOnce(&quot;afterRender&quot;,t),e.render())},f.UndoRedo.FiltersAction=function(e){this.formulaStacks=e,this.actionType=&quot;filter&quot;},w(f.UndoRedo.FiltersAction,f.UndoRedo.Action),f.UndoRedo.FiltersAction.prototype.undo=function(e,t){var n=e.getPlugin(&quot;filters&quot;);e.addHookOnce(&quot;afterRender&quot;,t),n.formulaCollection.importAllFormulas(this.formulaStacks.slice(0,this.formulaStacks.length-1)),n.filter()},f.UndoRedo.FiltersAction.prototype.redo=function(e,t){var n=e.getPlugin(&quot;filters&quot;);e.addHookOnce(&quot;afterRender&quot;,t),n.formulaCollection.importAllFormulas(this.formulaStacks),n.filter()},f.UndoRedo.RowMoveAction=function(e,t){this.rows=e.slice(),this.target=t},w(f.UndoRedo.RowMoveAction,f.UndoRedo.Action),f.UndoRedo.RowMoveAction.prototype.undo=function(e,t){var n=e.getPlugin(&quot;manualRowMove&quot;);e.addHookOnce(&quot;afterRender&quot;,t);for(var o=this.rows[0]&lt;this.target?-1*this.rows.length:0,r=this.rows[0]&gt;this.target?this.rows[0]+this.rows.length:this.rows[0],i=[],s=this.rows.length+o,a=o;a&lt;s;a++)i.push(this.target+a);n.moveRows(i.slice(),r),e.render(),e.selection.setRangeStartOnly(new WalkontableCellCoords(this.rows[0],0)),e.selection.setRangeEnd(new WalkontableCellCoords(this.rows[this.rows.length-1],e.countCols()-1))},f.UndoRedo.RowMoveAction.prototype.redo=function(e,t){var n=e.getPlugin(&quot;manualRowMove&quot;);e.addHookOnce(&quot;afterRender&quot;,t),n.moveRows(this.rows.slice(),this.target),e.render();var o=this.rows[0]&lt;this.target?this.target-this.rows.length:this.target;e.selection.setRangeStartOnly(new WalkontableCellCoords(o,0)),e.selection.setRangeEnd(new WalkontableCellCoords(o+this.rows.length-1,e.countCols()-1))},f.hooks.add(&quot;afterInit&quot;,o),f.hooks.add(&quot;afterUpdateSettings&quot;,o),f.hooks.register(&quot;beforeUndo&quot;),f.hooks.register(&quot;afterUndo&quot;),f.hooks.register(&quot;beforeRedo&quot;),f.hooks.register(&quot;afterRedo&quot;)},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/dom/event&quot;:48,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53}],117:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n;c[e]=t,n=u(e)+&quot;Renderer&quot;,l.renderers[n]=t,l[n]=t,&quot;base&quot;===e&amp;&amp;(l.renderers.cellDecorator=t)}function r(e){if(&quot;function&quot;==typeof e)return e;if(&quot;string&quot;!=typeof e)throw Error('Only strings and functions can be passed as &quot;renderer&quot; parameter');if(!(e in c))throw Error('No editor registered under name &quot;'+e+'&quot;');return c[e]}function i(e){return e in c}Object.defineProperties(n,{registerRenderer:{get:function(){return o}},getRenderer:{get:function(){return r}},hasRenderer:{get:function(){return i}},__esModule:{value:!0}});var s,a,l=(s=e(&quot;browser&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).default,u=(a=e(&quot;helpers/string&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).toUpperCaseFirst,c={};l.renderers=l.renderers||{},l.renderers.registerRenderer=o,l.renderers.getRenderer=r},{browser:24,&quot;helpers/string&quot;:55}],118:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,s){s.className&amp;&amp;(t.className?t.className=t.className+&quot; &quot;+s.className:t.className=s.className),s.readOnly&amp;&amp;a(t,s.readOnlyCellClassName),s.valid===!1&amp;&amp;s.invalidCellClassName?a(t,s.invalidCellClassName):l(t,s.invalidCellClassName),s.wordWrap===!1&amp;&amp;s.noWordWrapClassName&amp;&amp;a(t,s.noWordWrapClassName),!i&amp;&amp;s.placeholder&amp;&amp;a(t,s.placeholderCellClassName)}Object.defineProperties(n,{cellDecorator:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),a=s.addClass,l=s.removeClass,u=(i=e(&quot;renderers&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).registerRenderer;u(&quot;base&quot;,o)},{&quot;helpers/dom/element&quot;:47,renderers:117}],119:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,s){var a=(g.cloneNode(!0),w.cloneNode(!0));if(s.allowHtml?f(&quot;html&quot;).apply(this,arguments):f(&quot;text&quot;).apply(this,arguments),t.appendChild(a),u(t,&quot;htAutocomplete&quot;),t.firstChild||t.appendChild(document.createTextNode(String.fromCharCode(160))),!e.acArrowListener){var l=d(e);e.acArrowListener=function(r){c(r.target,&quot;htAutocompleteArrow&quot;)&amp;&amp;e.view.wt.getSetting(&quot;onCellDblClick&quot;,null,new m(n,o),t)},l.addEventListener(e.rootElement,&quot;mousedown&quot;,e.acArrowListener),e.addHookOnce(&quot;afterDestroy&quot;,function(){l.destroy()})}}Object.defineProperties(n,{autocompleteRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),u=l.addClass,c=l.hasClass,d=(l.empty,(i=e(&quot;eventManager&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).eventManager),h=(s=e(&quot;renderers&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),f=h.getRenderer,p=h.registerRenderer,m=(a=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).WalkontableCellCoords,g=document.createElement(&quot;DIV&quot;);g.className=&quot;htAutocompleteWrapper&quot;;var w=document.createElement(&quot;DIV&quot;);w.className=&quot;htAutocompleteArrow&quot;,w.appendChild(document.createTextNode(String.fromCharCode(9660)));p(&quot;autocomplete&quot;,o)},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,eventManager:42,&quot;helpers/dom/element&quot;:47,renderers:117}],120:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,a,l,u){function c(e){var t=&quot;SPACE|ENTER&quot;,n=&quot;DELETE|BACKSPACE&quot;,o=O(E,e.keyCode);o(t+&quot;|&quot;+n)&amp;&amp;!x(e)&amp;&amp;h(function(){k(e),e.preventDefault()}),o(t)&amp;&amp;d(),o(n)&amp;&amp;d(!0)}function d(){var t=void 0!==arguments[0]&amp;&amp;arguments[0],n=e.getSelectedRange();if(n){for(var o=n.getTopLeftCorner(),r=n.getBottomRightCorner(),i=[],s=o.row;s&lt;=r.row;s+=1)for(var a=o.col;a&lt;=r.col;a+=1){var l=e.getCellMeta(s,a);if(&quot;checkbox&quot;!==l.type)return;if(l.readOnly!==!0){&quot;undefined&quot;==typeof l.checkedTemplate&amp;&amp;(l.checkedTemplate=!0),&quot;undefined&quot;==typeof l.uncheckedTemplate&amp;&amp;(l.uncheckedTemplate=!1);var u=e.getDataAtCell(s,a);t===!1?u===l.checkedTemplate?i.push([s,a,l.uncheckedTemplate]):[l.uncheckedTemplate,null,void 0].indexOf(u)!==-1&amp;&amp;i.push([s,a,l.checkedTemplate]):i.push([s,a,l.uncheckedTemplate])}}i.length&gt;0&amp;&amp;e.setDataAtCell(i)}}function h(t){var n=e.getSelectedRange();if(n)for(var o=n.getTopLeftCorner(),r=n.getBottomRightCorner(),i=o.row;i&lt;=r.row;i++)for(var s=o.col;s&lt;=r.col;s++){var a=e.getCellMeta(i,s);if(&quot;checkbox&quot;!==a.type)return;var l=e.getCell(i,s);if(null==l)t(i,s,a);else{var u=l.querySelectorAll(&quot;input[type=checkbox]&quot;);u.length&gt;0&amp;&amp;!a.readOnly&amp;&amp;t(u)}}}M(&quot;base&quot;).apply(this,arguments);var f=(r(e),i()),p=u.label,m=!1;if(&quot;undefined&quot;==typeof u.checkedTemplate&amp;&amp;(u.checkedTemplate=!0),&quot;undefined&quot;==typeof u.uncheckedTemplate&amp;&amp;(u.uncheckedTemplate=!1),y(t),l===u.checkedTemplate||C(l,u.checkedTemplate)?f.checked=!0:l===u.uncheckedTemplate||C(l,u.uncheckedTemplate)?f.checked=!1:null===l?b(f,&quot;noValue&quot;):(f.style.display=&quot;none&quot;,b(f,A),m=!0),f.setAttribute(&quot;data-row&quot;,n),f.setAttribute(&quot;data-col&quot;,o),!m&amp;&amp;p){var g=&quot;&quot;;p.value?g=&quot;function&quot;==typeof p.value?p.value.call(this,n,o,a,l):p.value:p.property&amp;&amp;(g=e.getDataAtRowProp(n,p.property));var w=s(g);&quot;before&quot;===p.position?w.appendChild(f):w.insertBefore(f,w.firstChild),f=w}t.appendChild(f),m&amp;&amp;t.appendChild(document.createTextNode(&quot;#bad-value#&quot;)),D.has(e)||(D.set(e,!0),e.addHook(&quot;beforeKeyDown&quot;,c))}function r(e){var t=H.get(e);return t||(t=new _(e),t.addEventListener(e.rootElement,&quot;click&quot;,function(t){return l(t,e)}),t.addEventListener(e.rootElement,&quot;mouseup&quot;,function(t){return a(t,e)}),t.addEventListener(e.rootElement,&quot;change&quot;,function(t){return u(t,e)}),H.set(e,t)),t}function i(){var e=document.createElement(&quot;input&quot;);return e.className=&quot;htCheckboxRendererInput&quot;,e.type=&quot;checkbox&quot;,e.setAttribute(&quot;autocomplete&quot;,&quot;off&quot;),e.setAttribute(&quot;tabindex&quot;,&quot;-1&quot;),e.cloneNode(!1)}function s(e){var t=document.createElement(&quot;label&quot;);return t.className=&quot;htCheckboxRendererLabel&quot;,t.appendChild(document.createTextNode(e)),t.cloneNode(!0)}function a(e,t){c(e.target)&amp;&amp;setTimeout(t.listen,10)}function l(e,t){if(!c(e.target))return!1;var n=parseInt(e.target.getAttribute(&quot;data-row&quot;),10),o=parseInt(e.target.getAttribute(&quot;data-col&quot;),10),r=t.getCellMeta(n,o);r.readOnly&amp;&amp;e.preventDefault()}function u(e,t){if(!c(e.target))return!1;var n=parseInt(e.target.getAttribute(&quot;data-row&quot;),10),o=parseInt(e.target.getAttribute(&quot;data-col&quot;),10),r=t.getCellMeta(n,o);if(!r.readOnly){var i=null;i=e.target.checked?void 0===r.checkedTemplate||r.checkedTemplate:void 0!==r.uncheckedTemplate&amp;&amp;r.uncheckedTemplate,t.setDataAtCell(n,o,i)}}function c(e){return&quot;INPUT&quot;===e.tagName&amp;&amp;&quot;checkbox&quot;===e.getAttribute(&quot;type&quot;)}Object.defineProperties(n,{checkboxRenderer:{get:function(){return o}},__esModule:{value:!0}});var d,h,f,p,m,g,w,v=(d=e(&quot;helpers/dom/element&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}),y=v.empty,b=v.addClass,C=(v.hasClass,(h=e(&quot;helpers/string&quot;),h&amp;&amp;h.__esModule&amp;&amp;h||{default:h}).equalsIgnoreCase),_=(f=e(&quot;eventManager&quot;),f&amp;&amp;f.__esModule&amp;&amp;f||{default:f}).EventManager,R=(p=e(&quot;renderers&quot;),p&amp;&amp;p.__esModule&amp;&amp;p||{default:p}),M=R.getRenderer,S=R.registerRenderer,E=(m=e(&quot;helpers/unicode&quot;),m&amp;&amp;m.__esModule&amp;&amp;m||{default:m}).isKey,O=(g=e(&quot;helpers/function&quot;),g&amp;&amp;g.__esModule&amp;&amp;g||{default:g}).partial,T=(w=e(&quot;helpers/dom/event&quot;),w&amp;&amp;w.__esModule&amp;&amp;w||{default:w}),k=T.stopImmediatePropagation,x=T.isImmediatePropagationStopped,D=new WeakMap,H=new WeakMap,A=&quot;htBadValue&quot;;S(&quot;checkbox&quot;,o)},{eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/function&quot;:50,&quot;helpers/string&quot;:55,&quot;helpers/unicode&quot;:56,renderers:117}],121:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,a){l(&quot;base&quot;).apply(this,arguments),null!==i&amp;&amp;void 0!==i||(i=&quot;&quot;),s(t,i)}Object.defineProperties(n,{htmlRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).fastInnerHTML,a=(i=e(&quot;renderers&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),l=a.getRenderer,u=a.registerRenderer;u(&quot;html&quot;,o)},{&quot;helpers/dom/element&quot;:47,renderers:117}],122:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,s){if(d(i)){&quot;undefined&quot;!=typeof s.language&amp;&amp;a.culture(s.language),i=a(i).format(s.format||&quot;0&quot;);var l=s.className||&quot;&quot;,c=l.length?l.split(&quot; &quot;):[];c.indexOf(&quot;htLeft&quot;)&lt;0&amp;&amp;c.indexOf(&quot;htCenter&quot;)&lt;0&amp;&amp;c.indexOf(&quot;htRight&quot;)&lt;0&amp;&amp;c.indexOf(&quot;htJustify&quot;)&lt;0&amp;&amp;c.push(&quot;htRight&quot;),c.indexOf(&quot;htNumeric&quot;)&lt;0&amp;&amp;c.push(&quot;htNumeric&quot;),s.className=c.join(&quot; &quot;)}u(&quot;text&quot;)(e,t,n,o,r,i,s)}Object.defineProperties(n,{numericRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e(&quot;numbro&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,l=(i=e(&quot;renderers&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),u=l.getRenderer,c=l.registerRenderer,d=(s=e(&quot;helpers/number&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isNumeric;c(&quot;numeric&quot;,o)},{&quot;helpers/number&quot;:52,numbro:&quot;numbro&quot;,renderers:117}],123:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,a){l(&quot;text&quot;).apply(this,arguments),i=t.innerHTML;var u,c=a.hashLength||i.length,d=a.hashSymbol||&quot;*&quot;;for(u=&quot;&quot;;u.split(d).length-1&lt;c;u+=d);s(t,u)}Object.defineProperties(n,{passwordRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).fastInnerHTML,a=(i=e(&quot;renderers&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),l=a.getRenderer,u=a.registerRenderer;u(&quot;password&quot;,o)},{&quot;helpers/dom/element&quot;:47,renderers:117}],124:[function(e,t,n){&quot;use strict&quot;;function o(e,t,n,o,r,i,s){h(&quot;base&quot;).apply(this,arguments),!i&amp;&amp;s.placeholder&amp;&amp;(i=s.placeholder);var a=c(i);if(e.getSettings().trimWhitespace||(a=a.replace(/ /g,String.fromCharCode(160))),s.rendererTemplate){l(t);var d=document.createElement(&quot;TEMPLATE&quot;);d.setAttribute(&quot;bind&quot;,&quot;{{}}&quot;),d.innerHTML=s.rendererTemplate,HTMLTemplateElement.decorate(d),d.model=e.getSourceDataAtRow(n),t.appendChild(d)}else u(t,a)}Object.defineProperties(n,{textRenderer:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),l=a.empty,u=a.fastInnerText,c=(i=e(&quot;helpers/mixed&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).stringify,d=(s=e(&quot;renderers&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}),h=d.getRenderer,f=d.registerRenderer;f(&quot;text&quot;,o)},{&quot;helpers/dom/element&quot;:47,&quot;helpers/mixed&quot;:51,renderers:117}],125:[function(e,t,n){!function(e){&quot;use strict&quot;;function t(e){return{configurable:!0,enumerable:!1,value:e,writable:!0}}function n(){return&quot;__$&quot;+Math.floor(1e9*Math.random())+&quot;$&quot;+ ++H+&quot;$__&quot;}function o(e){return I[e]}function r(){var e=n();return I[e]=!0,e}function i(e){return&quot;object&quot;==typeof e&amp;&amp;e instanceof l}function s(e){return i(e)?&quot;symbol&quot;:typeof e}function a(e){var t=new l(e);if(!(this instanceof a))return t;throw new TypeError(&quot;Symbol cannot be new'ed&quot;)}function l(e){var t=n();S(this,N,{value:this}),S(this,A,{value:t}),S(this,P,{value:e}),c(this),L[t]=this}function u(e){var t=e[W];return t&amp;&amp;t.self===e?t:x(e)?(V.hash.value=B++,V.self.value=e,j.value=R(null,V),S(e,W,j),j.value):void 0}function c(e){return u(e),E.apply(this,arguments)}function d(e){return L[e]||I[e]}function h(e){return i(e)?e[A]:e}function f(e){for(var t=[],n=T(e),o=0;o&lt;n.length;o++){var r=L[n[o]];r&amp;&amp;t.push(r)}return t}function p(t){return e.traceur&amp;&amp;e.traceur.options[t]}function m(e){for(var t=1;t&lt;arguments.length;t++)for(var n=T(arguments[t]),o=0;o&lt;n.length;o++){var r=n[o];d(r)||!function(t,n){S(e,n,{get:function(){return t[n]},enumerable:!0})}(arguments[t],n[o])}return e}function g(e){return null!=e&amp;&amp;(&quot;object&quot;==typeof e||&quot;function&quot;==typeof e)}function w(e){if(null==e)throw _();return C(e)}function v(e){if(null==e)throw new TypeError(&quot;Value cannot be converted to an Object&quot;);return e}function y(e,t){e.Symbol||(e.Symbol=t,Object.getOwnPropertySymbols=f),e.Symbol.iterator||(e.Symbol.iterator=t(&quot;Symbol.iterator&quot;))}function b(e){y(e,a),e.Reflect=e.Reflect||{},e.Reflect.global=e.Reflect.global||e}if(!e.$traceurRuntime){var C=Object,_=TypeError,R=C.create,M=C.defineProperties,S=C.defineProperty,E=C.freeze,O=C.getOwnPropertyDescriptor,T=C.getOwnPropertyNames,k=C.keys,x=Object.isExtensible,D=t,H=0,A=n(),P=n(),N=n(),L=R(null),I=R(null);S(a.prototype,&quot;constructor&quot;,t(a)),S(a.prototype,&quot;toString&quot;,D(function(){var e=this[N];if(!p(&quot;symbols&quot;))return e[A];if(!e)throw TypeError(&quot;Conversion from symbol to string&quot;);var t=e[P];return void 0===t&amp;&amp;(t=&quot;&quot;),&quot;Symbol(&quot;+t+&quot;)&quot;})),S(a.prototype,&quot;valueOf&quot;,D(function(){var e=this[N];if(!e)throw TypeError(&quot;Conversion from symbol to string&quot;);return p(&quot;symbols&quot;)?e:e[A]})),S(l.prototype,&quot;constructor&quot;,t(a)),S(l.prototype,&quot;toString&quot;,{value:a.prototype.toString,enumerable:!1}),S(l.prototype,&quot;valueOf&quot;,{value:a.prototype.valueOf,enumerable:!1});var W=r(),j={value:void 0},V={hash:{value:void 0},self:{value:void 0}},B=0;c(l.prototype),b(e),e.$traceurRuntime={checkObjectCoercible:v,createPrivateName:r,defineProperties:M,defineProperty:S,exportStar:m,getOwnHashObject:u,getOwnPropertyDescriptor:O,getOwnPropertyNames:T,isObject:g,isPrivateName:o,isSymbolString:d,keys:k,setupGlobals:b,toObject:w,toProperty:h,typeof:s}}}(window),function(){&quot;use strict&quot;;function e(){for(var e,n=[],o=0,r=0;r&lt;arguments.length;r++){var i=$traceurRuntime.checkObjectCoercible(arguments[r]);&quot;function&quot;!=typeof i[t(Symbol.iterator)]&amp;&amp;(i[t(Symbol.iterator)]=function(){var e=this,t=e.length,n=0;return{next:function(){var o={done:!0};return n&lt;t&amp;&amp;(o.done=!1,o.value=e[n],++n),o}}});for(var s=i[t(Symbol.iterator)]();!(e=s.next()).done;)n[o++]=e.value}return n}var t=$traceurRuntime.toProperty;$traceurRuntime.spread=e}(),function(){&quot;use strict&quot;;function e(e,t){var n=m(e);do{var o=p(n,t);if(o)return o;n=m(n)}while(n)}function t(e){return e.__proto__}function n(e,t,n,r){return o(e,t,n).apply(e,r)}function o(t,n,o){var r=e(n,o);if(r)return r.get?r.get.call(t):r.value}function r(t,n,o,r){var i=e(n,o);if(i&amp;&amp;i.set)return i.set.call(t,r),r;throw c(&quot;super has no setter '&quot;+o+&quot;'.&quot;)}function i(e){for(var t={},n=v(e),o=0;o&lt;n.length;o++){var r=n[o];t[r]=p(e,r)}for(var i=y(e),o=0;o&lt;i.length;o++){var s=i[o];t[g(s)]=p(e,g(s))}return t}function s(e,t,n,o){return f(t,&quot;constructor&quot;,{value:e,configurable:!0,enumerable:!1,writable:!0}),arguments.length&gt;3?(&quot;function&quot;==typeof o&amp;&amp;(e.__proto__=o),e.prototype=d(a(o),i(t))):e.prototype=t,f(e,&quot;prototype&quot;,{configurable:!1,writable:!1}),h(e,i(n))}function a(e){if(&quot;function&quot;==typeof e){var t=e.prototype;if(u(t)===t||null===t)return e.prototype;throw new c(&quot;super prototype must be an Object or null&quot;)}if(null===e)return null;throw new c(&quot;Super expression must either be null or a function, not &quot;+typeof e+&quot;.&quot;)}function l(e,t,o){null!==m(t)&amp;&amp;n(e,t,&quot;constructor&quot;,o)}var u=Object,c=TypeError,d=u.create,h=$traceurRuntime.defineProperties,f=$traceurRuntime.defineProperty,p=$traceurRuntime.getOwnPropertyDescriptor,m=Object.getPrototypeOf,g=$traceurRuntime.toProperty,w=Object,v=w.getOwnPropertyNames,y=w.getOwnPropertySymbols;$traceurRuntime.createClass=s,$traceurRuntime.defaultSuperCall=l,$traceurRuntime.superCall=n,$traceurRuntime.superConstructor=t,$traceurRuntime.superGet=o,$traceurRuntime.superSet=r}()},{}],126:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=this,n=this;this.eventManager=M(e),this.instance=e,this.settings=e.getSettings(),this.selectionMouseDown=!1;var o=e.rootElement.getAttribute(&quot;style&quot;);o&amp;&amp;e.rootElement.setAttribute(&quot;data-originalstyle&quot;,o),p(e.rootElement,&quot;handsontable&quot;);var r=document.createElement(&quot;TABLE&quot;);p(r,&quot;htCore&quot;),e.getSettings().tableClassName&amp;&amp;p(r,e.getSettings().tableClassName),this.THEAD=document.createElement(&quot;THEAD&quot;),r.appendChild(this.THEAD),this.TBODY=document.createElement(&quot;TBODY&quot;),r.appendChild(this.TBODY),e.table=r,e.container.insertBefore(r,e.container.firstChild),this.eventManager.addEventListener(e.rootElement,&quot;mousedown&quot;,function(e){this.selectionMouseDown=!0,n.isTextSelectionAllowed(e.target)||(s(),e.preventDefault(),window.focus())}),this.eventManager.addEventListener(e.rootElement,&quot;mouseup&quot;,function(e){this.selectionMouseDown=!1}),this.eventManager.addEventListener(e.rootElement,&quot;mousemove&quot;,function(e){this.selectionMouseDown&amp;&amp;!n.isTextSelectionAllowed(e.target)&amp;&amp;(s(),e.preventDefault())}),this.eventManager.addEventListener(document.documentElement,&quot;keyup&quot;,function(t){e.selection.isInProgress()&amp;&amp;!t.shiftKey&amp;&amp;e.selection.finish()});var i;this.isMouseDown=function(){return i},this.eventManager.addEventListener(document.documentElement,&quot;mouseup&quot;,function(t){e.selection.isInProgress()&amp;&amp;1===t.which&amp;&amp;e.selection.finish(),i=!1,_(document.activeElement)&amp;&amp;e.unlisten()}),this.eventManager.addEventListener(document.documentElement,&quot;mousedown&quot;,function(t){var o=t.target,r=t.target,s=t.x||t.clientX,a=t.y||t.clientY;if(!i&amp;&amp;e.rootElement){if(r===e.view.wt.wtTable.holder){var l=v();if(document.elementFromPoint(s+l,a)!==e.view.wt.wtTable.holder||document.elementFromPoint(s,a+l)!==e.view.wt.wtTable.holder)return}else for(;r!==document.documentElement;){if(null===r){if(t.isTargetWebComponent)break;return}if(r===e.rootElement)return;r=r.parentNode}var u=&quot;function&quot;==typeof n.settings.outsideClickDeselects?n.settings.outsideClickDeselects(o):n.settings.outsideClickDeselects;u?e.deselectCell():e.destroyEditor()}}),this.eventManager.addEventListener(r,&quot;selectstart&quot;,function(e){n.settings.fragmentSelection||C(e.target)||e.preventDefault()});var s=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&amp;&amp;window.getSelection().removeAllRanges():document.selection&amp;&amp;document.selection.empty()},a=[new D({className:&quot;current&quot;,border:{width:2,color:&quot;#5292F7&quot;,cornerVisible:function(){return n.settings.fillHandle&amp;&amp;!n.isCellEdited()&amp;&amp;!e.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!n.isCellEdited()&amp;&amp;!e.selection.isMultiple()}}}),new D({className:&quot;area&quot;,border:{width:1,color:&quot;#89AFF9&quot;,cornerVisible:function(){return n.settings.fillHandle&amp;&amp;!n.isCellEdited()&amp;&amp;e.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!n.isCellEdited()&amp;&amp;e.selection.isMultiple()}}}),new D({className:&quot;highlight&quot;,highlightHeaderClassName:n.settings.currentHeaderClassName,highlightRowClassName:n.settings.currentRowClassName,highlightColumnClassName:n.settings.currentColClassName}),new D({className:&quot;fill&quot;,border:{width:1,color:&quot;red&quot;}})];a.current=a[0],a.area=a[1],a.highlight=a[2],a.fill=a[3];var l={debug:function(){return n.settings.debug},externalRowCalculator:this.instance.getPlugin(&quot;autoRowSize&quot;)&amp;&amp;this.instance.getPlugin(&quot;autoRowSize&quot;).isEnabled(),table:r,preventOverflow:function(){return t.settings.preventOverflow},stretchH:function(){return n.settings.stretchH},data:e.getDataAtCell,totalRows:function(){return e.countRows()},totalColumns:function(){return e.countCols()},fixedColumnsLeft:function(){return n.settings.fixedColumnsLeft},fixedRowsTop:function(){return n.settings.fixedRowsTop},fixedRowsBottom:function(){return n.settings.fixedRowsBottom},minSpareRows:function(){return n.settings.minSpareRows},renderAllRows:n.settings.renderAllRows,rowHeaders:function(){var t=[];return e.hasRowHeaders()&amp;&amp;t.push(function(e,t){n.appendRowHeader(e,t)}),h.hooks.run(e,&quot;afterGetRowHeaderRenderers&quot;,t),t},columnHeaders:function(){var t=[];return e.hasColHeaders()&amp;&amp;t.push(function(e,t){n.appendColHeader(e,t)}),h.hooks.run(e,&quot;afterGetColumnHeaderRenderers&quot;,t),t},columnWidth:e.getColWidth,rowHeight:e.getRowHeight,cellRenderer:function(e,t,o){var r=n.instance.getCellMeta(e,t),i=n.instance.colToProp(t),s=n.instance.getDataAtRowProp(e,i);n.instance.hasHook(&quot;beforeValueRender&quot;)&amp;&amp;(s=n.instance.runHooks(&quot;beforeValueRender&quot;,s)),n.instance.runHooks(&quot;beforeRenderer&quot;,o,e,t,i,s,r),n.instance.getCellRenderer(r)(n.instance,o,e,t,i,s,r),n.instance.runHooks(&quot;afterRenderer&quot;,o,e,t,i,s,r)},selections:a,hideBorderOnMouseDownOver:function(){return n.settings.fragmentSelection},onCellMouseDown:function(t,o,r,s){var a={row:!1,column:!1,cells:!1};if(e.listen(),n.activeWt=s,i=!0,h.hooks.run(e,&quot;beforeOnCellMouseDown&quot;,t,o,r,a),!O(t)){var l=e.getSelectedRange(),u=e.selection,c=u.selectedHeader;if(t.shiftKey&amp;&amp;l)o.row&gt;=0&amp;&amp;o.col&gt;=0&amp;&amp;!a.cells?(u.setSelectedHeaders(!1,!1),u.setRangeEnd(o)):(c.cols||c.rows)&amp;&amp;o.row&gt;=0&amp;&amp;o.col&gt;=0&amp;&amp;!a.cells?(u.setSelectedHeaders(!1,!1),u.setRangeEnd(new x(o.row,o.col))):c.cols&amp;&amp;o.row&lt;0&amp;&amp;!a.column?u.setRangeEnd(new x(l.to.row,o.col)):c.rows&amp;&amp;o.col&lt;0&amp;&amp;!a.row?u.setRangeEnd(new x(o.row,l.to.col)):(!c.cols&amp;&amp;!c.rows&amp;&amp;o.col&lt;0||c.cols&amp;&amp;o.col&lt;0)&amp;&amp;!a.row?(u.setSelectedHeaders(!0,!1),u.setRangeStartOnly(new x(l.from.row,0)),u.setRangeEnd(new x(o.row,e.countCols()-1))):(!c.cols&amp;&amp;!c.rows&amp;&amp;o.row&lt;0||c.rows&amp;&amp;o.row&lt;0)&amp;&amp;!a.column&amp;&amp;(u.setSelectedHeaders(!1,!0),u.setRangeStartOnly(new x(0,l.from.col)),u.setRangeEnd(new x(e.countRows()-1,o.col)));else{var d=!0;if(l){var f=l,m=f.from,g=f.to,w=!u.inInSelection(o);if(o.row&lt;0&amp;&amp;c.cols){var v=Math.min(m.col,g.col),y=Math.max(m.col,g.col);d=o.col&lt;v||o.col&gt;y}else if(o.col&lt;0&amp;&amp;c.rows){var b=Math.min(m.row,g.row),C=Math.max(m.row,g.row);d=o.row&lt;b||o.row&gt;C}else d=w}var _=T(t),M=k(t)||&quot;touchstart&quot;===t.type;o.row&lt;0&amp;&amp;o.col&gt;=0&amp;&amp;!a.column?(u.setSelectedHeaders(!1,!0),(M||_&amp;&amp;d)&amp;&amp;(u.setRangeStartOnly(new x(0,o.col)),u.setRangeEnd(new x(Math.max(e.countRows()-1,0),o.col),!1))):o.col&lt;0&amp;&amp;o.row&gt;=0&amp;&amp;!a.row?(u.setSelectedHeaders(!0,!1),(M||_&amp;&amp;d)&amp;&amp;(u.setRangeStartOnly(new x(o.row,0)),u.setRangeEnd(new x(o.row,Math.max(e.countCols()-1,0)),!1))):o.col&gt;=0&amp;&amp;o.row&gt;=0&amp;&amp;!a.cells?(M||_&amp;&amp;d)&amp;&amp;(u.setSelectedHeaders(!1,!1),u.setRangeStart(o)):o.col&lt;0&amp;&amp;o.row&lt;0&amp;&amp;(o.row=0,o.col=0,u.setSelectedHeaders(!1,!1,!0),u.setRangeStart(o))}u.selectedHeader.rows?(R(e.rootElement,&quot;ht__selection--columns&quot;),p(e.rootElement,&quot;ht__selection--rows&quot;)):u.selectedHeader.cols?(R(e.rootElement,&quot;ht__selection--rows&quot;),p(e.rootElement,&quot;ht__selection--columns&quot;)):R(e.rootElement,[&quot;ht__selection--rows&quot;,&quot;ht__selection--columns&quot;]),h.hooks.run(e,&quot;afterOnCellMouseDown&quot;,t,o,r),n.activeWt=n.wt}},onCellMouseOver:function(t,o,r,s){var a={row:!1,column:!1,cell:!1};n.activeWt=s,h.hooks.run(e,&quot;beforeOnCellMouseOver&quot;,t,o,r,a),O(t)||(0===t.button&amp;&amp;i&amp;&amp;(o.row&gt;=0&amp;&amp;o.col&gt;=0?e.selection.selectedHeader.cols&amp;&amp;!a.column?e.selection.setRangeEnd(new x(e.countRows()-1,o.col),!1):e.selection.selectedHeader.rows&amp;&amp;!a.row?e.selection.setRangeEnd(new x(o.row,e.countCols()-1),!1):a.cell||e.selection.setRangeEnd(o):e.selection.selectedHeader.cols&amp;&amp;!a.column?e.selection.setRangeEnd(new x(e.countRows()-1,o.col),!1):e.selection.selectedHeader.rows&amp;&amp;!a.row?e.selection.setRangeEnd(new x(o.row,e.countCols()-1),!1):a.cell||e.selection.setRangeEnd(o)),h.hooks.run(e,&quot;afterOnCellMouseOver&quot;,t,o,r),n.activeWt=n.wt)},onCellMouseUp:function(t,o,r,i){n.activeWt=i,h.hooks.run(e,&quot;beforeOnCellMouseUp&quot;,t,o,r),h.hooks.run(e,&quot;afterOnCellMouseUp&quot;,t,o,r),n.activeWt=n.wt},onCellCornerMouseDown:function(t){t.preventDefault(),h.hooks.run(e,&quot;afterOnCellCornerMouseDown&quot;,t)},onCellCornerDblClick:function(t){t.preventDefault(),h.hooks.run(e,&quot;afterOnCellCornerDblClick&quot;,t)},beforeDraw:function(e,t){n.beforeRender(e,t)},onDraw:function(e){n.onDraw(e)},onScrollVertically:function(){e.runHooks(&quot;afterScrollVertically&quot;)},onScrollHorizontally:function(){e.runHooks(&quot;afterScrollHorizontally&quot;)},onBeforeDrawBorders:function(t,n){e.runHooks(&quot;beforeDrawBorders&quot;,t,n)},onBeforeTouchScroll:function(){e.runHooks(&quot;beforeTouchScroll&quot;)},onAfterMomentumScroll:function(){e.runHooks(&quot;afterMomentumScroll&quot;)},onBeforeStretchingColumnWidth:function(t,n){return e.runHooks(&quot;beforeStretchingColumnWidth&quot;,t,n)},onModifyRowHeaderWidth:function(t){return e.runHooks(&quot;modifyRowHeaderWidth&quot;,t)},viewportRowCalculatorOverride:function(t){var o=e.countRows(),r=n.settings.viewportRowRenderingOffset;if(&quot;auto&quot;===r&amp;&amp;n.settings.fixedRowsTop&amp;&amp;(r=10),&quot;number&quot;==typeof r&amp;&amp;(t.startRow=Math.max(t.startRow-r,0),t.endRow=Math.min(t.endRow+r,o-1)),&quot;auto&quot;===r){var i=t.startRow+t.endRow-t.startRow,s=Math.ceil(i/o*12);t.startRow=Math.max(t.startRow-s,0),t.endRow=Math.min(t.endRow+s,o-1)}e.runHooks(&quot;afterViewportRowCalculatorOverride&quot;,t)},viewportColumnCalculatorOverride:function(t){var o=e.countCols(),r=n.settings.viewportColumnRenderingOffset;if(&quot;auto&quot;===r&amp;&amp;n.settings.fixedColumnsLeft&amp;&amp;(r=10),&quot;number&quot;==typeof r&amp;&amp;(t.startColumn=Math.max(t.startColumn-r,0),t.endColumn=Math.min(t.endColumn+r,o-1)),&quot;auto&quot;===r){var i=t.startColumn+t.endColumn-t.startColumn,s=Math.ceil(i/o*12);t.startRow=Math.max(t.startColumn-s,0),t.endColumn=Math.min(t.endColumn+s,o-1)}e.runHooks(&quot;afterViewportColumnCalculatorOverride&quot;,t)},rowHeaderWidth:function(){return n.settings.rowHeaderWidth},columnHeaderHeight:function(){var t=e.runHooks(&quot;modifyColumnHeaderHeight&quot;);return n.settings.columnHeaderHeight||t}};h.hooks.run(e,&quot;beforeInitWalkontable&quot;,l),this.wt=new H(l),this.activeWt=this.wt,this.eventManager.addEventListener(n.wt.wtTable.spreader,&quot;mousedown&quot;,function(e){e.target===n.wt.wtTable.spreader&amp;&amp;3===e.which&amp;&amp;E(e)}),this.eventManager.addEventListener(n.wt.wtTable.spreader,&quot;contextmenu&quot;,function(e){e.target===n.wt.wtTable.spreader&amp;&amp;3===e.which&amp;&amp;E(e)}),this.eventManager.addEventListener(document.documentElement,&quot;click&quot;,function(){n.settings.observeDOMVisibility&amp;&amp;n.wt.drawInterrupted&amp;&amp;(n.instance.forceFullRender=!0,n.render())})}Object.defineProperties(n,{TableView:{get:function(){return o}},__esModule:{value:!0}});var r,i,s,a,l,u,c,d,h=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,f=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),p=f.addClass,m=f.empty,g=f.fastInnerHTML,w=f.fastInnerText,v=f.getScrollbarWidth,y=f.hasClass,b=f.isChildOf,C=f.isInput,_=f.isOutsideInput,R=f.removeClass,M=((s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).createObjectPropListener,(a=e(&quot;eventManager&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).eventManager),S=(l=e(&quot;helpers/dom/event&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}),E=S.stopPropagation,O=S.isImmediatePropagationStopped,T=S.isRightClick,k=S.isLeftClick,x=(u=e(&quot;3rdparty/walkontable/src/cell/coords&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).WalkontableCellCoords,D=(c=e(&quot;3rdparty/walkontable/src/selection&quot;),c&amp;&amp;c.__esModule&amp;&amp;c||{default:c}).WalkontableSelection,H=(d=e(&quot;3rdparty/walkontable/src/core&quot;),d&amp;&amp;d.__esModule&amp;&amp;d||{default:d}).Walkontable;h.TableView=o,o.prototype.isTextSelectionAllowed=function(e){if(C(e))return!0;var t=b(e,this.instance.view.wt.wtTable.spreader);return!(this.settings.fragmentSelection!==!0||!t)||(!(&quot;cell&quot;!==this.settings.fragmentSelection||!this.isSelectedOnlyCell()||!t)||!(this.settings.fragmentSelection||!this.isCellEdited()||!this.isSelectedOnlyCell()))},o.prototype.isSelectedOnlyCell=function(){var e=this.instance.getSelected()||[],t=e[0],n=e[1],o=e[2],r=e[3];return void 0!==t&amp;&amp;t===o&amp;&amp;n===r},o.prototype.isCellEdited=function(){var e=this.instance.getActiveEditor();return e&amp;&amp;e.isOpened()},o.prototype.beforeRender=function(e,t){e&amp;&amp;h.hooks.run(this.instance,&quot;beforeRender&quot;,this.instance.forceFullRender,t)},o.prototype.onDraw=function(e){e&amp;&amp;h.hooks.run(this.instance,&quot;afterRender&quot;,this.instance.forceFullRender)},o.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.forceFullRender=!1,this.instance.renderCall=!1},o.prototype.getCellAtCoords=function(e,t){var n=this.wt.getCell(e,t);return n&lt;0?null:n},o.prototype.scrollViewport=function(e){this.wt.scrollViewport(e)},o.prototype.appendRowHeader=function(e,t){if(t.firstChild){var n=t.firstChild;if(!y(n,&quot;relative&quot;))return m(t),void this.appendRowHeader(e,t);this.updateCellHeader(n.querySelector(&quot;.rowHeader&quot;),e,this.instance.getRowHeader)}else{var o=document.createElement(&quot;div&quot;),r=document.createElement(&quot;span&quot;);o.className=&quot;relative&quot;,r.className=&quot;rowHeader&quot;,this.updateCellHeader(r,e,this.instance.getRowHeader),o.appendChild(r),t.appendChild(o)}h.hooks.run(this.instance,&quot;afterGetRowHeader&quot;,e,t)},o.prototype.appendColHeader=function(e,t){if(t.firstChild){var n=t.firstChild;y(n,&quot;relative&quot;)?this.updateCellHeader(n.querySelector(&quot;.colHeader&quot;),e,this.instance.getColHeader):(m(t),this.appendColHeader(e,t))}else{var o=document.createElement(&quot;div&quot;),r=document.createElement(&quot;span&quot;);o.className=&quot;relative&quot;,r.className=&quot;colHeader&quot;,this.updateCellHeader(r,e,this.instance.getColHeader),o.appendChild(r),
t.appendChild(o)}h.hooks.run(this.instance,&quot;afterGetColHeader&quot;,e,t)},o.prototype.updateCellHeader=function(e,t,n){var o=t,r=this.wt.wtOverlays.getParentOverlay(e)||this.wt;e.parentNode&amp;&amp;(y(e,&quot;colHeader&quot;)?o=r.wtTable.columnFilter.sourceToRendered(t):y(e,&quot;rowHeader&quot;)&amp;&amp;(o=r.wtTable.rowFilter.sourceToRendered(t))),o&gt;-1?g(e,n(t)):(w(e,String.fromCharCode(160)),p(e,&quot;cornerHeader&quot;))},o.prototype.maximumVisibleElementWidth=function(e){var t=this.wt.wtViewport.getWorkspaceWidth(),n=t-e;return n&gt;0?n:0},o.prototype.maximumVisibleElementHeight=function(e){var t=this.wt.wtViewport.getWorkspaceHeight(),n=t-e;return n&gt;0?n:0},o.prototype.mainViewIsActive=function(){return this.wt===this.activeWt},o.prototype.destroy=function(){this.wt.destroy(),this.eventManager.destroy()}},{&quot;3rdparty/walkontable/src/cell/coords&quot;:6,&quot;3rdparty/walkontable/src/core&quot;:8,&quot;3rdparty/walkontable/src/selection&quot;:19,browser:24,eventManager:42,&quot;helpers/dom/element&quot;:47,&quot;helpers/dom/event&quot;:48,&quot;helpers/object&quot;:53}],127:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{NodeStructure:{get:function(){return i}},LinkedList:{get:function(){return s}},__esModule:{value:!0}});var o,r=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,i=function(e){this.data=e,this.next=null,this.prev=null};$traceurRuntime.createClass(i,{},{});var s=function(){this.first=null,this.last=null};$traceurRuntime.createClass(s,{push:function(e){var t=new i(e);if(null===this.first)this.first=this.last=t;else{var n=this.last;this.last=t,t.prev=n,n.next=t}},unshift:function(e){var t=new i(e);if(null===this.first)this.first=this.last=t;else{var n=this.first;this.first=t,t.next=n,n.prev=t}},inorder:function(e){for(var t=this.first;t;)e(t),t=t.next},remove:function(e){if(null===this.first)return!1;for(var t,n,o=this.first;o;){if(o.data===e)return t=o.next,n=o.prev,t&amp;&amp;(t.prev=n),n&amp;&amp;(n.next=t),o===this.first&amp;&amp;(this.first=t),o===this.last&amp;&amp;(this.last=n),!0;o=o.next}return!1},hasCycle:function(){for(var e=this.first,t=this.first;;){if(null===e)return!1;if(e=e.next,null===e)return!1;if(e=e.next,t=t.next,e===t)return!0}},pop:function(){if(null===this.last)return null;var e=this.last;return this.last=this.last.prev,e},shift:function(){if(null===this.first)return null;var e=this.first;return this.first=this.first.next,e},recursiveReverse:function(){function e(t,n){n&amp;&amp;(e(n,n.next),n.next=t)}if(this.first){e(this.first,this.first.next),this.first.next=null;var t=this.first;this.first=this.last,this.last=t}},reverse:function(){if(this.first&amp;&amp;this.first.next){for(var e,t=this.first.next,n=this.first;t;)e=t.next,t.next=n,n.prev=t,n=t,t=e;this.first.next=null,this.last.prev=null,e=this.first,this.first=n,this.last=e}}},{}),r.utils.NodeStructure=i,r.utils.LinkedList=s},{browser:24}],128:[function(e,t,n){&quot;use strict&quot;;Object.defineProperties(n,{GhostTable:{get:function(){return m}},__esModule:{value:!0}});var o,r,i,s,a,l,u=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,c=(r=e(&quot;helpers/dom/element&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}),d=c.addClass,h=c.outerHeight,f=c.outerWidth,p=(i=e(&quot;helpers/array&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).arrayEach,m=((s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).objectEach,(a=e(&quot;helpers/number&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}).rangeEach,(l=e(&quot;helpers/mixed&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).stringify,function(e){this.hot=e,this.container=null,this.injected=!1,this.rows=[],this.columns=[],this.samples=null,this.settings={useHeaders:!0}});$traceurRuntime.createClass(m,{addRow:function(e,t){if(this.columns.length)throw new Error(&quot;Doesn't support multi-dimensional table&quot;);this.rows.length||(this.container=this.createContainer(this.hot.rootElement.className));var n={row:e};this.rows.push(n),this.samples=t,this.table=this.createTable(this.hot.table.className),this.table.colGroup.appendChild(this.createColGroupsCol()),this.table.tr.appendChild(this.createRow(e)),this.container.container.appendChild(this.table.fragment),n.table=this.table.table},addColumnHeadersRow:function(e){if(null!=this.hot.getColHeader(0)){var t={row:-1};this.rows.push(t),this.container=this.createContainer(this.hot.rootElement.className),this.samples=e,this.table=this.createTable(this.hot.table.className),this.table.colGroup.appendChild(this.createColGroupsCol()),this.table.tHead.appendChild(this.createColumnHeadersRow()),this.container.container.appendChild(this.table.fragment),t.table=this.table.table}},addColumn:function(e,t){if(this.rows.length)throw new Error(&quot;Doesn't support multi-dimensional table&quot;);this.columns.length||(this.container=this.createContainer(this.hot.rootElement.className));var n={col:e};this.columns.push(n),this.samples=t,this.table=this.createTable(this.hot.table.className),this.getSetting(&quot;useHeaders&quot;)&amp;&amp;null!==this.hot.getColHeader(e)&amp;&amp;this.hot.view.appendColHeader(e,this.table.th),this.table.tBody.appendChild(this.createCol(e)),this.container.container.appendChild(this.table.fragment),n.table=this.table.table},getHeights:function(e){this.injected||this.injectTable(),p(this.rows,function(t){e(t.row,h(t.table)-1)})},getWidths:function(e){this.injected||this.injectTable(),p(this.columns,function(t){e(t.col,f(t.table))})},setSettings:function(e){this.settings=e},setSetting:function(e,t){this.settings||(this.settings={}),this.settings[e]=t},getSettings:function(){return this.settings},getSetting:function(e){return this.settings?this.settings[e]:null},createColGroupsCol:function(){var e=this,t=document,n=t.createDocumentFragment();return this.hot.hasRowHeaders()&amp;&amp;n.appendChild(this.createColElement(-1)),this.samples.forEach(function(t){p(t.strings,function(t){n.appendChild(e.createColElement(t.col))})}),n},createRow:function(e){var t=this,n=document,o=n.createDocumentFragment(),r=n.createElement(&quot;th&quot;);return this.hot.hasRowHeaders()&amp;&amp;(this.hot.view.appendRowHeader(e,r),o.appendChild(r)),this.samples.forEach(function(r){p(r.strings,function(r){var i=r.col,s=t.hot.getCellMeta(e,i);s.col=i,s.row=e;var a=t.hot.getCellRenderer(s),l=n.createElement(&quot;td&quot;);a(t.hot,l,e,i,t.hot.colToProp(i),r.value,s),o.appendChild(l)})}),o},createColumnHeadersRow:function(){var e=this,t=document,n=t.createDocumentFragment();if(this.hot.hasRowHeaders()){var o=t.createElement(&quot;th&quot;);this.hot.view.appendColHeader(-1,o),n.appendChild(o)}return this.samples.forEach(function(o){p(o.strings,function(o){var r=o.col,i=t.createElement(&quot;th&quot;);e.hot.view.appendColHeader(r,i),n.appendChild(i)})}),n},createCol:function(e){var t=this,n=document,o=n.createDocumentFragment();return this.samples.forEach(function(r){p(r.strings,function(r){var i=r.row,s=t.hot.getCellMeta(i,e);s.col=e,s.row=i;var a=t.hot.getCellRenderer(s),l=n.createElement(&quot;td&quot;),u=n.createElement(&quot;tr&quot;);a(t.hot,l,i,e,t.hot.colToProp(e),r.value,s),u.appendChild(l),o.appendChild(u)})}),o},clean:function(){this.rows.length=0,this.rows[-1]=void 0,this.columns.length=0,this.samples&amp;&amp;this.samples.clear(),this.samples=null,this.removeTable()},injectTable:function(){var e=void 0!==arguments[0]?arguments[0]:null;this.injected||((e||this.hot.rootElement).appendChild(this.container.fragment),this.injected=!0)},removeTable:function(){this.injected&amp;&amp;this.container.container.parentNode&amp;&amp;(this.container.container.parentNode.removeChild(this.container.container),this.container=null,this.injected=!1)},createColElement:function(e){var t=document,n=t.createElement(&quot;col&quot;);return n.style.width=this.hot.view.wt.wtTable.getStretchedColumnWidth(e)+&quot;px&quot;,n},createTable:function(){var e=void 0!==arguments[0]?arguments[0]:&quot;&quot;,t=document,n=t.createDocumentFragment(),o=t.createElement(&quot;table&quot;),r=t.createElement(&quot;thead&quot;),i=t.createElement(&quot;tbody&quot;),s=t.createElement(&quot;colgroup&quot;),a=t.createElement(&quot;tr&quot;),l=t.createElement(&quot;th&quot;);return this.isVertical()&amp;&amp;o.appendChild(s),this.isHorizontal()&amp;&amp;(a.appendChild(l),r.appendChild(a),o.style.tableLayout=&quot;auto&quot;,o.style.width=&quot;auto&quot;),o.appendChild(r),this.isVertical()&amp;&amp;i.appendChild(a),o.appendChild(i),d(o,e),n.appendChild(o),{fragment:n,table:o,tHead:r,tBody:i,colGroup:s,tr:a,th:l}},createContainer:function(){var e=void 0!==arguments[0]?arguments[0]:&quot;&quot;,t=document,n=t.createDocumentFragment(),o=t.createElement(&quot;div&quot;);return e=&quot;htGhostTable htAutoSize &quot;+e.trim(),d(o,e),n.appendChild(o),{fragment:n,container:o}},isVertical:function(){return!(!this.rows.length||this.columns.length)},isHorizontal:function(){return!(!this.columns.length||this.rows.length)}},{}),u.utils.GhostTable=m},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/mixed&quot;:51,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53}],129:[function(e,t,n){&quot;use strict&quot;;function o(e){return&quot;string&quot;==typeof e&amp;&amp;/fps$/.test(e)&amp;&amp;(e=1e3/parseInt(e.replace(&quot;fps&quot;,&quot;&quot;)||0,10)),e}Object.defineProperties(n,{Interval:{get:function(){return c}},__esModule:{value:!0}});var r,i,s=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,a=(i=e(&quot;helpers/feature&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),l=a.requestAnimationFrame,u=a.cancelAnimationFrame,c=function(e,t){var n=this;this.timer=null,this.func=e,this.delay=o(t),this.stopped=!0,this._then=null,this._callback=function(){return n.__callback()}},d=c;$traceurRuntime.createClass(c,{start:function(){return this.stopped&amp;&amp;(this._then=Date.now(),this.stopped=!1,this.timer=l(this._callback)),this},stop:function(){return this.stopped||(this.stopped=!0,u(this.timer),this.timer=null),this},__callback:function(){if(this.timer=l(this._callback),this.delay){var e=Date.now(),t=e-this._then;t&gt;this.delay&amp;&amp;(this._then=e-t%this.delay,this.func())}else this.func()}},{create:function(e,t){return new d(e,t)}}),s.utils.Interval=c},{browser:24,&quot;helpers/feature&quot;:49}],130:[function(e,t,n){&quot;use strict&quot;;function o(e,t){c.set(e,t)}function r(e){var t;if(!(e instanceof a.Core)){if(!c.has(e))throw Error(&quot;Record translator was not registered for this object identity&quot;);e=c.get(e)}return d.has(e)?t=d.get(e):(t=new u(e),d.set(e,t)),t}Object.defineProperties(n,{registerIdentity:{get:function(){return o}},getTranslator:{get:function(){return r}},__esModule:{value:!0}});var i,s,a=(i=e(&quot;browser&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).default,l=(s=e(&quot;helpers/object&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).isObject,u=function(e){this.hot=e};$traceurRuntime.createClass(u,{toVisualRow:function(e){return this.hot.runHooks(&quot;unmodifyRow&quot;,e)},toVisualColumn:function(e){return this.hot.runHooks(&quot;unmodifyCol&quot;,e)},toVisual:function(e,t){var n;return n=l(e)?{row:this.toVisualRow(e.row),column:this.toVisualColumn(e.column)}:[this.toVisualRow(e),this.toVisualColumn(t)]},toPhysicalRow:function(e){return this.hot.runHooks(&quot;modifyRow&quot;,e)},toPhysicalColumn:function(e){return this.hot.runHooks(&quot;modifyCol&quot;,e)},toPhysical:function(e,t){var n;return n=l(e)?{row:this.toPhysicalRow(e.row),column:this.toPhysicalColumn(e.column)}:[this.toPhysicalRow(e),this.toPhysicalColumn(t)]}},{});var c=new WeakMap,d=new WeakMap;a.utils.RecordTranslator=u,a.utils.RecordTranslatorUtils={registerIdentity:o,getTranslator:r}},{browser:24,&quot;helpers/object&quot;:53}],131:[function(e,t,n){&quot;use strict&quot;;var o;Object.defineProperties(n,{SamplesGenerator:{get:function(){return g}},__esModule:{value:!0}});var r,i,s,a,l,u,c=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,d=(i=e(&quot;helpers/dom/element&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}),h=(d.addClass,d.outerHeight,d.outerWidth,(s=e(&quot;helpers/array&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).arrayEach,a=e(&quot;helpers/object&quot;),a&amp;&amp;a.__esModule&amp;&amp;a||{default:a}),f=(h.objectEach,h.isObject),p=(l=e(&quot;helpers/number&quot;),l&amp;&amp;l.__esModule&amp;&amp;l||{default:l}).rangeEach,m=(u=e(&quot;helpers/mixed&quot;),u&amp;&amp;u.__esModule&amp;&amp;u||{default:u}).stringify,g=function(e){this.samples=null,this.dataFactory=e,this.customSampleCount=null,this.allowDuplicates=!1},w=g;$traceurRuntime.createClass(g,(o={},Object.defineProperty(o,&quot;getSampleCount&quot;,{value:function(){return this.customSampleCount?this.customSampleCount:w.SAMPLE_COUNT},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;setSampleCount&quot;,{value:function(e){this.customSampleCount=e},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;setAllowDuplicates&quot;,{value:function(e){this.allowDuplicates=e},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;generateRowSamples&quot;,{value:function(e,t){return this.generateSamples(&quot;row&quot;,t,e)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;generateColumnSamples&quot;,{value:function(e,t){return this.generateSamples(&quot;col&quot;,t,e)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;generateSamples&quot;,{value:function(e,t,n){var o=this,r=new Map;return&quot;number&quot;==typeof n&amp;&amp;(n={from:n,to:n}),p(n.from,n.to,function(n){var i=o.generateSample(e,t,n);r.set(n,i)}),r},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,&quot;generateSample&quot;,{value:function(e,t,n){var o,r=this,i=new Map,s=[];return p(t.from,t.to,function(t){var a,l;if(&quot;row&quot;===e)l=r.dataFactory(n,t);else{if(&quot;col&quot;!==e)throw new Error(&quot;Unsupported sample type&quot;);l=r.dataFactory(t,n)}o=f(l)?Object.keys(l).length:Array.isArray(l)?l.length:m(l).length,i.has(o)||i.set(o,{needed:r.getSampleCount(),strings:[]});var u=i.get(o);if(u.needed){var c=s.indexOf(l)&gt;-1;if(!c||r.allowDuplicates){var d=&quot;row&quot;===e?&quot;col&quot;:&quot;row&quot;;u.strings.push((a={},Object.defineProperty(a,&quot;value&quot;,{value:l,configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(a,d,{value:t,configurable:!0,enumerable:!0,writable:!0}),a)),s.push(l),u.needed--}}}),i},configurable:!0,enumerable:!0,writable:!0}),o),{get SAMPLE_COUNT(){return 3}}),c.utils.SamplesGenerator=g},{browser:24,&quot;helpers/array&quot;:43,&quot;helpers/dom/element&quot;:47,&quot;helpers/mixed&quot;:51,&quot;helpers/number&quot;:52,&quot;helpers/object&quot;:53}],132:[function(e,t,n){&quot;use strict&quot;;function o(e){var t=void 0!==arguments[1]?arguments[1]:u,n=void 0!==arguments[2]?arguments[2]:0,i=void 0!==arguments[3]?arguments[3]:e.length;if(Math.abs(i-n)&lt;=1)return[];var s=Math.ceil((n+i)/2);return o(e,t,n,s),o(e,t,s,i),r(e,t,n,s,i)}function r(e,t,n,o,r){for(var i=new a,s=new a,l=o-n,u=r-o,c=Math.max(l,u),d=r-n,h=0;h&lt;c;h+=1)h&lt;l&amp;&amp;i.push(e[n+h]),h&lt;u&amp;&amp;s.push(e[o+h]);for(var f=0;f&lt;d;)i.first&amp;&amp;s.first?t(i.first.data,s.first.data)&gt;0?e[n+f]=s.shift().data:e[n+f]=i.shift().data:i.first?e[n+f]=i.shift().data:e[n+f]=s.shift().data,f+=1;return e}Object.defineProperties(n,{mergeSort:{get:function(){return o}},__esModule:{value:!0}});var i,s,a=(i=e(&quot;../dataStructures/linkedList&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).LinkedList,l=(s=e(&quot;browser&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).default,u=function(e,t){var n=e.toString(),o=t.toString();return n===o?0:n&lt;o?-1:1};l.utils.mergeSort=o},{&quot;../dataStructures/linkedList&quot;:127,browser:24}],133:[function(e,t,n){&quot;use strict&quot;;function o(e,t){var n=e;return function(e){for(var o=!1,r=0,i=e.length;r&lt;i;r++)if(n===e[r]){o=!0;break}t(o)}}var r,i,s=(r=e(&quot;browser&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default;(i=e(&quot;helpers/mixed&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).stringify;s.AutocompleteValidator=function(e,t){return null==e&amp;&amp;(e=&quot;&quot;),this.allowEmpty&amp;&amp;&quot;&quot;===e?void t(!0):void(this.strict&amp;&amp;this.source?&quot;function&quot;==typeof this.source?this.source(e,o(e,t)):o(e,t)(this.source):t(!0))}},{browser:24,&quot;helpers/mixed&quot;:51}],134:[function(e,t,n){&quot;use strict&quot;;var o,r,i,s,a=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,l=(r=e(&quot;moment&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,u=(i=e(&quot;../helpers/date&quot;),i&amp;&amp;i.__esModule&amp;&amp;i||{default:i}).getNormalizedDate,c=(s=e(&quot;editors&quot;),s&amp;&amp;s.__esModule&amp;&amp;s||{default:s}).getEditor;a.DateValidator=function(e,t){var n=!0,o=c(&quot;date&quot;,this.instance);null==e&amp;&amp;(e=&quot;&quot;);var r=l(new Date(e)).isValid()||l(e,o.defaultDateFormat).isValid(),i=l(e,this.dateFormat||o.defaultDateFormat,!0).isValid();if(this.allowEmpty&amp;&amp;&quot;&quot;===e&amp;&amp;(r=!0,i=!0),r||(n=!1),!r&amp;&amp;i&amp;&amp;(n=!0),r&amp;&amp;!i)if(this.correctFormat===!0){var s=d(e,this.dateFormat),a=this.instance.runHooks(&quot;unmodifyRow&quot;,this.row),u=this.instance.runHooks(&quot;unmodifyCol&quot;,this.col);this.instance.setDataAtCell(a,u,s,&quot;dateValidator&quot;),n=!0}else n=!1;t(n)};var d=function(e,t){var n,o=l(u(e)),r=l(e,t),i=e.search(/[A-z]/g)&gt;-1;return n=o.isValid()&amp;&amp;o.format(&quot;x&quot;)===r.format(&quot;x&quot;)||!r.isValid()||i?o:r,n.format(t)}},{&quot;../helpers/date&quot;:46,browser:24,editors:30,moment:&quot;moment&quot;}],135:[function(e,t,n){&quot;use strict&quot;;var o,r=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default;r.NumericValidator=function(e,t){null==e&amp;&amp;(e=&quot;&quot;),t(this.allowEmpty&amp;&amp;&quot;&quot;===e?!0:&quot;&quot;===e?!1:/^-?\d*(\.|\,)?\d*$/.test(e))}},{browser:24}],136:[function(e,t,n){&quot;use strict&quot;;var o,r,i=(o=e(&quot;browser&quot;),o&amp;&amp;o.__esModule&amp;&amp;o||{default:o}).default,s=(r=e(&quot;moment&quot;),r&amp;&amp;r.__esModule&amp;&amp;r||{default:r}).default,a=[&quot;YYYY-MM-DDTHH:mm:ss.SSSZ&quot;,&quot;X&quot;,&quot;x&quot;];i.TimeValidator=function(e,t){var n=!0,o=this.timeFormat||&quot;h:mm:ss a&quot;;null===e&amp;&amp;(e=&quot;&quot;),e=/^\d{3,}$/.test(e)?parseInt(e,10):e;var r=/^\d{1,2}$/.test(e);r&amp;&amp;(e+=&quot;:00&quot;);var i=s(e,a,!0).isValid()?s(e):s(e,o),l=i.isValid(),u=s(e,o,!0).isValid()&amp;&amp;!r;if(this.allowEmpty&amp;&amp;&quot;&quot;===e&amp;&amp;(l=!0,u=!0),l||(n=!1),!l&amp;&amp;u&amp;&amp;(n=!0),l&amp;&amp;!u)if(this.correctFormat===!0){var c=i.format(o),d=this.instance.runHooks(&quot;unmodifyRow&quot;,this.row),h=this.instance.runHooks(&quot;unmodifyCol&quot;,this.col);this.instance.setDataAtCell(d,h,c,&quot;timeValidator&quot;),n=!0}else n=!1;t(n)}},{browser:24,moment:&quot;moment&quot;}],SheetClip:[function(e,t,n){!function(e){&quot;use strict&quot;;function t(e){return e.split('&quot;').length-1}var o={parse:function(e){var n,o,r,i,s,a,l,u=[],c=0;for(r=e.split(&quot;\n&quot;),r.length&gt;1&amp;&amp;&quot;&quot;===r[r.length-1]&amp;&amp;r.pop(),n=0,o=r.length;n&lt;o;n+=1){for(r[n]=r[n].split(&quot;\t&quot;),i=0,s=r[n].length;i&lt;s;i+=1)u[c]||(u[c]=[]),a&amp;&amp;0===i?(l=u[c].length-1,u[c][l]=u[c][l]+&quot;\n&quot;+r[n][0],a&amp;&amp;1&amp;t(r[n][0])&amp;&amp;(a=!1,u[c][l]=u[c][l].substring(0,u[c][l].length-1).replace(/&quot;&quot;/g,'&quot;'))):i===s-1&amp;&amp;0===r[n][i].indexOf('&quot;')&amp;&amp;1&amp;t(r[n][i])?(u[c].push(r[n][i].substring(1).replace(/&quot;&quot;/g,'&quot;')),a=!0):(u[c].push(r[n][i].replace(/&quot;&quot;/g,'&quot;')),a=!1);a||(c+=1)}return u},stringify:function(e){var t,n,o,r,i,s=&quot;&quot;;for(t=0,n=e.length;t&lt;n;t+=1){for(r=e[t].length,o=0;o&lt;r;o+=1)o&gt;0&amp;&amp;(s+=&quot;\t&quot;),i=e[t][o],s+=&quot;string&quot;==typeof i?i.indexOf(&quot;\n&quot;)&gt;-1?'&quot;'+i.replace(/&quot;/g,'&quot;&quot;')+'&quot;':i:null===i||void 0===i?&quot;&quot;:i;s+=&quot;\n&quot;}return s}};&quot;undefined&quot;!=typeof n?(n.parse=o.parse,n.stringify=o.stringify):e.SheetClip=o}(window)},{}],autoResize:[function(e,t,n){function o(){function e(e){return e.currentStyle||document.defaultView.getComputedStyle(e)}var t,n={minHeight:200,maxHeight:300,minWidth:100,maxWidth:300},o=document.body,r=document.createTextNode(&quot;&quot;),i=document.createElement(&quot;SPAN&quot;),s=function(e,t,n){window.attachEvent?e.attachEvent(&quot;on&quot;+t,n):e.addEventListener(t,n,!1)},a=function(e,t,n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent(&quot;on&quot;+t,n)},l=function(s){var a,l;s?/^[a-zA-Z \.,\\\/\|0-9]$/.test(s)||(s=&quot;.&quot;):s=&quot;&quot;,void 0!==r.textContent?r.textContent=t.value+s:r.data=t.value+s,i.style.fontSize=e(t).fontSize,i.style.fontFamily=e(t).fontFamily,i.style.whiteSpace=&quot;pre&quot;,o.appendChild(i),a=i.clientWidth+2,o.removeChild(i),t.style.height=n.minHeight+&quot;px&quot;,n.minWidth&gt;a?t.style.width=n.minWidth+&quot;px&quot;:a&gt;n.maxWidth?t.style.width=n.maxWidth+&quot;px&quot;:t.style.width=a+&quot;px&quot;,l=t.scrollHeight?t.scrollHeight-1:0,n.minHeight&gt;l?t.style.height=n.minHeight+&quot;px&quot;:n.maxHeight&lt;l?(t.style.height=n.maxHeight+&quot;px&quot;,t.style.overflowY=&quot;visible&quot;):t.style.height=l+&quot;px&quot;},u=function(){window.setTimeout(l,0)},c=function(e){if(e&amp;&amp;e.minHeight)if(&quot;inherit&quot;==e.minHeight)n.minHeight=t.clientHeight;else{var o=parseInt(e.minHeight);isNaN(o)||(n.minHeight=o)}if(e&amp;&amp;e.maxHeight)if(&quot;inherit&quot;==e.maxHeight)n.maxHeight=t.clientHeight;else{var s=parseInt(e.maxHeight);isNaN(s)||(n.maxHeight=s)}if(e&amp;&amp;e.minWidth)if(&quot;inherit&quot;==e.minWidth)n.minWidth=t.clientWidth;else{var a=parseInt(e.minWidth);isNaN(a)||(n.minWidth=a)}if(e&amp;&amp;e.maxWidth)if(&quot;inherit&quot;==e.maxWidth)n.maxWidth=t.clientWidth;else{var l=parseInt(e.maxWidth);isNaN(l)||(n.maxWidth=l)}i.firstChild||(i.className=&quot;autoResize&quot;,i.style.display=&quot;inline-block&quot;,i.appendChild(r))},d=function(e,o,r){t=e,c(o),&quot;TEXTAREA&quot;==t.nodeName&amp;&amp;(t.style.resize=&quot;none&quot;,t.style.overflowY=&quot;&quot;,t.style.height=n.minHeight+&quot;px&quot;,t.style.minWidth=n.minWidth+&quot;px&quot;,t.style.maxWidth=n.maxWidth+&quot;px&quot;,t.style.overflowY=&quot;hidden&quot;),r&amp;&amp;(s(t,&quot;change&quot;,l),s(t,&quot;cut&quot;,u),s(t,&quot;paste&quot;,u),s(t,&quot;drop&quot;,u),s(t,&quot;keydown&quot;,u),s(t,&quot;focus&quot;,l)),l()};return{init:function(e,t,n){d(e,t,n)},unObserve:function(){a(t,&quot;change&quot;,l),a(t,&quot;cut&quot;,u),a(t,&quot;paste&quot;,u),a(t,&quot;drop&quot;,u),a(t,&quot;keydown&quot;,u),a(t,&quot;focus&quot;,l)},resize:l}}&quot;undefined&quot;!=typeof n&amp;&amp;(t.exports=o)},{}],copyPaste:[function(e,t,n){function o(){return i?i.hasBeenDestroyed()&amp;&amp;i.init():i=new r,i.refCounter++,i}function r(){this.refCounter=0,this.init()}var i;&quot;undefined&quot;!=typeof n&amp;&amp;(t.exports=o),r.prototype.init=function(){var e,t;this.copyCallbacks=[],this.cutCallbacks=[],this.pasteCallbacks=[],t=document.body,document.getElementById(&quot;CopyPasteDiv&quot;)?(this.elDiv=document.getElementById(&quot;CopyPasteDiv&quot;),this.elTextarea=this.elDiv.firstChild):(this.elDiv=document.createElement(&quot;div&quot;),this.elDiv.id=&quot;CopyPasteDiv&quot;,e=this.elDiv.style,e.position=&quot;fixed&quot;,e.top=&quot;-10000px&quot;,e.left=&quot;-10000px&quot;,t.appendChild(this.elDiv),this.elTextarea=document.createElement(&quot;textarea&quot;),this.elTextarea.className=&quot;copyPaste&quot;,this.elTextarea.onpaste=function(e){var t,n;&quot;WebkitAppearance&quot;in document.documentElement.style&amp;&amp;(t=e.clipboardData.getData(&quot;Text&quot;),navigator.userAgent.indexOf(&quot;Safari&quot;)!==-1&amp;&amp;navigator.userAgent.indexOf(&quot;Chrome&quot;)===-1&amp;&amp;(n=t.split(&quot;\n&quot;),&quot;&quot;===n[n.length-1]&amp;&amp;n.pop(),t=n.join(&quot;\n&quot;)),this.value=t,e.preventDefault())},e=this.elTextarea.style,e.width=&quot;10000px&quot;,e.height=&quot;10000px&quot;,e.overflow=&quot;hidden&quot;,this.elDiv.appendChild(this.elTextarea),&quot;undefined&quot;!=typeof e.opacity&amp;&amp;(e.opacity=0)),this.onKeyDownRef=this.onKeyDown.bind(this),document.documentElement.addEventListener(&quot;keydown&quot;,this.onKeyDownRef,!1)},r.prototype.onKeyDown=function(e){function t(){var e=document.activeElement;return e.shadowRoot&amp;&amp;e.shadowRoot.activeElement&amp;&amp;(e=e.shadowRoot.activeElement),[&quot;INPUT&quot;,&quot;SELECT&quot;,&quot;TEXTAREA&quot;].indexOf(e.nodeName)&gt;-1||&quot;true&quot;===e.contentEditable}var n=this,o=!1;if(e.metaKey?o=!0:e.ctrlKey&amp;&amp;navigator.userAgent.indexOf(&quot;Mac&quot;)===-1&amp;&amp;(o=!0),o){if(document.activeElement!==this.elTextarea&amp;&amp;(&quot;&quot;!==this.getSelectionText()||t()))return;this.selectNodeText(this.elTextarea),setTimeout(function(){document.activeElement!==n.elTextarea&amp;&amp;n.selectNodeText(n.elTextarea)},0)}e.isImmediatePropagationEnabled===!1||!o||67!==e.keyCode&amp;&amp;86!==e.keyCode&amp;&amp;88!==e.keyCode||(88===e.keyCode?setTimeout(function(){n.triggerCut(e)},0):86===e.keyCode&amp;&amp;setTimeout(function(){n.triggerPaste(e)},0))},r.prototype.selectNodeText=function(e){e&amp;&amp;e.select()},r.prototype.getSelectionText=function(){var e=&quot;&quot;;return window.getSelection?e=window.getSelection().toString():document.selection&amp;&amp;&quot;Control&quot;!==document.selection.type&amp;&amp;(e=document.selection.createRange().text),e},r.prototype.copyable=function(e){if(&quot;string&quot;!=typeof e&amp;&amp;void 0===e.toString)throw new Error(&quot;copyable requires string parameter&quot;);this.elTextarea.value=e,this.selectNodeText(this.elTextarea)},r.prototype.onCut=function(e){this.cutCallbacks.push(e)},r.prototype.onPaste=function(e){this.pasteCallbacks.push(e)},r.prototype.removeCallback=function(e){var t,n;for(t=0,n=this.copyCallbacks.length;t&lt;n;t++)if(this.copyCallbacks[t]===e)return this.copyCallbacks.splice(t,1),!0;for(t=0,n=this.cutCallbacks.length;t&lt;n;t++)if(this.cutCallbacks[t]===e)return this.cutCallbacks.splice(t,1),!0;for(t=0,n=this.pasteCallbacks.length;t&lt;n;t++)if(this.pasteCallbacks[t]===e)return this.pasteCallbacks.splice(t,1),!0;return!1},r.prototype.triggerCut=function(e){var t=this;t.cutCallbacks&amp;&amp;setTimeout(function(){for(var n=0,o=t.cutCallbacks.length;n&lt;o;n++)t.cutCallbacks[n](e)},50)},r.prototype.triggerPaste=function(e,t){var n=this;n.pasteCallbacks&amp;&amp;setTimeout(function(){for(var o=t||n.elTextarea.value,r=0,i=n.pasteCallbacks.length;r&lt;i;r++)n.pasteCallbacks[r](o,e)},50)},r.prototype.destroy=function(){this.hasBeenDestroyed()||0!==--this.refCounter||(this.elDiv&amp;&amp;this.elDiv.parentNode&amp;&amp;(this.elDiv.parentNode.removeChild(this.elDiv),this.elDiv=null,this.elTextarea=null),document.documentElement.removeEventListener(&quot;keydown&quot;,this.onKeyDownRef),this.onKeyDownRef=null)},r.prototype.hasBeenDestroyed=function(){return!this.refCounter}},{}],es6collections:[function(e,t,n){/*!
 * Copyright (C) 2011 by Andrea Giammarchi, @WebReflection
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e){&quot;use strict&quot;;function t(e,t){function o(e){return this&amp;&amp;this.constructor===o?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=t,void(e&amp;&amp;n.call(this,e))):new o(e)}return t||y(e,&quot;size&quot;,{get:g}),e.constructor=o,o.prototype=e,o}function n(e){this.add?e.forEach(this.add,this):e.forEach(function(e){this.set(e[0],e[1])},this)}function o(e){return this.has(e)&amp;&amp;(this._keys.splice(v,1),this._values.splice(v,1),this._itp.forEach(function(e){v&lt;e[0]&amp;&amp;e[0]--})),-1&lt;v}function r(e){return this.has(e)?this._values[v]:void 0}function i(e,t){if(this.objectOnly&amp;&amp;t!==Object(t))throw new TypeError(&quot;Invalid value used as weak collection key&quot;);if(t!=t||0===t)for(v=e.length;v--&amp;&amp;!b(e[v],t););else v=e.indexOf(t);return-1&lt;v}function s(e){return i.call(this,this._values,e)}function a(e){return i.call(this,this._keys,e)}function l(e,t){return this.has(e)?this._values[v]=t:this._values[this._keys.push(e)-1]=t,this}function u(e){return this.has(e)||this._values.push(e),this}function c(){this._values.length=0}function d(){return m(this._itp,this._keys)}function h(){return m(this._itp,this._values)}function f(){return m(this._itp,this._keys,this._values)}function p(){return m(this._itp,this._values,this._values)}function m(e,t,n){var o=[0],r=!1;return e.push(o),{next:function(){var i,s=o[0];return!r&amp;&amp;s&lt;t.length?(i=n?[t[s],n[s]]:t[s],o[0]++):(r=!0,e.splice(e.indexOf(o),1)),{done:r,value:i}}}}function g(){return this._values.length}function w(e,t){for(var n=this.entries();;){var o=n.next();if(o.done)break;e.call(t,o.value[1],o.value[0],this)}}var v,y=Object.defineProperty,b=function(e,t){return isNaN(e)?isNaN(t):e===t};&quot;undefined&quot;==typeof WeakMap&amp;&amp;(e.WeakMap=t({delete:o,clear:c,get:r,has:a,set:l},!0)),&quot;undefined&quot;==typeof Map&amp;&amp;(e.Map=t({delete:o,has:a,get:r,set:l,keys:d,values:h,entries:f,forEach:w,clear:c})),&quot;undefined&quot;==typeof Set&amp;&amp;(e.Set=t({has:s,add:u,delete:o,clear:c,keys:h,values:h,entries:p,forEach:w})),&quot;undefined&quot;==typeof WeakSet&amp;&amp;(e.WeakSet=t({delete:o,add:u,clear:c,has:s},!0))}(&quot;undefined&quot;!=typeof n&amp;&amp;&quot;undefined&quot;!=typeof global?global:window)},{}],jsonpatch:[function(e,t,n){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 0.5.7
 * (c) 2013 Joachim Wester
 * MIT license
 */
var o,r=this&amp;&amp;this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&amp;&amp;(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=Error;!function(e){function t(e,n){switch(typeof e){case&quot;undefined&quot;:case&quot;boolean&quot;:case&quot;string&quot;:case&quot;number&quot;:return e===n;case&quot;object&quot;:if(null===e)return null===n;if(E(e)){if(!E(n)||e.length!==n.length)return!1;for(var o=0,r=e.length;o&lt;r;o++)if(!t(e[o],n[o]))return!1;return!0}var i=y(n),s=i.length;if(y(e).length!==s)return!1;for(var o=0;o&lt;s;o++)if(!t(e[o],n[o]))return!1;return!0;default:return!1}}function n(e){return e.indexOf(&quot;/&quot;)===-1&amp;&amp;e.indexOf(&quot;~&quot;)===-1?e:e.replace(/~/g,&quot;~0&quot;).replace(/\//g,&quot;~1&quot;)}function o(e){for(var t=0,n=R.length;t&lt;n;t++)if(R[t].obj===e)return R[t]}function s(e,t){for(var n=0,o=e.observers.length;n&lt;o;n++)if(e.observers[n].callback===t)return e.observers[n].observer}function a(e,t){for(var n=0,o=e.observers.length;n&lt;o;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}function l(e,t){t.unobserve()}function u(e){return&quot;object&quot;==typeof e?JSON.parse(JSON.stringify(e)):e}function c(e,t){var n,r=[],l=o(e);if(l?n=s(l,t):(l=new M(e),R.push(l)),n)return n;if(n={},l.value=u(e),t){n.callback=t,n.next=null;var c=this.intervals||[100,1e3,1e4,6e4];if(void 0===c.push)throw new i(&quot;jsonpatch.intervals must be an array&quot;);var h=0,f=function(){d(n)},p=function(){clearTimeout(n.next),n.next=setTimeout(function(){f(),h=0,n.next=setTimeout(m,c[h++])},0)},m=function(){f(),h==c.length&amp;&amp;(h=c.length-1),n.next=setTimeout(m,c[h++])};&quot;undefined&quot;!=typeof window&amp;&amp;(window.addEventListener?(window.addEventListener(&quot;mousedown&quot;,p),window.addEventListener(&quot;mouseup&quot;,p),window.addEventListener(&quot;keydown&quot;,p)):(document.documentElement.attachEvent(&quot;onmousedown&quot;,p),document.documentElement.attachEvent(&quot;onmouseup&quot;,p),document.documentElement.attachEvent(&quot;onkeydown&quot;,p))),n.next=setTimeout(m,c[h++])}return n.patches=r,n.object=e,n.unobserve=function(){d(n),clearTimeout(n.next),a(l,n),&quot;undefined&quot;!=typeof window&amp;&amp;(window.removeEventListener?(window.removeEventListener(&quot;mousedown&quot;,p),window.removeEventListener(&quot;mouseup&quot;,p),window.removeEventListener(&quot;keydown&quot;,p)):(document.documentElement.detachEvent(&quot;onmousedown&quot;,p),document.documentElement.detachEvent(&quot;onmouseup&quot;,p),document.documentElement.detachEvent(&quot;onkeydown&quot;,p)))},l.observers.push(new S(t,n)),n}function d(e){for(var t,n=0,o=R.length;n&lt;o;n++)if(R[n].obj===e.object){t=R[n];break}h(t.value,e.object,e.patches,&quot;&quot;),e.patches.length&amp;&amp;p(t.value,e.patches);var r=e.patches;return r.length&gt;0&amp;&amp;(e.patches=[],e.callback&amp;&amp;e.callback(r)),r}function h(e,t,o,r){for(var i=y(t),s=y(e),a=!1,l=!1,c=s.length-1;c&gt;=0;c--){var d=s[c],f=e[d];if(t.hasOwnProperty(d)){var p=t[d];&quot;object&quot;==typeof f&amp;&amp;null!=f&amp;&amp;&quot;object&quot;==typeof p&amp;&amp;null!=p?h(f,p,o,r+&quot;/&quot;+n(d)):f!=p&amp;&amp;(a=!0,o.push({op:&quot;replace&quot;,path:r+&quot;/&quot;+n(d),value:u(p)}))}else o.push({op:&quot;remove&quot;,path:r+&quot;/&quot;+n(d)}),l=!0}if(l||i.length!=s.length)for(var c=0;c&lt;i.length;c++){var d=i[c];e.hasOwnProperty(d)||o.push({op:&quot;add&quot;,path:r+&quot;/&quot;+n(d),value:u(t[d])})}}function f(e){for(var t,n=0,o=e.length;n&lt;o;){t=e.charCodeAt(n);{if(!(t&gt;=48&amp;&amp;t&lt;=57))return!1;n++}}return!0}function p(e,t,n){for(var o,r,i=!1,s=0,a=t.length;s&lt;a;){o=t[s],s++;for(var l=o.path||&quot;&quot;,u=l.split(&quot;/&quot;),c=e,d=1,h=u.length,p=void 0;;){if(r=u[d],n&amp;&amp;void 0===p&amp;&amp;(void 0===c[r]?p=u.slice(0,d).join(&quot;/&quot;):d==h-1&amp;&amp;(p=o.path),void 0!==p&amp;&amp;this.validator(o,s-1,e,p)),d++,void 0===r&amp;&amp;d&gt;=h){i=_[o.op].call(o,c,r,e);break}if(E(c)){if(&quot;-&quot;===r)r=c.length;else{if(n&amp;&amp;!f(r))throw new O(&quot;Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index&quot;,&quot;OPERATION_PATH_ILLEGAL_ARRAY_INDEX&quot;,s-1,o.path,o);r=parseInt(r,10)}if(d&gt;=h){if(n&amp;&amp;&quot;add&quot;===o.op&amp;&amp;r&gt;c.length)throw new O(&quot;The specified index MUST NOT be greater than the number of elements in the array&quot;,&quot;OPERATION_VALUE_OUT_OF_BOUNDS&quot;,s-1,o.path,o);i=C[o.op].call(o,c,r,e);break}}else if(r&amp;&amp;r.indexOf(&quot;~&quot;)!=-1&amp;&amp;(r=r.replace(/~1/g,&quot;/&quot;).replace(/~0/g,&quot;~&quot;)),d&gt;=h){i=b[o.op].call(o,c,r,e);break}c=c[r]}}return i}function m(e,t){var n=[];return h(e,t,n,&quot;&quot;),n}function g(e){if(void 0===e)return!0;if(&quot;array&quot;==typeof e||&quot;object&quot;==typeof e)for(var t in e)if(g(e[t]))return!0;return!1}function w(t,n,o,r){if(&quot;object&quot;!=typeof t||null===t||E(t))throw new O(&quot;Operation is not an object&quot;,&quot;OPERATION_NOT_AN_OBJECT&quot;,n,t,o);if(!b[t.op])throw new O(&quot;Operation `op` property is not one of operations defined in RFC-6902&quot;,&quot;OPERATION_OP_INVALID&quot;,n,t,o);if(&quot;string&quot;!=typeof t.path)throw new O(&quot;Operation `path` property is not a string&quot;,&quot;OPERATION_PATH_INVALID&quot;,n,t,o);if((&quot;move&quot;===t.op||&quot;copy&quot;===t.op)&amp;&amp;&quot;string&quot;!=typeof t.from)throw new O(&quot;Operation `from` property is not present (applicable in `move` and `copy` operations)&quot;,&quot;OPERATION_FROM_REQUIRED&quot;,n,t,o);if((&quot;add&quot;===t.op||&quot;replace&quot;===t.op||&quot;test&quot;===t.op)&amp;&amp;void 0===t.value)throw new O(&quot;Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)&quot;,&quot;OPERATION_VALUE_REQUIRED&quot;,n,t,o);if((&quot;add&quot;===t.op||&quot;replace&quot;===t.op||&quot;test&quot;===t.op)&amp;&amp;g(t.value))throw new O(&quot;Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)&quot;,&quot;OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED&quot;,n,t,o);if(o)if(&quot;add&quot;==t.op){var i=t.path.split(&quot;/&quot;).length,s=r.split(&quot;/&quot;).length;if(i!==s+1&amp;&amp;i!==s)throw new O(&quot;Cannot perform an `add` operation at the desired path&quot;,&quot;OPERATION_PATH_CANNOT_ADD&quot;,n,t,o)}else if(&quot;replace&quot;===t.op||&quot;remove&quot;===t.op||&quot;_get&quot;===t.op){if(t.path!==r)throw new O(&quot;Cannot perform the operation at a path that does not exist&quot;,&quot;OPERATION_PATH_UNRESOLVABLE&quot;,n,t,o)}else if(&quot;move&quot;===t.op||&quot;copy&quot;===t.op){var a={op:&quot;_get&quot;,path:t.from,value:void 0},l=e.validate([a],o);if(l&amp;&amp;&quot;OPERATION_PATH_UNRESOLVABLE&quot;===l.name)throw new O(&quot;Cannot perform the operation from a path that does not exist&quot;,&quot;OPERATION_FROM_UNRESOLVABLE&quot;,n,t,o)}}function v(e,t){try{if(!E(e))throw new O(&quot;Patch sequence must be an array&quot;,&quot;SEQUENCE_NOT_AN_ARRAY&quot;);if(t)t=JSON.parse(JSON.stringify(t)),p.call(this,t,e,!0);else for(var n=0;n&lt;e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof O)return e;throw e}}var y=function(e){if(E(e)){for(var t=new Array(e.length),n=0;n&lt;t.length;n++)t[n]=&quot;&quot;+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var o in e)e.hasOwnProperty(o)&amp;&amp;t.push(o);return t},b={add:function(e,t){return e[t]=this.value,!0},remove:function(e,t){return delete e[t],!0},replace:function(e,t){return e[t]=this.value,!0},move:function(e,t,n){var o={op:&quot;_get&quot;,path:this.from};return p(n,[o]),p(n,[{op:&quot;remove&quot;,path:this.from}]),p(n,[{op:&quot;add&quot;,path:this.path,value:o.value}]),!0},copy:function(e,t,n){var o={op:&quot;_get&quot;,path:this.from};return p(n,[o]),p(n,[{op:&quot;add&quot;,path:this.path,value:o.value}]),!0},test:function(e,n){return t(e[n],this.value)},_get:function(e,t){this.value=e[t]}},C={add:function(e,t){return e.splice(t,0,this.value),!0},remove:function(e,t){return e.splice(t,1),!0},replace:function(e,t){return e[t]=this.value,!0},move:b.move,copy:b.copy,test:b.test,_get:b._get},_={add:function(e){_.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&amp;&amp;(e[t]=this.value[t]);return!0},remove:function(e){for(var t in e)e.hasOwnProperty(t)&amp;&amp;b.remove.call(this,e,t);return!0},replace:function(e){return p(e,[{op:&quot;remove&quot;,path:this.path}]),p(e,[{op:&quot;add&quot;,path:this.path,value:this.value}]),!0},move:b.move,copy:b.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}},R=[],M=function(){function e(e){this.observers=[],this.obj=e}return e}(),S=function(){function e(e,t){this.callback=e,this.observer=t}return e}();e.unobserve=l,e.observe=c,e.generate=d;var E;E=Array.isArray?Array.isArray:function(e){return e.push&amp;&amp;&quot;number&quot;==typeof e.length},e.apply=p,e.compare=m;var O=function(e){function t(t,n,o,r,i){e.call(this,t),this.message=t,this.name=n,this.index=o,this.operation=r,this.tree=i}return r(t,e),t}(i);e.JsonPatchError=O,e.Error=O,e.validator=w,e.validate=v}(o||(o={})),&quot;undefined&quot;!=typeof n&amp;&amp;(n.apply=o.apply,n.observe=o.observe,n.unobserve=o.unobserve,n.generate=o.generate,n.compare=o.compare,n.validate=o.validate,n.validator=o.validator,n.JsonPatchError=o.JsonPatchError,n.Error=o.Error)},{}],moment:[function(t,n,o){!function(t,r){&quot;object&quot;==typeof o&amp;&amp;&quot;undefined&quot;!=typeof n?n.exports=r():&quot;function&quot;==typeof e&amp;&amp;e.amd?e(r):t.moment=r()}(this,function(){&quot;use strict&quot;;function e(){return vo.apply(null,arguments)}function o(e){vo=e}function r(e){return e instanceof Array||&quot;[object Array]&quot;===Object.prototype.toString.call(e)}function i(e){return null!=e&amp;&amp;&quot;[object Object]&quot;===Object.prototype.toString.call(e)}function s(e){var t;for(t in e)return!1;return!0}function a(e){return&quot;number&quot;==typeof e||&quot;[object Number]&quot;===Object.prototype.toString.call(e)}function l(e){return e instanceof Date||&quot;[object Date]&quot;===Object.prototype.toString.call(e)}function u(e,t){var n,o=[];for(n=0;n&lt;e.length;++n)o.push(t(e[n],n));return o}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){for(var n in t)c(t,n)&amp;&amp;(e[n]=t[n]);return c(t,&quot;toString&quot;)&amp;&amp;(e.toString=t.toString),c(t,&quot;valueOf&quot;)&amp;&amp;(e.valueOf=t.valueOf),e}function h(e,t,n,o){return yt(e,t,n,o,!0).utc()}function f(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null}}function p(e){return null==e._pf&amp;&amp;(e._pf=f()),e._pf}function m(e){if(null==e._isValid){var t=p(e),n=bo.call(t.parsedDateParts,function(e){return null!=e}),o=!isNaN(e._d.getTime())&amp;&amp;t.overflow&lt;0&amp;&amp;!t.empty&amp;&amp;!t.invalidMonth&amp;&amp;!t.invalidWeekday&amp;&amp;!t.nullInput&amp;&amp;!t.invalidFormat&amp;&amp;!t.userInvalidated&amp;&amp;(!t.meridiem||t.meridiem&amp;&amp;n);if(e._strict&amp;&amp;(o=o&amp;&amp;0===t.charsLeftOver&amp;&amp;0===t.unusedTokens.length&amp;&amp;void 0===t.bigHour),null!=Object.isFrozen&amp;&amp;Object.isFrozen(e))return o;e._isValid=o}return e._isValid}function g(e){var t=h(NaN);return null!=e?d(p(t),e):p(t).userInvalidated=!0,t}function w(e){return void 0===e}function v(e,t){var n,o,r;if(w(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),w(t._i)||(e._i=t._i),w(t._f)||(e._f=t._f),w(t._l)||(e._l=t._l),w(t._strict)||(e._strict=t._strict),w(t._tzm)||(e._tzm=t._tzm),w(t._isUTC)||(e._isUTC=t._isUTC),w(t._offset)||(e._offset=t._offset),w(t._pf)||(e._pf=p(t)),w(t._locale)||(e._locale=t._locale),Co.length&gt;0)for(n in Co)o=Co[n],r=t[o],w(r)||(e[o]=r);return e}function y(t){v(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),_o===!1&amp;&amp;(_o=!0,e.updateOffset(this),_o=!1)}function b(e){return e instanceof y||null!=e&amp;&amp;null!=e._isAMomentObject}function C(e){return e&lt;0?Math.ceil(e)||0:Math.floor(e)}function _(e){var t=+e,n=0;return 0!==t&amp;&amp;isFinite(t)&amp;&amp;(n=C(t)),n}function R(e,t,n){var o,r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),s=0;for(o=0;o&lt;r;o++)(n&amp;&amp;e[o]!==t[o]||!n&amp;&amp;_(e[o])!==_(t[o]))&amp;&amp;s++;return s+i}function M(t){e.suppressDeprecationWarnings===!1&amp;&amp;&quot;undefined&quot;!=typeof console&amp;&amp;console.warn&amp;&amp;console.warn(&quot;Deprecation warning: &quot;+t)}function S(t,n){var o=!0;return d(function(){if(null!=e.deprecationHandler&amp;&amp;e.deprecationHandler(null,t),o){for(var r,i=[],s=0;s&lt;arguments.length;s++){if(r=&quot;&quot;,&quot;object&quot;==typeof arguments[s]){r+=&quot;\n[&quot;+s+&quot;] &quot;;for(var a in arguments[0])r+=a+&quot;: &quot;+arguments[0][a]+&quot;, &quot;;r=r.slice(0,-2)}else r=arguments[s];i.push(r)}M(t+&quot;\nArguments: &quot;+Array.prototype.slice.call(i).join(&quot;&quot;)+&quot;\n&quot;+(new Error).stack),o=!1}return n.apply(this,arguments)},n)}function E(t,n){null!=e.deprecationHandler&amp;&amp;e.deprecationHandler(t,n),Ro[t]||(M(n),Ro[t]=!0)}function O(e){return e instanceof Function||&quot;[object Function]&quot;===Object.prototype.toString.call(e)}function T(e){var t,n;for(n in e)t=e[n],O(t)?this[n]=t:this[&quot;_&quot;+n]=t;this._config=e,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+&quot;|&quot;+/\d{1,2}/.source)}function k(e,t){var n,o=d({},e);for(n in t)c(t,n)&amp;&amp;(i(e[n])&amp;&amp;i(t[n])?(o[n]={},d(o[n],e[n]),d(o[n],t[n])):null!=t[n]?o[n]=t[n]:delete o[n]);for(n in e)c(e,n)&amp;&amp;!c(t,n)&amp;&amp;i(e[n])&amp;&amp;(o[n]=d({},o[n]));return o}function x(e){null!=e&amp;&amp;this.set(e)}function D(e,t,n){var o=this._calendar[e]||this._calendar.sameElse;return O(o)?o.call(t,n):o}function H(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])}function A(){return this._invalidDate}function P(e){return this._ordinal.replace(&quot;%d&quot;,e)}function N(e,t,n,o){var r=this._relativeTime[n];return O(r)?r(e,t,n,o):r.replace(/%d/i,e)}function L(e,t){var n=this._relativeTime[e&gt;0?&quot;future&quot;:&quot;past&quot;];return O(n)?n(t):n.replace(/%s/i,t)}function I(e,t){var n=e.toLowerCase();Ao[n]=Ao[n+&quot;s&quot;]=Ao[t]=e}function W(e){return&quot;string&quot;==typeof e?Ao[e]||Ao[e.toLowerCase()]:void 0}function j(e){var t,n,o={};for(n in e)c(e,n)&amp;&amp;(t=W(n),t&amp;&amp;(o[t]=e[n]));return o}function V(e,t){Po[e]=t}function B(e){var t=[];for(var n in e)t.push({unit:n,priority:Po[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}function F(t,n){return function(o){return null!=o?(Y(this,t,o),e.updateOffset(this,n),this):z(this,t)}}function z(e,t){return e.isValid()?e._d[&quot;get&quot;+(e._isUTC?&quot;UTC&quot;:&quot;&quot;)+t]():NaN}function Y(e,t,n){e.isValid()&amp;&amp;e._d[&quot;set&quot;+(e._isUTC?&quot;UTC&quot;:&quot;&quot;)+t](n)}function U(e){return e=W(e),O(this[e])?this[e]():this}function G(e,t){if(&quot;object&quot;==typeof e){e=j(e);for(var n=B(e),o=0;o&lt;n.length;o++)this[n[o].unit](e[n[o].unit])}else if(e=W(e),O(this[e]))return this[e](t);return this}function $(e,t,n){var o=&quot;&quot;+Math.abs(e),r=t-o.length,i=e&gt;=0;return(i?n?&quot;+&quot;:&quot;&quot;:&quot;-&quot;)+Math.pow(10,Math.max(0,r)).toString().substr(1)+o}function K(e,t,n,o){var r=o;&quot;string&quot;==typeof o&amp;&amp;(r=function(){return this[o]()}),e&amp;&amp;(Wo[e]=r),t&amp;&amp;(Wo[t[0]]=function(){return $(r.apply(this,arguments),t[1],t[2])}),n&amp;&amp;(Wo[n]=function(){return this.localeData().ordinal(r.apply(this,arguments),e)})}function X(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,&quot;&quot;):e.replace(/\\/g,&quot;&quot;)}function q(e){var t,n,o=e.match(No);for(t=0,n=o.length;t&lt;n;t++)Wo[o[t]]?o[t]=Wo[o[t]]:o[t]=X(o[t]);return function(t){var r,i=&quot;&quot;;for(r=0;r&lt;n;r++)i+=o[r]instanceof Function?o[r].call(t,e):o[r];return i}}function Z(e,t){return e.isValid()?(t=J(t,e.localeData()),Io[t]=Io[t]||q(t),Io[t](e)):e.localeData().invalidDate()}function J(e,t){function n(e){return t.longDateFormat(e)||e}var o=5;for(Lo.lastIndex=0;o&gt;=0&amp;&amp;Lo.test(e);)e=e.replace(Lo,n),Lo.lastIndex=0,o-=1;return e}function Q(e,t,n){nr[e]=O(t)?t:function(e,o){return e&amp;&amp;n?n:t}}function ee(e,t){return c(nr,e)?nr[e](t._strict,t._locale):new RegExp(te(e))}function te(e){return ne(e.replace(&quot;\\&quot;,&quot;&quot;).replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,o,r){return t||n||o||r}))}function ne(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,&quot;\\$&amp;&quot;)}function oe(e,t){var n,o=t;for(&quot;string&quot;==typeof e&amp;&amp;(e=[e]),a(t)&amp;&amp;(o=function(e,n){n[t]=_(e)}),n=0;n&lt;e.length;n++)or[e[n]]=o}function re(e,t){oe(e,function(e,n,o,r){o._w=o._w||{},t(e,o._w,o,r)})}function ie(e,t,n){null!=t&amp;&amp;c(or,e)&amp;&amp;or[e](t,n._a,n,e)}function se(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function ae(e,t){return e?r(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||pr).test(t)?&quot;format&quot;:&quot;standalone&quot;][e.month()]:this._months}function le(e,t){return e?r(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[pr.test(t)?&quot;format&quot;:&quot;standalone&quot;][e.month()]:this._monthsShort}function ue(e,t,n){var o,r,i,s=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],o=0;o&lt;12;++o)i=h([2e3,o]),this._shortMonthsParse[o]=this.monthsShort(i,&quot;&quot;).toLocaleLowerCase(),this._longMonthsParse[o]=this.months(i,&quot;&quot;).toLocaleLowerCase();return n?&quot;MMM&quot;===t?(r=fr.call(this._shortMonthsParse,s),r!==-1?r:null):(r=fr.call(this._longMonthsParse,s),r!==-1?r:null):&quot;MMM&quot;===t?(r=fr.call(this._shortMonthsParse,s),r!==-1?r:(r=fr.call(this._longMonthsParse,s),r!==-1?r:null)):(r=fr.call(this._longMonthsParse,s),r!==-1?r:(r=fr.call(this._shortMonthsParse,s),r!==-1?r:null))}function ce(e,t,n){var o,r,i;if(this._monthsParseExact)return ue.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),o=0;o&lt;12;o++){if(r=h([2e3,o]),n&amp;&amp;!this._longMonthsParse[o]&amp;&amp;(this._longMonthsParse[o]=new RegExp(&quot;^&quot;+this.months(r,&quot;&quot;).replace(&quot;.&quot;,&quot;&quot;)+&quot;$&quot;,&quot;i&quot;),this._shortMonthsParse[o]=new RegExp(&quot;^&quot;+this.monthsShort(r,&quot;&quot;).replace(&quot;.&quot;,&quot;&quot;)+&quot;$&quot;,&quot;i&quot;)),n||this._monthsParse[o]||(i=&quot;^&quot;+this.months(r,&quot;&quot;)+&quot;|^&quot;+this.monthsShort(r,&quot;&quot;),this._monthsParse[o]=new RegExp(i.replace(&quot;.&quot;,&quot;&quot;),&quot;i&quot;)),n&amp;&amp;&quot;MMMM&quot;===t&amp;&amp;this._longMonthsParse[o].test(e))return o;if(n&amp;&amp;&quot;MMM&quot;===t&amp;&amp;this._shortMonthsParse[o].test(e))return o;if(!n&amp;&amp;this._monthsParse[o].test(e))return o}}function de(e,t){var n;if(!e.isValid())return e;if(&quot;string&quot;==typeof t)if(/^\d+$/.test(t))t=_(t);else if(t=e.localeData().monthsParse(t),!a(t))return e;return n=Math.min(e.date(),se(e.year(),t)),e._d[&quot;set&quot;+(e._isUTC?&quot;UTC&quot;:&quot;&quot;)+&quot;Month&quot;](t,n),e}function he(t){return null!=t?(de(this,t),e.updateOffset(this,!0),this):z(this,&quot;Month&quot;)}function fe(){return se(this.year(),this.month())}function pe(e){return this._monthsParseExact?(c(this,&quot;_monthsRegex&quot;)||ge.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(c(this,&quot;_monthsShortRegex&quot;)||(this._monthsShortRegex=wr),this._monthsShortStrictRegex&amp;&amp;e?this._monthsShortStrictRegex:this._monthsShortRegex)}function me(e){return this._monthsParseExact?(c(this,&quot;_monthsRegex&quot;)||ge.call(this),e?this._monthsStrictRegex:this._monthsRegex):(c(this,&quot;_monthsRegex&quot;)||(this._monthsRegex=vr),this._monthsStrictRegex&amp;&amp;e?this._monthsStrictRegex:this._monthsRegex)}function ge(){function e(e,t){return t.length-e.length}var t,n,o=[],r=[],i=[];for(t=0;t&lt;12;t++)n=h([2e3,t]),o.push(this.monthsShort(n,&quot;&quot;)),r.push(this.months(n,&quot;&quot;)),i.push(this.months(n,&quot;&quot;)),i.push(this.monthsShort(n,&quot;&quot;));for(o.sort(e),r.sort(e),i.sort(e),t=0;t&lt;12;t++)o[t]=ne(o[t]),r[t]=ne(r[t]);for(t=0;t&lt;24;t++)i[t]=ne(i[t]);this._monthsRegex=new RegExp(&quot;^(&quot;+i.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp(&quot;^(&quot;+r.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;),this._monthsShortStrictRegex=new RegExp(&quot;^(&quot;+o.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;)}function we(e){return ve(e)?366:365}function ve(e){return e%4===0&amp;&amp;e%100!==0||e%400===0}function ye(){return ve(this.year())}function be(e,t,n,o,r,i,s){var a=new Date(e,t,n,o,r,i,s);return e&lt;100&amp;&amp;e&gt;=0&amp;&amp;isFinite(a.getFullYear())&amp;&amp;a.setFullYear(e),a}function Ce(e){var t=new Date(Date.UTC.apply(null,arguments));return e&lt;100&amp;&amp;e&gt;=0&amp;&amp;isFinite(t.getUTCFullYear())&amp;&amp;t.setUTCFullYear(e),t}function _e(e,t,n){var o=7+t-n,r=(7+Ce(e,0,o).getUTCDay()-t)%7;return-r+o-1}function Re(e,t,n,o,r){var i,s,a=(7+n-o)%7,l=_e(e,o,r),u=1+7*(t-1)+a+l;return u&lt;=0?(i=e-1,s=we(i)+u):u&gt;we(e)?(i=e+1,s=u-we(e)):(i=e,s=u),{year:i,dayOfYear:s}}function Me(e,t,n){var o,r,i=_e(e.year(),t,n),s=Math.floor((e.dayOfYear()-i-1)/7)+1;return s&lt;1?(r=e.year()-1,o=s+Se(r,t,n)):s&gt;Se(e.year(),t,n)?(o=s-Se(e.year(),t,n),r=e.year()+1):(r=e.year(),o=s),{week:o,year:r}}function Se(e,t,n){var o=_e(e,t,n),r=_e(e+1,t,n);return(we(e)-o+r)/7}function Ee(e){return Me(e,this._week.dow,this._week.doy).week}function Oe(){return this._week.dow}function Te(){return this._week.doy}function ke(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),&quot;d&quot;)}function xe(e){var t=Me(this,1,4).week;return null==e?t:this.add(7*(e-t),&quot;d&quot;)}function De(e,t){return&quot;string&quot;!=typeof e?e:isNaN(e)?(e=t.weekdaysParse(e),&quot;number&quot;==typeof e?e:null):parseInt(e,10)}function He(e,t){return&quot;string&quot;==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function Ae(e,t){return e?r(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?&quot;format&quot;:&quot;standalone&quot;][e.day()]:this._weekdays}function Pe(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort}function Ne(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin}function Le(e,t,n){var o,r,i,s=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],o=0;o&lt;7;++o)i=h([2e3,1]).day(o),this._minWeekdaysParse[o]=this.weekdaysMin(i,&quot;&quot;).toLocaleLowerCase(),this._shortWeekdaysParse[o]=this.weekdaysShort(i,&quot;&quot;).toLocaleLowerCase(),this._weekdaysParse[o]=this.weekdays(i,&quot;&quot;).toLocaleLowerCase();return n?&quot;dddd&quot;===t?(r=fr.call(this._weekdaysParse,s),r!==-1?r:null):&quot;ddd&quot;===t?(r=fr.call(this._shortWeekdaysParse,s),r!==-1?r:null):(r=fr.call(this._minWeekdaysParse,s),r!==-1?r:null):&quot;dddd&quot;===t?(r=fr.call(this._weekdaysParse,s),r!==-1?r:(r=fr.call(this._shortWeekdaysParse,s),r!==-1?r:(r=fr.call(this._minWeekdaysParse,s),r!==-1?r:null))):&quot;ddd&quot;===t?(r=fr.call(this._shortWeekdaysParse,s),r!==-1?r:(r=fr.call(this._weekdaysParse,s),r!==-1?r:(r=fr.call(this._minWeekdaysParse,s),r!==-1?r:null))):(r=fr.call(this._minWeekdaysParse,s),r!==-1?r:(r=fr.call(this._weekdaysParse,s),r!==-1?r:(r=fr.call(this._shortWeekdaysParse,s),r!==-1?r:null)))}function Ie(e,t,n){var o,r,i;if(this._weekdaysParseExact)return Le.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),o=0;o&lt;7;o++){if(r=h([2e3,1]).day(o),n&amp;&amp;!this._fullWeekdaysParse[o]&amp;&amp;(this._fullWeekdaysParse[o]=new RegExp(&quot;^&quot;+this.weekdays(r,&quot;&quot;).replace(&quot;.&quot;,&quot;.?&quot;)+&quot;$&quot;,&quot;i&quot;),this._shortWeekdaysParse[o]=new RegExp(&quot;^&quot;+this.weekdaysShort(r,&quot;&quot;).replace(&quot;.&quot;,&quot;.?&quot;)+&quot;$&quot;,&quot;i&quot;),this._minWeekdaysParse[o]=new RegExp(&quot;^&quot;+this.weekdaysMin(r,&quot;&quot;).replace(&quot;.&quot;,&quot;.?&quot;)+&quot;$&quot;,&quot;i&quot;)),this._weekdaysParse[o]||(i=&quot;^&quot;+this.weekdays(r,&quot;&quot;)+&quot;|^&quot;+this.weekdaysShort(r,&quot;&quot;)+&quot;|^&quot;+this.weekdaysMin(r,&quot;&quot;),this._weekdaysParse[o]=new RegExp(i.replace(&quot;.&quot;,&quot;&quot;),&quot;i&quot;)),n&amp;&amp;&quot;dddd&quot;===t&amp;&amp;this._fullWeekdaysParse[o].test(e))return o;if(n&amp;&amp;&quot;ddd&quot;===t&amp;&amp;this._shortWeekdaysParse[o].test(e))return o;if(n&amp;&amp;&quot;dd&quot;===t&amp;&amp;this._minWeekdaysParse[o].test(e))return o;if(!n&amp;&amp;this._weekdaysParse[o].test(e))return o}}function We(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=De(e,this.localeData()),this.add(e-t,&quot;d&quot;)):t}function je(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,&quot;d&quot;)}function Ve(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=He(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7}function Be(e){return this._weekdaysParseExact?(c(this,&quot;_weekdaysRegex&quot;)||Ye.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(c(this,&quot;_weekdaysRegex&quot;)||(this._weekdaysRegex=Mr),this._weekdaysStrictRegex&amp;&amp;e?this._weekdaysStrictRegex:this._weekdaysRegex)}function Fe(e){return this._weekdaysParseExact?(c(this,&quot;_weekdaysRegex&quot;)||Ye.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(c(this,&quot;_weekdaysShortRegex&quot;)||(this._weekdaysShortRegex=Sr),this._weekdaysShortStrictRegex&amp;&amp;e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function ze(e){return this._weekdaysParseExact?(c(this,&quot;_weekdaysRegex&quot;)||Ye.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(c(this,&quot;_weekdaysMinRegex&quot;)||(this._weekdaysMinRegex=Er),this._weekdaysMinStrictRegex&amp;&amp;e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Ye(){function e(e,t){return t.length-e.length}var t,n,o,r,i,s=[],a=[],l=[],u=[];for(t=0;t&lt;7;t++)n=h([2e3,1]).day(t),o=this.weekdaysMin(n,&quot;&quot;),r=this.weekdaysShort(n,&quot;&quot;),i=this.weekdays(n,&quot;&quot;),s.push(o),a.push(r),l.push(i),u.push(o),u.push(r),u.push(i);for(s.sort(e),a.sort(e),l.sort(e),u.sort(e),t=0;t&lt;7;t++)a[t]=ne(a[t]),l[t]=ne(l[t]),u[t]=ne(u[t]);this._weekdaysRegex=new RegExp(&quot;^(&quot;+u.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp(&quot;^(&quot;+l.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;),this._weekdaysShortStrictRegex=new RegExp(&quot;^(&quot;+a.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;),this._weekdaysMinStrictRegex=new RegExp(&quot;^(&quot;+s.join(&quot;|&quot;)+&quot;)&quot;,&quot;i&quot;)}function Ue(){return this.hours()%12||12}function Ge(){return this.hours()||24}function $e(e,t){K(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}function Xe(e){return&quot;p&quot;===(e+&quot;&quot;).toLowerCase().charAt(0)}function qe(e,t,n){return e&gt;11?n?&quot;pm&quot;:&quot;PM&quot;:n?&quot;am&quot;:&quot;AM&quot;}function Ze(e){return e?e.toLowerCase().replace(&quot;_&quot;,&quot;-&quot;):e}function Je(e){for(var t,n,o,r,i=0;i&lt;e.length;){for(r=Ze(e[i]).split(&quot;-&quot;),t=r.length,n=Ze(e[i+1]),n=n?n.split(&quot;-&quot;):null;t&gt;0;){if(o=Qe(r.slice(0,t).join(&quot;-&quot;)))return o;if(n&amp;&amp;n.length&gt;=t&amp;&amp;R(r,n,!0)&gt;=t-1)break;t--}i++}return null}function Qe(e){var o=null;if(!Dr[e]&amp;&amp;&quot;undefined&quot;!=typeof n&amp;&amp;n&amp;&amp;n.exports)try{o=Or._abbr,t(&quot;./locale/&quot;+e),et(o)}catch(e){}return Dr[e]}function et(e,t){var n;return e&amp;&amp;(n=w(t)?ot(e):tt(e,t),n&amp;&amp;(Or=n)),Or._abbr}function tt(e,t){if(null!==t){var n=xr;if(t.abbr=e,null!=Dr[e])E(&quot;defineLocaleOverride&quot;,&quot;use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info.&quot;),n=Dr[e]._config;else if(null!=t.parentLocale){if(null==Dr[t.parentLocale])return Hr[t.parentLocale]||(Hr[t.parentLocale]=[]),Hr[t.parentLocale].push({name:e,config:t}),null;n=Dr[t.parentLocale]._config}return Dr[e]=new x(k(n,t)),Hr[e]&amp;&amp;Hr[e].forEach(function(e){tt(e.name,e.config)}),et(e),Dr[e]}return delete Dr[e],null}function nt(e,t){if(null!=t){var n,o=xr;null!=Dr[e]&amp;&amp;(o=Dr[e]._config),t=k(o,t),n=new x(t),n.parentLocale=Dr[e],Dr[e]=n,et(e)}else null!=Dr[e]&amp;&amp;(null!=Dr[e].parentLocale?Dr[e]=Dr[e].parentLocale:null!=Dr[e]&amp;&amp;delete Dr[e]);return Dr[e]}function ot(e){var t;if(e&amp;&amp;e._locale&amp;&amp;e._locale._abbr&amp;&amp;(e=e._locale._abbr),!e)return Or;if(!r(e)){if(t=Qe(e))return t;e=[e]}return Je(e)}function rt(){return Eo(Dr)}function it(e){var t,n=e._a;return n&amp;&amp;p(e).overflow===-2&amp;&amp;(t=n[ir]&lt;0||n[ir]&gt;11?ir:n[sr]&lt;1||n[sr]&gt;se(n[rr],n[ir])?sr:n[ar]&lt;0||n[ar]&gt;24||24===n[ar]&amp;&amp;(0!==n[lr]||0!==n[ur]||0!==n[cr])?ar:n[lr]&lt;0||n[lr]&gt;59?lr:n[ur]&lt;0||n[ur]&gt;59?ur:n[cr]&lt;0||n[cr]&gt;999?cr:-1,p(e)._overflowDayOfYear&amp;&amp;(t&lt;rr||t&gt;sr)&amp;&amp;(t=sr),p(e)._overflowWeeks&amp;&amp;t===-1&amp;&amp;(t=dr),p(e)._overflowWeekday&amp;&amp;t===-1&amp;&amp;(t=hr),p(e).overflow=t),e}function st(e){var t,n,o,r,i,s,a=e._i,l=Ar.exec(a)||Pr.exec(a);if(l){for(p(e).iso=!0,t=0,n=Lr.length;t&lt;n;t++)if(Lr[t][1].exec(l[1])){r=Lr[t][0],o=Lr[t][2]!==!1;break}if(null==r)return void(e._isValid=!1);if(l[3]){for(t=0,n=Ir.length;t&lt;n;t++)if(Ir[t][1].exec(l[3])){i=(l[2]||&quot; &quot;)+Ir[t][0];break}if(null==i)return void(e._isValid=!1)}if(!o&amp;&amp;null!=i)return void(e._isValid=!1);if(l[4]){if(!Nr.exec(l[4]))return void(e._isValid=!1);s=&quot;Z&quot;}e._f=r+(i||&quot;&quot;)+(s||&quot;&quot;),ht(e)}else e._isValid=!1}function at(t){var n=Wr.exec(t._i);return null!==n?void(t._d=new Date(+n[1])):(st(t),void(t._isValid===!1&amp;&amp;(delete t._isValid,e.createFromInputFallback(t))))}function lt(e,t,n){return null!=e?e:null!=t?t:n}function ut(t){var n=new Date(e.now());return t._useUTC?[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()]:[n.getFullYear(),n.getMonth(),n.getDate()]}function ct(e){var t,n,o,r,i=[];if(!e._d){for(o=ut(e),e._w&amp;&amp;null==e._a[sr]&amp;&amp;null==e._a[ir]&amp;&amp;dt(e),e._dayOfYear&amp;&amp;(r=lt(e._a[rr],o[rr]),e._dayOfYear&gt;we(r)&amp;&amp;(p(e)._overflowDayOfYear=!0),n=Ce(r,0,e._dayOfYear),e._a[ir]=n.getUTCMonth(),e._a[sr]=n.getUTCDate()),t=0;t&lt;3&amp;&amp;null==e._a[t];++t)e._a[t]=i[t]=o[t];for(;t&lt;7;t++)e._a[t]=i[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ar]&amp;&amp;0===e._a[lr]&amp;&amp;0===e._a[ur]&amp;&amp;0===e._a[cr]&amp;&amp;(e._nextDay=!0,e._a[ar]=0),e._d=(e._useUTC?Ce:be).apply(null,i),null!=e._tzm&amp;&amp;e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&amp;&amp;(e._a[ar]=24)}}function dt(e){var t,n,o,r,i,s,a,l;if(t=e._w,null!=t.GG||null!=t.W||null!=t.E)i=1,s=4,n=lt(t.GG,e._a[rr],Me(bt(),1,4).year),o=lt(t.W,1),r=lt(t.E,1),(r&lt;1||r&gt;7)&amp;&amp;(l=!0);else{i=e._locale._week.dow,s=e._locale._week.doy;var u=Me(bt(),i,s);n=lt(t.gg,e._a[rr],u.year),o=lt(t.w,u.week),null!=t.d?(r=t.d,(r&lt;0||r&gt;6)&amp;&amp;(l=!0)):null!=t.e?(r=t.e+i,(t.e&lt;0||t.e&gt;6)&amp;&amp;(l=!0)):r=i}o&lt;1||o&gt;Se(n,i,s)?p(e)._overflowWeeks=!0:null!=l?p(e)._overflowWeekday=!0:(a=Re(n,o,r,i,s),e._a[rr]=a.year,e._dayOfYear=a.dayOfYear)}function ht(t){if(t._f===e.ISO_8601)return void st(t);t._a=[],p(t).empty=!0;var n,o,r,i,s,a=&quot;&quot;+t._i,l=a.length,u=0;for(r=J(t._f,t._locale).match(No)||[],n=0;n&lt;r.length;n++)i=r[n],o=(a.match(ee(i,t))||[])[0],o&amp;&amp;(s=a.substr(0,a.indexOf(o)),s.length&gt;0&amp;&amp;p(t).unusedInput.push(s),a=a.slice(a.indexOf(o)+o.length),u+=o.length),Wo[i]?(o?p(t).empty=!1:p(t).unusedTokens.push(i),ie(i,o,t)):t._strict&amp;&amp;!o&amp;&amp;p(t).unusedTokens.push(i);p(t).charsLeftOver=l-u,a.length&gt;0&amp;&amp;p(t).unusedInput.push(a),t._a[ar]&lt;=12&amp;&amp;p(t).bigHour===!0&amp;&amp;t._a[ar]&gt;0&amp;&amp;(p(t).bigHour=void 0),p(t).parsedDateParts=t._a.slice(0),p(t).meridiem=t._meridiem,t._a[ar]=ft(t._locale,t._a[ar],t._meridiem),ct(t),it(t)}function ft(e,t,n){var o;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(o=e.isPM(n),o&amp;&amp;t&lt;12&amp;&amp;(t+=12),o||12!==t||(t=0),t):t}function pt(e){var t,n,o,r,i;if(0===e._f.length)return p(e).invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r&lt;e._f.length;r++)i=0,t=v({},e),null!=e._useUTC&amp;&amp;(t._useUTC=e._useUTC),t._f=e._f[r],ht(t),m(t)&amp;&amp;(i+=p(t).charsLeftOver,i+=10*p(t).unusedTokens.length,p(t).score=i,(null==o||i&lt;o)&amp;&amp;(o=i,n=t));d(e,n||t)}function mt(e){if(!e._d){var t=j(e._i);e._a=u([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&amp;&amp;parseInt(e,10)}),ct(e)}}function gt(e){var t=new y(it(wt(e)));return t._nextDay&amp;&amp;(t.add(1,&quot;d&quot;),t._nextDay=void 0),t}function wt(e){var t=e._i,n=e._f;return e._locale=e._locale||ot(e._l),null===t||void 0===n&amp;&amp;&quot;&quot;===t?g({nullInput:!0}):(&quot;string&quot;==typeof t&amp;&amp;(e._i=t=e._locale.preparse(t)),b(t)?new y(it(t)):(l(t)?e._d=t:r(n)?pt(e):n?ht(e):vt(e),m(e)||(e._d=null),e))}function vt(t){var n=t._i;void 0===n?t._d=new Date(e.now()):l(n)?t._d=new Date(n.valueOf()):&quot;string&quot;==typeof n?at(t):r(n)?(t._a=u(n.slice(0),function(e){return parseInt(e,10)}),ct(t)):&quot;object&quot;==typeof n?mt(t):a(n)?t._d=new Date(n):e.createFromInputFallback(t)}function yt(e,t,n,o,a){var l={};return n!==!0&amp;&amp;n!==!1||(o=n,n=void 0),(i(e)&amp;&amp;s(e)||r(e)&amp;&amp;0===e.length)&amp;&amp;(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=a,l._l=n,l._i=e,l._f=t,l._strict=o,gt(l)}function bt(e,t,n,o){return yt(e,t,n,o,!1)}function Ct(e,t){var n,o;if(1===t.length&amp;&amp;r(t[0])&amp;&amp;(t=t[0]),!t.length)return bt();for(n=t[0],o=1;o&lt;t.length;++o)t[o].isValid()&amp;&amp;!t[o][e](n)||(n=t[o]);return n}function _t(){var e=[].slice.call(arguments,0);return Ct(&quot;isBefore&quot;,e)}function Rt(){var e=[].slice.call(arguments,0);return Ct(&quot;isAfter&quot;,e)}function Mt(e){var t=j(e),n=t.year||0,o=t.quarter||0,r=t.month||0,i=t.week||0,s=t.day||0,a=t.hour||0,l=t.minute||0,u=t.second||0,c=t.millisecond||0;this._milliseconds=+c+1e3*u+6e4*l+1e3*a*60*60,this._days=+s+7*i,this._months=+r+3*o+12*n,this._data={},this._locale=ot(),this._bubble()}function St(e){return e instanceof Mt}function Et(e){return e&lt;0?Math.round(-1*e)*-1:Math.round(e)}function Ot(e,t){K(e,0,0,function(){var e=this.utcOffset(),n=&quot;+&quot;;return e&lt;0&amp;&amp;(e=-e,n=&quot;-&quot;),n+$(~~(e/60),2)+t+$(~~e%60,2)})}function Tt(e,t){var n=(t||&quot;&quot;).match(e);if(null===n)return null;var o=n[n.length-1]||[],r=(o+&quot;&quot;).match(Fr)||[&quot;-&quot;,0,0],i=+(60*r[1])+_(r[2]);return 0===i?0:&quot;+&quot;===r[0]?i:-i}function kt(t,n){var o,r;return n._isUTC?(o=n.clone(),r=(b(t)||l(t)?t.valueOf():bt(t).valueOf())-o.valueOf(),o._d.setTime(o._d.valueOf()+r),e.updateOffset(o,!1),o):bt(t).local()}function xt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Dt(t,n){var o,r=this._offset||0;if(!this.isValid())return null!=t?this:NaN;if(null!=t){if(&quot;string&quot;==typeof t){if(t=Tt(Qo,t),null===t)return this}else Math.abs(t)&lt;16&amp;&amp;(t*=60);return!this._isUTC&amp;&amp;n&amp;&amp;(o=xt(this)),this._offset=t,this._isUTC=!0,null!=o&amp;&amp;this.add(o,&quot;m&quot;),r!==t&amp;&amp;(!n||this._changeInProgress?$t(this,Ft(t-r,&quot;m&quot;),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?r:xt(this)}function Ht(e,t){return null!=e?(&quot;string&quot;!=typeof e&amp;&amp;(e=-e),this.utcOffset(e,t),this):-this.utcOffset();
}function At(e){return this.utcOffset(0,e)}function Pt(e){return this._isUTC&amp;&amp;(this.utcOffset(0,e),this._isUTC=!1,e&amp;&amp;this.subtract(xt(this),&quot;m&quot;)),this}function Nt(){if(null!=this._tzm)this.utcOffset(this._tzm);else if(&quot;string&quot;==typeof this._i){var e=Tt(Jo,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this}function Lt(e){return!!this.isValid()&amp;&amp;(e=e?bt(e).utcOffset():0,(this.utcOffset()-e)%60===0)}function It(){return this.utcOffset()&gt;this.clone().month(0).utcOffset()||this.utcOffset()&gt;this.clone().month(5).utcOffset()}function Wt(){if(!w(this._isDSTShifted))return this._isDSTShifted;var e={};if(v(e,this),e=wt(e),e._a){var t=e._isUTC?h(e._a):bt(e._a);this._isDSTShifted=this.isValid()&amp;&amp;R(e._a,t.toArray())&gt;0}else this._isDSTShifted=!1;return this._isDSTShifted}function jt(){return!!this.isValid()&amp;&amp;!this._isUTC}function Vt(){return!!this.isValid()&amp;&amp;this._isUTC}function Bt(){return!!this.isValid()&amp;&amp;(this._isUTC&amp;&amp;0===this._offset)}function Ft(e,t){var n,o,r,i=e,s=null;return St(e)?i={ms:e._milliseconds,d:e._days,M:e._months}:a(e)?(i={},t?i[t]=e:i.milliseconds=e):(s=zr.exec(e))?(n=&quot;-&quot;===s[1]?-1:1,i={y:0,d:_(s[sr])*n,h:_(s[ar])*n,m:_(s[lr])*n,s:_(s[ur])*n,ms:_(Et(1e3*s[cr]))*n}):(s=Yr.exec(e))?(n=&quot;-&quot;===s[1]?-1:1,i={y:zt(s[2],n),M:zt(s[3],n),w:zt(s[4],n),d:zt(s[5],n),h:zt(s[6],n),m:zt(s[7],n),s:zt(s[8],n)}):null==i?i={}:&quot;object&quot;==typeof i&amp;&amp;(&quot;from&quot;in i||&quot;to&quot;in i)&amp;&amp;(r=Ut(bt(i.from),bt(i.to)),i={},i.ms=r.milliseconds,i.M=r.months),o=new Mt(i),St(e)&amp;&amp;c(e,&quot;_locale&quot;)&amp;&amp;(o._locale=e._locale),o}function zt(e,t){var n=e&amp;&amp;parseFloat(e.replace(&quot;,&quot;,&quot;.&quot;));return(isNaN(n)?0:n)*t}function Yt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,&quot;M&quot;).isAfter(t)&amp;&amp;--n.months,n.milliseconds=+t-+e.clone().add(n.months,&quot;M&quot;),n}function Ut(e,t){var n;return e.isValid()&amp;&amp;t.isValid()?(t=kt(t,e),e.isBefore(t)?n=Yt(e,t):(n=Yt(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function Gt(e,t){return function(n,o){var r,i;return null===o||isNaN(+o)||(E(t,&quot;moment().&quot;+t+&quot;(period, number) is deprecated. Please use moment().&quot;+t+&quot;(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.&quot;),i=n,n=o,o=i),n=&quot;string&quot;==typeof n?+n:n,r=Ft(n,o),$t(this,r,e),this}}function $t(t,n,o,r){var i=n._milliseconds,s=Et(n._days),a=Et(n._months);t.isValid()&amp;&amp;(r=null==r||r,i&amp;&amp;t._d.setTime(t._d.valueOf()+i*o),s&amp;&amp;Y(t,&quot;Date&quot;,z(t,&quot;Date&quot;)+s*o),a&amp;&amp;de(t,z(t,&quot;Month&quot;)+a*o),r&amp;&amp;e.updateOffset(t,s||a))}function Kt(e,t){var n=e.diff(t,&quot;days&quot;,!0);return n&lt;-6?&quot;sameElse&quot;:n&lt;-1?&quot;lastWeek&quot;:n&lt;0?&quot;lastDay&quot;:n&lt;1?&quot;sameDay&quot;:n&lt;2?&quot;nextDay&quot;:n&lt;7?&quot;nextWeek&quot;:&quot;sameElse&quot;}function Xt(t,n){var o=t||bt(),r=kt(o,this).startOf(&quot;day&quot;),i=e.calendarFormat(this,r)||&quot;sameElse&quot;,s=n&amp;&amp;(O(n[i])?n[i].call(this,o):n[i]);return this.format(s||this.localeData().calendar(i,this,bt(o)))}function qt(){return new y(this)}function Zt(e,t){var n=b(e)?e:bt(e);return!(!this.isValid()||!n.isValid())&amp;&amp;(t=W(w(t)?&quot;millisecond&quot;:t),&quot;millisecond&quot;===t?this.valueOf()&gt;n.valueOf():n.valueOf()&lt;this.clone().startOf(t).valueOf())}function Jt(e,t){var n=b(e)?e:bt(e);return!(!this.isValid()||!n.isValid())&amp;&amp;(t=W(w(t)?&quot;millisecond&quot;:t),&quot;millisecond&quot;===t?this.valueOf()&lt;n.valueOf():this.clone().endOf(t).valueOf()&lt;n.valueOf())}function Qt(e,t,n,o){return o=o||&quot;()&quot;,(&quot;(&quot;===o[0]?this.isAfter(e,n):!this.isBefore(e,n))&amp;&amp;(&quot;)&quot;===o[1]?this.isBefore(t,n):!this.isAfter(t,n))}function en(e,t){var n,o=b(e)?e:bt(e);return!(!this.isValid()||!o.isValid())&amp;&amp;(t=W(t||&quot;millisecond&quot;),&quot;millisecond&quot;===t?this.valueOf()===o.valueOf():(n=o.valueOf(),this.clone().startOf(t).valueOf()&lt;=n&amp;&amp;n&lt;=this.clone().endOf(t).valueOf()))}function tn(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function nn(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function on(e,t,n){var o,r,i,s;return this.isValid()?(o=kt(e,this),o.isValid()?(r=6e4*(o.utcOffset()-this.utcOffset()),t=W(t),&quot;year&quot;===t||&quot;month&quot;===t||&quot;quarter&quot;===t?(s=rn(this,o),&quot;quarter&quot;===t?s/=3:&quot;year&quot;===t&amp;&amp;(s/=12)):(i=this-o,s=&quot;second&quot;===t?i/1e3:&quot;minute&quot;===t?i/6e4:&quot;hour&quot;===t?i/36e5:&quot;day&quot;===t?(i-r)/864e5:&quot;week&quot;===t?(i-r)/6048e5:i),n?s:C(s)):NaN):NaN}function rn(e,t){var n,o,r=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(r,&quot;months&quot;);return t-i&lt;0?(n=e.clone().add(r-1,&quot;months&quot;),o=(t-i)/(i-n)):(n=e.clone().add(r+1,&quot;months&quot;),o=(t-i)/(n-i)),-(r+o)||0}function sn(){return this.clone().locale(&quot;en&quot;).format(&quot;ddd MMM DD YYYY HH:mm:ss [GMT]ZZ&quot;)}function an(){var e=this.clone().utc();return 0&lt;e.year()&amp;&amp;e.year()&lt;=9999?O(Date.prototype.toISOString)?this.toDate().toISOString():Z(e,&quot;YYYY-MM-DD[T]HH:mm:ss.SSS[Z]&quot;):Z(e,&quot;YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]&quot;)}function ln(){if(!this.isValid())return&quot;moment.invalid(/* &quot;+this._i+&quot; */)&quot;;var e=&quot;moment&quot;,t=&quot;&quot;;this.isLocal()||(e=0===this.utcOffset()?&quot;moment.utc&quot;:&quot;moment.parseZone&quot;,t=&quot;Z&quot;);var n=&quot;[&quot;+e+'(&quot;]',o=0&lt;this.year()&amp;&amp;this.year()&lt;=9999?&quot;YYYY&quot;:&quot;YYYYYY&quot;,r=&quot;-MM-DD[T]HH:mm:ss.SSS&quot;,i=t+'[&quot;)]';return this.format(n+o+r+i)}function un(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var n=Z(this,t);return this.localeData().postformat(n)}function cn(e,t){return this.isValid()&amp;&amp;(b(e)&amp;&amp;e.isValid()||bt(e).isValid())?Ft({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function dn(e){return this.from(bt(),e)}function hn(e,t){return this.isValid()&amp;&amp;(b(e)&amp;&amp;e.isValid()||bt(e).isValid())?Ft({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function fn(e){return this.to(bt(),e)}function pn(e){var t;return void 0===e?this._locale._abbr:(t=ot(e),null!=t&amp;&amp;(this._locale=t),this)}function mn(){return this._locale}function gn(e){switch(e=W(e)){case&quot;year&quot;:this.month(0);case&quot;quarter&quot;:case&quot;month&quot;:this.date(1);case&quot;week&quot;:case&quot;isoWeek&quot;:case&quot;day&quot;:case&quot;date&quot;:this.hours(0);case&quot;hour&quot;:this.minutes(0);case&quot;minute&quot;:this.seconds(0);case&quot;second&quot;:this.milliseconds(0)}return&quot;week&quot;===e&amp;&amp;this.weekday(0),&quot;isoWeek&quot;===e&amp;&amp;this.isoWeekday(1),&quot;quarter&quot;===e&amp;&amp;this.month(3*Math.floor(this.month()/3)),this}function wn(e){return e=W(e),void 0===e||&quot;millisecond&quot;===e?this:(&quot;date&quot;===e&amp;&amp;(e=&quot;day&quot;),this.startOf(e).add(1,&quot;isoWeek&quot;===e?&quot;week&quot;:e).subtract(1,&quot;ms&quot;))}function vn(){return this._d.valueOf()-6e4*(this._offset||0)}function yn(){return Math.floor(this.valueOf()/1e3)}function bn(){return new Date(this.valueOf())}function Cn(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function _n(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function Rn(){return this.isValid()?this.toISOString():null}function Mn(){return m(this)}function Sn(){return d({},p(this))}function En(){return p(this).overflow}function On(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Tn(e,t){K(0,[e,e.length],0,t)}function kn(e){return An.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function xn(e){return An.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function Dn(){return Se(this.year(),1,4)}function Hn(){var e=this.localeData()._week;return Se(this.year(),e.dow,e.doy)}function An(e,t,n,o,r){var i;return null==e?Me(this,o,r).year:(i=Se(e,o,r),t&gt;i&amp;&amp;(t=i),Pn.call(this,e,t,n,o,r))}function Pn(e,t,n,o,r){var i=Re(e,t,n,o,r),s=Ce(i.year,0,i.dayOfYear);return this.year(s.getUTCFullYear()),this.month(s.getUTCMonth()),this.date(s.getUTCDate()),this}function Nn(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}function Ln(e){var t=Math.round((this.clone().startOf(&quot;day&quot;)-this.clone().startOf(&quot;year&quot;))/864e5)+1;return null==e?t:this.add(e-t,&quot;d&quot;)}function In(e,t){t[cr]=_(1e3*(&quot;0.&quot;+e))}function Wn(){return this._isUTC?&quot;UTC&quot;:&quot;&quot;}function jn(){return this._isUTC?&quot;Coordinated Universal Time&quot;:&quot;&quot;}function Vn(e){return bt(1e3*e)}function Bn(){return bt.apply(null,arguments).parseZone()}function Fn(e){return e}function zn(e,t,n,o){var r=ot(),i=h().set(o,t);return r[n](i,e)}function Yn(e,t,n){if(a(e)&amp;&amp;(t=e,e=void 0),e=e||&quot;&quot;,null!=t)return zn(e,t,n,&quot;month&quot;);var o,r=[];for(o=0;o&lt;12;o++)r[o]=zn(e,o,n,&quot;month&quot;);return r}function Un(e,t,n,o){&quot;boolean&quot;==typeof e?(a(t)&amp;&amp;(n=t,t=void 0),t=t||&quot;&quot;):(t=e,n=t,e=!1,a(t)&amp;&amp;(n=t,t=void 0),t=t||&quot;&quot;);var r=ot(),i=e?r._week.dow:0;if(null!=n)return zn(t,(n+i)%7,o,&quot;day&quot;);var s,l=[];for(s=0;s&lt;7;s++)l[s]=zn(t,(s+i)%7,o,&quot;day&quot;);return l}function Gn(e,t){return Yn(e,t,&quot;months&quot;)}function $n(e,t){return Yn(e,t,&quot;monthsShort&quot;)}function Kn(e,t,n){return Un(e,t,n,&quot;weekdays&quot;)}function Xn(e,t,n){return Un(e,t,n,&quot;weekdaysShort&quot;)}function qn(e,t,n){return Un(e,t,n,&quot;weekdaysMin&quot;)}function Zn(){var e=this._data;return this._milliseconds=ti(this._milliseconds),this._days=ti(this._days),this._months=ti(this._months),e.milliseconds=ti(e.milliseconds),e.seconds=ti(e.seconds),e.minutes=ti(e.minutes),e.hours=ti(e.hours),e.months=ti(e.months),e.years=ti(e.years),this}function Jn(e,t,n,o){var r=Ft(t,n);return e._milliseconds+=o*r._milliseconds,e._days+=o*r._days,e._months+=o*r._months,e._bubble()}function Qn(e,t){return Jn(this,e,t,1)}function eo(e,t){return Jn(this,e,t,-1)}function to(e){return e&lt;0?Math.floor(e):Math.ceil(e)}function no(){var e,t,n,o,r,i=this._milliseconds,s=this._days,a=this._months,l=this._data;return i&gt;=0&amp;&amp;s&gt;=0&amp;&amp;a&gt;=0||i&lt;=0&amp;&amp;s&lt;=0&amp;&amp;a&lt;=0||(i+=864e5*to(ro(a)+s),s=0,a=0),l.milliseconds=i%1e3,e=C(i/1e3),l.seconds=e%60,t=C(e/60),l.minutes=t%60,n=C(t/60),l.hours=n%24,s+=C(n/24),r=C(oo(s)),a+=r,s-=to(ro(r)),o=C(a/12),a%=12,l.days=s,l.months=a,l.years=o,this}function oo(e){return 4800*e/146097}function ro(e){return 146097*e/4800}function io(e){var t,n,o=this._milliseconds;if(e=W(e),&quot;month&quot;===e||&quot;year&quot;===e)return t=this._days+o/864e5,n=this._months+oo(t),&quot;month&quot;===e?n:n/12;switch(t=this._days+Math.round(ro(this._months)),e){case&quot;week&quot;:return t/7+o/6048e5;case&quot;day&quot;:return t+o/864e5;case&quot;hour&quot;:return 24*t+o/36e5;case&quot;minute&quot;:return 1440*t+o/6e4;case&quot;second&quot;:return 86400*t+o/1e3;case&quot;millisecond&quot;:return Math.floor(864e5*t)+o;default:throw new Error(&quot;Unknown unit &quot;+e)}}function so(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*_(this._months/12)}function ao(e){return function(){return this.as(e)}}function lo(e){return e=W(e),this[e+&quot;s&quot;]()}function uo(e){return function(){return this._data[e]}}function co(){return C(this.days()/7)}function ho(e,t,n,o,r){return r.relativeTime(t||1,!!n,e,o)}function fo(e,t,n){var o=Ft(e).abs(),r=wi(o.as(&quot;s&quot;)),i=wi(o.as(&quot;m&quot;)),s=wi(o.as(&quot;h&quot;)),a=wi(o.as(&quot;d&quot;)),l=wi(o.as(&quot;M&quot;)),u=wi(o.as(&quot;y&quot;)),c=r&lt;vi.s&amp;&amp;[&quot;s&quot;,r]||i&lt;=1&amp;&amp;[&quot;m&quot;]||i&lt;vi.m&amp;&amp;[&quot;mm&quot;,i]||s&lt;=1&amp;&amp;[&quot;h&quot;]||s&lt;vi.h&amp;&amp;[&quot;hh&quot;,s]||a&lt;=1&amp;&amp;[&quot;d&quot;]||a&lt;vi.d&amp;&amp;[&quot;dd&quot;,a]||l&lt;=1&amp;&amp;[&quot;M&quot;]||l&lt;vi.M&amp;&amp;[&quot;MM&quot;,l]||u&lt;=1&amp;&amp;[&quot;y&quot;]||[&quot;yy&quot;,u];return c[2]=t,c[3]=+e&gt;0,c[4]=n,ho.apply(null,c)}function po(e){return void 0===e?wi:&quot;function&quot;==typeof e&amp;&amp;(wi=e,!0)}function mo(e,t){return void 0!==vi[e]&amp;&amp;(void 0===t?vi[e]:(vi[e]=t,!0))}function go(e){var t=this.localeData(),n=fo(this,!e,t);return e&amp;&amp;(n=t.pastFuture(+this,n)),t.postformat(n)}function wo(){var e,t,n,o=yi(this._milliseconds)/1e3,r=yi(this._days),i=yi(this._months);e=C(o/60),t=C(e/60),o%=60,e%=60,n=C(i/12),i%=12;var s=n,a=i,l=r,u=t,c=e,d=o,h=this.asSeconds();return h?(h&lt;0?&quot;-&quot;:&quot;&quot;)+&quot;P&quot;+(s?s+&quot;Y&quot;:&quot;&quot;)+(a?a+&quot;M&quot;:&quot;&quot;)+(l?l+&quot;D&quot;:&quot;&quot;)+(u||c||d?&quot;T&quot;:&quot;&quot;)+(u?u+&quot;H&quot;:&quot;&quot;)+(c?c+&quot;M&quot;:&quot;&quot;)+(d?d+&quot;S&quot;:&quot;&quot;):&quot;P0D&quot;}var vo,yo;yo=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length&gt;&gt;&gt;0,o=0;o&lt;n;o++)if(o in t&amp;&amp;e.call(this,t[o],o,t))return!0;return!1};var bo=yo,Co=e.momentProperties=[],_o=!1,Ro={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;var Mo;Mo=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)c(e,t)&amp;&amp;n.push(t);return n};var So,Eo=Mo,Oo={sameDay:&quot;[Today at] LT&quot;,nextDay:&quot;[Tomorrow at] LT&quot;,nextWeek:&quot;dddd [at] LT&quot;,lastDay:&quot;[Yesterday at] LT&quot;,lastWeek:&quot;[Last] dddd [at] LT&quot;,sameElse:&quot;L&quot;},To={LTS:&quot;h:mm:ss A&quot;,LT:&quot;h:mm A&quot;,L:&quot;MM/DD/YYYY&quot;,LL:&quot;MMMM D, YYYY&quot;,LLL:&quot;MMMM D, YYYY h:mm A&quot;,LLLL:&quot;dddd, MMMM D, YYYY h:mm A&quot;},ko=&quot;Invalid date&quot;,xo=&quot;%d&quot;,Do=/\d{1,2}/,Ho={future:&quot;in %s&quot;,past:&quot;%s ago&quot;,s:&quot;a few seconds&quot;,m:&quot;a minute&quot;,mm:&quot;%d minutes&quot;,h:&quot;an hour&quot;,hh:&quot;%d hours&quot;,d:&quot;a day&quot;,dd:&quot;%d days&quot;,M:&quot;a month&quot;,MM:&quot;%d months&quot;,y:&quot;a year&quot;,yy:&quot;%d years&quot;},Ao={},Po={},No=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Lo=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Io={},Wo={},jo=/\d/,Vo=/\d\d/,Bo=/\d{3}/,Fo=/\d{4}/,zo=/[+-]?\d{6}/,Yo=/\d\d?/,Uo=/\d\d\d\d?/,Go=/\d\d\d\d\d\d?/,$o=/\d{1,3}/,Ko=/\d{1,4}/,Xo=/[+-]?\d{1,6}/,qo=/\d+/,Zo=/[+-]?\d+/,Jo=/Z|[+-]\d\d:?\d\d/gi,Qo=/Z|[+-]\d\d(?::?\d\d)?/gi,er=/[+-]?\d+(\.\d{1,3})?/,tr=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,nr={},or={},rr=0,ir=1,sr=2,ar=3,lr=4,ur=5,cr=6,dr=7,hr=8;So=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t&lt;this.length;++t)if(this[t]===e)return t;return-1};var fr=So;K(&quot;M&quot;,[&quot;MM&quot;,2],&quot;Mo&quot;,function(){return this.month()+1}),K(&quot;MMM&quot;,0,0,function(e){return this.localeData().monthsShort(this,e)}),K(&quot;MMMM&quot;,0,0,function(e){return this.localeData().months(this,e)}),I(&quot;month&quot;,&quot;M&quot;),V(&quot;month&quot;,8),Q(&quot;M&quot;,Yo),Q(&quot;MM&quot;,Yo,Vo),Q(&quot;MMM&quot;,function(e,t){return t.monthsShortRegex(e)}),Q(&quot;MMMM&quot;,function(e,t){return t.monthsRegex(e)}),oe([&quot;M&quot;,&quot;MM&quot;],function(e,t){t[ir]=_(e)-1}),oe([&quot;MMM&quot;,&quot;MMMM&quot;],function(e,t,n,o){var r=n._locale.monthsParse(e,o,n._strict);null!=r?t[ir]=r:p(n).invalidMonth=e});var pr=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,mr=&quot;January_February_March_April_May_June_July_August_September_October_November_December&quot;.split(&quot;_&quot;),gr=&quot;Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec&quot;.split(&quot;_&quot;),wr=tr,vr=tr;K(&quot;Y&quot;,0,0,function(){var e=this.year();return e&lt;=9999?&quot;&quot;+e:&quot;+&quot;+e}),K(0,[&quot;YY&quot;,2],0,function(){return this.year()%100}),K(0,[&quot;YYYY&quot;,4],0,&quot;year&quot;),K(0,[&quot;YYYYY&quot;,5],0,&quot;year&quot;),K(0,[&quot;YYYYYY&quot;,6,!0],0,&quot;year&quot;),I(&quot;year&quot;,&quot;y&quot;),V(&quot;year&quot;,1),Q(&quot;Y&quot;,Zo),Q(&quot;YY&quot;,Yo,Vo),Q(&quot;YYYY&quot;,Ko,Fo),Q(&quot;YYYYY&quot;,Xo,zo),Q(&quot;YYYYYY&quot;,Xo,zo),oe([&quot;YYYYY&quot;,&quot;YYYYYY&quot;],rr),oe(&quot;YYYY&quot;,function(t,n){n[rr]=2===t.length?e.parseTwoDigitYear(t):_(t)}),oe(&quot;YY&quot;,function(t,n){n[rr]=e.parseTwoDigitYear(t)}),oe(&quot;Y&quot;,function(e,t){t[rr]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return _(e)+(_(e)&gt;68?1900:2e3)};var yr=F(&quot;FullYear&quot;,!0);K(&quot;w&quot;,[&quot;ww&quot;,2],&quot;wo&quot;,&quot;week&quot;),K(&quot;W&quot;,[&quot;WW&quot;,2],&quot;Wo&quot;,&quot;isoWeek&quot;),I(&quot;week&quot;,&quot;w&quot;),I(&quot;isoWeek&quot;,&quot;W&quot;),V(&quot;week&quot;,5),V(&quot;isoWeek&quot;,5),Q(&quot;w&quot;,Yo),Q(&quot;ww&quot;,Yo,Vo),Q(&quot;W&quot;,Yo),Q(&quot;WW&quot;,Yo,Vo),re([&quot;w&quot;,&quot;ww&quot;,&quot;W&quot;,&quot;WW&quot;],function(e,t,n,o){t[o.substr(0,1)]=_(e)});var br={dow:0,doy:6};K(&quot;d&quot;,0,&quot;do&quot;,&quot;day&quot;),K(&quot;dd&quot;,0,0,function(e){return this.localeData().weekdaysMin(this,e)}),K(&quot;ddd&quot;,0,0,function(e){return this.localeData().weekdaysShort(this,e)}),K(&quot;dddd&quot;,0,0,function(e){return this.localeData().weekdays(this,e)}),K(&quot;e&quot;,0,0,&quot;weekday&quot;),K(&quot;E&quot;,0,0,&quot;isoWeekday&quot;),I(&quot;day&quot;,&quot;d&quot;),I(&quot;weekday&quot;,&quot;e&quot;),I(&quot;isoWeekday&quot;,&quot;E&quot;),V(&quot;day&quot;,11),V(&quot;weekday&quot;,11),V(&quot;isoWeekday&quot;,11),Q(&quot;d&quot;,Yo),Q(&quot;e&quot;,Yo),Q(&quot;E&quot;,Yo),Q(&quot;dd&quot;,function(e,t){return t.weekdaysMinRegex(e)}),Q(&quot;ddd&quot;,function(e,t){return t.weekdaysShortRegex(e)}),Q(&quot;dddd&quot;,function(e,t){return t.weekdaysRegex(e)}),re([&quot;dd&quot;,&quot;ddd&quot;,&quot;dddd&quot;],function(e,t,n,o){var r=n._locale.weekdaysParse(e,o,n._strict);null!=r?t.d=r:p(n).invalidWeekday=e}),re([&quot;d&quot;,&quot;e&quot;,&quot;E&quot;],function(e,t,n,o){t[o]=_(e)});var Cr=&quot;Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday&quot;.split(&quot;_&quot;),_r=&quot;Sun_Mon_Tue_Wed_Thu_Fri_Sat&quot;.split(&quot;_&quot;),Rr=&quot;Su_Mo_Tu_We_Th_Fr_Sa&quot;.split(&quot;_&quot;),Mr=tr,Sr=tr,Er=tr;K(&quot;H&quot;,[&quot;HH&quot;,2],0,&quot;hour&quot;),K(&quot;h&quot;,[&quot;hh&quot;,2],0,Ue),K(&quot;k&quot;,[&quot;kk&quot;,2],0,Ge),K(&quot;hmm&quot;,0,0,function(){return&quot;&quot;+Ue.apply(this)+$(this.minutes(),2)}),K(&quot;hmmss&quot;,0,0,function(){return&quot;&quot;+Ue.apply(this)+$(this.minutes(),2)+$(this.seconds(),2)}),K(&quot;Hmm&quot;,0,0,function(){return&quot;&quot;+this.hours()+$(this.minutes(),2)}),K(&quot;Hmmss&quot;,0,0,function(){return&quot;&quot;+this.hours()+$(this.minutes(),2)+$(this.seconds(),2)}),$e(&quot;a&quot;,!0),$e(&quot;A&quot;,!1),I(&quot;hour&quot;,&quot;h&quot;),V(&quot;hour&quot;,13),Q(&quot;a&quot;,Ke),Q(&quot;A&quot;,Ke),Q(&quot;H&quot;,Yo),Q(&quot;h&quot;,Yo),Q(&quot;HH&quot;,Yo,Vo),Q(&quot;hh&quot;,Yo,Vo),Q(&quot;hmm&quot;,Uo),Q(&quot;hmmss&quot;,Go),Q(&quot;Hmm&quot;,Uo),Q(&quot;Hmmss&quot;,Go),oe([&quot;H&quot;,&quot;HH&quot;],ar),oe([&quot;a&quot;,&quot;A&quot;],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),oe([&quot;h&quot;,&quot;hh&quot;],function(e,t,n){t[ar]=_(e),p(n).bigHour=!0}),oe(&quot;hmm&quot;,function(e,t,n){var o=e.length-2;t[ar]=_(e.substr(0,o)),t[lr]=_(e.substr(o)),p(n).bigHour=!0}),oe(&quot;hmmss&quot;,function(e,t,n){var o=e.length-4,r=e.length-2;t[ar]=_(e.substr(0,o)),t[lr]=_(e.substr(o,2)),t[ur]=_(e.substr(r)),p(n).bigHour=!0}),oe(&quot;Hmm&quot;,function(e,t,n){var o=e.length-2;t[ar]=_(e.substr(0,o)),t[lr]=_(e.substr(o))}),oe(&quot;Hmmss&quot;,function(e,t,n){var o=e.length-4,r=e.length-2;t[ar]=_(e.substr(0,o)),t[lr]=_(e.substr(o,2)),t[ur]=_(e.substr(r))});var Or,Tr=/[ap]\.?m?\.?/i,kr=F(&quot;Hours&quot;,!0),xr={calendar:Oo,longDateFormat:To,invalidDate:ko,ordinal:xo,ordinalParse:Do,relativeTime:Ho,months:mr,monthsShort:gr,week:br,weekdays:Cr,weekdaysMin:Rr,weekdaysShort:_r,meridiemParse:Tr},Dr={},Hr={},Ar=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Pr=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Nr=/Z|[+-]\d\d(?::?\d\d)?/,Lr=[[&quot;YYYYYY-MM-DD&quot;,/[+-]\d{6}-\d\d-\d\d/],[&quot;YYYY-MM-DD&quot;,/\d{4}-\d\d-\d\d/],[&quot;GGGG-[W]WW-E&quot;,/\d{4}-W\d\d-\d/],[&quot;GGGG-[W]WW&quot;,/\d{4}-W\d\d/,!1],[&quot;YYYY-DDD&quot;,/\d{4}-\d{3}/],[&quot;YYYY-MM&quot;,/\d{4}-\d\d/,!1],[&quot;YYYYYYMMDD&quot;,/[+-]\d{10}/],[&quot;YYYYMMDD&quot;,/\d{8}/],[&quot;GGGG[W]WWE&quot;,/\d{4}W\d{3}/],[&quot;GGGG[W]WW&quot;,/\d{4}W\d{2}/,!1],[&quot;YYYYDDD&quot;,/\d{7}/]],Ir=[[&quot;HH:mm:ss.SSSS&quot;,/\d\d:\d\d:\d\d\.\d+/],[&quot;HH:mm:ss,SSSS&quot;,/\d\d:\d\d:\d\d,\d+/],[&quot;HH:mm:ss&quot;,/\d\d:\d\d:\d\d/],[&quot;HH:mm&quot;,/\d\d:\d\d/],[&quot;HHmmss.SSSS&quot;,/\d\d\d\d\d\d\.\d+/],[&quot;HHmmss,SSSS&quot;,/\d\d\d\d\d\d,\d+/],[&quot;HHmmss&quot;,/\d\d\d\d\d\d/],[&quot;HHmm&quot;,/\d\d\d\d/],[&quot;HH&quot;,/\d\d/]],Wr=/^\/?Date\((\-?\d+)/i;e.createFromInputFallback=S(&quot;value provided is not in a recognized ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.&quot;,function(e){e._d=new Date(e._i+(e._useUTC?&quot; UTC&quot;:&quot;&quot;))}),e.ISO_8601=function(){};var jr=S(&quot;moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/&quot;,function(){var e=bt.apply(null,arguments);return this.isValid()&amp;&amp;e.isValid()?e&lt;this?this:e:g()}),Vr=S(&quot;moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/&quot;,function(){var e=bt.apply(null,arguments);return this.isValid()&amp;&amp;e.isValid()?e&gt;this?this:e:g()}),Br=function(){return Date.now?Date.now():+new Date};Ot(&quot;Z&quot;,&quot;:&quot;),Ot(&quot;ZZ&quot;,&quot;&quot;),Q(&quot;Z&quot;,Qo),Q(&quot;ZZ&quot;,Qo),oe([&quot;Z&quot;,&quot;ZZ&quot;],function(e,t,n){n._useUTC=!0,n._tzm=Tt(Qo,e)});var Fr=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var zr=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Yr=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;Ft.fn=Mt.prototype;var Ur=Gt(1,&quot;add&quot;),Gr=Gt(-1,&quot;subtract&quot;);e.defaultFormat=&quot;YYYY-MM-DDTHH:mm:ssZ&quot;,e.defaultFormatUtc=&quot;YYYY-MM-DDTHH:mm:ss[Z]&quot;;var $r=S(&quot;moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.&quot;,function(e){return void 0===e?this.localeData():this.locale(e)});K(0,[&quot;gg&quot;,2],0,function(){return this.weekYear()%100}),K(0,[&quot;GG&quot;,2],0,function(){return this.isoWeekYear()%100}),Tn(&quot;gggg&quot;,&quot;weekYear&quot;),Tn(&quot;ggggg&quot;,&quot;weekYear&quot;),Tn(&quot;GGGG&quot;,&quot;isoWeekYear&quot;),Tn(&quot;GGGGG&quot;,&quot;isoWeekYear&quot;),I(&quot;weekYear&quot;,&quot;gg&quot;),I(&quot;isoWeekYear&quot;,&quot;GG&quot;),V(&quot;weekYear&quot;,1),V(&quot;isoWeekYear&quot;,1),Q(&quot;G&quot;,Zo),Q(&quot;g&quot;,Zo),Q(&quot;GG&quot;,Yo,Vo),Q(&quot;gg&quot;,Yo,Vo),Q(&quot;GGGG&quot;,Ko,Fo),Q(&quot;gggg&quot;,Ko,Fo),Q(&quot;GGGGG&quot;,Xo,zo),Q(&quot;ggggg&quot;,Xo,zo),re([&quot;gggg&quot;,&quot;ggggg&quot;,&quot;GGGG&quot;,&quot;GGGGG&quot;],function(e,t,n,o){t[o.substr(0,2)]=_(e)}),re([&quot;gg&quot;,&quot;GG&quot;],function(t,n,o,r){n[r]=e.parseTwoDigitYear(t)}),K(&quot;Q&quot;,0,&quot;Qo&quot;,&quot;quarter&quot;),I(&quot;quarter&quot;,&quot;Q&quot;),V(&quot;quarter&quot;,7),Q(&quot;Q&quot;,jo),oe(&quot;Q&quot;,function(e,t){t[ir]=3*(_(e)-1)}),K(&quot;D&quot;,[&quot;DD&quot;,2],&quot;Do&quot;,&quot;date&quot;),I(&quot;date&quot;,&quot;D&quot;),V(&quot;date&quot;,9),Q(&quot;D&quot;,Yo),Q(&quot;DD&quot;,Yo,Vo),Q(&quot;Do&quot;,function(e,t){return e?t._ordinalParse:t._ordinalParseLenient}),oe([&quot;D&quot;,&quot;DD&quot;],sr),oe(&quot;Do&quot;,function(e,t){t[sr]=_(e.match(Yo)[0],10)});var Kr=F(&quot;Date&quot;,!0);K(&quot;DDD&quot;,[&quot;DDDD&quot;,3],&quot;DDDo&quot;,&quot;dayOfYear&quot;),I(&quot;dayOfYear&quot;,&quot;DDD&quot;),V(&quot;dayOfYear&quot;,4),Q(&quot;DDD&quot;,$o),Q(&quot;DDDD&quot;,Bo),oe([&quot;DDD&quot;,&quot;DDDD&quot;],function(e,t,n){n._dayOfYear=_(e)}),K(&quot;m&quot;,[&quot;mm&quot;,2],0,&quot;minute&quot;),I(&quot;minute&quot;,&quot;m&quot;),V(&quot;minute&quot;,14),Q(&quot;m&quot;,Yo),Q(&quot;mm&quot;,Yo,Vo),oe([&quot;m&quot;,&quot;mm&quot;],lr);var Xr=F(&quot;Minutes&quot;,!1);K(&quot;s&quot;,[&quot;ss&quot;,2],0,&quot;second&quot;),I(&quot;second&quot;,&quot;s&quot;),V(&quot;second&quot;,15),Q(&quot;s&quot;,Yo),Q(&quot;ss&quot;,Yo,Vo),oe([&quot;s&quot;,&quot;ss&quot;],ur);var qr=F(&quot;Seconds&quot;,!1);K(&quot;S&quot;,0,0,function(){return~~(this.millisecond()/100)}),K(0,[&quot;SS&quot;,2],0,function(){return~~(this.millisecond()/10)}),K(0,[&quot;SSS&quot;,3],0,&quot;millisecond&quot;),K(0,[&quot;SSSS&quot;,4],0,function(){return 10*this.millisecond()}),K(0,[&quot;SSSSS&quot;,5],0,function(){return 100*this.millisecond()}),K(0,[&quot;SSSSSS&quot;,6],0,function(){return 1e3*this.millisecond()}),K(0,[&quot;SSSSSSS&quot;,7],0,function(){return 1e4*this.millisecond()}),K(0,[&quot;SSSSSSSS&quot;,8],0,function(){return 1e5*this.millisecond()}),K(0,[&quot;SSSSSSSSS&quot;,9],0,function(){return 1e6*this.millisecond()}),I(&quot;millisecond&quot;,&quot;ms&quot;),V(&quot;millisecond&quot;,16),Q(&quot;S&quot;,$o,jo),Q(&quot;SS&quot;,$o,Vo),Q(&quot;SSS&quot;,$o,Bo);var Zr;for(Zr=&quot;SSSS&quot;;Zr.length&lt;=9;Zr+=&quot;S&quot;)Q(Zr,qo);for(Zr=&quot;S&quot;;Zr.length&lt;=9;Zr+=&quot;S&quot;)oe(Zr,In);var Jr=F(&quot;Milliseconds&quot;,!1);K(&quot;z&quot;,0,0,&quot;zoneAbbr&quot;),K(&quot;zz&quot;,0,0,&quot;zoneName&quot;);var Qr=y.prototype;Qr.add=Ur,Qr.calendar=Xt,Qr.clone=qt,Qr.diff=on,Qr.endOf=wn,Qr.format=un,Qr.from=cn,Qr.fromNow=dn,Qr.to=hn,Qr.toNow=fn,Qr.get=U,Qr.invalidAt=En,Qr.isAfter=Zt,Qr.isBefore=Jt,Qr.isBetween=Qt,Qr.isSame=en,Qr.isSameOrAfter=tn,Qr.isSameOrBefore=nn,Qr.isValid=Mn,Qr.lang=$r,Qr.locale=pn,Qr.localeData=mn,Qr.max=Vr,Qr.min=jr,Qr.parsingFlags=Sn,Qr.set=G,Qr.startOf=gn,Qr.subtract=Gr,Qr.toArray=Cn,Qr.toObject=_n,Qr.toDate=bn,Qr.toISOString=an,Qr.inspect=ln,Qr.toJSON=Rn,Qr.toString=sn,Qr.unix=yn,Qr.valueOf=vn,Qr.creationData=On,Qr.year=yr,Qr.isLeapYear=ye,Qr.weekYear=kn,Qr.isoWeekYear=xn,Qr.quarter=Qr.quarters=Nn,Qr.month=he,Qr.daysInMonth=fe,Qr.week=Qr.weeks=ke,Qr.isoWeek=Qr.isoWeeks=xe,Qr.weeksInYear=Hn,Qr.isoWeeksInYear=Dn,Qr.date=Kr,Qr.day=Qr.days=We,Qr.weekday=je,Qr.isoWeekday=Ve,Qr.dayOfYear=Ln,Qr.hour=Qr.hours=kr,Qr.minute=Qr.minutes=Xr,Qr.second=Qr.seconds=qr,Qr.millisecond=Qr.milliseconds=Jr,Qr.utcOffset=Dt,Qr.utc=At,Qr.local=Pt,Qr.parseZone=Nt,Qr.hasAlignedHourOffset=Lt,Qr.isDST=It,Qr.isLocal=jt,Qr.isUtcOffset=Vt,Qr.isUtc=Bt,Qr.isUTC=Bt,Qr.zoneAbbr=Wn,Qr.zoneName=jn,Qr.dates=S(&quot;dates accessor is deprecated. Use date instead.&quot;,Kr),Qr.months=S(&quot;months accessor is deprecated. Use month instead&quot;,he),Qr.years=S(&quot;years accessor is deprecated. Use year instead&quot;,yr),Qr.zone=S(&quot;moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/&quot;,Ht),Qr.isDSTShifted=S(&quot;isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information&quot;,Wt);var ei=x.prototype;ei.calendar=D,ei.longDateFormat=H,ei.invalidDate=A,ei.ordinal=P,ei.preparse=Fn,ei.postformat=Fn,ei.relativeTime=N,ei.pastFuture=L,ei.set=T,ei.months=ae,ei.monthsShort=le,ei.monthsParse=ce,ei.monthsRegex=me,ei.monthsShortRegex=pe,ei.week=Ee,ei.firstDayOfYear=Te,ei.firstDayOfWeek=Oe,ei.weekdays=Ae,ei.weekdaysMin=Ne,ei.weekdaysShort=Pe,ei.weekdaysParse=Ie,ei.weekdaysRegex=Be,ei.weekdaysShortRegex=Fe,ei.weekdaysMinRegex=ze,ei.isPM=Xe,ei.meridiem=qe,et(&quot;en&quot;,{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===_(e%100/10)?&quot;th&quot;:1===t?&quot;st&quot;:2===t?&quot;nd&quot;:3===t?&quot;rd&quot;:&quot;th&quot;;return e+n}}),e.lang=S(&quot;moment.lang is deprecated. Use moment.locale instead.&quot;,et),e.langData=S(&quot;moment.langData is deprecated. Use moment.localeData instead.&quot;,ot);var ti=Math.abs,ni=ao(&quot;ms&quot;),oi=ao(&quot;s&quot;),ri=ao(&quot;m&quot;),ii=ao(&quot;h&quot;),si=ao(&quot;d&quot;),ai=ao(&quot;w&quot;),li=ao(&quot;M&quot;),ui=ao(&quot;y&quot;),ci=uo(&quot;milliseconds&quot;),di=uo(&quot;seconds&quot;),hi=uo(&quot;minutes&quot;),fi=uo(&quot;hours&quot;),pi=uo(&quot;days&quot;),mi=uo(&quot;months&quot;),gi=uo(&quot;years&quot;),wi=Math.round,vi={s:45,m:45,h:22,d:26,M:11},yi=Math.abs,bi=Mt.prototype;return bi.abs=Zn,bi.add=Qn,bi.subtract=eo,bi.as=io,bi.asMilliseconds=ni,bi.asSeconds=oi,bi.asMinutes=ri,bi.asHours=ii,bi.asDays=si,bi.asWeeks=ai,bi.asMonths=li,bi.asYears=ui,bi.valueOf=so,bi._bubble=no,bi.get=lo,bi.milliseconds=ci,bi.seconds=di,bi.minutes=hi,bi.hours=fi,bi.days=pi,bi.weeks=co,bi.months=mi,bi.years=gi,bi.humanize=go,bi.toISOString=wo,bi.toString=wo,bi.toJSON=wo,bi.locale=pn,bi.localeData=mn,bi.toIsoString=S(&quot;toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)&quot;,wo),bi.lang=$r,K(&quot;X&quot;,0,0,&quot;unix&quot;),K(&quot;x&quot;,0,0,&quot;valueOf&quot;),Q(&quot;x&quot;,Zo),Q(&quot;X&quot;,er),oe(&quot;X&quot;,function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),oe(&quot;x&quot;,function(e,t,n){n._d=new Date(_(e))}),e.version=&quot;2.17.1&quot;,o(bt),e.fn=Qr,e.min=_t,e.max=Rt,e.now=Br,e.utc=h,e.unix=Vn,e.months=Gn,e.isDate=l,e.locale=et,e.invalid=g,e.duration=Ft,e.isMoment=b,e.weekdays=Kn,e.parseZone=Bn,e.localeData=ot,e.isDuration=St,e.monthsShort=$n,e.weekdaysMin=qn,e.defineLocale=tt,e.updateLocale=nt,e.locales=rt,e.weekdaysShort=Xn,e.normalizeUnits=W,e.relativeTimeRounding=po,e.relativeTimeThreshold=mo,e.calendarFormat=Kt,e.prototype=Qr,e})},{}],numbro:[function(t,n,o){/*!
 * numbro.js
 * version : 1.9.3
 * author : FÃ¶retagsplatsen AB
 * license : MIT
 * http://www.foretagsplatsen.se
 */
(function(){&quot;use strict&quot;;function o(e){this._value=e}function r(e){var t,n=&quot;&quot;;for(t=0;t&lt;e;t++)n+=&quot;0&quot;;return n}function i(e,t){var n,o,i,s,a,l,u,c;return c=e.toString(),n=c.split(&quot;e&quot;)[0],s=c.split(&quot;e&quot;)[1],o=n.split(&quot;.&quot;)[0],i=n.split(&quot;.&quot;)[1]||&quot;&quot;,+s&gt;0?c=o+i+r(s-i.length):(a=+o&lt;0?&quot;-0&quot;:&quot;0&quot;,t&gt;0&amp;&amp;(a+=&quot;.&quot;),u=r(-1*s-1),l=(u+Math.abs(o)+i).substr(0,t),c=a+l),+s&gt;0&amp;&amp;t&gt;0&amp;&amp;(c+=&quot;.&quot;+r(t)),c}function s(e,t,n,o){var r,s,a=Math.pow(10,t);return e.toString().indexOf(&quot;e&quot;)&gt;-1?(s=i(e,t),&quot;-&quot;===s.charAt(0)&amp;&amp;+s&gt;=0&amp;&amp;(s=s.substr(1))):s=(n(e+&quot;e+&quot;+t)/a).toFixed(t),o&amp;&amp;(r=new RegExp(&quot;0{1,&quot;+o+&quot;}$&quot;),s=s.replace(r,&quot;&quot;)),s}function a(e,t,n){var o,r=t.replace(/\{[^\{\}]*\}/g,&quot;&quot;);return o=r.indexOf(&quot;$&quot;)&gt;-1?u(e,O[k].currency.symbol,t,n):r.indexOf(&quot;%&quot;)&gt;-1?d(e,t,n):r.indexOf(&quot;:&quot;)&gt;-1?h(e,t):m(e._value,t,n)}function l(e,t){var n,o,r,i,s,a=t,l=!1;if(t.indexOf(&quot;:&quot;)&gt;-1)e._value=f(t);else if(t===x)e._value=0;else{for(&quot;.&quot;!==O[k].delimiters.decimal&amp;&amp;(t=t.replace(/\./g,&quot;&quot;).replace(O[k].delimiters.decimal,&quot;.&quot;)),n=new RegExp(&quot;[^a-zA-Z]&quot;+O[k].abbreviations.thousand+&quot;(?:\\)|(\\&quot;+O[k].currency.symbol+&quot;)?(?:\\))?)?$&quot;),o=new RegExp(&quot;[^a-zA-Z]&quot;+O[k].abbreviations.million+&quot;(?:\\)|(\\&quot;+O[k].currency.symbol+&quot;)?(?:\\))?)?$&quot;),r=new RegExp(&quot;[^a-zA-Z]&quot;+O[k].abbreviations.billion+&quot;(?:\\)|(\\&quot;+O[k].currency.symbol+&quot;)?(?:\\))?)?$&quot;),i=new RegExp(&quot;[^a-zA-Z]&quot;+O[k].abbreviations.trillion+&quot;(?:\\)|(\\&quot;+O[k].currency.symbol+&quot;)?(?:\\))?)?$&quot;),s=1;s&lt;R.length&amp;&amp;!l;++s)t.indexOf(R[s])&gt;-1?l=Math.pow(1024,s):t.indexOf(M[s])&gt;-1&amp;&amp;(l=Math.pow(1e3,s));var u=t.replace(/[^0-9\.]+/g,&quot;&quot;);&quot;&quot;===u?e._value=NaN:(e._value=(l?l:1)*(a.match(n)?Math.pow(10,3):1)*(a.match(o)?Math.pow(10,6):1)*(a.match(r)?Math.pow(10,9):1)*(a.match(i)?Math.pow(10,12):1)*(t.indexOf(&quot;%&quot;)&gt;-1?.01:1)*((t.split(&quot;-&quot;).length+Math.min(t.split(&quot;(&quot;).length-1,t.split(&quot;)&quot;).length-1))%2?1:-1)*Number(u),e._value=l?Math.ceil(e._value):e._value)}return e._value}function u(e,t,n,o){var r,i,s=n,a=s.indexOf(&quot;$&quot;),l=s.indexOf(&quot;(&quot;),u=s.indexOf(&quot;+&quot;),c=s.indexOf(&quot;-&quot;),d=&quot;&quot;,h=&quot;&quot;;if(s.indexOf(&quot;$&quot;)===-1?&quot;infix&quot;===O[k].currency.position?(h=t,O[k].currency.spaceSeparated&amp;&amp;(h=&quot; &quot;+h+&quot; &quot;)):O[k].currency.spaceSeparated&amp;&amp;(d=&quot; &quot;):s.indexOf(&quot; $&quot;)&gt;-1?(d=&quot; &quot;,s=s.replace(&quot; $&quot;,&quot;&quot;)):s.indexOf(&quot;$ &quot;)&gt;-1?(d=&quot; &quot;,s=s.replace(&quot;$ &quot;,&quot;&quot;)):s=s.replace(&quot;$&quot;,&quot;&quot;),i=m(e._value,s,o,h),n.indexOf(&quot;$&quot;)===-1)switch(O[k].currency.position){case&quot;postfix&quot;:i.indexOf(&quot;)&quot;)&gt;-1?(i=i.split(&quot;&quot;),i.splice(-1,0,d+t),i=i.join(&quot;&quot;)):i=i+d+t;break;case&quot;infix&quot;:break;case&quot;prefix&quot;:i.indexOf(&quot;(&quot;)&gt;-1||i.indexOf(&quot;-&quot;)&gt;-1?(i=i.split(&quot;&quot;),r=Math.max(l,c)+1,i.splice(r,0,t+d),i=i.join(&quot;&quot;)):i=t+d+i;break;default:throw Error('Currency position should be among [&quot;prefix&quot;, &quot;infix&quot;, &quot;postfix&quot;]')}else a&lt;=1?i.indexOf(&quot;(&quot;)&gt;-1||i.indexOf(&quot;+&quot;)&gt;-1||i.indexOf(&quot;-&quot;)&gt;-1?(i=i.split(&quot;&quot;),r=1,(a&lt;l||a&lt;u||a&lt;c)&amp;&amp;(r=0),i.splice(r,0,t+d),i=i.join(&quot;&quot;)):i=t+d+i:i.indexOf(&quot;)&quot;)&gt;-1?(i=i.split(&quot;&quot;),i.splice(-1,0,d+t),i=i.join(&quot;&quot;)):i=i+d+t;return i}function c(e,t,n,o){return u(e,t,n,o)}function d(e,t,n){var o,r=&quot;&quot;,i=100*e._value;return t.indexOf(&quot; %&quot;)&gt;-1?(r=&quot; &quot;,t=t.replace(&quot; %&quot;,&quot;&quot;)):t=t.replace(&quot;%&quot;,&quot;&quot;),o=m(i,t,n),o.indexOf(&quot;)&quot;)&gt;-1?(o=o.split(&quot;&quot;),o.splice(-1,0,r+&quot;%&quot;),o=o.join(&quot;&quot;)):o=o+r+&quot;%&quot;,o}function h(e){var t=Math.floor(e._value/60/60),n=Math.floor((e._value-60*t*60)/60),o=Math.round(e._value-60*t*60-60*n);return t+&quot;:&quot;+(n&lt;10?&quot;0&quot;+n:n)+&quot;:&quot;+(o&lt;10?&quot;0&quot;+o:o)}function f(e){var t=e.split(&quot;:&quot;),n=0;return 3===t.length?(n+=60*Number(t[0])*60,n+=60*Number(t[1]),n+=Number(t[2])):2===t.length&amp;&amp;(n+=60*Number(t[0]),n+=Number(t[1])),Number(n)}function p(e,t,n){var o,r,i,s=t[0],a=Math.abs(e);if(a&gt;=n){for(o=1;o&lt;t.length;++o)if(r=Math.pow(n,o),i=Math.pow(n,o+1),a&gt;=r&amp;&amp;a&lt;i){s=t[o],e/=r;break}s===t[0]&amp;&amp;(e/=Math.pow(n,t.length-1),s=t[t.length-1])}return{value:e,suffix:s}}function m(e,t,n,o){var i,a,l,u,c,d,h,f,m,g,w,v,y,b,C,_,R,M=!1,S=!1,T=!1,D=&quot;&quot;,H=!1,A=!1,P=!1,N=!1,L=!1,I=&quot;&quot;,W=&quot;&quot;,j=Math.abs(e),V=&quot;&quot;,B=!1,F=!1,z=&quot;&quot;;if(0===e&amp;&amp;null!==x)return x;if(!isFinite(e))return&quot;&quot;+e;if(0===t.indexOf(&quot;{&quot;)){var Y=t.indexOf(&quot;}&quot;);if(Y===-1)throw Error('Format should also contain a &quot;}&quot;');g=t.slice(1,Y),t=t.slice(Y+1)}else g=&quot;&quot;;if(t.indexOf(&quot;}&quot;)===t.length-1){var U=t.indexOf(&quot;{&quot;);if(U===-1)throw Error('Format should also contain a &quot;{&quot;');w=t.slice(U+1,-1),t=t.slice(0,U+1)}else w=&quot;&quot;;var G;for(G=t.indexOf(&quot;.&quot;)===-1?t.match(/([0-9]+).*/):t.match(/([0-9]+)\..*/),_=null===G?-1:G[1].length,t.indexOf(&quot;-&quot;)!==-1&amp;&amp;(B=!0),t.indexOf(&quot;(&quot;)&gt;-1?(M=!0,t=t.slice(1,-1)):t.indexOf(&quot;+&quot;)&gt;-1&amp;&amp;(S=!0,t=t.replace(/\+/g,&quot;&quot;)),t.indexOf(&quot;a&quot;)&gt;-1&amp;&amp;(f=t.split(&quot;.&quot;)[0].match(/[0-9]+/g)||[&quot;0&quot;],f=parseInt(f[0],10),H=t.indexOf(&quot;aK&quot;)&gt;=0,A=t.indexOf(&quot;aM&quot;)&gt;=0,P=t.indexOf(&quot;aB&quot;)&gt;=0,N=t.indexOf(&quot;aT&quot;)&gt;=0,L=H||A||P||N,t.indexOf(&quot; a&quot;)&gt;-1?(D=&quot; &quot;,t=t.replace(&quot; a&quot;,&quot;&quot;)):t=t.replace(&quot;a&quot;,&quot;&quot;),l=Math.floor(Math.log(j)/Math.LN10)+1,c=l%3,c=0===c?3:c,f&amp;&amp;0!==j&amp;&amp;(u=Math.floor(Math.log(j)/Math.LN10)+1-f,d=3*~~((Math.min(f,l)-c)/3),j/=Math.pow(10,d),t.indexOf(&quot;.&quot;)===-1&amp;&amp;f&gt;3&amp;&amp;(t+=&quot;[.]&quot;,b=0===u?0:3*~~(u/3)-u,b=b&lt;0?b+3:b,t+=r(b))),Math.floor(Math.log(Math.abs(e))/Math.LN10)+1!==f&amp;&amp;(j&gt;=Math.pow(10,12)&amp;&amp;!L||N?(D+=O[k].abbreviations.trillion,e/=Math.pow(10,12)):j&lt;Math.pow(10,12)&amp;&amp;j&gt;=Math.pow(10,9)&amp;&amp;!L||P?(D+=O[k].abbreviations.billion,e/=Math.pow(10,9)):j&lt;Math.pow(10,9)&amp;&amp;j&gt;=Math.pow(10,6)&amp;&amp;!L||A?(D+=O[k].abbreviations.million,e/=Math.pow(10,6)):(j&lt;Math.pow(10,6)&amp;&amp;j&gt;=Math.pow(10,3)&amp;&amp;!L||H)&amp;&amp;(D+=O[k].abbreviations.thousand,e/=Math.pow(10,3)))),R=0;R&lt;E.length;++R)if(i=E[R],t.indexOf(i.marker)&gt;-1){t.indexOf(&quot; &quot;+i.marker)&gt;-1&amp;&amp;(I=&quot; &quot;),t=t.replace(I+i.marker,&quot;&quot;),a=p(e,i.suffixes,i.scale),e=a.value,I+=a.suffix;break}if(t.indexOf(&quot;o&quot;)&gt;-1&amp;&amp;(t.indexOf(&quot; o&quot;)&gt;-1?(W=&quot; &quot;,t=t.replace(&quot; o&quot;,&quot;&quot;)):t=t.replace(&quot;o&quot;,&quot;&quot;),O[k].ordinal&amp;&amp;(W+=O[k].ordinal(e))),t.indexOf(&quot;[.]&quot;)&gt;-1&amp;&amp;(T=!0,t=t.replace(&quot;[.]&quot;,&quot;.&quot;)),h=e.toString().split(&quot;.&quot;)[0],m=t.split(&quot;.&quot;)[1],v=t.indexOf(&quot;,&quot;),m){if(m.indexOf(&quot;*&quot;)!==-1?V=s(e,e.toString().split(&quot;.&quot;)[1].length,n):m.indexOf(&quot;[&quot;)&gt;-1?(m=m.replace(&quot;]&quot;,&quot;&quot;),m=m.split(&quot;[&quot;),V=s(e,m[0].length+m[1].length,n,m[1].length)):V=s(e,m.length,n),h=V.split(&quot;.&quot;)[0],V.split(&quot;.&quot;)[1].length){var $=o?D+o:O[k].delimiters.decimal;V=$+V.split(&quot;.&quot;)[1]}else V=&quot;&quot;;T&amp;&amp;0===Number(V.slice(1))&amp;&amp;(V=&quot;&quot;)}else h=s(e,0,n);return h.indexOf(&quot;-&quot;)&gt;-1&amp;&amp;(h=h.slice(1),F=!0),h.length&lt;_&amp;&amp;(h=r(_-h.length)+h),v&gt;-1&amp;&amp;(h=h.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,&quot;$1&quot;+O[k].delimiters.thousands)),0===t.indexOf(&quot;.&quot;)&amp;&amp;(h=&quot;&quot;),y=t.indexOf(&quot;(&quot;),C=t.indexOf(&quot;-&quot;),z=y&lt;C?(M&amp;&amp;F?&quot;(&quot;:&quot;&quot;)+(B&amp;&amp;F||!M&amp;&amp;F?&quot;-&quot;:&quot;&quot;):(B&amp;&amp;F||!M&amp;&amp;F?&quot;-&quot;:&quot;&quot;)+(M&amp;&amp;F?&quot;(&quot;:&quot;&quot;),g+z+(!F&amp;&amp;S&amp;&amp;0!==e?&quot;+&quot;:&quot;&quot;)+h+V+(W?W:&quot;&quot;)+(D&amp;&amp;!o?D:&quot;&quot;)+(I?I:&quot;&quot;)+(M&amp;&amp;F?&quot;)&quot;:&quot;&quot;)+w}function g(e,t){O[e]=t}function w(e){k=e;var t=O[e].defaults;t&amp;&amp;t.format&amp;&amp;C.defaultFormat(t.format),t&amp;&amp;t.currencyFormat&amp;&amp;C.defaultCurrencyFormat(t.currencyFormat)}function v(){return&quot;undefined&quot;!=typeof process&amp;&amp;void 0===process.browser&amp;&amp;process.title&amp;&amp;(0===process.title.indexOf(&quot;node&quot;)||process.title.indexOf(&quot;meteor-tool&quot;)&gt;0||&quot;grunt&quot;===process.title||&quot;gulp&quot;===process.title)&amp;&amp;&quot;undefined&quot;!=typeof t}function y(e){var t=e.toString().split(&quot;.&quot;);return t.length&lt;2?1:Math.pow(10,t[1].length)}function b(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var n=y(e),o=y(t);return n&gt;o?n:o},-(1/0))}var C,_=&quot;1.9.3&quot;,R=[&quot;B&quot;,&quot;KiB&quot;,&quot;MiB&quot;,&quot;GiB&quot;,&quot;TiB&quot;,&quot;PiB&quot;,&quot;EiB&quot;,&quot;ZiB&quot;,&quot;YiB&quot;],M=[&quot;B&quot;,&quot;KB&quot;,&quot;MB&quot;,&quot;GB&quot;,&quot;TB&quot;,&quot;PB&quot;,&quot;EB&quot;,&quot;ZB&quot;,&quot;YB&quot;],S={general:{scale:1024,suffixes:M,marker:&quot;bd&quot;},binary:{scale:1024,suffixes:R,marker:&quot;b&quot;},decimal:{scale:1e3,suffixes:M,marker:&quot;d&quot;}},E=[S.general,S.binary,S.decimal],O={},T=O,k=&quot;en-US&quot;,x=null,D=&quot;0,0&quot;,H=&quot;0$&quot;,A=&quot;undefined&quot;!=typeof n&amp;&amp;n.exports,P={delimiters:{thousands:&quot;,&quot;,decimal:&quot;.&quot;},abbreviations:{thousand:&quot;k&quot;,million:&quot;m&quot;,billion:&quot;b&quot;,trillion:&quot;t&quot;},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?&quot;th&quot;:1===t?&quot;st&quot;:2===t?&quot;nd&quot;:3===t?&quot;rd&quot;:&quot;th&quot;},currency:{symbol:&quot;$&quot;,position:&quot;prefix&quot;},defaults:{currencyFormat:&quot;,0000 a&quot;},formats:{fourDigits:&quot;0000 a&quot;,fullWithTwoDecimals:&quot;$ ,0.00&quot;,fullWithTwoDecimalsNoCurrency:&quot;,0.00&quot;}};C=function(e){return C.isNumbro(e)?e=e.value():0===e||&quot;undefined&quot;==typeof e?e=0:Number(e)||(e=C.fn.unformat(e)),new o(Number(e))},C.version=_,C.isNumbro=function(e){return e instanceof o},C.setLanguage=function(e,t){console.warn(&quot;`setLanguage` is deprecated since version 1.6.0. Use `setCulture` instead&quot;);var n=e,o=e.split(&quot;-&quot;)[0],r=null;T[n]||(Object.keys(T).forEach(function(e){r||e.split(&quot;-&quot;)[0]!==o||(r=e)}),n=r||t||&quot;en-US&quot;),w(n)},C.setCulture=function(e,t){var n=e,o=e.split(&quot;-&quot;)[1],r=null;O[n]||(o&amp;&amp;Object.keys(O).forEach(function(e){r||e.split(&quot;-&quot;)[1]!==o||(r=e)}),n=r||t||&quot;en-US&quot;),w(n)},C.language=function(e,t){if(console.warn(&quot;`language` is deprecated since version 1.6.0. Use `culture` instead&quot;),!e)return k;if(e&amp;&amp;!t){if(!T[e])throw new Error(&quot;Unknown language : &quot;+e);w(e)}return!t&amp;&amp;T[e]||g(e,t),C},C.culture=function(e,t){if(!e)return k;if(e&amp;&amp;!t){if(!O[e])throw new Error(&quot;Unknown culture : &quot;+e);w(e)}return!t&amp;&amp;O[e]||g(e,t),C},C.languageData=function(e){if(console.warn(&quot;`languageData` is deprecated since version 1.6.0. Use `cultureData` instead&quot;),!e)return T[k];if(!T[e])throw new Error(&quot;Unknown language : &quot;+e);return T[e]},C.cultureData=function(e){if(!e)return O[k];if(!O[e])throw new Error(&quot;Unknown culture : &quot;+e);return O[e]},C.culture(&quot;en-US&quot;,P),C.languages=function(){return console.warn(&quot;`languages` is deprecated since version 1.6.0. Use `cultures` instead&quot;),T},C.cultures=function(){return O},C.zeroFormat=function(e){x=&quot;string&quot;==typeof e?e:null},C.defaultFormat=function(e){D=&quot;string&quot;==typeof e?e:&quot;0.0&quot;},C.defaultCurrencyFormat=function(e){H=&quot;string&quot;==typeof e?e:&quot;0$&quot;},C.validate=function(e,t){var n,o,r,i,s,a,l,u;if(&quot;string&quot;!=typeof e&amp;&amp;(e+=&quot;&quot;,console.warn&amp;&amp;console.warn(&quot;Numbro.js: Value is not string. It has been co-erced to: &quot;,e)),e=e.trim(),e=e.replace(/^[+-]?/,&quot;&quot;),e.match(/^\d+$/))return!0;if(&quot;&quot;===e)return!1;try{l=C.cultureData(t)}catch(e){l=C.cultureData(C.culture())}return r=l.currency.symbol,s=l.abbreviations,n=l.delimiters.decimal,o=&quot;.&quot;===l.delimiters.thousands?&quot;\\.&quot;:l.delimiters.thousands,u=e.match(/^[^\d\.\,]+/),(null===u||(e=e.substr(1),u[0]===r))&amp;&amp;(u=e.match(/[^\d]+$/),(null===u||(e=e.slice(0,-1),u[0]===s.thousand||u[0]===s.million||u[0]===s.billion||u[0]===s.trillion))&amp;&amp;(a=new RegExp(o+&quot;{2}&quot;),!e.match(/[^\d.,]/g)&amp;&amp;(i=e.split(n),!(i.length&gt;2)&amp;&amp;(i.length&lt;2?!!i[0].match(/^\d+.*\d$/)&amp;&amp;!i[0].match(a):&quot;&quot;===i[0]?!i[0].match(a)&amp;&amp;!!i[1].match(/^\d+$/):1===i[0].length?!!i[0].match(/^\d+$/)&amp;&amp;!i[0].match(a)&amp;&amp;!!i[1].match(/^\d+$/):!!i[0].match(/^\d+.*\d$/)&amp;&amp;!i[0].match(a)&amp;&amp;!!i[1].match(/^\d+$/)))))},C.loadLanguagesInNode=function(){console.warn(&quot;`loadLanguagesInNode` is deprecated since version 1.6.0. Use `loadCulturesInNode` instead&quot;),C.loadCulturesInNode()},C.loadCulturesInNode=function(){var e=t(&quot;./languages&quot;);for(var n in e)n&amp;&amp;C.culture(n,e[n])},&quot;function&quot;!=typeof Array.prototype.reduce&amp;&amp;(Array.prototype.reduce=function(e,t){if(null===this||&quot;undefined&quot;==typeof this)throw new TypeError(&quot;Array.prototype.reduce called on null or undefined&quot;);if(&quot;function&quot;!=typeof e)throw new TypeError(e+&quot; is not a function&quot;);var n,o,r=this.length&gt;&gt;&gt;0,i=!1;for(1&lt;arguments.length&amp;&amp;(o=t,i=!0),n=0;r&gt;n;++n)this.hasOwnProperty(n)&amp;&amp;(i?o=e(o,this[n],n,this):(o=this[n],i=!0));if(!i)throw new TypeError(&quot;Reduce of empty array with no initial value&quot;);return o}),C.fn=o.prototype={clone:function(){return C(this)},format:function(e,t){return a(this,e?e:D,void 0!==t?t:Math.round)},formatCurrency:function(e,t){return u(this,O[k].currency.symbol,e?e:H,void 0!==t?t:Math.round)},formatForeignCurrency:function(e,t,n){return c(this,e,t?t:H,void 0!==n?n:Math.round)},unformat:function(e){if(&quot;number&quot;==typeof e)return e;if(&quot;string&quot;==typeof e){var t=l(this,e);return isNaN(t)?void 0:t}},binaryByteUnits:function(){return p(this._value,S.binary.suffixes,S.binary.scale).suffix},byteUnits:function(){return p(this._value,S.general.suffixes,S.general.scale).suffix},decimalByteUnits:function(){return p(this._value,S.decimal.suffixes,S.decimal.scale).suffix},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function t(e,t){return e+n*t}var n=b.call(null,this._value,e);return this._value=[this._value,e].reduce(t,0)/n,this},subtract:function(e){function t(e,t){return e-n*t}var n=b.call(null,this._value,e);return this._value=[e].reduce(t,this._value*n)/n,this},multiply:function(e){function t(e,t){var n=b(e,t),o=e*n;return o*=t*n,o/=n*n}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t){var n=b(e,t);return e*n/(t*n)}return this._value=[this._value,e].reduce(t),this},difference:function(e){return Math.abs(C(this._value).subtract(e).value())}},v()&amp;&amp;C.loadCulturesInNode(),A?n.exports=C:(&quot;undefined&quot;==typeof ender&amp;&amp;(this.numbro=C),&quot;function&quot;==typeof e&amp;&amp;e.amd&amp;&amp;e([],function(){return C}))}).call(&quot;undefined&quot;==typeof window?this:window)},{languages:1}],pikaday:[function(t,n,o){/*!
 * Pikaday
 *
 * Copyright Â© 2014 David Bushell | BSD &amp; MIT license | https://github.com/dbushell/Pikaday
 */
!function(r,i){&quot;use strict&quot;;var s;if(&quot;object&quot;==typeof o){try{s=t(&quot;moment&quot;)}catch(e){}n.exports=i(s)}else&quot;function&quot;==typeof e&amp;&amp;e.amd?e(function(e){var t=&quot;moment&quot;;try{s=e(t)}catch(e){}return i(s)}):r.Pikaday=i(r.moment)}(this,function(e){&quot;use strict&quot;;var t=&quot;function&quot;==typeof e,n=!!window.addEventListener,o=window.document,r=window.setTimeout,i=function(e,t,o,r){n?e.addEventListener(t,o,!!r):e.attachEvent(&quot;on&quot;+t,o)},s=function(e,t,o,r){n?e.removeEventListener(t,o,!!r):e.detachEvent(&quot;on&quot;+t,o)},a=function(e,t,n){var r;o.createEvent?(r=o.createEvent(&quot;HTMLEvents&quot;),r.initEvent(t,!0,!1),r=y(r,n),e.dispatchEvent(r)):o.createEventObject&amp;&amp;(r=o.createEventObject(),r=y(r,n),e.fireEvent(&quot;on&quot;+t,r))},l=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,&quot;&quot;)},u=function(e,t){return(&quot; &quot;+e.className+&quot; &quot;).indexOf(&quot; &quot;+t+&quot; &quot;)!==-1},c=function(e,t){u(e,t)||(e.className=&quot;&quot;===e.className?t:e.className+&quot; &quot;+t)},d=function(e,t){e.className=l((&quot; &quot;+e.className+&quot; &quot;).replace(&quot; &quot;+t+&quot; &quot;,&quot; &quot;))},h=function(e){return/Array/.test(Object.prototype.toString.call(e))},f=function(e){return/Date/.test(Object.prototype.toString.call(e))&amp;&amp;!isNaN(e.getTime())},p=function(e){var t=e.getDay();return 0===t||6===t},m=function(e){return e%4===0&amp;&amp;e%100!==0||e%400===0},g=function(e,t){return[31,m(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},w=function(e){f(e)&amp;&amp;e.setHours(0,0,0,0)},v=function(e,t){return e.getTime()===t.getTime()},y=function(e,t,n){var o,r;for(o in t)r=void 0!==e[o],r&amp;&amp;&quot;object&quot;==typeof t[o]&amp;&amp;null!==t[o]&amp;&amp;void 0===t[o].nodeName?f(t[o])?n&amp;&amp;(e[o]=new Date(t[o].getTime())):h(t[o])?n&amp;&amp;(e[o]=t[o].slice(0)):e[o]=y({},t[o],n):!n&amp;&amp;r||(e[o]=t[o]);return e},b=function(e){return e.month&lt;0&amp;&amp;(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month&gt;11&amp;&amp;(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},C={field:null,bound:void 0,position:&quot;bottom left&quot;,reposition:!0,format:&quot;YYYY-MM-DD&quot;,defaultDate:null,setDefaultDate:!1,firstDay:0,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:&quot;&quot;,showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:&quot;left&quot;,container:void 0,i18n:{previousMonth:&quot;Previous Month&quot;,nextMonth:&quot;Next Month&quot;,months:[&quot;January&quot;,&quot;February&quot;,&quot;March&quot;,&quot;April&quot;,&quot;May&quot;,&quot;June&quot;,&quot;July&quot;,&quot;August&quot;,&quot;September&quot;,&quot;October&quot;,&quot;November&quot;,&quot;December&quot;],weekdays:[&quot;Sunday&quot;,&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;],weekdaysShort:[&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;]},theme:null,onSelect:null,onOpen:null,onClose:null,onDraw:null},_=function(e,t,n){for(t+=e.firstDay;t&gt;=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},R=function(e){var t=[],n=&quot;false&quot;;if(e.isEmpty){if(!e.showDaysInNextAndPreviousMonths)return'&lt;td class=&quot;is-empty&quot;&gt;&lt;/td&gt;';t.push(&quot;is-outside-current-month&quot;)}return e.isDisabled&amp;&amp;t.push(&quot;is-disabled&quot;),e.isToday&amp;&amp;t.push(&quot;is-today&quot;),e.isSelected&amp;&amp;(t.push(&quot;is-selected&quot;),n=&quot;true&quot;),e.isInRange&amp;&amp;t.push(&quot;is-inrange&quot;),e.isStartRange&amp;&amp;t.push(&quot;is-startrange&quot;),e.isEndRange&amp;&amp;t.push(&quot;is-endrange&quot;),'&lt;td data-day=&quot;'+e.day+'&quot; class=&quot;'+t.join(&quot; &quot;)+'&quot; aria-selected=&quot;'+n+'&quot;&gt;&lt;button class=&quot;pika-button pika-day&quot; type=&quot;button&quot; data-pika-year=&quot;'+e.year+'&quot; data-pika-month=&quot;'+e.month+'&quot; data-pika-day=&quot;'+e.day+'&quot;&gt;'+e.day+&quot;&lt;/button&gt;&lt;/td&gt;&quot;},M=function(e,t,n){var o=new Date(n,0,1),r=Math.ceil(((new Date(n,t,e)-o)/864e5+o.getDay()+1)/7);return'&lt;td class=&quot;pika-week&quot;&gt;'+r+&quot;&lt;/td&gt;&quot;},S=function(e,t){return&quot;&lt;tr&gt;&quot;+(t?e.reverse():e).join(&quot;&quot;)+&quot;&lt;/tr&gt;&quot;},E=function(e){return&quot;&lt;tbody&gt;&quot;+e.join(&quot;&quot;)+&quot;&lt;/tbody&gt;&quot;},O=function(e){var t,n=[];for(e.showWeekNumber&amp;&amp;n.push(&quot;&lt;th&gt;&lt;/th&gt;&quot;),t=0;t&lt;7;t++)n.push('&lt;th scope=&quot;col&quot;&gt;&lt;abbr title=&quot;'+_(e,t)+'&quot;&gt;'+_(e,t,!0)+&quot;&lt;/abbr&gt;&lt;/th&gt;&quot;);return&quot;&lt;thead&gt;&lt;tr&gt;&quot;+(e.isRTL?n.reverse():n).join(&quot;&quot;)+&quot;&lt;/tr&gt;&lt;/thead&gt;&quot;},T=function(e,t,n,o,r,i){var s,a,l,u,c,d=e._o,f=n===d.minYear,p=n===d.maxYear,m='&lt;div id=&quot;'+i+'&quot; class=&quot;pika-title&quot; role=&quot;heading&quot; aria-live=&quot;assertive&quot;&gt;',g=!0,w=!0;for(l=[],s=0;s&lt;12;s++)l.push('&lt;option value=&quot;'+(n===r?s-t:12+s-t)+'&quot;'+(s===o?' selected=&quot;selected&quot;':&quot;&quot;)+(f&amp;&amp;s&lt;d.minMonth||p&amp;&amp;s&gt;d.maxMonth?'disabled=&quot;disabled&quot;':&quot;&quot;)+&quot;&gt;&quot;+d.i18n.months[s]+&quot;&lt;/option&gt;&quot;);for(u='&lt;div class=&quot;pika-label&quot;&gt;'+d.i18n.months[o]+'&lt;select class=&quot;pika-select pika-select-month&quot; tabindex=&quot;-1&quot;&gt;'+l.join(&quot;&quot;)+&quot;&lt;/select&gt;&lt;/div&gt;&quot;,h(d.yearRange)?(s=d.yearRange[0],a=d.yearRange[1]+1):(s=n-d.yearRange,a=1+n+d.yearRange),l=[];s&lt;a&amp;&amp;s&lt;=d.maxYear;s++)s&gt;=d.minYear&amp;&amp;l.push('&lt;option value=&quot;'+s+'&quot;'+(s===n?' selected=&quot;selected&quot;':&quot;&quot;)+&quot;&gt;&quot;+s+&quot;&lt;/option&gt;&quot;);return c='&lt;div class=&quot;pika-label&quot;&gt;'+n+d.yearSuffix+'&lt;select class=&quot;pika-select pika-select-year&quot; tabindex=&quot;-1&quot;&gt;'+l.join(&quot;&quot;)+&quot;&lt;/select&gt;&lt;/div&gt;&quot;,m+=d.showMonthAfterYear?c+u:u+c,f&amp;&amp;(0===o||d.minMonth&gt;=o)&amp;&amp;(g=!1),p&amp;&amp;(11===o||d.maxMonth&lt;=o)&amp;&amp;(w=!1),0===t&amp;&amp;(m+='&lt;button class=&quot;pika-prev'+(g?&quot;&quot;:&quot; is-disabled&quot;)+'&quot; type=&quot;button&quot;&gt;'+d.i18n.previousMonth+&quot;&lt;/button&gt;&quot;),t===e._o.numberOfMonths-1&amp;&amp;(m+='&lt;button class=&quot;pika-next'+(w?&quot;&quot;:&quot; is-disabled&quot;)+'&quot; type=&quot;button&quot;&gt;'+d.i18n.nextMonth+&quot;&lt;/button&gt;&quot;),m+=&quot;&lt;/div&gt;&quot;},k=function(e,t,n){return'&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;pika-table&quot; role=&quot;grid&quot; aria-labelledby=&quot;'+n+'&quot;&gt;'+O(e)+E(t)+&quot;&lt;/table&gt;&quot;},x=function(s){var a=this,l=a.config(s);a._onMouseDown=function(e){if(a._v){e=e||window.event;var t=e.target||e.srcElement;if(t)if(u(t,&quot;is-disabled&quot;)||(!u(t,&quot;pika-button&quot;)||u(t,&quot;is-empty&quot;)||u(t.parentNode,&quot;is-disabled&quot;)?u(t,&quot;pika-prev&quot;)?a.prevMonth():u(t,&quot;pika-next&quot;)&amp;&amp;a.nextMonth():(a.setDate(new Date(t.getAttribute(&quot;data-pika-year&quot;),t.getAttribute(&quot;data-pika-month&quot;),t.getAttribute(&quot;data-pika-day&quot;))),l.bound&amp;&amp;r(function(){a.hide(),l.field&amp;&amp;l.field.blur()},100))),u(t,&quot;pika-select&quot;))a._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}},a._onChange=function(e){e=e||window.event;var t=e.target||e.srcElement;t&amp;&amp;(u(t,&quot;pika-select-month&quot;)?a.gotoMonth(t.value):u(t,&quot;pika-select-year&quot;)&amp;&amp;a.gotoYear(t.value))},a._onKeyChange=function(e){if(e=e||window.event,a.isVisible())switch(e.keyCode){case 13:case 27:l.field.blur();break;case 37:e.preventDefault(),a.adjustDate(&quot;subtract&quot;,1);break;case 38:a.adjustDate(&quot;subtract&quot;,7);break;case 39:a.adjustDate(&quot;add&quot;,1);break;case 40:a.adjustDate(&quot;add&quot;,7)}},a._onInputChange=function(n){var o;n.firedBy!==a&amp;&amp;(t?(o=e(l.field.value,l.format,l.formatStrict),o=o&amp;&amp;o.isValid()?o.toDate():null):o=new Date(Date.parse(l.field.value)),f(o)&amp;&amp;a.setDate(o),a._v||a.show())},a._onInputFocus=function(){a.show()},a._onInputClick=function(){a.show()},a._onInputBlur=function(){var e=o.activeElement;do if(u(e,&quot;pika-single&quot;))return;while(e=e.parentNode);a._c||(a._b=r(function(){a.hide()},50)),a._c=!1},a._onClick=function(e){e=e||window.event;var t=e.target||e.srcElement,o=t;if(t){!n&amp;&amp;u(t,&quot;pika-select&quot;)&amp;&amp;(t.onchange||(t.setAttribute(&quot;onchange&quot;,&quot;return;&quot;),i(t,&quot;change&quot;,a._onChange)));do if(u(o,&quot;pika-single&quot;)||o===l.trigger)return;while(o=o.parentNode);a._v&amp;&amp;t!==l.trigger&amp;&amp;o!==l.trigger&amp;&amp;a.hide()}},a.el=o.createElement(&quot;div&quot;),a.el.className=&quot;pika-single&quot;+(l.isRTL?&quot; is-rtl&quot;:&quot;&quot;)+(l.theme?&quot; &quot;+l.theme:&quot;&quot;),i(a.el,&quot;mousedown&quot;,a._onMouseDown,!0),i(a.el,&quot;touchend&quot;,a._onMouseDown,!0),i(a.el,&quot;change&quot;,a._onChange),i(o,&quot;keydown&quot;,a._onKeyChange),l.field&amp;&amp;(l.container?l.container.appendChild(a.el):l.bound?o.body.appendChild(a.el):l.field.parentNode.insertBefore(a.el,l.field.nextSibling),i(l.field,&quot;change&quot;,a._onInputChange),l.defaultDate||(t&amp;&amp;l.field.value?l.defaultDate=e(l.field.value,l.format).toDate():l.defaultDate=new Date(Date.parse(l.field.value)),l.setDefaultDate=!0));var c=l.defaultDate;f(c)?l.setDefaultDate?a.setDate(c,!0):a.gotoDate(c):a.gotoDate(new Date),l.bound?(this.hide(),a.el.className+=&quot; is-bound&quot;,i(l.trigger,&quot;click&quot;,a._onInputClick),i(l.trigger,&quot;focus&quot;,a._onInputFocus),i(l.trigger,&quot;blur&quot;,a._onInputBlur)):this.show()};return x.prototype={config:function(e){this._o||(this._o=y({},C,!0));var t=y(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&amp;&amp;t.field.nodeName?t.field:null,t.theme=&quot;string&quot;==typeof t.theme&amp;&amp;t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&amp;&amp;t.bound:t.field),t.trigger=t.trigger&amp;&amp;t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn=&quot;function&quot;==typeof t.disableDayFn?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n&gt;4?4:n,f(t.minDate)||(t.minDate=!1),f(t.maxDate)||(t.maxDate=!1),t.minDate&amp;&amp;t.maxDate&amp;&amp;t.maxDate&lt;t.minDate&amp;&amp;(t.maxDate=t.minDate=!1),t.minDate&amp;&amp;this.setMinDate(t.minDate),t.maxDate&amp;&amp;this.setMaxDate(t.maxDate),h(t.yearRange)){var o=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||o,t.yearRange[1]=parseInt(t.yearRange[1],10)||o}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||C.yearRange,t.yearRange&gt;100&amp;&amp;(t.yearRange=100);return t},toString:function(n){return f(this._d)?t?e(this._d).format(n||this._o.format):this._d.toDateString():&quot;&quot;},getMoment:function(){return t?e(this._d):null},setMoment:function(n,o){t&amp;&amp;e.isMoment(n)&amp;&amp;this.setDate(n.toDate(),o)},getDate:function(){return f(this._d)?new Date(this._d.getTime()):new Date},setDate:function(e,t){if(!e)return this._d=null,this._o.field&amp;&amp;(this._o.field.value=&quot;&quot;,a(this._o.field,&quot;change&quot;,{firedBy:this})),this.draw();if(&quot;string&quot;==typeof e&amp;&amp;(e=new Date(Date.parse(e))),f(e)){var n=this._o.minDate,o=this._o.maxDate;f(n)&amp;&amp;e&lt;n?e=n:f(o)&amp;&amp;e&gt;o&amp;&amp;(e=o),this._d=new Date(e.getTime()),w(this._d),this.gotoDate(this._d),this._o.field&amp;&amp;(this._o.field.value=this.toString(),a(this._o.field,&quot;change&quot;,{firedBy:this})),t||&quot;function&quot;!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(f(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),o=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),r=e.getTime();o.setMonth(o.getMonth()+1),o.setDate(o.getDate()-1),t=r&lt;n.getTime()||o.getTime()&lt;r}t&amp;&amp;(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],&quot;right&quot;===this._o.mainCalendar&amp;&amp;(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustDate:function(n,o){var r,i=this.getDate(),s=24*parseInt(o)*60*60*1e3;&quot;add&quot;===n?r=new Date(i.valueOf()+s):&quot;subtract&quot;===n&amp;&amp;(r=new Date(i.valueOf()-s)),t&amp;&amp;(&quot;add&quot;===n?r=e(i).add(o,&quot;days&quot;).toDate():&quot;subtract&quot;===n&amp;&amp;(r=e(i).subtract(o,&quot;days&quot;).toDate())),this.setDate(r)},adjustCalendars:function(){this.calendars[0]=b(this.calendars[0]);for(var e=1;e&lt;this._o.numberOfMonths;e++)this.calendars[e]=b({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){e instanceof Date?(w(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()):(this._o.minDate=C.minDate,this._o.minYear=C.minYear,this._o.minMonth=C.minMonth,this._o.startRange=C.startRange),this.draw()},setMaxDate:function(e){e instanceof Date?(w(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth()):(this._o.maxDate=C.maxDate,this._o.maxYear=C.maxYear,this._o.maxMonth=C.maxMonth,this._o.endRange=C.endRange),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t,n=this._o,o=n.minYear,i=n.maxYear,s=n.minMonth,a=n.maxMonth,l=&quot;&quot;;this._y&lt;=o&amp;&amp;(this._y=o,!isNaN(s)&amp;&amp;this._m&lt;s&amp;&amp;(this._m=s)),this._y&gt;=i&amp;&amp;(this._y=i,!isNaN(a)&amp;&amp;this._m&gt;a&amp;&amp;(this._m=a)),t=&quot;pika-title-&quot;+Math.random().toString(36).replace(/[^a-z]+/g,&quot;&quot;).substr(0,2);for(var u=0;u&lt;n.numberOfMonths;u++)l+='&lt;div class=&quot;pika-lendar&quot;&gt;'+T(this,u,this.calendars[u].year,this.calendars[u].month,this.calendars[0].year,t)+this.render(this.calendars[u].year,this.calendars[u].month,t)+&quot;&lt;/div&gt;&quot;;this.el.innerHTML=l,n.bound&amp;&amp;&quot;hidden&quot;!==n.field.type&amp;&amp;r(function(){n.trigger.focus()},1),&quot;function&quot;==typeof this._o.onDraw&amp;&amp;this._o.onDraw(this),n.bound&amp;&amp;n.field.setAttribute(&quot;aria-label&quot;,&quot;Use the arrow keys to pick a date&quot;)}},adjustPosition:function(){var e,t,n,r,i,s,a,l,u,c;if(!this._o.container){if(this.el.style.position=&quot;absolute&quot;,e=this._o.trigger,t=e,n=this.el.offsetWidth,r=this.el.offsetHeight,i=window.innerWidth||o.documentElement.clientWidth,s=window.innerHeight||o.documentElement.clientHeight,a=window.pageYOffset||o.body.scrollTop||o.documentElement.scrollTop,&quot;function&quot;==typeof e.getBoundingClientRect)c=e.getBoundingClientRect(),l=c.left+window.pageXOffset,u=c.bottom+window.pageYOffset;else for(l=t.offsetLeft,u=t.offsetTop+t.offsetHeight;t=t.offsetParent;)l+=t.offsetLeft,u+=t.offsetTop;(this._o.reposition&amp;&amp;l+n&gt;i||this._o.position.indexOf(&quot;right&quot;)&gt;-1&amp;&amp;l-n+e.offsetWidth&gt;0)&amp;&amp;(l=l-n+e.offsetWidth),(this._o.reposition&amp;&amp;u+r&gt;s+a||this._o.position.indexOf(&quot;top&quot;)&gt;-1&amp;&amp;u-r-e.offsetHeight&gt;0)&amp;&amp;(u=u-r-e.offsetHeight),this.el.style.left=l+&quot;px&quot;,this.el.style.top=u+&quot;px&quot;}},render:function(e,t,n){var o=this._o,r=new Date,i=g(e,t),s=new Date(e,t,1).getDay(),a=[],l=[];w(r),o.firstDay&gt;0&amp;&amp;(s-=o.firstDay,s&lt;0&amp;&amp;(s+=7));for(var u=0===t?11:t-1,c=11===t?0:t+1,d=0===t?e-1:e,h=11===t?e+1:e,m=g(d,u),y=i+s,b=y;b&gt;7;)b-=7;y+=7-b;for(var C=0,_=0;C&lt;y;C++){var E=new Date(e,t,1+(C-s)),O=!!f(this._d)&amp;&amp;v(E,this._d),T=v(E,r),x=C&lt;s||C&gt;=i+s,D=1+(C-s),H=t,A=e,P=o.startRange&amp;&amp;v(o.startRange,E),N=o.endRange&amp;&amp;v(o.endRange,E),L=o.startRange&amp;&amp;o.endRange&amp;&amp;o.startRange&lt;E&amp;&amp;E&lt;o.endRange,I=o.minDate&amp;&amp;E&lt;o.minDate||o.maxDate&amp;&amp;E&gt;o.maxDate||o.disableWeekends&amp;&amp;p(E)||o.disableDayFn&amp;&amp;o.disableDayFn(E);x&amp;&amp;(C&lt;s?(D=m+D,H=u,A=d):(D-=i,H=c,A=h));var W={day:D,month:H,year:A,isSelected:O,isToday:T,isDisabled:I,isEmpty:x,isStartRange:P,isEndRange:N,isInRange:L,showDaysInNextAndPreviousMonths:o.showDaysInNextAndPreviousMonths};l.push(R(W)),7===++_&amp;&amp;(o.showWeekNumber&amp;&amp;l.unshift(M(C-s,t,e)),a.push(S(l,o.isRTL)),l=[],_=0)}return k(o,a,n)},isVisible:function(){return this._v},show:function(){this.isVisible()||(d(this.el,&quot;is-hidden&quot;),this._v=!0,this.draw(),this._o.bound&amp;&amp;(i(o,&quot;click&quot;,this._onClick),this.adjustPosition()),&quot;function&quot;==typeof this._o.onOpen&amp;&amp;this._o.onOpen.call(this))},hide:function(){var e=this._v;e!==!1&amp;&amp;(this._o.bound&amp;&amp;s(o,&quot;click&quot;,this._onClick),this.el.style.position=&quot;static&quot;,this.el.style.left=&quot;auto&quot;,this.el.style.top=&quot;auto&quot;,c(this.el,&quot;is-hidden&quot;),this._v=!1,void 0!==e&amp;&amp;&quot;function&quot;==typeof this._o.onClose&amp;&amp;this._o.onClose.call(this))},destroy:function(){this.hide(),s(this.el,&quot;mousedown&quot;,this._onMouseDown,!0),s(this.el,&quot;touchend&quot;,this._onMouseDown,!0),s(this.el,&quot;change&quot;,this._onChange),this._o.field&amp;&amp;(s(this._o.field,&quot;change&quot;,this._onInputChange),this._o.bound&amp;&amp;(s(this._o.trigger,&quot;click&quot;,this._onInputClick),s(this._o.trigger,&quot;focus&quot;,this._onInputFocus),s(this._o.trigger,&quot;blur&quot;,this._onInputBlur))),this.el.parentNode&amp;&amp;this.el.parentNode.removeChild(this.el)}},x})},{moment:&quot;moment&quot;}],zeroclipboard:[function(t,n,o){/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface
 * Copyright (c) 2009-2016 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.3.0
 */
!function(t,o){&quot;use strict&quot;;var r,i,s,a=t,l=a.document,u=a.navigator,c=a.setTimeout,d=a.clearTimeout,h=a.setInterval,f=a.clearInterval,p=a.getComputedStyle,m=a.encodeURIComponent,g=a.ActiveXObject,w=a.Error,v=a.Number.parseInt||a.parseInt,y=a.Number.parseFloat||a.parseFloat,b=a.Number.isNaN||a.isNaN,C=a.Date.now,_=a.Object.keys,R=a.Object.prototype.hasOwnProperty,M=a.Array.prototype.slice,S=function(){var e=function(e){return e};if(&quot;function&quot;==typeof a.wrap&amp;&amp;&quot;function&quot;==typeof a.unwrap)try{var t=l.createElement(&quot;div&quot;),n=a.unwrap(t);1===t.nodeType&amp;&amp;n&amp;&amp;1===n.nodeType&amp;&amp;(e=a.unwrap)}catch(e){}return e}(),E=function(e){return M.call(e,0)},O=function(){var e,t,n,r,i,s,a=E(arguments),l=a[0]||{};for(e=1,t=a.length;e&lt;t;e++)if(null!=(n=a[e]))for(r in n)R.call(n,r)&amp;&amp;(i=l[r],s=n[r],l!==s&amp;&amp;s!==o&amp;&amp;(l[r]=s));return l},T=function(e){var t,n,o,r;if(&quot;object&quot;!=typeof e||null==e||&quot;number&quot;==typeof e.nodeType)t=e;else if(&quot;number&quot;==typeof e.length)for(t=[],n=0,o=e.length;n&lt;o;n++)R.call(e,n)&amp;&amp;(t[n]=T(e[n]));else{t={};for(r in e)R.call(e,r)&amp;&amp;(t[r]=T(e[r]))}return t},k=function(e,t){for(var n={},o=0,r=t.length;o&lt;r;o++)t[o]in e&amp;&amp;(n[t[o]]=e[t[o]]);return n},x=function(e,t){var n={};for(var o in e)t.indexOf(o)===-1&amp;&amp;(n[o]=e[o]);return n},D=function(e){if(e)for(var t in e)R.call(e,t)&amp;&amp;delete e[t];return e},H=function(e,t){if(e&amp;&amp;1===e.nodeType&amp;&amp;e.ownerDocument&amp;&amp;t&amp;&amp;(1===t.nodeType&amp;&amp;t.ownerDocument&amp;&amp;t.ownerDocument===e.ownerDocument||9===t.nodeType&amp;&amp;!t.ownerDocument&amp;&amp;t===e.ownerDocument))do{if(e===t)return!0;e=e.parentNode}while(e);return!1},A=function(e){var t;return&quot;string&quot;==typeof e&amp;&amp;e&amp;&amp;(t=e.split(&quot;#&quot;)[0].split(&quot;?&quot;)[0],t=e.slice(0,e.lastIndexOf(&quot;/&quot;)+1)),t},P=function(e){var t,n;return&quot;string&quot;==typeof e&amp;&amp;e&amp;&amp;(n=e.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&amp;&amp;n[1]?t=n[1]:(n=e.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&amp;&amp;n[1]&amp;&amp;(t=n[1]))),t},N=function(){var e,t;try{throw new w}catch(e){t=e}return t&amp;&amp;(e=t.sourceURL||t.fileName||P(t.stack)),e},L=function(){var e,t,n;if(l.currentScript&amp;&amp;(e=l.currentScript.src))return e;if(t=l.getElementsByTagName(&quot;script&quot;),1===t.length)return t[0].src||o;if(&quot;readyState&quot;in(t[0]||document.createElement(&quot;script&quot;)))for(n=t.length;n--;)if(&quot;interactive&quot;===t[n].readyState&amp;&amp;(e=t[n].src))return e;return&quot;loading&quot;===l.readyState&amp;&amp;(e=t[t.length-1].src)?e:(e=N())?e:o},I=function(){var e,t,n,r=l.getElementsByTagName(&quot;script&quot;);for(e=r.length;e--;){if(!(n=r[e].src)){t=null;break}if(n=A(n),null==t)t=n;else if(t!==n){t=null;break}}return t||o},W=function(){var e=A(L())||I()||&quot;&quot;;return e+&quot;ZeroClipboard.swf&quot;},j=function(){var e=/win(dows|[\s]?(nt|me|ce|xp|vista|[\d]+))/i;return!!u&amp;&amp;(e.test(u.appVersion||&quot;&quot;)||e.test(u.platform||&quot;&quot;)||(u.userAgent||&quot;&quot;).indexOf(&quot;Windows&quot;)!==-1)},V=function(){return null==a.opener&amp;&amp;(!!a.top&amp;&amp;a!=a.top||!!a.parent&amp;&amp;a!=a.parent)}(),B=&quot;html&quot;===l.documentElement.nodeName,F={bridge:null,version:&quot;0.0.0&quot;,pluginType:&quot;unknown&quot;,sandboxed:null,disabled:null,outdated:null,insecure:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},z=&quot;11.0.0&quot;,Y={},U={},G=null,$=0,K=0,X={ready:&quot;Flash communication is established&quot;,error:{&quot;flash-sandboxed&quot;:&quot;Attempting to run Flash in a sandboxed iframe, which is impossible&quot;,&quot;flash-disabled&quot;:&quot;Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.&quot;,&quot;flash-outdated&quot;:&quot;Flash is too outdated to support ZeroClipboard&quot;,&quot;flash-insecure&quot;:&quot;Flash will be unable to communicate due to a protocol mismatch between your `swfPath` configuration and the page&quot;,&quot;flash-unavailable&quot;:&quot;Flash is unable to communicate bidirectionally with JavaScript&quot;,&quot;flash-degraded&quot;:&quot;Flash is unable to preserve data fidelity when communicating with JavaScript&quot;,&quot;flash-deactivated&quot;:&quot;Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.&quot;,&quot;flash-overdue&quot;:&quot;Flash communication was established but NOT within the acceptable time limit&quot;,&quot;version-mismatch&quot;:&quot;ZeroClipboard JS version number does not match ZeroClipboard SWF version number&quot;,&quot;clipboard-error&quot;:&quot;At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard&quot;,&quot;config-mismatch&quot;:&quot;ZeroClipboard configuration does not match Flash's reality&quot;,&quot;swf-not-found&quot;:&quot;The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity&quot;,&quot;browser-unsupported&quot;:&quot;The browser does not support the required HTML DOM and JavaScript features&quot;}},q=[&quot;flash-unavailable&quot;,&quot;flash-degraded&quot;,&quot;flash-overdue&quot;,&quot;version-mismatch&quot;,&quot;config-mismatch&quot;,&quot;clipboard-error&quot;],Z=[&quot;flash-sandboxed&quot;,&quot;flash-disabled&quot;,&quot;flash-outdated&quot;,&quot;flash-insecure&quot;,&quot;flash-unavailable&quot;,&quot;flash-degraded&quot;,&quot;flash-deactivated&quot;,&quot;flash-overdue&quot;],J=new RegExp(&quot;^flash-(&quot;+Z.map(function(e){return e.replace(/^flash-/,&quot;&quot;)}).join(&quot;|&quot;)+&quot;)$&quot;),Q=new RegExp(&quot;^flash-(&quot;+Z.filter(function(e){return&quot;flash-disabled&quot;!==e}).map(function(e){return e.replace(/^flash-/,&quot;&quot;)}).join(&quot;|&quot;)+&quot;)$&quot;),ee={swfPath:W(),trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,fixLineEndings:!0,containerId:&quot;global-zeroclipboard-html-bridge&quot;,containerClass:&quot;global-zeroclipboard-container&quot;,swfObjectId:&quot;global-zeroclipboard-flash-bridge&quot;,hoverClass:&quot;zeroclipboard-is-hover&quot;,activeClass:&quot;zeroclipboard-is-active&quot;,forceHandCursor:!1,title:null,zIndex:999999999},te=function(e){&quot;object&quot;!=typeof e||!e||&quot;length&quot;in e||_(e).forEach(function(t){if(/^(?:forceHandCursor|title|zIndex|bubbleEvents|fixLineEndings)$/.test(t))ee[t]=e[t];else if(null==F.bridge)if(&quot;containerId&quot;===t||&quot;swfObjectId&quot;===t){if(!ve(e[t]))throw new Error(&quot;The specified `&quot;+t+&quot;` value is not valid as an HTML4 Element ID&quot;);ee[t]=e[t]}else ee[t]=e[t]});{if(&quot;string&quot;!=typeof e||!e)return T(ee);if(R.call(ee,e))return ee[e]}},ne=function(){return Je(),{browser:O(k(u,[&quot;userAgent&quot;,&quot;platform&quot;,&quot;appName&quot;,&quot;appVersion&quot;]),{isSupported:oe()}),flash:x(F,[&quot;bridge&quot;]),zeroclipboard:{version:et.version,config:et.config()}}},oe=function(){return!!(l.addEventListener&amp;&amp;a.Object.keys&amp;&amp;a.Array.prototype.map)},re=function(){return!!(F.sandboxed||F.disabled||F.outdated||F.unavailable||F.degraded||F.deactivated)},ie=function(e,t){var n,i,s,a={};if(&quot;string&quot;==typeof e&amp;&amp;e?s=e.toLowerCase().split(/\s+/):&quot;object&quot;!=typeof e||!e||&quot;length&quot;in e||&quot;undefined&quot;!=typeof t||_(e).forEach(function(t){var n=e[t];&quot;function&quot;==typeof n&amp;&amp;et.on(t,n)}),s&amp;&amp;s.length&amp;&amp;t){for(n=0,i=s.length;n&lt;i;n++)e=s[n].replace(/^on/,&quot;&quot;),a[e]=!0,Y[e]||(Y[e]=[]),Y[e].push(t);if(a.ready&amp;&amp;F.ready&amp;&amp;et.emit({type:&quot;ready&quot;}),a.error){for(oe()||et.emit({type:&quot;error&quot;,name:&quot;browser-unsupported&quot;}),n=0,i=Z.length;n&lt;i;n++)if(F[Z[n].replace(/^flash-/,&quot;&quot;)]===!0){et.emit({type:&quot;error&quot;,name:Z[n]});break}r!==o&amp;&amp;et.version!==r&amp;&amp;et.emit({type:&quot;error&quot;,name:&quot;version-mismatch&quot;,jsVersion:et.version,swfVersion:r})}}return et},se=function(e,t){var n,o,r,i,s;if(0===arguments.length?i=_(Y):&quot;string&quot;==typeof e&amp;&amp;e?i=e.toLowerCase().split(/\s+/):&quot;object&quot;!=typeof e||!e||&quot;length&quot;in e||&quot;undefined&quot;!=typeof t||_(e).forEach(function(t){var n=e[t];&quot;function&quot;==typeof n&amp;&amp;et.off(t,n)}),i&amp;&amp;i.length)for(n=0,o=i.length;n&lt;o;n++)if(e=i[n].replace(/^on/,&quot;&quot;),s=Y[e],s&amp;&amp;s.length)if(t)for(r=s.indexOf(t);r!==-1;)s.splice(r,1),r=s.indexOf(t,r);else s.length=0;return et},ae=function(e){var t;return t=&quot;string&quot;==typeof e&amp;&amp;e?T(Y[e])||null:T(Y)},le=function(e){var t,n,o;if(e=ye(e),e&amp;&amp;!Ee(e))return&quot;ready&quot;===e.type&amp;&amp;F.overdue===!0?et.emit({type:&quot;error&quot;,name:&quot;flash-overdue&quot;}):(t=O({},e),Me.call(this,t),&quot;copy&quot;===e.type&amp;&amp;(o=Ne(U),n=o.data,G=o.formatMap),n)},ue=function(){var e=ee.swfPath||&quot;&quot;,t=e.slice(0,2),n=e.slice(0,e.indexOf(&quot;://&quot;)+1);return&quot;\\\\&quot;===t?&quot;file:&quot;:&quot;//&quot;===t||&quot;&quot;===n?a.location.protocol:n},ce=function(){var e,t,n=F.sandboxed;return oe()?(Je(),&quot;boolean&quot;!=typeof F.ready&amp;&amp;(F.ready=!1),void(F.sandboxed!==n&amp;&amp;F.sandboxed===!0?(F.ready=!1,et.emit({type:&quot;error&quot;,name:&quot;flash-sandboxed&quot;})):et.isFlashUnusable()||null!==F.bridge||(t=ue(),t&amp;&amp;t!==a.location.protocol?et.emit({type:&quot;error&quot;,name:&quot;flash-insecure&quot;}):(e=ee.flashLoadTimeout,&quot;number&quot;==typeof e&amp;&amp;e&gt;=0&amp;&amp;($=c(function(){&quot;boolean&quot;!=typeof F.deactivated&amp;&amp;(F.deactivated=!0),F.deactivated===!0&amp;&amp;et.emit({type:&quot;error&quot;,name:&quot;flash-deactivated&quot;})},e)),F.overdue=!1,Ae())))):(F.ready=!1,void et.emit({type:&quot;error&quot;,name:&quot;browser-unsupported&quot;}))},de=function(){et.clearData(),et.blur(),et.emit(&quot;destroy&quot;),Pe(),et.off()},he=function(e,t){var n;if(&quot;object&quot;==typeof e&amp;&amp;e&amp;&amp;&quot;undefined&quot;==typeof t)n=e,et.clearData();else{if(&quot;string&quot;!=typeof e||!e)return;n={},n[e]=t}for(var o in n)&quot;string&quot;==typeof o&amp;&amp;o&amp;&amp;R.call(n,o)&amp;&amp;&quot;string&quot;==typeof n[o]&amp;&amp;n[o]&amp;&amp;(U[o]=Ze(n[o]))},fe=function(e){&quot;undefined&quot;==typeof e?(D(U),G=null):&quot;string&quot;==typeof e&amp;&amp;R.call(U,e)&amp;&amp;delete U[e]},pe=function(e){return&quot;undefined&quot;==typeof e?T(U):&quot;string&quot;==typeof e&amp;&amp;R.call(U,e)?U[e]:void 0},me=function(e){if(e&amp;&amp;1===e.nodeType){i&amp;&amp;(ze(i,ee.activeClass),i!==e&amp;&amp;ze(i,ee.hoverClass)),i=e,Fe(e,ee.hoverClass);var t=e.getAttribute(&quot;title&quot;)||ee.title;if(&quot;string&quot;==typeof t&amp;&amp;t){var n=De(F.bridge);n&amp;&amp;n.setAttribute(&quot;title&quot;,t)}var o=ee.forceHandCursor===!0||&quot;pointer&quot;===Ye(e,&quot;cursor&quot;);Xe(o),Ke()}},ge=function(){var e=De(F.bridge);e&amp;&amp;(e.removeAttribute(&quot;title&quot;),e.style.left=&quot;0px&quot;,e.style.top=&quot;-9999px&quot;,e.style.width=&quot;1px&quot;,e.style.height=&quot;1px&quot;),i&amp;&amp;(ze(i,ee.hoverClass),ze(i,ee.activeClass),i=null)},we=function(){return i||null},ve=function(e){return&quot;string&quot;==typeof e&amp;&amp;e&amp;&amp;/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},ye=function(e){var t;if(&quot;string&quot;==typeof e&amp;&amp;e?(t=e,e={}):&quot;object&quot;==typeof e&amp;&amp;e&amp;&amp;&quot;string&quot;==typeof e.type&amp;&amp;e.type&amp;&amp;(t=e.type),t){t=t.toLowerCase(),!e.target&amp;&amp;(/^(copy|aftercopy|_click)$/.test(t)||&quot;error&quot;===t&amp;&amp;&quot;clipboard-error&quot;===e.name)&amp;&amp;(e.target=s),O(e,{type:t,target:e.target||i||null,relatedTarget:e.relatedTarget||null,currentTarget:F&amp;&amp;F.bridge||null,timeStamp:e.timeStamp||C()||null});var n=X[e.type];return&quot;error&quot;===e.type&amp;&amp;e.name&amp;&amp;n&amp;&amp;(n=n[e.name]),n&amp;&amp;(e.message=n),&quot;ready&quot;===e.type&amp;&amp;O(e,{target:null,version:F.version}),&quot;error&quot;===e.type&amp;&amp;(J.test(e.name)&amp;&amp;O(e,{target:null,minimumVersion:z}),Q.test(e.name)&amp;&amp;O(e,{version:F.version}),&quot;flash-insecure&quot;===e.name&amp;&amp;O(e,{pageProtocol:a.location.protocol,swfProtocol:ue()})),&quot;copy&quot;===e.type&amp;&amp;(e.clipboardData={setData:et.setData,clearData:et.clearData}),&quot;aftercopy&quot;===e.type&amp;&amp;(e=Le(e,G)),e.target&amp;&amp;!e.relatedTarget&amp;&amp;(e.relatedTarget=be(e.target)),Ce(e)}},be=function(e){var t=e&amp;&amp;e.getAttribute&amp;&amp;e.getAttribute(&quot;data-clipboard-target&quot;);return t?l.getElementById(t):null},Ce=function(e){if(e&amp;&amp;/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,n=&quot;_mouseover&quot;===e.type&amp;&amp;e.relatedTarget?e.relatedTarget:o,r=&quot;_mouseout&quot;===e.type&amp;&amp;e.relatedTarget?e.relatedTarget:o,i=Ue(t),s=a.screenLeft||a.screenX||0,u=a.screenTop||a.screenY||0,c=l.body.scrollLeft+l.documentElement.scrollLeft,d=l.body.scrollTop+l.documentElement.scrollTop,h=i.left+(&quot;number&quot;==typeof e._stageX?e._stageX:0),f=i.top+(&quot;number&quot;==typeof e._stageY?e._stageY:0),p=h-c,m=f-d,g=s+p,w=u+m,v=&quot;number&quot;==typeof e.movementX?e.movementX:0,y=&quot;number&quot;==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,O(e,{srcElement:t,fromElement:n,toElement:r,screenX:g,screenY:w,pageX:h,pageY:f,clientX:p,clientY:m,x:p,y:m,movementX:v,movementY:y,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},_e=function(e){var t=e&amp;&amp;&quot;string&quot;==typeof e.type&amp;&amp;e.type||&quot;&quot;;return!/^(?:(?:before)?copy|destroy)$/.test(t)},Re=function(e,t,n,o){o?c(function(){e.apply(t,n)},0):e.apply(t,n)},Me=function(e){if(&quot;object&quot;==typeof e&amp;&amp;e&amp;&amp;e.type){var t=_e(e),n=Y[&quot;*&quot;]||[],o=Y[e.type]||[],r=n.concat(o);if(r&amp;&amp;r.length){var i,s,l,u,c,d=this;for(i=0,s=r.length;i&lt;s;i++)l=r[i],u=d,&quot;string&quot;==typeof l&amp;&amp;&quot;function&quot;==typeof a[l]&amp;&amp;(l=a[l]),&quot;object&quot;==typeof l&amp;&amp;l&amp;&amp;&quot;function&quot;==typeof l.handleEvent&amp;&amp;(u=l,l=l.handleEvent),&quot;function&quot;==typeof l&amp;&amp;(c=O({},e),Re(l,u,[c],t))}return this}},Se=function(e){var t=null;return(V===!1||e&amp;&amp;&quot;error&quot;===e.type&amp;&amp;e.name&amp;&amp;q.indexOf(e.name)!==-1)&amp;&amp;(t=!1),t},Ee=function(e){var t=e.target||i||null,n=&quot;swf&quot;===e._source;switch(delete e._source,e.type){case&quot;error&quot;:var o=&quot;flash-sandboxed&quot;===e.name||Se(e);&quot;boolean&quot;==typeof o&amp;&amp;(F.sandboxed=o),&quot;browser-unsupported&quot;===e.name?O(F,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1}):Z.indexOf(e.name)!==-1?O(F,{disabled:&quot;flash-disabled&quot;===e.name,outdated:&quot;flash-outdated&quot;===e.name,insecure:&quot;flash-insecure&quot;===e.name,unavailable:&quot;flash-unavailable&quot;===e.name,degraded:&quot;flash-degraded&quot;===e.name,deactivated:&quot;flash-deactivated&quot;===e.name,overdue:&quot;flash-overdue&quot;===e.name,ready:!1}):&quot;version-mismatch&quot;===e.name&amp;&amp;(r=e.swfVersion,O(F,{disabled:!1,outdated:!1,insecure:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),$e();break;case&quot;ready&quot;:r=e.swfVersion;var a=F.deactivated===!0;O(F,{sandboxed:!1,disabled:!1,outdated:!1,insecure:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:a,ready:!a}),$e();break;case&quot;beforecopy&quot;:s=t;break;case&quot;copy&quot;:var l,u,c=e.relatedTarget;!U[&quot;text/html&quot;]&amp;&amp;!U[&quot;text/plain&quot;]&amp;&amp;c&amp;&amp;(u=c.value||c.outerHTML||c.innerHTML)&amp;&amp;(l=c.value||c.textContent||c.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData(&quot;text/plain&quot;,l),u!==l&amp;&amp;e.clipboardData.setData(&quot;text/html&quot;,u)):!U[&quot;text/plain&quot;]&amp;&amp;e.target&amp;&amp;(l=e.target.getAttribute(&quot;data-clipboard-text&quot;))&amp;&amp;(e.clipboardData.clearData(),e.clipboardData.setData(&quot;text/plain&quot;,l));break;case&quot;aftercopy&quot;:Oe(e),et.clearData(),t&amp;&amp;t!==Be()&amp;&amp;t.focus&amp;&amp;t.focus();break;case&quot;_mouseover&quot;:et.focus(t),ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;(t&amp;&amp;t!==e.relatedTarget&amp;&amp;!H(e.relatedTarget,t)&amp;&amp;Te(O({},e,{type:&quot;mouseenter&quot;,bubbles:!1,cancelable:!1})),Te(O({},e,{type:&quot;mouseover&quot;})));break;case&quot;_mouseout&quot;:et.blur(),ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;(t&amp;&amp;t!==e.relatedTarget&amp;&amp;!H(e.relatedTarget,t)&amp;&amp;Te(O({},e,{type:&quot;mouseleave&quot;,bubbles:!1,cancelable:!1})),Te(O({},e,{type:&quot;mouseout&quot;})));break;case&quot;_mousedown&quot;:Fe(t,ee.activeClass),ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;Te(O({},e,{type:e.type.slice(1)}));break;case&quot;_mouseup&quot;:ze(t,ee.activeClass),ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;Te(O({},e,{type:e.type.slice(1)}));break;case&quot;_click&quot;:s=null,ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;Te(O({},e,{type:e.type.slice(1)}));break;case&quot;_mousemove&quot;:ee.bubbleEvents===!0&amp;&amp;n&amp;&amp;Te(O({},e,{type:e.type.slice(1)}))}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type))return!0},Oe=function(e){if(e.errors&amp;&amp;e.errors.length&gt;0){var t=T(e);O(t,{type:&quot;error&quot;,name:&quot;clipboard-error&quot;}),delete t.success,c(function(){et.emit(t)},0)}},Te=function(e){if(e&amp;&amp;&quot;string&quot;==typeof e.type&amp;&amp;e){var t,n=e.target||null,o=n&amp;&amp;n.ownerDocument||l,r={view:o.defaultView||a,canBubble:!0,cancelable:!0,detail:&quot;click&quot;===e.type?1:0,button:&quot;number&quot;==typeof e.which?e.which-1:&quot;number&quot;==typeof e.button?e.button:o.createEvent?0:1},i=O(r,e);n&amp;&amp;o.createEvent&amp;&amp;n.dispatchEvent&amp;&amp;(i=[i.type,i.canBubble,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget],t=o.createEvent(&quot;MouseEvents&quot;),t.initMouseEvent&amp;&amp;(t.initMouseEvent.apply(t,i),t._source=&quot;js&quot;,n.dispatchEvent(t)))}},ke=function(){var e=ee.flashLoadTimeout;if(&quot;number&quot;==typeof e&amp;&amp;e&gt;=0){var t=Math.min(1e3,e/10),n=ee.swfObjectId+&quot;_fallbackContent&quot;;K=h(function(){var e=l.getElementById(n);Ge(e)&amp;&amp;($e(),F.deactivated=null,et.emit({type:&quot;error&quot;,name:&quot;swf-not-found&quot;}))},t)}},xe=function(){var e=l.createElement(&quot;div&quot;);return e.id=ee.containerId,e.className=ee.containerClass,e.style.position=&quot;absolute&quot;,e.style.left=&quot;0px&quot;,e.style.top=&quot;-9999px&quot;,e.style.width=&quot;1px&quot;,e.style.height=&quot;1px&quot;,e.style.zIndex=&quot;&quot;+qe(ee.zIndex),e},De=function(e){for(var t=e&amp;&amp;e.parentNode;t&amp;&amp;&quot;OBJECT&quot;===t.nodeName&amp;&amp;t.parentNode;)t=t.parentNode;return t||null},He=function(e){return&quot;string&quot;==typeof e&amp;&amp;e?e.replace(/[&quot;&amp;'&lt;&gt;]/g,function(e){switch(e){case'&quot;':return&quot;&amp;quot;&quot;;case&quot;&amp;&quot;:return&quot;&amp;amp;&quot;;case&quot;'&quot;:return&quot;&amp;apos;&quot;;case&quot;&lt;&quot;:return&quot;&amp;lt;&quot;;case&quot;&gt;&quot;:return&quot;&amp;gt;&quot;;default:return e}}):e},Ae=function(){var e,t=F.bridge,n=De(t);if(!t){var o=Ve(a.location.host,ee),r=&quot;never&quot;===o?&quot;none&quot;:&quot;all&quot;,i=We(O({jsVersion:et.version},ee)),s=ee.swfPath+Ie(ee.swfPath,ee);B&amp;&amp;(s=He(s)),n=xe();var u=l.createElement(&quot;div&quot;);n.appendChild(u),l.body.appendChild(n);var c=l.createElement(&quot;div&quot;),d=&quot;activex&quot;===F.pluginType;c.innerHTML='&lt;object id=&quot;'+ee.swfObjectId+'&quot; name=&quot;'+ee.swfObjectId+'&quot; width=&quot;100%&quot; height=&quot;100%&quot; '+(d?'classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot;':'type=&quot;application/x-shockwave-flash&quot; data=&quot;'+s+'&quot;')+&quot;&gt;&quot;+(d?'&lt;param name=&quot;movie&quot; value=&quot;'+s+'&quot;/&gt;':&quot;&quot;)+'&lt;param name=&quot;allowScriptAccess&quot; value=&quot;'+o+'&quot;/&gt;&lt;param name=&quot;allowNetworking&quot; value=&quot;'+r+'&quot;/&gt;&lt;param name=&quot;menu&quot; value=&quot;false&quot;/&gt;&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot;/&gt;&lt;param name=&quot;flashvars&quot; value=&quot;'+i+'&quot;/&gt;&lt;div id=&quot;'+ee.swfObjectId+'_fallbackContent&quot;&gt;&amp;nbsp;&lt;/div&gt;&lt;/object&gt;',t=c.firstChild,c=null,S(t).ZeroClipboard=et,n.replaceChild(t,u),ke()}return t||(t=l[ee.swfObjectId],t&amp;&amp;(e=t.length)&amp;&amp;(t=t[e-1]),!t&amp;&amp;n&amp;&amp;(t=n.firstChild)),F.bridge=t||null,t},Pe=function(){var e=F.bridge;if(e){var t=De(e);t&amp;&amp;(&quot;activex&quot;===F.pluginType&amp;&amp;&quot;readyState&quot;in e?(e.style.display=&quot;none&quot;,function n(){if(4===e.readyState){for(var o in e)&quot;function&quot;==typeof e[o]&amp;&amp;(e[o]=null);e.parentNode&amp;&amp;e.parentNode.removeChild(e),t.parentNode&amp;&amp;t.parentNode.removeChild(t)}else c(n,10)}()):(e.parentNode&amp;&amp;e.parentNode.removeChild(e),t.parentNode&amp;&amp;t.parentNode.removeChild(t))),$e(),F.ready=null,F.bridge=null,F.deactivated=null,F.insecure=null,r=o}},Ne=function(e){var t={},n={};if(&quot;object&quot;==typeof e&amp;&amp;e){for(var o in e)if(o&amp;&amp;R.call(e,o)&amp;&amp;&quot;string&quot;==typeof e[o]&amp;&amp;e[o])switch(o.toLowerCase()){case&quot;text/plain&quot;:case&quot;text&quot;:case&quot;air:text&quot;:case&quot;flash:text&quot;:t.text=e[o],n.text=o;break;case&quot;text/html&quot;:case&quot;html&quot;:case&quot;air:html&quot;:case&quot;flash:html&quot;:t.html=e[o],n.html=o;break;case&quot;application/rtf&quot;:case&quot;text/rtf&quot;:case&quot;rtf&quot;:case&quot;richtext&quot;:case&quot;air:rtf&quot;:case&quot;flash:rtf&quot;:t.rtf=e[o],n.rtf=o}return{data:t,formatMap:n}}},Le=function(e,t){if(&quot;object&quot;!=typeof e||!e||&quot;object&quot;!=typeof t||!t)return e;var n={};for(var o in e)if(R.call(e,o))if(&quot;errors&quot;===o){n[o]=e[o]?e[o].slice():[];for(var r=0,i=n[o].length;r&lt;i;r++)n[o][r].format=t[n[o][r].format]}else if(&quot;success&quot;!==o&amp;&amp;&quot;data&quot;!==o)n[o]=e[o];else{n[o]={};var s=e[o];for(var a in s)a&amp;&amp;R.call(s,a)&amp;&amp;R.call(t,a)&amp;&amp;(n[o][t[a]]=s[a])}return n},Ie=function(e,t){var n=null==t||t&amp;&amp;t.cacheBust===!0;return n?(e.indexOf(&quot;?&quot;)===-1?&quot;?&quot;:&quot;&amp;&quot;)+&quot;noCache=&quot;+C():&quot;&quot;},We=function(e){var t,n,o,r,i=&quot;&quot;,s=[];if(e.trustedDomains&amp;&amp;(&quot;string&quot;==typeof e.trustedDomains?r=[e.trustedDomains]:&quot;object&quot;==typeof e.trustedDomains&amp;&amp;&quot;length&quot;in e.trustedDomains&amp;&amp;(r=e.trustedDomains)),r&amp;&amp;r.length)for(t=0,n=r.length;t&lt;n;t++)if(R.call(r,t)&amp;&amp;r[t]&amp;&amp;&quot;string&quot;==typeof r[t]){if(o=je(r[t]),!o)continue;if(&quot;*&quot;===o){s.length=0,s.push(o);break}s.push.apply(s,[o,&quot;//&quot;+o,a.location.protocol+&quot;//&quot;+o])}return s.length&amp;&amp;(i+=&quot;trustedOrigins=&quot;+m(s.join(&quot;,&quot;))),e.forceEnhancedClipboard===!0&amp;&amp;(i+=(i?&quot;&amp;&quot;:&quot;&quot;)+&quot;forceEnhancedClipboard=true&quot;),&quot;string&quot;==typeof e.swfObjectId&amp;&amp;e.swfObjectId&amp;&amp;(i+=(i?&quot;&amp;&quot;:&quot;&quot;)+&quot;swfObjectId=&quot;+m(e.swfObjectId)),&quot;string&quot;==typeof e.jsVersion&amp;&amp;e.jsVersion&amp;&amp;(i+=(i?&quot;&amp;&quot;:&quot;&quot;)+&quot;jsVersion=&quot;+m(e.jsVersion)),i},je=function(e){if(null==e||&quot;&quot;===e)return null;if(e=e.replace(/^\s+|\s+$/g,&quot;&quot;),&quot;&quot;===e)return null;var t=e.indexOf(&quot;//&quot;);e=t===-1?e:e.slice(t+2);var n=e.indexOf(&quot;/&quot;);return e=n===-1?e:t===-1||0===n?null:e.slice(0,n),e&amp;&amp;&quot;.swf&quot;===e.slice(-4).toLowerCase()?null:e||null},Ve=function(){var e=function(e){var t,n,o,r=[];if(&quot;string&quot;==typeof e&amp;&amp;(e=[e]),&quot;object&quot;!=typeof e||!e||&quot;number&quot;!=typeof e.length)return r;for(t=0,n=e.length;t&lt;n;t++)if(R.call(e,t)&amp;&amp;(o=je(e[t]))){if(&quot;*&quot;===o){r.length=0,r.push(&quot;*&quot;);break}r.indexOf(o)===-1&amp;&amp;r.push(o)}return r};return function(t,n){var o=je(n.swfPath);null===o&amp;&amp;(o=t);var r=e(n.trustedDomains),i=r.length;if(i&gt;0){if(1===i&amp;&amp;&quot;*&quot;===r[0])return&quot;always&quot;;if(r.indexOf(t)!==-1)return 1===i&amp;&amp;t===o?&quot;sameDomain&quot;:&quot;always&quot;}return&quot;never&quot;}}(),Be=function(){try{return l.activeElement}catch(e){return null}},Fe=function(e,t){var n,o,r,i=[];if(&quot;string&quot;==typeof t&amp;&amp;t&amp;&amp;(i=t.split(/\s+/)),e&amp;&amp;1===e.nodeType&amp;&amp;i.length&gt;0){for(r=(&quot; &quot;+(e.className||&quot;&quot;)+&quot; &quot;).replace(/[\t\r\n\f]/g,&quot; &quot;),n=0,o=i.length;n&lt;o;n++)r.indexOf(&quot; &quot;+i[n]+&quot; &quot;)===-1&amp;&amp;(r+=i[n]+&quot; &quot;);r=r.replace(/^\s+|\s+$/g,&quot;&quot;),r!==e.className&amp;&amp;(e.className=r)}return e},ze=function(e,t){var n,o,r,i=[];if(&quot;string&quot;==typeof t&amp;&amp;t&amp;&amp;(i=t.split(/\s+/)),e&amp;&amp;1===e.nodeType&amp;&amp;i.length&gt;0&amp;&amp;e.className){for(r=(&quot; &quot;+e.className+&quot; &quot;).replace(/[\t\r\n\f]/g,&quot; &quot;),n=0,o=i.length;n&lt;o;n++)r=r.replace(&quot; &quot;+i[n]+&quot; &quot;,&quot; &quot;);r=r.replace(/^\s+|\s+$/g,&quot;&quot;),r!==e.className&amp;&amp;(e.className=r)}return e},Ye=function(e,t){var n=p(e,null).getPropertyValue(t);return&quot;cursor&quot;!==t||n&amp;&amp;&quot;auto&quot;!==n||&quot;A&quot;!==e.nodeName?n:&quot;pointer&quot;},Ue=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n=e.getBoundingClientRect(),o=a.pageXOffset,r=a.pageYOffset,i=l.documentElement.clientLeft||0,s=l.documentElement.clientTop||0,u=0,c=0;if(&quot;relative&quot;===Ye(l.body,&quot;position&quot;)){var d=l.body.getBoundingClientRect(),h=l.documentElement.getBoundingClientRect();u=d.left-h.left||0,c=d.top-h.top||0}t.left=n.left+o-i-u,t.top=n.top+r-s-c,t.width=&quot;width&quot;in n?n.width:n.right-n.left,t.height=&quot;height&quot;in n?n.height:n.bottom-n.top}return t},Ge=function(e){if(!e)return!1;var t=p(e,null);if(!t)return!1;var n=y(t.height)&gt;0,o=y(t.width)&gt;0,r=y(t.top)&gt;=0,i=y(t.left)&gt;=0,s=n&amp;&amp;o&amp;&amp;r&amp;&amp;i,a=s?null:Ue(e),l=&quot;none&quot;!==t.display&amp;&amp;&quot;collapse&quot;!==t.visibility&amp;&amp;(s||!!a&amp;&amp;(n||a.height&gt;0)&amp;&amp;(o||a.width&gt;0)&amp;&amp;(r||a.top&gt;=0)&amp;&amp;(i||a.left&gt;=0));return l},$e=function(){d($),$=0,f(K),K=0},Ke=function(){var e;if(i&amp;&amp;(e=De(F.bridge))){var t=Ue(i);O(e.style,{width:t.width+&quot;px&quot;,height:t.height+&quot;px&quot;,top:t.top+&quot;px&quot;,left:t.left+&quot;px&quot;,zIndex:&quot;&quot;+qe(ee.zIndex)})}},Xe=function(e){F.ready===!0&amp;&amp;(F.bridge&amp;&amp;&quot;function&quot;==typeof F.bridge.setHandCursor?F.bridge.setHandCursor(e):F.ready=!1)},qe=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return&quot;number&quot;!=typeof e||b(e)?&quot;string&quot;==typeof e&amp;&amp;(t=qe(v(e,10))):t=e,&quot;number&quot;==typeof t?t:&quot;auto&quot;},Ze=function(e){var t=/(\r\n|\r|\n)/g;return&quot;string&quot;==typeof e&amp;&amp;ee.fixLineEndings===!0&amp;&amp;(j()?/((^|[^\r])\n|\r([^\n]|$))/.test(e)&amp;&amp;(e=e.replace(t,&quot;\r\n&quot;)):/\r/.test(e)&amp;&amp;(e=e.replace(t,&quot;\n&quot;))),e},Je=function(e){var n,o,r,i=F.sandboxed,s=null;if(e=e===!0,V===!1)s=!1;else{try{o=t.frameElement||null}catch(e){r={name:e.name,message:e.message}}if(o&amp;&amp;1===o.nodeType&amp;&amp;&quot;IFRAME&quot;===o.nodeName)try{s=o.hasAttribute(&quot;sandbox&quot;)}catch(e){s=null}else{try{n=document.domain||null}catch(e){n=null}(null===n||r&amp;&amp;&quot;SecurityError&quot;===r.name&amp;&amp;/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(r.message.toLowerCase()))&amp;&amp;(s=!0)}}return F.sandboxed=s,i===s||e||Qe(g),s},Qe=function(e){function t(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(&quot;.&quot;)}function n(e){return!!e&amp;&amp;(e=e.toLowerCase())&amp;&amp;(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||&quot;chrome.plugin&quot;===e.slice(-13))}function o(e){e&amp;&amp;(a=!0,e.version&amp;&amp;(d=t(e.version)),!d&amp;&amp;e.description&amp;&amp;(d=t(e.description)),e.filename&amp;&amp;(c=n(e.filename)))}var r,i,s,a=!1,l=!1,c=!1,d=&quot;&quot;;if(u.plugins&amp;&amp;u.plugins.length)r=u.plugins[&quot;Shockwave Flash&quot;],o(r),u.plugins[&quot;Shockwave Flash 2.0&quot;]&amp;&amp;(a=!0,d=&quot;2.0.0.11&quot;);else if(u.mimeTypes&amp;&amp;u.mimeTypes.length)s=u.mimeTypes[&quot;application/x-shockwave-flash&quot;],r=s&amp;&amp;s.enabledPlugin,o(r);else if(&quot;undefined&quot;!=typeof e){l=!0;try{i=new e(&quot;ShockwaveFlash.ShockwaveFlash.7&quot;),a=!0,d=t(i.GetVariable(&quot;$version&quot;))}catch(n){try{i=new e(&quot;ShockwaveFlash.ShockwaveFlash.6&quot;),a=!0,d=&quot;6.0.21&quot;}catch(n){try{i=new e(&quot;ShockwaveFlash.ShockwaveFlash&quot;),a=!0,d=t(i.GetVariable(&quot;$version&quot;))}catch(e){l=!1}}}}F.disabled=a!==!0,F.outdated=d&amp;&amp;y(d)&lt;y(z),F.version=d||&quot;0.0.0&quot;,F.pluginType=c?&quot;pepper&quot;:l?&quot;activex&quot;:a?&quot;netscape&quot;:&quot;unknown&quot;};Qe(g),Je(!0);var et=function(){return this instanceof et?void(&quot;function&quot;==typeof et._createClient&amp;&amp;et._createClient.apply(this,E(arguments))):new et};et.version=&quot;2.3.0&quot;,et.config=function(){return te.apply(this,E(arguments))},et.state=function(){return ne.apply(this,E(arguments))},et.isFlashUnusable=function(){return re.apply(this,E(arguments))},et.on=function(){return ie.apply(this,E(arguments))},et.off=function(){return se.apply(this,E(arguments))},et.handlers=function(){return ae.apply(this,E(arguments))},et.emit=function(){return le.apply(this,E(arguments))},et.create=function(){return ce.apply(this,E(arguments))},et.destroy=function(){return de.apply(this,E(arguments))},et.setData=function(){return he.apply(this,E(arguments))},et.clearData=function(){return fe.apply(this,E(arguments))},et.getData=function(){return pe.apply(this,E(arguments))},et.focus=et.activate=function(){return me.apply(this,E(arguments))},et.blur=et.deactivate=function(){return ge.apply(this,E(arguments))},et.activeElement=function(){return we.apply(this,E(arguments))};var tt=0,nt={},ot=0,rt={},it={};O(ee,{autoActivate:!0});var st=function(e){var t,n=this;n.id=&quot;&quot;+tt++,t={instance:n,elements:[],handlers:{},coreWildcardHandler:function(e){return n.emit(e)}},nt[n.id]=t,e&amp;&amp;n.clip(e),et.on(&quot;*&quot;,t.coreWildcardHandler),et.on(&quot;destroy&quot;,function(){n.destroy()}),et.create()},at=function(e,t){var n,i,s,a={},l=this,u=nt[l.id],c=u&amp;&amp;u.handlers;if(!u)throw new Error(&quot;Attempted to add new listener(s) to a destroyed ZeroClipboard client instance&quot;);if(&quot;string&quot;==typeof e&amp;&amp;e?s=e.toLowerCase().split(/\s+/):&quot;object&quot;!=typeof e||!e||&quot;length&quot;in e||&quot;undefined&quot;!=typeof t||_(e).forEach(function(t){var n=e[t];&quot;function&quot;==typeof n&amp;&amp;l.on(t,n)}),s&amp;&amp;s.length&amp;&amp;t){for(n=0,i=s.length;n&lt;i;n++)e=s[n].replace(/^on/,&quot;&quot;),a[e]=!0,c[e]||(c[e]=[]),c[e].push(t);if(a.ready&amp;&amp;F.ready&amp;&amp;this.emit({type:&quot;ready&quot;,client:this}),a.error){for(n=0,i=Z.length;n&lt;i;n++)if(F[Z[n].replace(/^flash-/,&quot;&quot;)]){this.emit({type:&quot;error&quot;,name:Z[n],client:this});break}r!==o&amp;&amp;et.version!==r&amp;&amp;this.emit({type:&quot;error&quot;,name:&quot;version-mismatch&quot;,jsVersion:et.version,swfVersion:r})}}return l},lt=function(e,t){var n,o,r,i,s,a=this,l=nt[a.id],u=l&amp;&amp;l.handlers;if(!u)return a;if(0===arguments.length?i=_(u):&quot;string&quot;==typeof e&amp;&amp;e?i=e.split(/\s+/):&quot;object&quot;!=typeof e||!e||&quot;length&quot;in e||&quot;undefined&quot;!=typeof t||_(e).forEach(function(t){var n=e[t];&quot;function&quot;==typeof n&amp;&amp;a.off(t,n)}),i&amp;&amp;i.length)for(n=0,o=i.length;n&lt;o;n++)if(e=i[n].toLowerCase().replace(/^on/,&quot;&quot;),s=u[e],s&amp;&amp;s.length)if(t)for(r=s.indexOf(t);r!==-1;)s.splice(r,1),r=s.indexOf(t,r);else s.length=0;return a},ut=function(e){var t=null,n=nt[this.id]&amp;&amp;nt[this.id].handlers;return n&amp;&amp;(t=&quot;string&quot;==typeof e&amp;&amp;e?n[e]?n[e].slice(0):[]:T(n)),t},ct=function(e){var t,n=this;return mt.call(n,e)&amp;&amp;(&quot;object&quot;==typeof e&amp;&amp;e&amp;&amp;&quot;string&quot;==typeof e.type&amp;&amp;e.type&amp;&amp;(e=O({},e)),t=O({},ye(e),{client:n}),gt.call(n,t)),n},dt=function(e){if(!nt[this.id])throw new Error(&quot;Attempted to clip element(s) to a destroyed ZeroClipboard client instance&quot;);e=wt(e);for(var t=0;t&lt;e.length;t++)if(R.call(e,t)&amp;&amp;e[t]&amp;&amp;1===e[t].nodeType){e[t].zcClippingId?rt[e[t].zcClippingId].indexOf(this.id)===-1&amp;&amp;rt[e[t].zcClippingId].push(this.id):(e[t].zcClippingId=&quot;zcClippingId_&quot;+ot++,rt[e[t].zcClippingId]=[this.id],ee.autoActivate===!0&amp;&amp;vt(e[t]));var n=nt[this.id]&amp;&amp;nt[this.id].elements;n.indexOf(e[t])===-1&amp;&amp;n.push(e[t])}return this},ht=function(e){var t=nt[this.id];if(!t)return this;var n,o=t.elements;e=&quot;undefined&quot;==typeof e?o.slice(0):wt(e);for(var r=e.length;r--;)if(R.call(e,r)&amp;&amp;e[r]&amp;&amp;1===e[r].nodeType){for(n=0;(n=o.indexOf(e[r],n))!==-1;)o.splice(n,1);var i=rt[e[r].zcClippingId];if(i){for(n=0;(n=i.indexOf(this.id,n))!==-1;)i.splice(n,1);0===i.length&amp;&amp;(ee.autoActivate===!0&amp;&amp;yt(e[r]),delete e[r].zcClippingId)}}return this},ft=function(){var e=nt[this.id];return e&amp;&amp;e.elements?e.elements.slice(0):[]},pt=function(){var e=nt[this.id];e&amp;&amp;(this.unclip(),this.off(),et.off(&quot;*&quot;,e.coreWildcardHandler),delete nt[this.id])},mt=function(e){if(!e||!e.type)return!1;if(e.client&amp;&amp;e.client!==this)return!1;var t=nt[this.id],n=t&amp;&amp;t.elements,o=!!n&amp;&amp;n.length&gt;0,r=!e.target||o&amp;&amp;n.indexOf(e.target)!==-1,i=e.relatedTarget&amp;&amp;o&amp;&amp;n.indexOf(e.relatedTarget)!==-1,s=e.client&amp;&amp;e.client===this;return!(!t||!(r||i||s))},gt=function(e){var t=nt[this.id];if(&quot;object&quot;==typeof e&amp;&amp;e&amp;&amp;e.type&amp;&amp;t){var n=_e(e),o=t&amp;&amp;t.handlers[&quot;*&quot;]||[],r=t&amp;&amp;t.handlers[e.type]||[],i=o.concat(r);if(i&amp;&amp;i.length){var s,l,u,c,d,h=this;for(s=0,l=i.length;s&lt;l;s++)u=i[s],c=h,&quot;string&quot;==typeof u&amp;&amp;&quot;function&quot;==typeof a[u]&amp;&amp;(u=a[u]),&quot;object&quot;==typeof u&amp;&amp;u&amp;&amp;&quot;function&quot;==typeof u.handleEvent&amp;&amp;(c=u,u=u.handleEvent),&quot;function&quot;==typeof u&amp;&amp;(d=O({},e),Re(u,c,[d],n))}}},wt=function(e){return&quot;string&quot;==typeof e&amp;&amp;(e=[]),&quot;number&quot;!=typeof e.length?[e]:e},vt=function(e){if(e&amp;&amp;1===e.nodeType){var t=function(e){(e||(e=a.event))&amp;&amp;(&quot;js&quot;!==e._source&amp;&amp;(e.stopImmediatePropagation(),e.preventDefault()),delete e._source)},n=function(n){(n||(n=a.event))&amp;&amp;(t(n),et.focus(e))};e.addEventListener(&quot;mouseover&quot;,n,!1),e.addEventListener(&quot;mouseout&quot;,t,!1),e.addEventListener(&quot;mouseenter&quot;,t,!1),e.addEventListener(&quot;mouseleave&quot;,t,!1),e.addEventListener(&quot;mousemove&quot;,t,!1),it[e.zcClippingId]={mouseover:n,mouseout:t,mouseenter:t,mouseleave:t,mousemove:t}}},yt=function(e){if(e&amp;&amp;1===e.nodeType){var t=it[e.zcClippingId];if(&quot;object&quot;==typeof t&amp;&amp;t){for(var n,o,r=[&quot;move&quot;,&quot;leave&quot;,&quot;enter&quot;,&quot;out&quot;,&quot;over&quot;],i=0,s=r.length;i&lt;s;i++)n=&quot;mouse&quot;+r[i],o=t[n],&quot;function&quot;==typeof o&amp;&amp;e.removeEventListener(n,o,!1);delete it[e.zcClippingId]}}};et._createClient=function(){st.apply(this,E(arguments))},et.prototype.on=function(){return at.apply(this,E(arguments))},et.prototype.off=function(){return lt.apply(this,E(arguments))},et.prototype.handlers=function(){return ut.apply(this,E(arguments))},et.prototype.emit=function(){return ct.apply(this,E(arguments))},et.prototype.clip=function(){return dt.apply(this,E(arguments))},et.prototype.unclip=function(){return ht.apply(this,E(arguments))},et.prototype.elements=function(){return ft.apply(this,E(arguments))},et.prototype.destroy=function(){return pt.apply(this,E(arguments))},et.prototype.setText=function(e){if(!nt[this.id])throw new Error(&quot;Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.setData(&quot;text/plain&quot;,e),this},et.prototype.setHtml=function(e){if(!nt[this.id])throw new Error(&quot;Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.setData(&quot;text/html&quot;,e),this},et.prototype.setRichText=function(e){if(!nt[this.id])throw new Error(&quot;Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.setData(&quot;application/rtf&quot;,e),this},et.prototype.setData=function(){if(!nt[this.id])throw new Error(&quot;Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.setData.apply(this,E(arguments)),this},et.prototype.clearData=function(){if(!nt[this.id])throw new Error(&quot;Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.clearData.apply(this,E(arguments)),this},et.prototype.getData=function(){if(!nt[this.id])throw new Error(&quot;Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance&quot;);return et.getData.apply(this,E(arguments))},&quot;function&quot;==typeof e&amp;&amp;e.amd?e(function(){return et}):&quot;object&quot;==typeof n&amp;&amp;n&amp;&amp;&quot;object&quot;==typeof n.exports&amp;&amp;n.exports?n.exports=et:t.ZeroClipboard=et}(function(){return this||window}())},{}]},{},[24,63,65,66,64,67,110,111,112,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,99,100,101,102,103,105,106,107,108,109,113,114,115,116,133,134,135,136,119,120,121,122,123,124,32,36,33,34,41,35,37,38,39,40])(24)});
//}}}
// %/ //
/***
!!! {{{handsontable}}} macro
***/
//{{{
config.macros.handsontable = {
	defaultOptions: {
		//rowHeaders: true, //alphanumerical headers, not very useful,
		colHeaders: true, //but needed for resizing
		contextMenu: true,
		//manualRowResize: true,
		manualColumnResize: true
	},
	createContainer: function(place,id)
	{
		// create a container with a unique id so that 2 HOTs don't interfere
		var containerId = id || (&quot;handsontable&quot; + Math.floor(Math.random()*1000));
		while(document.getElementById(containerId))
			containerId += Math.floor(Math.random()*10);
		return createTiddlyElement(place,&quot;div&quot;,containerId,null,null,{
			refresh: &quot;macro&quot;, macroName: &quot;handsontable&quot; // enable refreshing
		});
	},
	wikifiedRenderer: function(instance, td, row, col, prop, value, cellProperties)
	{
	    	Handsontable.Dom.empty(td);
	    	wikify(&quot;&quot;+(value || &quot;&quot;),td);
		return td;
	},
	allowBrowserTabSwitch: function(event){
		var $tab = 9;
		if(event.which == $tab &amp;&amp; event.ctrlKey)
			Handsontable.Dom.stopImmediatePropagation(event);
	},
	expandCollapseOrRearrange: function(event)
	{
if(event.target == document.body)
  console.log('targeted document body');
else
  console.log('! targeted not document body');

		var $right = 39, $down = 40, $left = 37, $up = 38,
		    selected = this.getSelected(),
		    isEditMode = this.getActiveEditor().isOpened();
		if(isEditMode) return;

		// calc dimensions
		var startRowNum	= selected ? selected[0] : null,
		    startColNum	= selected ? selected[1] : null,
		    endRowNum	= selected ? selected[2] : null,
		    endColNum	= selected ? selected[3] : null,
		// endRowNum is not necessarily &gt;= startRowNum, it is where selection /has ended/
		    rowsNum	= this.countRows(),
		    colsNum	= this.countCols(),
		    isFirstRow	= endRowNum == 0,
		    isLastRow	= endRowNum == rowsNum-1,
		    isFirstCol	= endColNum == 0,
		    isLastCol	= endColNum == colsNum-1,
		    container	= this.container.parentElement,
		    data	= jQuery(container).data(&quot;data&quot;), i, noData,
		    wasChanged = false, preventDefault = false;

//# test with selections (not just one cell) from right to left/from bottom to top: probably behaves inadequately

		// add rows/columns on going beyond boundaries (by down/right)
		if(isLastRow) {
			if(event.which == $down) {
				this.alter('insert_row',endRowNum+1);
				wasChanged = true;
			}
			if(event.which == $up &amp;&amp; !isFirstRow) {
				noData = true;
				for(i = 0; i &lt; colsNum; i++)
					if(data[endRowNum][i])
						noData = false;
				if(noData) {
					this.alter('remove_row');
					wasChanged = true;
					preventDefault = true;
				}
			}
		}
		if(isLastCol) {
			if(event.which == $right) {
				this.alter('insert_col',endColNum+1);
				wasChanged = true;
			}
			if(event.which == $left &amp;&amp; !isFirstCol) {
				noData = true;
				for(i = 0; i &lt; rowsNum; i++)
					if(data[i][endColNum])
						noData = false;
				if(noData) {
					this.alter('remove_col');
					wasChanged = true;
					preventDefault = true;
				}
			}
		}

		// handle inserting/deleting rows in the middle
		var $i = 73, $enter = 13, $delete = 46,
		    minSelRow	= Math.min(startRowNum,endRowNum),
		    maxSelRow	= Math.max(startRowNum,endRowNum);
		if(event.which == $i &amp;&amp; event.ctrlKey &amp;&amp; !event.shiftKey) {
			this.alter('insert_row',minSelRow);
			this.selectCell(minSelRow,startColNum,minSelRow,endColNum);
			wasChanged = true;
			preventDefault = true;
		}
		if(event.which == $enter &amp;&amp; event.ctrlKey) {
			this.alter('insert_row',maxSelRow+1);
			this.selectCell(maxSelRow+1,startColNum,maxSelRow+1,endColNum);
			wasChanged = true;
			preventDefault = true;
		}
		if(event.which == $delete &amp;&amp; event.ctrlKey) {
			for(var j = 0; j &lt; maxSelRow-minSelRow+1; j++)
				this.alter('remove_row',minSelRow);
			wasChanged = true;
			preventDefault = true;
		}
		// these are ctrl+z-able, according to the tests (made in FF)

		//# rearrange on pressing ctrl+↑/↓/home/end
		var $home = 36, $end = 35;
		if(event.ctrlKey) {
			var shift = event.which == $down ? +1
				  : event.which == $up ?   -1
				  : event.which == $home ? -minSelRow
				  : event.which == $end ?   data.length-1 - maxSelRow
				  : 0;
			// prevent shifting to negative indices
			while(minSelRow + shift &lt; 0)
				shift++;

			if(shift) {
				var mover = this.getPlugin('ManualRowMove');
				if(shift &gt; 0)
				  for(var row = maxSelRow; row &gt;= minSelRow; row--)
					// move down by shift (why +1 ? HOT magic)
					mover.moveRow(row, row + shift+1);
//# this is ctrl+z-able, but after moving multiple rows, multiple ctrl+z is needed to undo
//  fiddles and discussion    see also multiple rows moving here: http://jsfiddle.net/a49efd1f/2/
				else
				  for(var row = minSelRow; row &lt;= maxSelRow; row++)
					// move up by -shift (no +1 or -1 here)
					mover.moveRow(row, row + shift);
//# fix: when moving several lines with .. being selected, the first line is not scrolled into view
//  possible solution: change the order of selection, move, return order
				this.render();
				wasChanged = true;

				// move selection as well
				this.selectCell(startRowNum+shift,startColNum, endRowNum+shift,endColNum);
				preventDefault = true;
			}
		}

		// prevent stuff not meant to happen when using the hotkeys (page scroll etc)
		if(preventDefault) {
			Handsontable.Dom.stopImmediatePropagation(event);
			if(event.preventDefault)
				event.preventDefault();
		}
		if(wasChanged) store.setDirty(true);
//# why is this needed? is it? doesn't afterChange fire?
	},
	getGranulatedData: function(tiddlers,containers)
	{
//# if containers/tiddlers is not an Array, ...
		return tiddlers.map(function(tiddler,i,arr){
			var tidData = [], i, partName;
			for(i = 0; i &lt; containers.length; i++)
			{
// looks like .getData from InsertEditable/SetManagerPlugin may be used here
				partName = containers[i].substr(1);
				switch(containers[i][0]) {
					case &quot;!&quot;:
					tidData.push(tiddler.title);
				  break;case &quot;t&quot;:
					tidData.push(tiddler.text);
				  break;case &quot;#&quot;:
					tidData.push(tiddler.getSection(partName||&quot;&quot;));
				  break;case &quot;:&quot;:
					tidData.push(tiddler.getSlice(partName||&quot;&quot;));
				  break;case &quot;@&quot;:
					tidData.push(store.getValue(tiddler,partName)||&quot;&quot;) ;
				  break;default:
					tidData.push(&quot;&quot;);
				}
			}
			return tidData;
		});
	},
	handler: function(place,macroName,params,wikifier,paramString,tiddler)
	{
		// parse macro params
		var pParams    = paramString.parseParams(&quot;dataAndOptions&quot;,null,true,false, true),
		    filter     = getParam(pParams,&quot;filter&quot;),
		    containers = pParams[0][&quot;containers&quot;], //containers:&quot;!&quot; &quot;:slice&quot; ...
		    macroData  = JSON.parse(getParam(pParams,&quot;data&quot;,&quot;[ [\&quot;\&quot;] ]&quot;)),
		    macroOptions, //= JSON.parse(getParam(pParams,&quot;options&quot;,&quot;{}&quot;))
		    showWikified = getFlag(pParams,&quot;wikified&quot;,paramString.match( /\swikified(\s|$)/gm));
		eval(&quot;macroOptions = &quot;+getParam(pParams,&quot;options&quot;,&quot;{}&quot;));
		var dataAndOptionsSection = getParam(pParams,&quot;dataAndOptions&quot;,&quot;&quot;),
		    separator  = config.textPrimitives.sectionSeparator,
		    dataAndOptionsText, dataAndOptions, storedData, storedOptions,
		    nonStoredOptions = macroOptions;
		merge(nonStoredOptions, this.defaultOptions, true);
		// priority is: storedOptions (highest), macroOptions, defaultOptions
		if(showWikified)
			nonStoredOptions.renderer = this.wikifiedRenderer;

//# refreshing should start here (seems to be only needed for aggregated data)
 // probably updating data and may be calling hot.render() is enough

		// get stored data and options
		if(dataAndOptionsSection) {
			if(dataAndOptionsSection.indexOf(separator) == 0)
				dataAndOptionsSection = tiddler.title + dataAndOptionsSection;
			dataAndOptionsText = store.getTiddlerText(dataAndOptionsSection);
			dataAndOptions	   = dataAndOptionsText ?
				JSON.parse(dataAndOptionsText) : {};
			storedData	   = dataAndOptions.data;
			storedOptions	   = dataAndOptions.options;
		}
		if(filter) {
			containers = containers || [&quot;!&quot;];
			var tiddlers = store.filterTiddlers(filter),
			    granulatedData = this.getGranulatedData(tiddlers,containers);
		}

		var container = this.createContainer(place);
//console.log(&quot;container: &quot;,container);

		// collect options
		var options = storedOptions || {},
		    data = filter ? granulatedData : (storedData || macroData);
		// warn them their edits won't be saved
		if(!dataAndOptionsSection &amp;&amp; !filter)
			data = [ [&quot;Warning: no tiddler, section or containers for storing data were specified, your edits won't be saved&quot;] ];
		if(!filter)
			nonStoredOptions.manualRowMove = true;
		merge(options,nonStoredOptions,true);
		merge(options,{
			data:        data,
			afterChange: filter ? this.saveToContainers : this.saveToTiddler
		},true);

//# change stuff below for the case of aggregated data (both storedOptions and nonStoredOptions may still be useful)
//   colHeaders: [&quot;&quot;,&quot;[[not wikified..]]&quot;,&quot;..but custom&quot;,&quot;headers&quot;,&quot;&quot;],

		// store options and other stuff in container and init handsontable
		if(filter) {
			jQuery(container).data(&quot;containers&quot;,containers);
			jQuery(container).data(&quot;tiddlers&quot;,tiddlers);
			jQuery(container).data(&quot;tiddlersFilter&quot;,filter);
		}
//# implement saving options in the case of containers as well
		jQuery(container).data(&quot;sourceTiddler&quot;,tiddler.title);
		jQuery(container).data(&quot;dataAndOptionsSection&quot;,dataAndOptionsSection);
		jQuery(container).data(&quot;data&quot;,data); // write-only: use to update HOT without creating a new one
		jQuery(container).data(&quot;hotOptions&quot;,options);
		jQuery(container).data(&quot;nonStoredOptions&quot;,nonStoredOptions);

//console.log(&quot;handler launched 1&quot;);
//try {
		var handsontable = new Handsontable(container,options);
//} catch(e) {
//	console.log(&quot;error with creating handsontable, container is&quot;,container,&quot;; options is &quot;,options,&quot;exception is &quot;,e.message);
//};
//##1
console.log(&quot;handler, handsontable is&quot;,handsontable); // can refreshing ~detach this?
		jQuery(container).data(&quot;handsontable&quot;,handsontable);
//var hotBack = jQuery(container).data(&quot;handsontable&quot;);
//console.log(&quot;handler launched 3, hotBack is&quot;,hotBack);

		handsontable.addHook('beforeKeyDown',this.allowBrowserTabSwitch);
//# ask/see source if this is the same as Handsontable.hooks.add(..,..,hotInstance)

//# temporal simplification
if(filter) return;

		// save data to tiddler when a row/column is created/removed as well
		handsontable.addHook('afterRemoveCol',this.saveToTiddler);
		handsontable.addHook('afterRemoveRow',this.saveToTiddler);
		handsontable.addHook('afterCreateCol',this.saveToTiddler);
		handsontable.addHook('afterCreateRow',this.saveToTiddler);
		handsontable.addHook('afterRowMove',this.saveToTiddler);
		// automatically add/remove empty rows/columns
		handsontable.addHook('beforeKeyDown',this.expandCollapseOrRearrange);
	},
	refresh: function(element) {

		var filter = jQuery(element).data(&quot;tiddlersFilter&quot;);
		// refreshing handsontable for non-granulated data doesn't seem
		// to be useful (unless we need to use several HOTs for the same data):
		if(!filter) return;

		var tiddlers	   = store.filterTiddlers(filter),
		    containers	   = jQuery(element).data(&quot;containers&quot;),
		    granulatedData = this.getGranulatedData(tiddlers,containers),
		    handsontable   = jQuery(element).data(&quot;handsontable&quot;),
//##2
		    data	   = jQuery(element).data(&quot;data&quot;),
		    freshData	   = this.getGranulatedData(tiddlers,containers);
console.log(&quot;refresher: handsontable is &quot;,handsontable); // here it is sometimes undefined
if(!handsontable) console.log(&quot;filter is &quot;,filter,&quot;, containers are &quot;,containers,&quot;, data is &quot;,data);

		// set data equal to freshData so that it is still the same array (data = freshData doesn't suffice)
		data.splice(0,data.length);	//empty data
		data.push.apply(data,freshData);//copy freshData to data
		// may use data.splice(0, data.length, ...freshData); but requires ES2015
//console.log(&quot;refresher, data is&quot;,data);

		handsontable.render();
	},
	saveToContainers: function(change,source)
	{
		var data	= this.getData(),
		    container	= this.container.parentElement,
		    filter	= jQuery(container).data(&quot;tiddlersFilter&quot;),
		    tiddlers	= store.filterTiddlers(filter), i, row, tid,
		    containers = jQuery(container).data(&quot;containers&quot;), j, value, partName;

		// simple tiddlers updating assuming no rows were moved, deleted or added
		for(i = 0; i &lt; tiddlers.length; i++)
		{
			row = data[i]; // data correspoding to this tiddler
			tid = tiddlers[i];
			for(j = 0; j &lt; containers.length; j++)
			{
				value = row[j] || &quot;&quot;;
				partName = containers[j].substr(1);
// looks like .setData from InsertEditable/SetManagerPlugin may be used here, except if noNotify is required (saveTiddler does notifying)
				switch(containers[j][0])
				{
					case &quot;!&quot;: // title
					if(!value || tid.title == value) break;
					store.saveTiddler(tid,value); // requires my fix to .sT
				  break;case &quot;t&quot;: // text
					if(tid.text == value) break;
					store.saveTiddler(tid,null,value);
				  break;case &quot;#&quot;:
					tid.setSection(partName,value);
					//if(tid.getSection(partName)!=value) store.notify(tid.title,true);
				  break;case &quot;:&quot;:
					tid.setSlice(partName,value);
					//if(tid.getSlice(partName)!=) store.notify(tid.title,true);
				  break;case &quot;@&quot;:
					//if(store.getValue(tid,partName)==value) break;
					store.setValue(tid,partName,value);
				  break;default:
					//# warn somehow?
				  break;
				}
			}
		}
		if(change || change === 0) // a real change
			store.setDirty(true);

	// advanced implementation:
	//# add new tiddlers
	 //# if there's no title field, how to add tiddler?
	//# ? when a row is removed/a title is deleted in it, do ? with the tiddler
	//# how to detect moved rows? which row was removed? probably requires extra hooks
	},
	convertDataToJSON: function(data)
	{
//# for a nicer storage format: turn edited numbers into numbers, not strings:
//  http://stackoverflow.com/questions/18302890/json-stringify-input-values-as-numbers
//  and also turn nulls into &quot;&quot;

		return JSON.stringify(data,&quot;&quot;,4)
			.replace(/\n {8}([^\n]*)\n {4}\]/gm,function($0,$1){
				return $1+&quot;]&quot;;
			})
			.replace(/\n {8}/gm,&quot;&quot;)
			.replace(/^ {4}/gm,&quot;\t&quot;);
	},
	saveToTiddler: function(change,source)
	{
		// get tiddler, HOT options
		var tiddlyContainer = this.container.parentElement,
		    dataAndOptionsSection = jQuery(tiddlyContainer)
			.data(&quot;dataAndOptionsSection&quot;),
		    nonStoredOptions = jQuery(tiddlyContainer).data(&quot;nonStoredOptions&quot;),
		    re = new RegExp(&quot;^(.*)&quot; + config.textPrimitives.sectionSeparator + &quot;(.+)$&quot;),
		    match = re.exec(dataAndOptionsSection),
		    tiddlerNameByMacro = jQuery(tiddlyContainer).data(&quot;sourceTiddler&quot;),
		    // dataAndOptionsSection may be
		    tiddlerName = match ? match[1] : // tiddler name##section name
			dataAndOptionsSection || tiddlerNameByMacro, // tid name; nothing?
		    sectionName = match ? match[2] : &quot;&quot;,
		    // fetches if exists and creates otherwise:
		    tiddler = tiddlerName ? store.createTiddler(tiddlerName) : null,

		// get updated data
		    data = this.getData(), dataText, optionsText, fullJSON,
		    hotMacro = config.macros.handsontable;
		//# get updated col widths, merged cells, update hotOptions

		var hotOptions = jQuery(tiddlyContainer).data(&quot;hotOptions&quot;);
//# this works fine but should be changed not on data change but on merge/unmerge
if(this.mergeCells)
  hotOptions.mergeCells = this.mergeCells.mergedCellInfoCollection;
		// prepare/format data and options for saving
		delete hotOptions.data; // we don't need 2 copies of data stored
		for(var key in nonStoredOptions) // remove also nonStoredOptions
			if(nonStoredOptions[key] == hotOptions[key])
				delete hotOptions[key];
		dataText    = hotMacro.convertDataToJSON(data);
		optionsText = hotMacro.convertDataToJSON(hotOptions);
		fullJSON    = '{&quot;data&quot;:' + dataText + ',\n&quot;options&quot;:' + optionsText +'}';

		// determine portion of tiddler's text to update, update tiddler text
		if(sectionName)
			tiddler.setHiddenSection(sectionName,fullJSON);
		else if(tiddlerName != tiddlerNameByMacro)
			tiddler.text = fullJSON;
		else
			; //# notify: won't save
		//# refresh/notify? refreshing is unwanted
		if(change || change === 0) // a real change
			store.setDirty(true);

//# requirements: updating must be successful even after several successive changes,
//  including changes of other reflexive formatters in the same tiddler
//  (most importantly earlier in the tw-code), without overwriting those changes

//# options to implement:
// + use section for data and options (implemented)
// - set/require an id and search macro text by id
// - substitute the whole text of macro each time (by search: this won't be hurt by editing other parts)
//  . there may be multiple macros with the same tw-code (including in code blocks), but taht's a ~rare case
// - extend wikifier by a &quot;virtual text-tree&quot; layer which knows a) what text corresponds to each formatter; b) how to assemble wikitext from those texts. The tree is to be updated on edit and to notify other trees if other wikifiers are showing (parts of) the same tiddler

 // (change wikifier's .source? will this affect other formatters' wikifier? will this help without changing .matchStart etc?)
 // this probably still doesn't help when there's several wikifiers wikified (parts of) the same tiddler

 // wikifier.matchStart contains the position of the first &lt;
 // wikifier.nextMatch  contains the position of the symbol after the last &gt;
 // macroName and paramString contain all but &lt;&lt;, &gt;&gt; and whitespace between macroName and paramString
 // also, wikifier.tiddler, .source and .output (and others) may be used
	}
};

// for research purposes:
config.macros.testIfWikifierIsShared = {
	handler: function(place,macroName,params,wikifier,paramString,tiddler)
	{
		if(!window.wikifiersCollection)
			window.wikifiersCollection = [];
		window.wikifiersCollection.push(wikifier);
	}
};
//}}}
/***
!!! config.extensions.Handsontable (deprecated tools from the first version)
***/
//{{{
config.extensions.Handsontable = {
	major: 0, minor: 2, revision: 0,
	date: new Date('2017/04/06'),

	afterChange: function(change,source)
	{
		if ( source == 'loadData' ) return;

		// Find the tiddler containing this table.
		var container = this.container;
		var parent   = story.findContainingTiddler(container);
		var tiddler = store.getTiddler(
			parent.getAttribute(&quot;tiddler&quot;)
		);
		// Get the tiddler text.
		var text = tiddler.text;

		// Find the start and end of table data.

		// First we find the index number of this Handsontable.
		var hots = parent.querySelectorAll('div.ht_master');
		var ndx = -1;
		for(var t = 0; t &lt; hots.length; t++)
			if(hots[t] == container){
				ndx = t;
				break;
			}
		// Then we find the variable name for the table data, we assume it exists.
		// The variable name is assigned to the data property
		// of the new Handsontable() constructor call option.
		// Hence we look for the right new Handsontable() statement
		// and the data property of its option.
		var p1 = -1;
		var regexp = /new\s+Handsontable/gm;
		while(ndx &gt;= 0) {
			if (regexp.test(text))
				p1 = regexp.lastIndex;
			ndx--;
		}
		regexp = /data\s*:/gm;
		regexp.lastIndex = p1;
		if (regexp.test(text))  p1 = regexp.lastIndex;
		var p2 = text.indexOf(',',p1+1);
		var dataname = text.substring(p1,p2).trim();
		//
		// Now we look back for the beginning of data definition.
		// If there are multiple tables created using the Handsontable,
		// each of their data sets must have a unique variable name
		// or the update may go to the wrong place.
		p1 = text.lastIndexOf(dataname,p1)+dataname.length;
		//
		// and then we look for the end of data definition.
		p2 = text.indexOf('];',p1)+2;

		// Convert the modified data into text with some nice formatting
		var data = this.getData();
		var txtdata = ' = ' +
			config.macros.handsontable.convertDataToJSON(data)+&quot;;&quot;;

		// Replace the original definition string with the modified one.
		text = text.substring(0,p1) + txtdata + text.substring(p2);
		// Set it back to the tiddler,
		tiddler.set(tiddler.title,text,tiddler.modifier,new Date());
		// and mark TiddlyWiki as modified.
		store.setDirty(true);
	}
};
//}}}
/***
!!! .setHiddenSection helper
***/
//{{{
// Sets the section value if it is present, appends a hidden one otherwise
// (code adapted from SetManagerPlugin, Tiddler.prototype.setSection)
//
Tiddler.prototype.setHiddenSection = function(sectionName,value)
{
	var beginSectionRegExp = new RegExp(&quot;(^!{1,6}[ \t]*&quot; + sectionName.escapeRegExp() + &quot;[ \t]*(\n|$))&quot;,&quot;mg&quot;),
	    sectionTerminatorRegExp = /^!/mg,
	    match = beginSectionRegExp.exec(this.text);

	if(!match) // no such section, append to the end, but don't break TW tables
	{
		// add empty
		this.text = this.text + (this.text[this.text.length-1] == &quot;|&quot; ? &quot;\n&quot;:&quot;&quot;) +
			&quot;/%\n!&quot;+sectionName+&quot;\n&quot; + &quot;\n!%/&quot;;
		// re-match
		beginSectionRegExp.lastIndex = 0;
		match = beginSectionRegExp.exec(this.text);
	}

	// now change section content (setSection may be used instead)
	var sectionTitle = match[1],
	    emptyAtEnd = match[2] != &quot;\n&quot;,
	    beforeSection = this.text.substr(0,match.index),
	    sectionAndAfter = this.text.substr(match.index + match[1].length);

	match = sectionTerminatorRegExp.exec(sectionAndAfter);
	var afterSection = match ? sectionAndAfter.substr(match.index) : &quot;&quot;;

	this.text = beforeSection + sectionTitle + (emptyAtEnd ? &quot;\n&quot; : &quot;&quot;) +
			value + (afterSection ? (&quot;\n&quot; + afterSection) : &quot;&quot;);

	// setting dirty, notifying is not done here
};
//}}}
// /%
/***
!handsontable.min.css
***/
///***
//handsontable.min.css 0.31.0
//downloaded from http://handsontable.com/dist/handsontable.full.min.css
//which redirected to http://docs.handsontable.com/0.31.0/bower_components/handsontable/dist/handsontable.full.min.css
//
//(The MIT License)
//
//Copyright (c) 2012-2014 Marcin Warpechowski
//Copyright (c) 2015 Handsoncode sp. z o.o. &lt;hello@handsoncode.net&gt;
//
//Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the 'Software'), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
//
//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
//
//THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
//IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//***/
///*{{{*/
//.handsontable{position:relative}.handsontable .hide{display:none}.handsontable .relative{position:relative}.handsontable.htAutoSize{visibility:hidden;left:-99000px;position:absolute;top:-99000px}.handsontable .wtHider{width:0}.handsontable .wtSpreader{position:relative;width:0;height:auto}.handsontable table,.handsontable tbody,.handsontable thead,.handsontable td,.handsontable th,.handsontable input,.handsontable textarea,.handsontable div{box-sizing:content-box;-webkit-box-sizing:content-box;-moz-box-sizing:content-box}.handsontable input,.handsontable textarea{min-height:initial}.handsontable table.htCore{border-collapse:separate;border-spacing:0;margin:0;border-width:0;table-layout:fixed;width:0;outline-width:0;max-width:none;max-height:none}.handsontable col{width:50px}.handsontable col.rowHeader{width:50px}.handsontable th,.handsontable td{border-top-width:0;border-left-width:0;border-right:1px solid #CCC;border-bottom:1px solid #CCC;height:22px;empty-cells:show;line-height:21px;padding:0 4px 0 4px;background-color:#FFF;vertical-align:top;overflow:hidden;outline-width:0;white-space:pre-line;background-clip:padding-box}.handsontable td.htInvalid{background-color:#ff4c42!important}.handsontable td.htNoWrap{white-space:nowrap}.handsontable th:last-child{border-right:1px solid #CCC;border-bottom:1px solid #CCC}.handsontable tr:first-child th.htNoFrame,.handsontable th:first-child.htNoFrame,.handsontable th.htNoFrame{border-left-width:0;background-color:white;border-color:#FFF}.handsontable th:first-child,.handsontable th:nth-child(2),.handsontable td:first-of-type,.handsontable .htNoFrame+th,.handsontable .htNoFrame+td{border-left:1px solid #CCC}.handsontable.htRowHeaders thead tr th:nth-child(2){border-left:1px solid #CCC}.handsontable tr:first-child th,.handsontable tr:first-child td{border-top:1px solid #CCC}.ht_master:not(.innerBorderLeft):not(.emptyColumns) ~ .handsontable tbody tr th,.ht_master:not(.innerBorderLeft):not(.emptyColumns) ~ .handsontable:not(.ht_clone_top) thead tr th:first-child{border-right-width:0}.ht_master:not(.innerBorderTop) thead tr:last-child th,.ht_master:not(.innerBorderTop) ~ .handsontable thead tr:last-child th,.ht_master:not(.innerBorderTop) thead tr.lastChild th,.ht_master:not(.innerBorderTop) ~ .handsontable thead tr.lastChild th{border-bottom-width:0}.handsontable th{background-color:#f3f3f3;color:#222;text-align:center;font-weight:normal;white-space:nowrap}.handsontable thead th{padding:0}.handsontable th.active{background-color:#CCC}.handsontable thead th .relative{padding:2px 4px}.handsontable tbody th.ht__highlight,.handsontable thead th.ht__highlight{background-color:#dcdcdc}.handsontable.ht__selection--columns thead th.ht__highlight,.handsontable.ht__selection--rows tbody th.ht__highlight{background-color:#8eb0e7;color:#000}.handsontable .manualColumnResizer{position:fixed;top:0;cursor:col-resize;z-index:110;width:5px;height:25px}.handsontable .manualRowResizer{position:fixed;left:0;cursor:row-resize;z-index:110;height:5px;width:50px}.handsontable .manualColumnResizer:hover,.handsontable .manualColumnResizer.active,.handsontable .manualRowResizer:hover,.handsontable .manualRowResizer.active{background-color:#AAB}.handsontable .manualColumnResizerGuide{position:fixed;right:0;top:0;background-color:#AAB;display:none;width:0;border-right:1px dashed #777;margin-left:5px}.handsontable .manualRowResizerGuide{position:fixed;left:0;bottom:0;background-color:#AAB;display:none;height:0;border-bottom:1px dashed #777;margin-top:5px}.handsontable .manualColumnResizerGuide.active,.handsontable .manualRowResizerGuide.active{display:block;z-index:199}.handsontable .columnSorting{position:relative}.handsontable .columnSorting:hover{text-decoration:underline;cursor:pointer}.handsontable .columnSorting.ascending::after{content:'\25B2';color:#5f5f5f;position:absolute;right:-15px}.handsontable .columnSorting.descending::after{content:'\25BC';color:#5f5f5f;position:absolute;right:-15px}.handsontable .wtBorder{position:absolute;font-size:0}.handsontable .wtBorder.hidden{display:none!important}.handsontable td.area{background:-moz-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(181,209,255,0.34)),color-stop(100%,rgba(181,209,255,0.34)));background:-webkit-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-o-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:-ms-linear-gradient(top,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);background:linear-gradient(to bottom,rgba(181,209,255,0.34) 0,rgba(181,209,255,0.34) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#57b5d1ff',endColorstr='#57b5d1ff',GradientType=0);background-color:#fff}.handsontable .wtBorder.corner{font-size:0;cursor:crosshair}.handsontable .htBorder.htFillBorder{background:red;width:1px;height:1px}.handsontableInput{border:0;outline-width:0;margin:0;padding:1px 5px 0 5px;font-family:inherit;line-height:21px;font-size:inherit;box-shadow:0 0 0 2px #5292f7 inset;resize:none;display:inline-block;color:#000;border-radius:0;background-color:#FFF}.handsontableInputHolder{position:absolute;top:0;left:0;z-index:100}.htSelectEditor{-webkit-appearance:menulist-button!important;position:absolute;width:auto}.handsontable .htDimmed{color:#777}.handsontable .htSubmenu{position:relative}.handsontable .htSubmenu :after{content:'▶';color:#777;position:absolute;right:5px}.handsontable .htLeft{text-align:left}.handsontable .htCenter{text-align:center}.handsontable .htRight{text-align:right}.handsontable .htJustify{text-align:justify}.handsontable .htTop{vertical-align:top}.handsontable .htMiddle{vertical-align:middle}.handsontable .htBottom{vertical-align:bottom}.handsontable .htPlaceholder{color:#999}.handsontable .htAutocompleteArrow{float:right;font-size:10px;color:#EEE;cursor:default;width:16px;text-align:center}.handsontable td .htAutocompleteArrow:hover{color:#777}.handsontable td.area .htAutocompleteArrow{color:#d3d3d3}.handsontable .htCheckboxRendererInput{display:inline-block;vertical-align:middle}.handsontable .htCheckboxRendererInput.noValue{opacity:.5}.handsontable .htCheckboxRendererLabel{cursor:pointer;display:inline-block;width:100%}@-webkit-keyframes opacity-hide{from{opacity:1}to{opacity:0}}@keyframes opacity-hide{from{opacity:1}to{opacity:0}}@-webkit-keyframes opacity-show{from{opacity:0}to{opacity:1}}@keyframes opacity-show{from{opacity:0}to{opacity:1}}.handsontable .handsontable.ht_clone_top .wtHider{padding:0 0 5px 0}.handsontable .autocompleteEditor.handsontable{padding-right:17px}.handsontable .autocompleteEditor.handsontable.htMacScroll{padding-right:15px}.handsontable.listbox{margin:0}.handsontable.listbox .ht_master table{border:1px solid #ccc;border-collapse:separate;background:white}.handsontable.listbox th,.handsontable.listbox tr:first-child th,.handsontable.listbox tr:last-child th,.handsontable.listbox tr:first-child td,.handsontable.listbox td{border-color:transparent}.handsontable.listbox th,.handsontable.listbox td{white-space:nowrap;text-overflow:ellipsis}.handsontable.listbox td.htDimmed{cursor:default;color:inherit;font-style:inherit}.handsontable.listbox .wtBorder{visibility:hidden}.handsontable.listbox tr td.current,.handsontable.listbox tr:hover td{background:#eee}.ht_clone_top{z-index:101}.ht_clone_left{z-index:102}.ht_clone_top_left_corner,.ht_clone_bottom_left_corner{z-index:103}.ht_clone_debug{z-index:103}.handsontable td.htSearchResult{background:#fcedd9;color:#583707}.htBordered{border-width:1px}.htBordered.htTopBorderSolid{border-top-style:solid;border-top-color:#000}.htBordered.htRightBorderSolid{border-right-style:solid;border-right-color:#000}.htBordered.htBottomBorderSolid{border-bottom-style:solid;border-bottom-color:#000}.htBordered.htLeftBorderSolid{border-left-style:solid;border-left-color:#000}.handsontable tbody tr th:nth-last-child(2){border-right:1px solid #CCC}.handsontable thead tr:nth-last-child(2) th.htGroupIndicatorContainer{border-bottom:1px solid #CCC;padding-bottom:5px}.ht_clone_top_left_corner thead tr th:nth-last-child(2){border-right:1px solid #CCC}.htCollapseButton{width:10px;height:10px;line-height:10px;text-align:center;border-radius:5px;border:1px solid #f3f3f3;-webkit-box-shadow:1px 1px 3px rgba(0,0,0,0.4);box-shadow:1px 1px 3px rgba(0,0,0,0.4);cursor:pointer;margin-bottom:3px;position:relative}.htCollapseButton:after{content:&quot;&quot;;height:300%;width:1px;display:block;background:#ccc;margin-left:4px;position:absolute;bottom:10px}thead .htCollapseButton{right:5px;position:absolute;top:5px;background:#fff}thead .htCollapseButton:after{height:1px;width:700%;right:10px;top:4px}.handsontable tr th .htExpandButton{position:absolute;width:10px;height:10px;line-height:10px;text-align:center;border-radius:5px;border:1px solid #f3f3f3;-webkit-box-shadow:1px 1px 3px rgba(0,0,0,0.4);box-shadow:1px 1px 3px rgba(0,0,0,0.4);cursor:pointer;top:0;display:none}.handsontable thead tr th .htExpandButton{top:5px}.handsontable tr th .htExpandButton.clickable{display:block}.collapsibleIndicator{position:absolute;top:50%;transform:translate(0%,-50%);right:5px;border:1px solid #a6a6a6;line-height:10px;color:#222;border-radius:10px;font-size:10px;width:10px;height:10px;cursor:pointer;-webkit-box-shadow:0 0 0 6px rgba(238,238,238,1);-moz-box-shadow:0 0 0 6px rgba(238,238,238,1);box-shadow:0 0 0 6px rgba(238,238,238,1);background:#eee}.handsontable col.hidden{width:0!important}.handsontable table tr th.lightRightBorder{border-right:1px solid #e6e6e6}.handsontable tr.hidden,.handsontable tr.hidden td,.handsontable tr.hidden th{display:none}.ht_master,.ht_clone_left,.ht_clone_top,.ht_clone_bottom{overflow:hidden}.ht_master .wtHolder{overflow:auto}.ht_clone_left .wtHolder{overflow-x:hidden;overflow-y:auto}.ht_clone_top .wtHolder,.ht_clone_bottom .wtHolder{overflow-x:auto;overflow-y:hidden}.wtDebugHidden{display:none}.wtDebugVisible{display:block;-webkit-animation-duration:.5s;-webkit-animation-name:wtFadeInFromNone;animation-duration:.5s;animation-name:wtFadeInFromNone}@keyframes wtFadeInFromNone{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}@-webkit-keyframes wtFadeInFromNone{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}.handsontable.mobile,.handsontable.mobile .wtHolder{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-overflow-scrolling:touch}.htMobileEditorContainer{display:none;position:absolute;top:0;width:70%;height:54pt;background:#f8f8f8;border-radius:20px;border:1px solid #ebebeb;z-index:999;box-sizing:border-box;-webkit-box-sizing:border-box;-webkit-text-size-adjust:none}.topLeftSelectionHandle:not(.ht_master .topLeftSelectionHandle),.topLeftSelectionHandle-HitArea:not(.ht_master .topLeftSelectionHandle-HitArea){z-index:9999}.topLeftSelectionHandle,.topLeftSelectionHandle-HitArea,.bottomRightSelectionHandle,.bottomRightSelectionHandle-HitArea{left:-10000px;top:-10000px}.htMobileEditorContainer.active{display:block}.htMobileEditorContainer .inputs{position:absolute;right:210pt;bottom:10pt;top:10pt;left:14px;height:34pt}.htMobileEditorContainer .inputs textarea{font-size:13pt;border:1px solid #a1a1a1;-webkit-appearance:none;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;position:absolute;left:14px;right:14px;top:0;bottom:0;padding:7pt}.htMobileEditorContainer .cellPointer{position:absolute;top:-13pt;height:0;width:0;left:30px;border-left:13pt solid transparent;border-right:13pt solid transparent;border-bottom:13pt solid #ebebeb}.htMobileEditorContainer .cellPointer.hidden{display:none}.htMobileEditorContainer .cellPointer:before{content:'';display:block;position:absolute;top:2px;height:0;width:0;left:-13pt;border-left:13pt solid transparent;border-right:13pt solid transparent;border-bottom:13pt solid #f8f8f8}.htMobileEditorContainer .moveHandle{position:absolute;top:10pt;left:5px;width:30px;bottom:0;cursor:move;z-index:9999}.htMobileEditorContainer .moveHandle:after{content:&quot;..\a..\a..\a..&quot;;white-space:pre;line-height:10px;font-size:20pt;display:inline-block;margin-top:-8px;color:#ebebeb}.htMobileEditorContainer .positionControls{width:205pt;position:absolute;right:5pt;top:0;bottom:0}.htMobileEditorContainer .positionControls&gt;div{width:50pt;height:100%;float:left}.htMobileEditorContainer .positionControls&gt;div:after{content:&quot; &quot;;display:block;width:15pt;height:15pt;text-align:center;line-height:50pt}.htMobileEditorContainer .leftButton:after,.htMobileEditorContainer .rightButton:after,.htMobileEditorContainer .upButton:after,.htMobileEditorContainer .downButton:after{transform-origin:5pt 5pt;-webkit-transform-origin:5pt 5pt;margin:21pt 0 0 21pt}.htMobileEditorContainer .leftButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(-45deg)}.htMobileEditorContainer .leftButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .rightButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(135deg)}.htMobileEditorContainer .rightButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .upButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(45deg)}.htMobileEditorContainer .upButton:active:after{border-color:#cfcfcf}.htMobileEditorContainer .downButton:after{border-top:2px solid #288ffe;border-left:2px solid #288ffe;-webkit-transform:rotate(225deg)}.htMobileEditorContainer .downButton:active:after{border-color:#cfcfcf}.handsontable.hide-tween{-webkit-animation:opacity-hide .3s;animation:opacity-hide .3s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}.handsontable.show-tween{-webkit-animation:opacity-show .3s;animation:opacity-show .3s;animation-fill-mode:forwards;-webkit-animation-fill-mode:forwards}.htCommentCell{position:relative}.htCommentCell:after{content:'';position:absolute;top:0;right:0;border-left:6px solid transparent;border-top:6px solid black}.htComments{display:none;z-index:1059;position:absolute}.htCommentTextArea{box-shadow:rgba(0,0,0,0.117647) 0 1px 3px,rgba(0,0,0,0.239216) 0 1px 2px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:0;border-left:3px solid #ccc;background-color:#fff;width:215px;height:90px;font-size:12px;padding:5px;outline:0!important;-webkit-appearance:none}.htCommentTextArea:focus{box-shadow:rgba(0,0,0,0.117647) 0 1px 3px,rgba(0,0,0,0.239216) 0 1px 2px,inset 0 0 0 1px #5292f7;border-left:3px solid #5292f7}/*!
// * Handsontable ContextMenu
// */.htContextMenu{display:none;position:absolute;z-index:1060}.htContextMenu .ht_clone_top,.htContextMenu .ht_clone_left,.htContextMenu .ht_clone_corner,.htContextMenu .ht_clone_debug{display:none}.htContextMenu table.htCore{border:1px solid #ccc;border-bottom-width:2px;border-right-width:2px}.htContextMenu .wtBorder{visibility:hidden}.htContextMenu table tbody tr td{background:white;border-width:0;padding:4px 6px 0 6px;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.htContextMenu table tbody tr td:first-child{border:0}.htContextMenu table tbody tr td.htDimmed{font-style:normal;color:#323232}.htContextMenu table tbody tr td.current,.htContextMenu table tbody tr td.zeroclipboard-is-hover{background:#f3f3f3}.htContextMenu table tbody tr td.htSeparator{border-top:1px solid #bbb;height:0;padding:0;cursor:default}.htContextMenu table tbody tr td.htDisabled{color:#999;cursor:default}.htContextMenu table tbody tr td.htDisabled:hover{background:#fff;color:#999;cursor:default}.htContextMenu table tbody tr.htHidden{display:none}.htContextMenu table tbody tr td .htItemWrapper{margin-left:10px;margin-right:6px}.htContextMenu table tbody tr td div span.selected{margin-top:-2px;position:absolute;left:4px}.htContextMenu .ht_master .wtHolder{overflow:hidden}.htRowHeaders .ht_master.innerBorderLeft ~ .ht_clone_top_left_corner th:nth-child(2),.htRowHeaders .ht_master.innerBorderLeft ~ .ht_clone_left td:first-of-type{border-left:0 none}.handsontable .wtHider{position:relative}.handsontable.ht__manualColumnMove.after-selection--columns thead th.ht__highlight{cursor:move;cursor:-moz-grab;cursor:-webkit-grab;cursor:grab}.handsontable.ht__manualColumnMove.on-moving--columns,.handsontable.ht__manualColumnMove.on-moving--columns thead th.ht__highlight{cursor:move;cursor:-moz-grabbing;cursor:-webkit-grabbing;cursor:grabbing}.handsontable.ht__manualColumnMove.on-moving--columns .manualColumnResizer{display:none}.handsontable .ht__manualColumnMove--guideline,.handsontable .ht__manualColumnMove--backlight{position:absolute;height:100%;display:none}.handsontable .ht__manualColumnMove--guideline{background:#757575;width:2px;top:0;margin-left:-1px;z-index:105}.handsontable .ht__manualColumnMove--backlight{background:#343434;background:rgba(52,52,52,0.25);display:none;z-index:105;pointer-events:none}.handsontable.on-moving--columns.show-ui .ht__manualColumnMove--guideline,.handsontable.on-moving--columns .ht__manualColumnMove--backlight{display:block}.handsontable .wtHider{position:relative}.handsontable.ht__manualRowMove.after-selection--rows tbody th.ht__highlight{cursor:move;cursor:-moz-grab;cursor:-webkit-grab;cursor:grab}.handsontable.ht__manualRowMove.on-moving--rows,.handsontable.ht__manualRowMove.on-moving--rows tbody th.ht__highlight{cursor:move;cursor:-moz-grabbing;cursor:-webkit-grabbing;cursor:grabbing}.handsontable.ht__manualRowMove.on-moving--rows .manualRowResizer{display:none}.handsontable .ht__manualRowMove--guideline,.handsontable .ht__manualRowMove--backlight{position:absolute;width:100%;display:none}.handsontable .ht__manualRowMove--guideline{background:#757575;height:2px;left:0;margin-top:-1px;z-index:105}.handsontable .ht__manualRowMove--backlight{background:#343434;background:rgba(52,52,52,0.25);display:none;z-index:105;pointer-events:none}.handsontable.on-moving--rows.show-ui .ht__manualRowMove--guideline,.handsontable.on-moving--rows .ht__manualRowMove--backlight{display:block}/*!
// * Pikaday
// * Copyright © 2014 David Bushell | BSD &amp; MIT license | http://dbushell.com/
// */.pika-single{z-index:9999;display:block;position:relative;color:#333;background:#fff;border:1px solid #ccc;border-bottom-color:#bbb;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif}.pika-single:before,.pika-single:after{content:&quot; &quot;;display:table}.pika-single:after{clear:both}.pika-single{*zoom:1}.pika-single.is-hidden{display:none}.pika-single.is-bound{position:absolute;box-shadow:0 5px 15px -5px rgba(0,0,0,.5)}.pika-lendar{float:left;width:240px;margin:8px}.pika-title{position:relative;text-align:center}.pika-label{display:inline-block;*display:inline;position:relative;z-index:9999;overflow:hidden;margin:0;padding:5px 3px;font-size:14px;line-height:20px;font-weight:bold;background-color:#fff}.pika-title select{cursor:pointer;position:absolute;z-index:9998;margin:0;left:0;top:5px;filter:alpha(opacity=0);opacity:0}.pika-prev,.pika-next{display:block;cursor:pointer;position:relative;outline:0;border:0;padding:0;width:20px;height:30px;text-indent:20px;white-space:nowrap;overflow:hidden;background-color:transparent;background-position:center center;background-repeat:no-repeat;background-size:75% 75%;opacity:.5;*position:absolute;*top:0}.pika-prev:hover,.pika-next:hover{opacity:1}.pika-prev,.is-rtl .pika-next{float:left;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj+OD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8+AqBIl6kKgHiXqQqAeJepBo/z38J/U0uAHlaBkBl9I4GwAAAABJRU5ErkJggg==');*left:0}.pika-next,.is-rtl .pika-prev{float:right;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO+BJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII=');*right:0}.pika-prev.is-disabled,.pika-next.is-disabled{cursor:default;opacity:.2}.pika-select{display:inline-block;*display:inline}.pika-table{width:100%;border-collapse:collapse;border-spacing:0;border:0}.pika-table th,.pika-table td{width:14.285714285714286%;padding:0}.pika-table th{color:#999;font-size:12px;line-height:25px;font-weight:bold;text-align:center}.pika-button{cursor:pointer;display:block;box-sizing:border-box;-moz-box-sizing:border-box;outline:0;border:0;margin:0;width:100%;padding:5px;color:#666;font-size:12px;line-height:15px;text-align:right;background:#f5f5f5}.pika-week{font-size:11px;color:#999}.is-today .pika-button{color:#3af;font-weight:bold}.is-selected .pika-button{color:#fff;font-weight:bold;background:#3af;box-shadow:inset 0 1px 3px #178fe5;border-radius:3px}.is-inrange .pika-button{background:#d5e9f7}.is-startrange .pika-button{color:#fff;background:#6cb31d;box-shadow:none;border-radius:3px}.is-endrange .pika-button{color:#fff;background:#3af;box-shadow:none;border-radius:3px}.is-disabled .pika-button,.is-outside-current-month .pika-button{pointer-events:none;cursor:default;color:#999;opacity:.3}.pika-button:hover{color:#fff;background:#ff8000;box-shadow:none;border-radius:3px}.pika-table abbr{border-bottom:0;cursor:help}
///*}}}*/
/***
!end of handsontable.min.css
***/
// %/ //
//{{{
var cssName = &quot;handsontable.min.css&quot;,
    css = store.getTiddlerText(&quot;HandsontablePlugin&quot;+&quot;##&quot;+cssName).replace(/^\/\//gm,&quot;&quot;);
css = css.substring(4,css.length-4); // cut leading ***/ and trailing /*** of the section
config.shadowTiddlers[cssName] = css;
store.addNotification(cssName, refreshStyles);
//}}}</pre>
</div>
<div title="MainMenu" modifier="Yakov Litvin" created="201705252001" modified="201705252001" changecount="2">
<pre></pre>
</div>
<div title="SiteSubtitle" modifier="Yakov Litvin" created="201705251958" modified="201705251958" changecount="2">
<pre>insert spreadsheet-like interfaces into ~TiddlyWiki Classic (currently: using handsontable library)</pre>
</div>
<div title="SiteTitle" modifier="Yakov Litvin" created="201705251947" modified="201705251947" changecount="2">
<pre>TW spreadsheets</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[

//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */

//--
//-- Global tw object (window.tw) exposing available methods and structures for developers
//--

window.tw = {
	assets: {
		icons: {}
	},
	io: {},
	textUtils: {}
};

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

config.adaptors = {};
config.defaultAdaptor = null;

// defines the order of the backstage tasks
config.backstageTasks = ["save", "importTask", "tweak", "upgrade", "plugins"];
// map by names from config.backstageTasks, defines their content (see Lingo.js and Backstage.js)
config.tasks = {};

config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkAnimate: true,
	chkAutoSave: false,
	chkBackstage: false,
	chkCaseSensitiveSearch: false,
	chkConfirmDelete: true,
	chkDisplayInstrumentation: false,
	chkForceMinorUpdate: false,
	chkGenerateAnRssFeed: false,
	chkHttpReadOnly: true,
	chkIncrementalSearch: true,
	chkInsertTabs: false,
	chkOpenInNewWindow: true,
	chkPreventAsyncSaving: true,
	chkRegExpSearch: false,
	chkRemoveExtraMarkers: false, // #162
	chkSaveBackups: true,
	chkSaveEmptyTemplate: false,
	chkSliderOptionsPanel: false,
	chkToggleLinks: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtFileSystemCharSet: "UTF-8",
	txtMainTab: "tabTimeline",
	txtMaxEditRows: "30",
	txtMoreTab: "moreTabAll",
	txtTheme: "",
	txtUpgradeCoreURI: ""
};
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: { sizeTextbox: 15 },
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: { defaultView: "text" },
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "https://classic.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: { hideReadOnly: true },
	cancelTiddler: {},
	deleteTiddler: { hideReadOnly: true },
	permalink: {},
	references: { type: "popup" },
	jump: { type: "popup" },
	syncing: { type: "popup" },
	fields: { type: "popup" }
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
var isBadSafari = !((new RegExp("[\u0150\u0170]", "g")).test("\u0150")); //# see 52678d4 and #22  ..remove at all?
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
// Moved navigator dependent code out of Config.js into a separate module. Helps with https://github.com/TiddlyWiki/tiddlywiki/issues/22
if(isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern =
	"(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b|\\[|\\])"; // #132
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter +
	"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead, "mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp =
	new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")", "mg");
config.textPrimitives.tiddlerAnyLinkRegExp =
	new RegExp("(" + config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")", "mg");

config.glyphs = {
	currBrowser: null,
	browsers: [],
	codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	SystemSettings: '',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields permalink references jump|\n' +
		'|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|', // #160
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	// config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	ieVersion: /MSIE (\d{1,2}.\d)/i.exec(config.userAgent),
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]", "g")).test("\u0150")),
	// config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent),
	isOpera: config.userAgent.indexOf("opera") != -1,
	isChrome: config.userAgent.indexOf('chrome') > -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs, {
	browsers: [
		function() { return config.browser.isIE },
		function() { return true }
	],
	codes: {
		downTriangle: ["\u25BC", "\u25BE"],
		downArrow: ["\u2193", "\u2193"],
		bentArrowLeft: ["\u2190", "\u21A9"],
		bentArrowRight: ["\u2192", "\u21AA"]
	}
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options, {
	txtUserName: "YourName"
});

merge(config.tasks, {
	save: { text: "save", tooltip: "Save your changes to this TiddlyWiki" },
	importTask: { text: "import", tooltip: "Import tiddlers and plugins " +
		"from other TiddlyWiki files and servers", content: '<<importTiddlers>>' },
	tweak: { text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>' },
	upgrade: { text: "upgrade", tooltip: "Upgrade TiddlyWiki core", content: '<<upgrade>>' },
	plugins: { text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>' }
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc, {
	chkAnimate: "Enable animations",
	chkAutoSave: "Automatically save changes",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkOpenInNewWindow: "Open external links in a new window",
	chkPreventAsyncSaving: "Disable attempting async saving (may be needed by old plugins)",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkSaveBackups: "Keep backup file when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	txtBackupFolder: "Name of folder to use for backups",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	chkRemoveExtraMarkers: "Replace unused transclusion markers with blanks", // #162
	txtTheme: "Name of the theme to use",
	txtUpgradeCoreURI: "Custom URI to download TiddlyWiki core from (when upgrading)",
	txtUserName: "Username for signing your edits"
});

merge(config.messages, {
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see https://classic.tiddlywiki.com/#SaveUnpredictabilities for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "TiddlyWiki saved",
	mainDownload: "Downloading/saving main TiddlyWiki file",
	mainDownloadManual: "RIGHT CLICK HERE to download/save main TiddlyWiki file",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"
});

merge(config.messages.messageClose, {
	text: "close",
	tooltip: "close this message area"
});

config.messages.backstage = {
	open: { text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks" },
	close: { text: "close", tooltip: "Close the backstage area" },
	prompt: "backstage: ",
	decal: {
		edit: { text: "edit", tooltip: "Edit the tiddler '%0'" }
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June",
	"July", "August", "September", "October", "November", "December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = [
	"st", "nd", "rd", "th", "th", "th", "th", "th", "th", "th",
	"th", "th", "th", "th", "th", "th", "th", "th", "th", "th",
	"st", "nd", "rd", "th", "th", "th", "th", "th", "th", "th",
	"st"
];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup, {});

merge(config.views.wikified.tag, {
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"
});

merge(config.views.wikified, {
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"
});

merge(config.views.editor, {
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"
});

merge(config.views.editor.tagChooser, {
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"
});

merge(config.messages, {
	sizeTemplates: [
		{ unit: 1024 * 1024 * 1024, template: "%0\u00a0GB" },
		{ unit: 1024 * 1024, template: "%0\u00a0MB" },
		{ unit: 1024, template: "%0\u00a0KB" },
		{ unit: 1, template: "%0\u00a0B" }
	]
});

merge(config.macros.search, {
	label: "search",
	prompt: "Search this TiddlyWiki",
	placeholder: "",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"
});

merge(config.macros.tagging, {
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"
});

merge(config.macros.timeline, {
	dateFormat: "DD MMM YYYY"
});

merge(config.macros.allTags, {
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"
});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll, {
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"
});

merge(config.macros.permaview, {
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"
});

merge(config.macros.saveChanges, {
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"
});

merge(config.macros.newTiddler, {
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"
});

merge(config.macros.newJournal, {
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"
});

merge(config.macros.options, {
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br>" +
		"<label><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</label>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{ name: 'Option', field: 'option', title: "Option", type: 'String' },
			{ name: 'Description', field: 'description', title: "Description", type: 'WikiText' },
			{ name: 'Name', field: 'name', title: "Name", type: 'String' }
		],
		rowClasses: [
			{ className: 'lowlight', field: 'lowlight' }
		]
	}
});

merge(config.macros.plugins, {
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{ name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector' },
			{ name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler' },
			{ name: 'Description', field: 'Description', title: "Description", type: 'String' },
			{ name: 'Version', field: 'Version', title: "Version", type: 'String' },
			{ name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size' },
			{ name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox' },
			{ name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox' },
			{ name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No" },
			{ name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String' },
			{ name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK" },
			{ name: 'Log', field: 'log', title: "Log", type: 'StringList' }
		],
		rowClasses: [
			{ className: 'error', field: 'error' },
			{ className: 'warning', field: 'warning' }
		]
	},
	listViewTemplateReadOnly: {
		columns: [
			{ name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler' },
			{ name: 'Description', field: 'Description', title: "Description", type: 'String' },
			{ name: 'Version', field: 'Version', title: "Version", type: 'String' },
			{ name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size' },
			{ name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No" },
			{ name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String' },
			{ name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK" },
			{ name: 'Log', field: 'log', title: "Log", type: 'StringList' }
		],
		rowClasses: [
			{ className: 'error', field: 'error' },
			{ className: 'warning', field: 'warning' }
		]
	}
});

merge(config.macros.toolbar, {
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
});

merge(config.macros.refreshDisplay, {
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
});

merge(config.macros.importTiddlers, {
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>" +
		"Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>" +
		"...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>" +
		"...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: " +
		"<select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	errorGettingTiddlerListHttp404: "Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",
	errorGettingTiddlerListHttp: "Error retrieving tiddlers from url, please " +
		"ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",
	errorGettingTiddlerListFile: "Error retrieving tiddlers from local file, " +
		"please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>" +
		"Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br>" +
		"<input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' " +
		"to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\n" +
		"This tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{ name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector' },
			{ name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler' },
			{ name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size' },
			{ name: 'Tags', field: 'tags', title: "Tags", type: 'Tags' }
		],
		rowClasses: []
	}
});

merge(config.macros.upgrade, {
	wizardTitle: "Upgrade TiddlyWiki",
	step1Title: "Update or repair TiddlyWiki core to the latest release",
	step1Html: "You are about to upgrade TiddlyWiki core to the latest release " +
		"(from <a href='%0' class='externalLink' target='_blank'>%1</a>). " +
		"Your content will be preserved across the upgrade.<br><br>" +
		"Note that core upgrades have been known to interfere with older plugins. " +
		"If you run into problems with upgrading, read how to handle them " +
		"<a href='%2' class='externalLink' target='_blank'>here</a>.",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>" +
		"You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	errorVerifyingBackup: "Failed to verify the backup was saved. " +
		"This is either because it wasn't saved to the moment of the check or " +
		"loading file doesn't work with your saver (and it is needed for " +
		"the next step of upgrading). To upgrade your TiddlyWiki, you can use " +
		"other methods listed at <a href='%0' class='externalLink' target='_blank'>%0</a>",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
});

merge(config.macros.annotations, {});

merge(config.commands.closeTiddler, {
	text: "close",
	tooltip: "Close this tiddler"
});

merge(config.commands.closeOthers, {
	text: "close others",
	tooltip: "Close all other tiddlers"
});

merge(config.commands.editTiddler, {
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"
});

merge(config.commands.saveTiddler, {
	text: "done",
	tooltip: "Save changes to this tiddler"
});

merge(config.commands.cancelTiddler, {
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"
});

merge(config.commands.deleteTiddler, {
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"
});

merge(config.commands.permalink, {
	text: "permalink",
	tooltip: "Permalink for this tiddler"
});

merge(config.commands.references, {
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"
});

merge(config.commands.jump, {
	text: "jump",
	tooltip: "Jump to another open tiddler"
});

merge(config.commands.fields, {
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{ name: 'Field', field: 'field', title: "Field", type: 'String' },
			{ name: 'Value', field: 'value', title: "Value", type: 'String' }
		],
		rowClasses: [],
		buttons: []
	}
});

merge(config.shadowTiddlers, {
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">>' +
		'<<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
});

merge(config.annotations, {
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. " +
		"''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. " +
	"''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	SystemSettings: "Options may be stored here using the slice notation (like {{{chkAutoSave: true}}} or {{{|txtUserName|The great inventor|}}})",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
});
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo, tiddler; // Used to pass information to plugins in loadPlugins()

// Whether this file can be saved back to the same location [Preemption]
window.allowSave = window.allowSave || function(l)
{
	return true;
};

// Whether this file is being viewed locally
window.isLocal = function()
{
	return (document.location.protocol == "file:");
};

var useJavaSaver = false;

// Allow preemption code a chance to tweak config and useJavaSaver [Preemption]
if (window.tweakConfig) window.tweakConfig();

if(!window || !window.console) {
	console = { tiddlywiki: true, log: function(message) { displayMessage(message) } };
}

// Starting up
function main()
{
	window.originalHTML = recreateOriginal();

	var t10, t9, t8, t7, t6, t5, t4, t3, t2, t1, t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) { if(window.confirmExit) return confirmExit(); };
	params = getParameters();
	if(params) params = params.parseParams("open", null, false);
	store = new TiddlyWiki({ config: config });
	invokeParamifier(params, "oninit");
	story = new Story("tiddlerDisplay", "tiddler");
	addEvent(document, "click", Popup.onDocumentClick);
	saveTest();
	for(var i = 0; i < config.notifyTiddlers.length; i++)
		store.addNotification(config.notifyTiddlers[i].name, config.notifyTiddlers[i].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea", "store", true);
	doc.trigger("loadTiddlers");
	loadOptions();
	t3 = new Date();
	invokeParamifier(params, "onload");
	t4 = new Date();
	readOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins("systemConfig");
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params, "onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	for(var name in config.macros) {
		if(config.macros[name].init)
			config.macros[name].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null, "PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2 - t1) + " ms");
		displayMessage("LoadFromDiv " + (t3 - t2) + " ms");
		displayMessage("LoadPlugins " + (t5 - t4) + " ms");
		displayMessage("Macro init " + (t7 - t6) + " ms");
		displayMessage("Notify " + (t8 - t7) + " ms");
		displayMessage("Restart " + (t9 - t8) + " ms");
		displayMessage("Total: " + (t10 - t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. Functions may get unloaded too, so they are called conditionally.
function unload()
{
	if(window.checkUnsavedChanges) checkUnsavedChanges();
	if(window.scrubNodes) scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params, "onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0, 0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea", "shadows", true);
	shadows.forEachTiddler(function(title, tiddler) { config.shadowTiddlers[title] = tiddler.text });
}

function loadPlugins(tag)
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers(tag);
	tiddlers.sort(function(a, b) { return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1) });
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i = 0; i < nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n) map[n] = p;
		n = p.Source;
		if(n) map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done) return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i = 0; i < reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i = 0; i < nPlugins; i++)
		visit(installedPlugins[i]);
	for(i = 0; i < toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title, ["Name", "Description", "Version",
		"Requires", "CoreVersion", "Date", "Source", "Author", "License", "Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0], 10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1], 10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2], 10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
	return window.location.hash ? decodeURIComponent(window.location.hash.substr(1)) : null;
}

function invokeParamifier(params, handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;

	for(var i = 1; i < params.length; i++) {
		var name = params[i].name,
		    value = params[i].value;
		var p = config.paramifiers[name];
		if(p && p[handler] instanceof Function)
			p[handler](value);
		else {
			var h = config.optionHandlers[name.substr(0, 3)];
			if(h && h.set instanceof Function)
				h.set(name, value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(title) {
		if(!readOnly || store.tiddlerExists(title) || store.isShadowTiddler(title))
			story.displayTiddler("bottom", title, null, false, null);
	}
};

config.paramifiers.story = {
	onstart: function(title) {
		var list = store.getTiddlerText(title, "").parseParams("open", null, false);
		invokeParamifier(list, "onstart");
	}
};

config.paramifiers.search = {
	onstart: function(query) {
		story.search(query, false, false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v, false, true);
	}
};

config.paramifiers.tag = {
	onstart: function(tag) {
		story.displayTiddlers(null, store.filterTiddlers("[tag[" + tag + "]]"), null, false, null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(readOnly) return;
		var args = v.parseParams("anon", null, null)[0];
		var title = args.title ? args.title[0] : v;
		var customFields = args.fields ? args.fields[0] : null;

		story.displayTiddler(null, title, DEFAULT_EDIT_TEMPLATE, false, null, customFields);
		story.focusTiddler(title, "text");
		var i, tags = args.tag || [];
		for(i = 0; i < tags.length; i++) {
			story.setTiddlerTag(title, tags[i], +1);
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(titleTemplate) {
		if(readOnly) return;
		var now = new Date();
		var title = now.formatString(titleTemplate.trim());
		story.displayTiddler(null, title, DEFAULT_EDIT_TEMPLATE);
		story.focusTiddler(title, "text");
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(themeTitle) {
		story.switchTheme(themeTitle);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent = {
	onstart: function(limit) {
		var titles = [];
		var i, tiddlers = store.getTiddlers("modified", "excludeLists").reverse();
		for(i = 0; i < limit && i < tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null, titles);
	}
};

config.paramifiers.filter = {
	onstart: function(filterExpression) {
		story.displayTiddlers(null, store.filterTiddlers(filterExpression), null, false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n = 0; n < formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"), "mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output, this.element), this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		// Convert CSS property name to a JavaScript style name ("background-color" -> "backgroundColor")
		var unDash = function(name) {
			return name
				.split("-")
				.map(function(word, i) {
					return i == 0 ? word :
						word.charAt(0).toUpperCase() + word.slice(1);
				})
				.join("");
		};
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s, v;
			if(lookaheadMatch[1]) {
				s = unDash(lookaheadMatch[1]);
				v = lookaheadMatch[2];
			} else {
				s = unDash(lookaheadMatch[3]);
				v = lookaheadMatch[4];
			}
			if(s == "bgcolor") s = "backgroundColor";
			if(s == "float") s = "cssFloat";
			styles.push({ style: s, value: v });
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e, styles)
	{
		for(var i = 0; i < styles.length; i++) {
			try {
				e.style[styles[i].style] = styles[i].value;
			} catch (ex) {}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE && (config.browser.ieVersion[1] < 10))
				text = text.replace(/\n/g, "\r");
			createTiddlyElement(w.output, this.element, null, null, text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern, "mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".") != -1 ||
		   link.indexOf("\\") != -1 ||
		   link.indexOf("/") != -1 ||
		   link.indexOf("#") != -1
		) {
			return true;
		}
		return false;
	}
};

//--
//-- Standard formatters
//--

config.formatters = [
	{
		name: "table",
		match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
		lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
		rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
		cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
		cellTermRegExp: /((?:\x20*)\|)/mg,
		rowTypes: { "c": "caption", "h": "thead", "": "tbody", "f": "tfoot" },
		handler: function(w)
		{
			var table = createTiddlyElement(w.output, "table", null, "twtable");
			var prevColumns = [];
			var currRowType = null;
			var rowContainer;
			var rowCount = 0;
			var onmouseover = function() { jQuery(this).addClass("hoverRow") };
			var onmouseout = function() { jQuery(this).removeClass("hoverRow") };
			w.nextMatch = w.matchStart;
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
				var nextRowType = lookaheadMatch[2];
				if(nextRowType == "k") {
					table.className = lookaheadMatch[1];
					w.nextMatch += lookaheadMatch[0].length + 1;
				} else {
					if(nextRowType != currRowType) {
						rowContainer = createTiddlyElement(table, this.rowTypes[nextRowType]);
						currRowType = nextRowType;
					}
					if(currRowType == "c") {
						// Caption
						w.nextMatch++;
						if(rowContainer != table.firstChild)
							table.insertBefore(rowContainer, table.firstChild);
						rowContainer.setAttribute("align", rowCount == 0 ? "top" : "bottom");
						w.subWikifyTerm(rowContainer, this.rowTermRegExp);
					} else {
						var theRow = createTiddlyElement(rowContainer, "tr", null, rowCount % 2 ? "oddRow" : "evenRow");
						theRow.onmouseover = onmouseover;
						theRow.onmouseout = onmouseout;
						this.rowHandler(w, theRow, prevColumns);
						rowCount++;
					}
				}
				this.lookaheadRegExp.lastIndex = w.nextMatch;
				lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			}
		},
		rowHandler: function(w, e, prevColumns)
		{
			var col = 0;
			var colSpanCount = 1;
			var prevCell = null;
			this.cellRegExp.lastIndex = w.nextMatch;
			var cellMatch = this.cellRegExp.exec(w.source);
			while(cellMatch && cellMatch.index == w.nextMatch) {
				if(cellMatch[1] == "~") {
					// Rowspan
					var last = prevColumns[col];
					if(last) {
						last.rowSpanCount++;
						last.element.setAttribute("rowspan", last.rowSpanCount);
						last.element.setAttribute("rowSpan", last.rowSpanCount); // Needed for IE
						last.element.valign = "center";
						if(colSpanCount > 1) {
							last.element.setAttribute("colspan", colSpanCount);
							last.element.setAttribute("colSpan", colSpanCount); // Needed for IE
							colSpanCount = 1;
						}
					}
					w.nextMatch = this.cellRegExp.lastIndex - 1;
				} else if(cellMatch[1] == ">") {
					// Colspan
					colSpanCount++;
					w.nextMatch = this.cellRegExp.lastIndex - 1;
				} else if(cellMatch[2]) {
					// End of row
					if(prevCell && colSpanCount > 1) {
						prevCell.setAttribute("colspan", colSpanCount);
						prevCell.setAttribute("colSpan", colSpanCount); // Needed for IE
					}
					w.nextMatch = this.cellRegExp.lastIndex;
					break;
				} else {
					// Cell
					w.nextMatch++;
					var styles = config.formatterHelpers.inlineCssHelper(w);
					var spaceLeft = false;
					var chr = w.source.substr(w.nextMatch, 1);
					while(chr == " ") {
						spaceLeft = true;
						w.nextMatch++;
						chr = w.source.substr(w.nextMatch, 1);
					}
					var cell;
					if(chr == "!") {
						cell = createTiddlyElement(e, "th");
						w.nextMatch++;
					} else {
						var isInsideHeader = e.parentElement.tagName.toLocaleLowerCase() === 'thead';
						cell = createTiddlyElement(e, isInsideHeader ? "th" : "td");
					}
					prevCell = cell;
					prevColumns[col] = { rowSpanCount: 1, element: cell };
					if(colSpanCount > 1) {
						cell.setAttribute("colspan", colSpanCount);
						cell.setAttribute("colSpan", colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
					config.formatterHelpers.applyCssHelper(cell, styles);
					w.subWikifyTerm(cell, this.cellTermRegExp);
					if(w.matchText.substr(w.matchText.length - 2, 1) == " ") // spaceRight
						cell.align = spaceLeft ? "center" : "left";
					else if(spaceLeft)
						cell.align = "right";
					w.nextMatch--;
				}
				col++;
				this.cellRegExp.lastIndex = w.nextMatch;
				cellMatch = this.cellRegExp.exec(w.source);
			}
		}
	},

	{
		name: "heading",
		match: "^!{1,6}",
		termRegExp: /(\n)/mg,
		handler: function(w)
		{
			w.subWikifyTerm(createTiddlyElement(w.output, "h" + w.matchLength), this.termRegExp);
		}
	},

	{
		name: "list",
		match: "^(?:[\\*#;:]+)",
		lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
		termRegExp: /(\n)/mg,
		handler: function(w)
		{
			// stack holds nested elements to which (nested) lists are appended
			var stack = [w.output];
			var currLevel = 0, currType = null;
			var listLevel, listType, itemType, baseType;
			w.nextMatch = w.matchStart;
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
				if(lookaheadMatch[1]) {
					listType = "ul";
					itemType = "li";
				} else if(lookaheadMatch[2]) {
					listType = "ol";
					itemType = "li";
				} else if(lookaheadMatch[3]) {
					listType = "dl";
					itemType = "dt";
				} else if(lookaheadMatch[4]) {
					listType = "dl";
					itemType = "dd";
				}
				if(!baseType)
					baseType = listType;
				listLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				var l;
				if(listLevel > currLevel) {
					for(l = currLevel; l < listLevel; l++) {
						var target = (currLevel == 0) ? stack[stack.length - 1] : stack[stack.length - 1].lastChild;
						stack.push(createTiddlyElement(target, listType));
					}
				} else if(listType != baseType && listLevel == 1) {
					w.nextMatch -= lookaheadMatch[0].length;
					return;
				} else if(listLevel < currLevel) {
					for(l = currLevel; l > listLevel; l--)
						stack.pop();
				} else if(listLevel == currLevel && listType != currType) {
					stack.pop();
					stack.push(createTiddlyElement(stack[stack.length - 1].lastChild, listType));
				}
				currLevel = listLevel;
				currType = listType;
				var itemElement = createTiddlyElement(stack[stack.length - 1], itemType);
				w.subWikifyTerm(itemElement, this.termRegExp);
				this.lookaheadRegExp.lastIndex = w.nextMatch;
				lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			}
		}
	},

	{
		name: "quoteByBlock",
		match: "^<<<\\n",
		termRegExp: /(^<<<(\n|$))/mg,
		element: "blockquote",
		handler: config.formatterHelpers.createElementAndWikify
	},

	{
		name: "quoteByLine",
		match: "^>+",
		lookaheadRegExp: /^>+/mg,
		termRegExp: /(\n)/mg,
		element: "blockquote",
		handler: function(w)
		{
			var stack = [w.output];
			var currLevel = 0;
			var newLevel = w.matchLength;
			var l, matched;
			do {
				if(newLevel > currLevel) {
					for(l = currLevel; l < newLevel; l++)
						stack.push(createTiddlyElement(stack[stack.length - 1], this.element));
				} else if(newLevel < currLevel) {
					for(l = currLevel; l > newLevel; l--)
						stack.pop();
				}
				currLevel = newLevel;
				w.subWikifyTerm(stack[stack.length - 1], this.termRegExp);
				createTiddlyElement(stack[stack.length - 1], "br");
				this.lookaheadRegExp.lastIndex = w.nextMatch;
				var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
				matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
				if(matched) {
					newLevel = lookaheadMatch[0].length;
					w.nextMatch += lookaheadMatch[0].length;
				}
			} while(matched);
		}
	},

	{
		name: "rule",
		match: "^----+$\\n?|<hr ?/?>\\n?",
		handler: function(w)
		{
			createTiddlyElement(w.output, "hr");
		}
	},

	{
		name: "monospacedByLine",
		match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
		element: "pre",
		handler: function(w)
		{
			switch(w.matchText) {
				case "/*{{{*/\n": // CSS
					this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
					break;
				case "{{{\n": // monospaced block
					this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
					break;
				case "//{{{\n": // plugin
					this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
					break;
				case "<!--{{{-->\n": //template
					this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
					break;
				default:
					break;
			}
			config.formatterHelpers.enclosedTextHelper.call(this, w);
		}
	},

	{
		name: "wikifyComment",
		match: "^(?:/\\*\\*\\*|<!---)\\n",
		handler: function(w)
		{
			var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
			w.subWikifyTerm(w.output, termRegExp);
		}
	},

	{
		name: "macro",
		match: "<<",
		lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
				w.nextMatch = this.lookaheadRegExp.lastIndex;
				invokeMacro(w.output, lookaheadMatch[1], lookaheadMatch[2], w, w.tiddler);
			}
		}
	},

	{
		name: "prettyLink",
		match: "\\[\\[",
		lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				var e;
				var text = lookaheadMatch[1];
				if(lookaheadMatch[3]) {
					// Pretty bracketted link
					var link = lookaheadMatch[3];
					e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output, link)
						: createTiddlyLink(w.output, link, false, null, w.isStatic, w.tiddler);
				} else {
					// Simple bracketted link
					e = createTiddlyLink(w.output, text, false, null, w.isStatic, w.tiddler);
				}
				createTiddlyText(e, text);
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	},

	{
		name: "wikiLink",
		match: config.textPrimitives.unWikiLink + "?" + config.textPrimitives.wikiLink,
		handler: function(w)
		{
			if(w.matchText.substr(0, 1) == config.textPrimitives.unWikiLink) {
				w.outputText(w.output, w.matchStart + 1, w.nextMatch);
				return;
			}
			if(w.matchStart > 0) {
				var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict, "mg");
				preRegExp.lastIndex = w.matchStart - 1;
				var preMatch = preRegExp.exec(w.source);
				if(preMatch.index == w.matchStart - 1) {
					w.outputText(w.output, w.matchStart, w.nextMatch);
					return;
				}
			}
			if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
				var link = createTiddlyLink(w.output, w.matchText, false, null, w.isStatic, w.tiddler);
				w.outputText(link, w.matchStart, w.nextMatch);
			} else {
				w.outputText(w.output, w.matchStart, w.nextMatch);
			}
		}
	},

	{
		name: "urlLink",
		match: config.textPrimitives.urlPattern,
		handler: function(w)
		{
			w.outputText(createExternalLink(w.output, w.matchText), w.matchStart, w.nextMatch);
		}
	},

	{
		name: "image",
		match: "\\[[<>]?[Ii][Mm][Gg]\\[",
		lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				var container = w.output;
				var link = lookaheadMatch[5];
				if(link) {
					container = config.formatterHelpers.isExternalLink(link)
						? createExternalLink(w.output, link)
						: createTiddlyLink(w.output, link, false, null, w.isStatic, w.tiddler);
					jQuery(container).addClass("imageLink");
				}
				var img = createTiddlyElement(container, "img");
				if(lookaheadMatch[1])
					img.align = "left";
				else if(lookaheadMatch[2])
					img.align = "right";
				if(lookaheadMatch[3]) {
					img.title = lookaheadMatch[3];
					img.setAttribute("alt", lookaheadMatch[3]);
				}
				img.src = lookaheadMatch[4];
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	},

	{
		name: "html",
		match: "<[Hh][Tt][Mm][Ll]>",
		lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output, "span").innerHTML = lookaheadMatch[1];
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	},

	{
		name: "commentByBlock",
		match: "/%",
		lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
				w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	},

	{
		name: "characterFormat",
		match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
		handler: function(w)
		{
			switch(w.matchText) {
				case "''":
					w.subWikifyTerm(w.output.appendChild(document.createElement("strong")), /('')/mg);
					break;
				case "//":
					w.subWikifyTerm(createTiddlyElement(w.output, "em"), /(\/\/)/mg);
					break;
				case "__":
					w.subWikifyTerm(createTiddlyElement(w.output, "u"), /(__)/mg);
					break;
				case "^^":
					w.subWikifyTerm(createTiddlyElement(w.output, "sup"), /(\^\^)/mg);
					break;
				case "~~":
					w.subWikifyTerm(createTiddlyElement(w.output, "sub"), /(~~)/mg);
					break;
				case "--":
					w.subWikifyTerm(createTiddlyElement(w.output, "strike"), /(--)/mg);
					break;
				case "{{{":
					var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
					lookaheadRegExp.lastIndex = w.matchStart;
					var lookaheadMatch = lookaheadRegExp.exec(w.source);
					if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
						createTiddlyElement(w.output, "code", null, null, lookaheadMatch[1]);
						w.nextMatch = lookaheadRegExp.lastIndex;
					}
					break;
			}
		}
	},

	{
		name: "customFormat",
		match: "@@|\\{\\{",
		handler: function(w)
		{
			switch(w.matchText) {
				case "@@":
					var e = createTiddlyElement(w.output, "span");
					var styles = config.formatterHelpers.inlineCssHelper(w);
					if(styles.length == 0)
						e.className = "marked";
					else
						config.formatterHelpers.applyCssHelper(e, styles);
					w.subWikifyTerm(e, /(@@)/mg);
					break;
				case "{{":
					var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
					lookaheadRegExp.lastIndex = w.matchStart;
					var lookaheadMatch = lookaheadRegExp.exec(w.source);
					if(lookaheadMatch) {
						w.nextMatch = lookaheadRegExp.lastIndex;
						e = createTiddlyElement(w.output, lookaheadMatch[2] == "\n" ? "div" : "span", null, lookaheadMatch[1]);
						w.subWikifyTerm(e, /(\}\}\})/mg);
					}
					break;
			}
		}
	},

	{
		name: "mdash",
		match: "--",
		handler: function(w)
		{
			createTiddlyElement(w.output, "span").innerHTML = "&mdash;";
		}
	},

	{
		name: "lineBreak",
		match: "\\n|<br ?/?>",
		handler: function(w)
		{
			createTiddlyElement(w.output, "br");
		}
	},

	{
		name: "rawText",
		match: "\"{3}|<nowiki>",
		lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
		handler: function(w)
		{
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output, "span", null, null, lookaheadMatch[1]);
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	},

	{
		name: "htmlEntitiesEncoding",
		match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)" +
			"(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*" +
			"(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+" +
			"|&#?[a-zA-Z0-9]{2,8};)",
		handler: function(w)
		{
			createTiddlyElement(w.output, "span").innerHTML = w.matchText;
		}
	}
];

//--
//-- Wikifier
//--

function getParser(tiddler, format)
{
	if(tiddler) {
		if(!format) format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers)
				if(format == config.parsers[i].format)
					return config.parsers[i];
		} else {
			for(i in config.parsers)
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
		}
	}
	return formatter;
}

function Wikifier(source, formatter, highlightRegExp, tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body, "div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(output, terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output, new RegExp("(" + terminator + ")", "mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch;
	while(formatterMatch = this.formatter.formatterRegExp.exec(this.source)) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output, this.nextMatch, formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var i = 1; i < formatterMatch.length; i++) {
			if(formatterMatch[i]) {
				this.formatter.formatters[i - 1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output, this.nextMatch, this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output, terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ?
		this.source.substr(0, terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output, this.nextMatch, terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output, this.nextMatch, formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var i = 1; i < formatterMatch.length; i++) {
			if(formatterMatch[i]) {
				this.formatter.formatters[i - 1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ?
			this.source.substr(0, terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output, this.nextMatch, this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place, startPos, endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) &&
		  (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place, this.source.substring(startPos, this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex, endPos);
		createTiddlyElement(place, "span", null, "highlight", this.source.substring(startPos, highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place, this.source.substring(startPos, endPos));
	}
};

function wikify(source, output, highlightRegExp, tiddler)
{
	if(!source) return;
	var wikifier = new Wikifier(source, getParser(tiddler), highlightRegExp, tiddler);
	var t0 = new Date();
	wikifier.subWikify(output);
	if(tiddler && config.options.chkDisplayInstrumentation)
		displayMessage("wikify:" + tiddler.title + " in " + (new Date() - t0) + " ms");
}

function wikifyStatic(source, highlightRegExp, tiddler, format)
{
	if(!source) return "";
	if(!tiddler) tiddler = new Tiddler("temp");
	var wikifier = new Wikifier(source, getParser(tiddler, format), highlightRegExp, tiddler);
	wikifier.isStatic = true;

	var e = createTiddlyElement(document.body, "pre");
	e.style.display = "none";
	wikifier.subWikify(e);
	var html = e.innerHTML;
	jQuery(e).remove();
	return html;
}

function wikifyPlainText(text, limit, tiddler)
{
	if(limit > 0)
		text = text.substr(0, limit);
	var wikifier = new Wikifier(text, formatter, null, tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source, output, highlightRegExp, tiddler)
{
	if(!source) return;
	var wikifier = new Wikifier(source, formatter, highlightRegExp, tiddler);
	wikifier.outputText(output, 0, source.length);
}

//--
//-- Macro definitions
//--

function invokeMacro(place, macro, params, wikifier, tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);

			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;

			var allowEval = true;
			if(config.evaluateMacroParameters == "system") {
				if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			m.handler(place, macro, m.noPreParse ? null : params.readMacroParams(!allowEval), wikifier, params, tiddler);
		} else {
			createTiddlyError(place, config.messages.macroError.format([macro]),
				config.messages.macroErrorDetails.format([macro, config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place, config.messages.macroError.format([macro]),
			config.messages.macroErrorDetails.format([macro, ex.toString()]));
	}
}

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place, macroName, params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place, macroName, params, wikifier, paramString)
{
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list)
{
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	var template = args.template ? store.getTiddlerText(args.template[0]) : false;
	if(!template) {
		template = config.macros.list.template;
	}
	var results;
	if(this[type].handler)
		results = this[type].handler(params);

	jQuery(list).empty().addClass("list list-" + type);
	if(this[type].prompt)
		createTiddlyElement(list, "li", null, "listTitle", this[type].prompt);

	for(var i = 0; i < results.length; i++) {
		var li = createTiddlyElement(list, "li");
		var tiddler = results[i];
		if(typeof(tiddler) == 'string') { // deal with missing etc..
			tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
		}
		wikify(template, li, null, tiddler);
	}
	if(results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags", "excludeLists", false, "title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	if(!filter) return [];
	return store.filterTiddlers(filter).map(function(tiddler) {
		return tiddler.title;
	});
};

config.macros.allTags.handler = function(place, macroName, params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place, "ul");
	if(tags.length == 0) createTiddlyElement(ul, "li", null, "listTitle", this.noTags);

	for(var i = 0; i < tags.length; i++) {
		var title = tags[i][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul, "li");
		var btn = createTiddlyButton(li, title + " (" + tags[i][1] + ")",
			this.tooltip.format([title]), onClickTag, info.classes);
		btn.setAttribute("tag", title);
		btn.setAttribute("refresh", "link");
		btn.setAttribute("tiddlyLink", title);
		if(params[1]) btn.setAttribute("sortby", params[1]);
	}
};

var macro = config.macros.timeline;
merge(macro, {
	handler: function(place, macroName, params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).
			attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var field = params[0] || "modified";
		var prefix = field.charAt(0);
		var no_prefix_field = prefix === "-" || prefix === "+" ? field.substr(1, field.length) : field;
		var dateFormat = params[2] || this.dateFormat;

		var groupTemplate = (args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) : null)
			|| macro.groupTemplate.format(no_prefix_field, dateFormat);
		var itemTemplate = (args.template ? store.getTiddlerText(args.template[0]) : null)
			|| macro.itemTemplate;

		var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
			store.reverseLookup("tags", "excludeLists", false, field);
		var last = params[1] ? tiddlers.length - Math.min(tiddlers.length, parseInt(params[1], 10)) : 0;
		var lastGroup = "", ul;

		for(var i = tiddlers.length - 1; i >= last; i--) {
			var theGroup = wikifyPlainText(groupTemplate, 0, tiddlers[i]);
			if(ul === undefined || theGroup != lastGroup) {
				ul = createTiddlyElement(container, "ul", null, "timeline");
				createTiddlyElement(ul, "li", null, "listTitle", theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul, "li", null, "listLink");
			wikify(itemTemplate, item, null, tiddlers[i]);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>",
	itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	var allowEval = true;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.length > 0 && config.evaluateMacroParameters == "system") {
		// included tiddler and "system" evaluation required, so check tiddler tagged appropriately
		var title = stack[stack.length - 1];
		var pos = title.indexOf(config.textPrimitives.sectionSeparator);
		if(pos != -1) {
			title = title.substr(0, pos); // get the base tiddler title
		}
		var t = store.getTiddler(title);
		if(!t || t.tags.indexOf("systemAllowEval") == -1) {
			allowEval = false;
		}
	}
	params = paramString.parseParams("name", null, allowEval, false, true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];

	var wrapper = createTiddlyElement(place, "span", null, className, null, {
		refresh: "content", tiddler: tiddlerName
	});
	if(args !== undefined)
		wrapper.macroArgs = args; // #154
	this.transclude(wrapper, tiddlerName, args);
};

config.macros.tiddler.transclude = function(wrapper, tiddlerName, args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text) return;

	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1) return;

	stack.push(tiddlerName);
	try {
		// substitute $1, $2, .. placeholders (markers)
		if(typeof args == "string")
			args = args.readBracketedList();
		var maxSupportedPlaceholders = 9; // $1 - $9
		var n = args ? args.length : 0;
		for(var i = 0; i < maxSupportedPlaceholders; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1), "mg");
			if(i < n) {
				text = text.replace(placeholderRE, args[i]);
			}
			// #162
			else if(n && config.options.chkRemoveExtraMarkers) {
				text = text.replace(placeholderRE, "");
			}
		}

		config.macros.tiddler.renderText(wrapper, text, tiddlerName);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place, text, tiddlerName)
{
	wikify(text, place, null, store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place, macroName, params)
{
	var btn = createTagButton(place, params[0], null, params[1], params[2]);
	if(params[3]) btn.setAttribute('sortby', params[3]);
};

config.macros.tags.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	params = paramString.parseParams("anon", null, true, false, false);
	var title = getParam(params, "anon", "");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params, "sep", " ");
	var lingo = config.views.wikified.tag;

	var ul = createTiddlyElement(place, "ul");
	createTiddlyElement(ul, "li", null, "listTitle",
		(tiddler.tags.length ? lingo.labelTags : lingo.labelNoTags).format([tiddler.title])
	);
	for(var i = 0; i < tiddler.tags.length; i++) {
		var tag = store.getTiddler(tiddler.tags[i]);
		if(tag && tag.tags.indexOf("excludeLists") != -1) continue;
		createTagButton(createTiddlyElement(ul, "li"), tiddler.tags[i], tiddler.title);
		if(i < tiddler.tags.length - 1)
			createTiddlyText(ul, sep);
	}
};

config.macros.tagging.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	params = paramString.parseParams("anon", null, true, false, false);
	var title = getParam(params, "anon", "");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params, "sep", " ");
	var sortby = getParam(params, "sortBy", false);
	var tagged = store.getTaggedTiddlers(title, sortby);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;

	var ul = createTiddlyElement(place, "ul");
	ul.setAttribute("title", this.tooltip.format([title]));
	createTiddlyElement(ul, "li", null, "listTitle", prompt.format([title, tagged.length]));

	for(var i = 0; i < tagged.length; i++) {
		createTiddlyLink(createTiddlyElement(ul, "li"), tagged[i].title, true);
		if(i < tagged.length - 1)
			createTiddlyText(ul, sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place, this.label, this.prompt, this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place, this.label, this.prompt, this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place, macroName, params)
{
	if(!readOnly)
		createTiddlyButton(place, params[0] || this.label, params[1] || this.prompt, this.onClick, null, null, this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n, !isOpen, null, "none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOption(cookie);
	return false;
};

config.macros.slider.createSlider = function(place, cookie, title, tooltip)
{
	var c = cookie || "";
	createTiddlyButton(place, title, tooltip, this.onClickSlider);
	var panel = createTiddlyElement(null, "div", null, "sliderPanel");
	panel.setAttribute("cookie", c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place, macroName, params)
{
	var panel = this.createSlider(place, params[0], params[2], params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh", "content");
	panel.setAttribute("tiddler", params[1]);
	if(text)
		wikify(text, panel, null, store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	var panel = wikifier ? createTiddlyElement(place, "div", null, "gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel, styles);
	}
	params = paramString.parseParams("color");
	var loColors = [], hiColors = [];

	for(var i = 2; i < params.length; i++) {
		var c = params[i].value;
		if(params[i].name == "snap") {
			hiColors[hiColors.length - 1] = c;
		} else {
			loColors.push(c);
			hiColors.push(c);
		}
	}
	drawGradient(panel, params[1].value != "vert", loColors, hiColors);
	if(wikifier)
		wikifier.subWikify(panel, ">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place, macroName, params)
{
	if(!params[0]) return;

	var names = params[0].split(".");
	var lookupMessage = function(root, nameIndex) {
		if(root[names[nameIndex]]) {
			if(nameIndex < names.length - 1)
				return (lookupMessage(root[names[nameIndex]], nameIndex + 1));
			else
				return root[names[nameIndex]];
		} else
			return null;
	};
	var m = lookupMessage(config, 0);
	if(m == null)
		m = lookupMessage(window, 0);
	createTiddlyText(place, m.toString().format(params.splice(1)));
};

config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value, place, params, wikifier, paramString, tiddler) {
		highlightify(value, place, highlightHack, tiddler);
	},
	link: function(value, place, params, wikifier, paramString, tiddler) {
		createTiddlyLink(place, value, true);
	},
	wikified: function(value, place, params, wikifier, paramString, tiddler) {
		if(config.macros.view.depth > 50)
			return;
		if(config.macros.view.depth > 0) {
			if (value == config.macros.view.values[config.macros.view.depth - 1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if(params[2])
			value = params[2].unescapeLineBreaks().format([value]);
		wikify(value, place, highlightHack, tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value, place, params, wikifier, paramString, tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place, value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	if(!(tiddler instanceof Tiddler) || !params[0]) return;
	var value = store.getValue(tiddler, params[0]);
	if(!value) return;

	var type = params[1] || config.macros.view.defaultView;
	var handler = config.macros.view.views[type];
	if(handler)
		handler(value, place, params, wikifier, paramString, tiddler);
};

config.macros.edit.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defaultValue = params[2] || '';
	if(!(tiddler instanceof Tiddler) || !field) return;

	story.setDirty(tiddler.title, true);
	var e, value = store.getValue(tiddler, field) || defaultValue;
	if(field != "text" && !rows) {
		e = createTiddlyElement(place, "input", null, null, null, {
			type: "text", edit: field, size: "40", autocomplete: "off"
		});
		e.value = value;
	} else {
		rows = rows || 10;
		var lines = value.match(/\n/mg);
		var maxLines = Math.max(parseInt(config.options.txtMaxEditRows), 5);
		if(lines != null && lines.length > rows)
			rows = lines.length + 5;
		rows = Math.min(rows, maxLines);

		var wrapper1 = createTiddlyElement(null, "fieldset", null, "fieldsetFix");
		var wrapper2 = createTiddlyElement(wrapper1, "div");
		e = createTiddlyElement(wrapper2, "textarea");
		e.value = value;
		e.setAttribute("rows", rows);
		e.setAttribute("edit", field);
		place.appendChild(wrapper1);
	}
	if(tiddler.isReadOnly()) {
		e.setAttribute("readOnly", "readOnly");
		jQuery(e).addClass("readOnly");
	}
	return e;
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));

	for(var i = 0; i < tags.length; i++) {
		var tag = createTiddlyButton(createTiddlyElement(popup, "li"), tags[i][0],
			lingo.tagTooltip.format([tags[i][0]]), config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag", tags[i][0]);
		tag.setAttribute("tiddler", this.getAttribute("tiddler"));
	}
	if(tags.length == 0) jQuery("<li/>").addClass('disabled').text(lingo.popupNone).appendTo(popup);

	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title, tag, 0);
	return false;
};

config.macros.tagChooser.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	if(!(tiddler instanceof Tiddler)) return;
	var lingo = config.views.editor.tagChooser;
	createTiddlyButton(place, lingo.text, lingo.tooltip, this.onClick, null, null, null, {
		tiddler: tiddler.title,
		tags: params[0]
	});
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place, this.label, this.prompt, this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var annotation = title ? config.annotations[title] : null;
	if(!tiddler || !title || !annotation) return;
	var text = annotation.format([title]);
	wikify(text, createTiddlyElement(place, "div", null, "annotation"), null, tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,
	title, params, label, prompt, accessKey, newFocus, isJournal)
{
	label = getParam(params, "label", label);
	prompt = getParam(params, "prompt", prompt);
	accessKey = getParam(params, "accessKey", accessKey);
	var customFields = getParam(params, "fields", "");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var tags = [];
	for(var i = 1; i < params.length; i++) {
		if((params[i].name == "anon" && i != 1) || (params[i].name == "tag"))
			tags.push(params[i].value);
	}
	var text = getParam(params, "text");

	var btn = createTiddlyButton(place, label, prompt, this.onClickNewTiddler, null, null, accessKey, {
		newTitle: title,
		isJournal: isJournal ? "true" : "false",
		newFocus: getParam(params, "focus", newFocus),
		newTemplate: getParam(params, "template", DEFAULT_EDIT_TEMPLATE)
	});
	if(tags.length > 0)
		btn.setAttribute("params", tags.join("|"));
	if(customFields !== "")
		btn.setAttribute("customFields", customFields);
	if(text !== undefined)
		btn.setAttribute("newText", text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);

	story.displayTiddler(this, title, template, false, null, null); // #161
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem, customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title, "text"))
		story.getTiddlerField(title, "text").value = text.format([title]);
	for(var i = 0; i < tags.length; i++)
		story.setTiddlerTag(title, tags[i], +1);
	story.focusTiddler(title, focus);
	return false;
};

config.macros.newTiddler.handler = function(place, macroName, params, wikifier, paramString)
{
	if(readOnly) return;
	params = paramString.parseParams("anon", null, true, false, false);
	var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
	title = getParam(params, "title", title);
	this.createNewTiddlerButton(place, title, params, this.label, this.prompt, this.accessKey, "title", false);
};

config.macros.newJournal.handler = function(place, macroName, params, wikifier, paramString)
{
	if(readOnly) return;
	params = paramString.parseParams("anon", null, true, false, false);
	var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
	title = getParam(params, "title", title);
	config.macros.newTiddler.createNewTiddlerButton(place, title,
		params, this.label, this.prompt, this.accessKey, "text", true);
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	params = paramString.parseParams("anon", null, false, false, false);
	createTiddlyButton(place, this.label, this.prompt, this.onClick, "button searchButton");
	var attributes = {
		size: this.sizeTextbox,
		accessKey: getParam(params, "accesskey", this.accessKey),
		autocomplete: "off",
		lastSearchText: "",
		placeholder: getParam(params, "placeholder", this.placeholder)
	};
	if(config.browser.isSafari) {
		attributes.type = "search";
		attributes.results = "5";
	} else {
		attributes.type = "text";
	}
	var input = createTiddlyElement(place, "input", null, "txtOptionInput searchField", null, attributes);
	input.value = getParam(params, "anon", "");
	input.onkeyup = this.onKeyPress;
	input.onfocus = this.onFocus;
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(input)
{
	if(input.value.length == 0) return;
	story.search(input.value, config.options.chkCaseSensitiveSearch, config.options.chkRegExpSearch);
	input.setAttribute("lastSearchText", input.value);
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 9: // Tab
			return;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout) clearTimeout(me.timeout);
				var input = this;
				me.timeout = setTimeout(function() { me.doSearch(input) }, 500);
			}
		} else {
			if(me.timeout) clearTimeout(me.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place, macroName, params)
{
	var cookie = params[0];
	var numTabs = (params.length - 1) / 3;
	var wrapper = createTiddlyElement(null, "div", null, "tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper, "div", null, "tabset");
	tabset.setAttribute("cookie", cookie);
	var validTab = false;
	for(var i = 0; i < numTabs; i++) {
		var label = params[i * 3 + 1];
		var prompt = params[i * 3 + 2];
		var content = params[i * 3 + 3];
		var tab = createTiddlyButton(tabset, label, prompt, this.onClickTab, "tab tabUnselected");
		createTiddlyElement(tab, "span", null, null, " ", { style: "font-size:0pt;line-height:0px" });
		tab.setAttribute("tab", label);
		tab.setAttribute("content", content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset, config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode, this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset, tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var i = 0; i < nodes.length; i++) {
		if(nodes[i].getAttribute && nodes[i].getAttribute("tab") == tab) {
			theTab = nodes[i];
			theTab.className = "tab tabSelected";
		} else {
			nodes[i].className = "tab tabUnselected";
		}
	}
	if(!theTab) return;

	if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
		jQuery(tabset.nextSibling).remove();
	var tabContent = createTiddlyElement(null, "div", null, "tabContents");
	tabset.parentNode.insertBefore(tabContent, tabset.nextSibling);
	var contentTitle = theTab.getAttribute("content");
	wikify(store.getTiddlerText(contentTitle), tabContent, null, store.getTiddler(contentTitle));
	if(cookie) {
		config.options[cookie] = tab;
		saveOption(cookie);
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place, commandName, tiddler, className)
{
	if(!(tiddler instanceof Tiddler)) return;
	if(typeof commandName != "string") {
		for(var name in config.commands) {
			if(config.commands[name] == commandName)
				commandName = name;
		}
	}
	if(typeof commandName != "string") return;
	var command = config.commands[commandName];
	if(command.isEnabled ? !command.isEnabled(tiddler) : !this.isCommandEnabled(command, tiddler))
		return;

	var text = command.getText ? command.getText(tiddler) : this.getCommandText(command, tiddler);
	var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command, tiddler);
	var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
	var btn = createTiddlyButton(place, text, tooltip, cmd, "button command_" + commandName, null, null, {
		commandName: commandName,
		tiddler: tiddler.title
	});
	if(className) jQuery(btn).addClass(className);
	if(commandName === 'permalink') {
		jQuery(btn).attr('href', config.commands.permalink.getUrl(tiddler.title));
	}
};

config.macros.toolbar.isCommandEnabled = function(command, tiddler)
{
	var title = tiddler.title;
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	if(shadow && command.hideShadow) return false;
	var ro = tiddler.isReadOnly();
	return !ro || (ro && !command.hideReadOnly);
};

config.macros.toolbar.getCommandText = function(command, tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command, tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e, this, this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var title = this.getAttribute("tiddler");
	popup.setAttribute("tiddler", title);
	var command = config.commands[this.getAttribute("commandName")];
	command.handlePopup(popup, title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place, className, event)
{
	var children = place.getElementsByTagName("a");
	for(var i = 0; i < children.length; i++) {
		var c = children[i];
		if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c, event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	for(var i = 0; i < params.length; i++) {
		var commandName = params[i];
		switch(commandName) {
			case "!":
				createTiddlyText(place, this.separator);
				break;
			case "*":
				createTiddlyElement(place, "br");
				break;
			case "<":
				createTiddlyButton(place, this.lessLabel, this.lessPrompt,
					config.macros.toolbar.onClickLess, "button lessCommand");
				break;
			case ">":
				createTiddlyButton(place, this.moreLabel, this.morePrompt,
					config.macros.toolbar.onClickMore, "button moreCommand");
				place = createTiddlyElement(place, "span", null, "moreCommand");
				place.style.display = "none";
				break;
			default:
				var className = "";
				switch(commandName.substring(0, 1)) {
					case "+":
						className = "defaultCommand";
						commandName = commandName.substring(1);
						break;
					case "-":
						className = "cancelCommand";
						commandName = commandName.substring(1);
						break;
				}
				if(config.commands[commandName]) {
					this.createCommand(place, commandName, tiddler, className);
				} else {
					this.customCommand(place, commandName, wikifier, tiddler);
				}
				break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place, command, wikifier, tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event, src, title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title, false);
	story.closeTiddler(title, true);
	return false;
};

config.commands.closeOthers.handler = function(event, src, title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event, src, title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null, title, DEFAULT_EDIT_TEMPLATE, false, null, fields);

	var editorElement = story.getTiddlerField(title, config.options.txtEditorFocus || "text");
	if(editorElement) setCaretPosition(editorElement, 0);
	return false;
};

config.commands.saveTiddler.handler = function(event, src, title)
{
	var newTitle = story.saveTiddler(title, event.shiftKey);
	if(newTitle) story.displayTiddler(null, newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event, src, title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title, false);
	story.displayTiddler(null, title);
	return false;
};

config.commands.deleteTiddler.handler = function(event, src, title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete) deleteIt = confirm(this.warning.format([title]));
	if(!deleteIt) return false;

	store.removeTiddler(title);
	story.closeTiddler(title, true);
	autoSaveChanges();
	return false;
};

config.commands.permalink.getUrl = function(title) {
	var hash = story.getPermaViewHash([title]);
	return window.location.href.replace(/#.*/, hash);
};
config.commands.permalink.handler = function(event, src, title)
{
	var hash = story.getPermaViewHash([title]);
	if(window.location.hash != hash) window.location.hash = hash;
	return false;
};

config.commands.references.handlePopup = function(popup, title)
{
	var references = store.getReferringTiddlers(title);
	var hasRefs = false;
	for(var i = 0; i < references.length; i++) {
		if(references[i].title != title && !references[i].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup, "li"), references[i].title, true);
			hasRefs = true;
		}
	}
	if(!hasRefs) createTiddlyElement(popup, "li", null, "disabled", this.popupNone);
};

config.commands.jump.handlePopup = function(popup, title)
{
	story.forEachTiddler(function(title, element) {
		createTiddlyLink(createTiddlyElement(popup, "li"), title, true, null, false, null, true);
	});
};

config.commands.fields.handlePopup = function(popup, title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler) return;
	var items = [];
	store.forEachField(tiddler, function(tiddler, fieldName, value) {
		items.push({ field: fieldName, value: value }); }, true);
	items.sort(function(a, b) { return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1) });

	if(items.length > 0) {
		ListView.create(popup, items, this.listViewTemplate);
	} else {
		createTiddlyElement(popup, "li", null, "disabled", this.emptyText);
	}
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated == false) this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i == "server.host" || i == "server.workspace" || i == "wikiformat" || i == "server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c, 10) : 0;
	this.fields['changecount'] = String(c + 1);
};

Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changecount = this.fields.changecount || 0;
	return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title, text, modifier, modified, tags, created, fields, creator)
{
	this.assign(title, text, modifier, modified, tags, created, fields, creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title, text, modifier, modified, tags, created, fields, creator)
{
	if(title != undefined) this.title = title;
	if(text != undefined) this.text = text;
	if(modifier != undefined) this.modifier = modifier;
	if(modified != undefined) this.modified = modified;
	if(creator != undefined) this.creator = creator;
	if(created != undefined) this.created = created;
	if(fields != undefined) this.fields = fields;
	if(tags != undefined) this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined) this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like .links array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g, "")
		.replace(/\{{3}((?:.|\n)*?)\}{3}/g, "")
		.replace(/"""((?:.|\n)*?)"""/g, "")
		.replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g, "")
		.replace(/<html\>((?:.|\n)*?)<\/html\>/g, "")
		.replace(/<script((?:.|\n)*?)<\/script\>/g, "");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t == 0 ?
		config.textPrimitives.tiddlerAnyLinkRegExp :
		config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t == 0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink + "|" +
					config.textPrimitives.anyLetter, "mg");
				preRegExp.lastIndex = formatMatch.index - 1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index - 1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2 - t] && !config.formatterHelpers.isExternalLink(formatMatch[3 - t]))
			// titledBrackettedLink
			this.links.pushUnique(formatMatch[3 - t]);
		else if(formatMatch[4 - t] && formatMatch[4 - t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4 - t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier || config.messages.subtitleUnknown || "";
	var modified = this.modified ?
		this.modified.toLocaleString() :
		config.messages.subtitleUnknown || "";
	var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
	return f.format([this.title, modifier, modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = this.fields['server.type'] || this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType]) return null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki(params)
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	if(params && params.config) {
		this.config = config;
	}
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var title in tiddlers) {
			var tiddler = tiddlers[title];
			if(tiddler instanceof Tiddler)
				callback.call(this, title, tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	return this.fetchTiddler(title) != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.isAvailable = function(title) {
	if(!title) return false;
	var i = title.indexOf(config.textPrimitives.sectionSeparator);
	if(i != -1) title = title.substring(0, i);
	return this.tiddlerExists(title) || this.isShadowTiddler(title);
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	return this.fetchTiddler(title) || null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	return (typeof config.shadowTiddlers[title] == "string")
		? config.shadowTiddlers[title]
		: "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title, defaultText)
{
	if(!title) return defaultText;

	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0, pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var sliceNameStart = pos + config.textPrimitives.sliceSeparator.length;
		var slice = this.getTiddlerSlice(title.substr(0, pos), title.substr(sliceNameStart));
		if(slice) return slice;
	}

	var tiddler = this.fetchTiddler(title);
	var text = tiddler ? tiddler.text : null;
	if(!tiddler && this.isShadowTiddler(title)) {
		text = this.getShadowTiddlerText(title);
	}
	if(!text) return defaultText != undefined ? defaultText : null;
	if(!section) return text;

	var headerRE = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)", "mg");
	headerRE.lastIndex = 0;
	var match = headerRE.exec(text);
	if(!match) return defaultText;

	var t = text.substr(match.index + match[1].length);
	var nextHeaderRE = /^!/mg;
	nextHeaderRE.lastIndex = 0;
	match = nextHeaderRE.exec(t);
	return !match ? t :
		// don't include final \n
		t.substr(0, match.index - 1);
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title, defaultText, depth)
{
	var text = this.getTiddlerText(title, null);
	if(text == null) return defaultText;

	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])", "mg");
	var textOut = [], match, lastPos = 0;
	do {
		if(match = bracketRegExp.exec(text)) {
			textOut.push(text.substr(lastPos, match.index - lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1], "", depth - 1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|\x20?([\'\/]{0,2})~?([^\|\s\:\~\'\/]|(?:[^\|\s~\'\/][^\|\n\f\r]*[^\|\s\:\'\/]))\:?\4[\x20\t]*\|[\t\x20]*([^\n\t\x20](?:[^\n]*[^\n\t\x20])?)[\t\x20]*\|$)/gm; // #112
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var text = this.getTiddlerText(title, "");
	this.slicesRE.lastIndex = 0;
	var slices = {}, m;
	while(m = this.slicesRE.exec(text)) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title, sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title, sliceNames)
{
	var i, r = {};
	for(i = 0; i < sliceNames.length; i++) {
		var slice = this.getTiddlerSlice(title, sliceNames[i]);
		if(slice) r[sliceNames[i]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title, doBlanket)
{
	if(this.notificationLevel) return;
	for(var i = 0; i < this.namedNotifications.length; i++) {
		var n = this.namedNotifications[i];
		if((n.name == null && doBlanket) || (n.name == title))
			n.notify(title);
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(this.notificationLevel) return;
	for(var i = 0; i < this.namedNotifications.length; i++) {
		var n = this.namedNotifications[i];
		if(n.name)
			n.notify(n.name);
	}
};

// Add a notification handler to a tiddler unless it's already set
TiddlyWiki.prototype.addNotification = function(title, fn)
{
	for(var i = 0; i < this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({ name: title, notify: fn });
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title, true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title, true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title, status, tag)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) return;

	var t = tiddler.tags.indexOf(tag);
	if(t != -1)
		tiddler.tags.splice(t, 1);
	if(status)
		tiddler.tags.push(tag);

	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title, true);
	this.setDirty(true);
};

TiddlyWiki.prototype.addTiddlerFields = function(title, fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) return;

	merge(tiddler.fields, fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title, true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(titleOrTiddler, newTitle, newBody,
	modifier, modified, tags, fields, clearChangeCount, created, creator)
{
	var wasTiddlerProvided = titleOrTiddler instanceof Tiddler;
	var tiddler = this.resolveTiddler(titleOrTiddler);
	var title = tiddler ? tiddler.title : titleOrTiddler;
	newTitle = newTitle || title;

	if(tiddler) {
		this.deleteTiddler(title); //# clean up slices for title, make sure the tiddler is not copied when renamed
		created = created || tiddler.created; // Preserve created date
		creator = creator || tiddler.creator;
	} else {
		tiddler = new Tiddler();
		created = created || modified;
	}

	if(wasTiddlerProvided) {
		tiddler.fields = merge(merge({}, tiddler.fields), config.defaultCustomFields, true);
	} else {
		fields = merge(merge({}, fields), config.defaultCustomFields, true);
		tiddler.set(newTitle, newBody, modifier, modified, tags, created, fields, creator);
	}
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();

	this.addTiddler(tiddler); //# clean up slices for newTitle, add/return the tiddler
	if(title != newTitle) this.notify(title, true);
	this.notify(newTitle, true);
	this.setDirty(true);

	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src, idPrefix, noUpdate)
{
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem) return;

	this.idPrefix = idPrefix;
	var tiddlers = this.getLoader().loadTiddlers(this, storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0; i < tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv) return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0], posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";

	// Create an iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6

	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();

	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea, "store");

	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title, tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp, sortField, excludeTag, match)
{
	var candidates = this.reverseLookup("tags", excludeTag, !!match);
	var i, results = [];
	for(i = 0; i < candidates.length; i++) {
		if((candidates[i].title.search(searchRegExp) != -1) || (candidates[i].text.search(searchRegExp) != -1))
			results.push(candidates[i]);
	}
	if(!sortField) sortField = "title";
	results.sort(function(a, b) { return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1) });
	return results;
};

// Returns a list of all tags in use (in the form of an array of [tagName, numberOfOccurances] "tuples")
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title, tiddler) {
	    var i, j;
		for(i = 0; i < tiddler.tags.length; i++) {
			var tag = tiddler.tags[i];
			var isTagToAdd = true;
			for(j = 0; j < results.length; j++) {
				if(results[j][0] == tag) {
					isTagToAdd = false;
					results[j][1]++;
				}
			}
			if(isTagToAdd && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					isTagToAdd = false;
			}
			if(isTagToAdd) results.push([tag, 1]);
		}
	});
	results.sort(function(a, b) {
		var tag1 = a[0].toLowerCase(), tag2 = b[0].toLowerCase();
		return tag1 < tag2 ? -1 : (tag1 == tag2 ? 0 : +1);
	});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag, sortField)
{
	return this.reverseLookup("tags", tag, true, sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field, value, sortField)
{
	return this.reverseLookup(field, value, true, sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title, unusedParameter, sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links", title, true, sortField);
};

// Return an array of the tiddlers that have a specified entry (lookupValue) in the specified field (lookupField, like "links" or "tags")
// if shouldMatch == true, or don't have such entry (if shouldMatch == false)
TiddlyWiki.prototype.reverseLookup = function(lookupField, lookupValue, shouldMatch, sortField)
{
	var results = [];
	this.forEachTiddler(function(title, tiddler) {
		var values;
		if(["links", "tags"].contains(lookupField)) {
			values = tiddler[lookupField];
		} else {
			var accessor = TiddlyWiki.standardFieldAccess[lookupField];
			values = accessor ? [ accessor.get(tiddler) ] :
				( tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [] );
		}

		var hasMatch = false;
		for(var i = 0; i < values.length; i++) {
			if(values[i] == lookupValue)
				hasMatch = true;
		}
		if(hasMatch == !!shouldMatch) results.push(tiddler);
	});
	return this.sortTiddlers(results, sortField || "title");
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field, excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title, tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field) results.sort(function(a, b) { return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1) });
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
	if(!this.tiddlersUpdated) this.updateTiddlers();

	var results = [];
	this.forEachTiddler(function (title, tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;

		for(var i = 0; i < tiddler.links.length; i++) {
			var link = tiddler.links[i];
			if(this.getTiddlerText(link, null) == null && !this.isShadowTiddler(link) && !config.macros[link])
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title, tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var t, results = [];
	for(t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title, tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
	});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers, field)
{
	var asc = +1;
	switch(field.substr(0, 1)) {
		case "-":
			asc = -1;
			field = field.substr(1);
			break;
		case "+":
			field = field.substr(1);
			break;
	}
	if(TiddlyWiki.standardFieldAccess[field]) {
		if(field == "title") {
			tiddlers.sort(function(a, b) {
				var t1 = a[field].toLowerCase(), t2 = b[field].toLowerCase();
				return t1 < t2 ? -asc : (t1 == t2 ? 0 : asc);
			});
		} else {
			tiddlers.sort(function(a, b) {
				return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);
			});
		}
	} else {
		tiddlers.sort(function(a, b) {
			return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);
		});
	}
	return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results, match) {
		var title = match[1] || match[4];
		var tiddler = this.fetchTiddler(title);
		if(tiddler) {
			results.pushUnique(tiddler);
		} else if(this.isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title, this.getTiddlerText(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results, match) {
		var i, matched = this.getTaggedTiddlers(match[3]);
		for(i = 0; i < matched.length; i++) {
			results.pushUnique(matched[i]);
		}
		return results;
	},
	sort: function(results, match) {
		return this.sortTiddlers(results, match[3]);
	},
	limit: function(results, match) {
		return results.slice(0, parseInt(match[3], 10));
	},
	field: function(results, match) {
		var i, matched = this.getValueTiddlers(match[2], match[3]);
		for (i = 0; i < matched.length; i++) {
			results.pushUnique(matched[i]);
		}
		return results;
	}
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter, results)
{
	var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

	results = results || [];
	if(filter) {
		var match;
		while(match = re.exec(filter)) {
			var handler = (match[1] || match[4]) ? 'tiddler' :
				config.filters[match[2]] ? match[2] : 'field';
			results = config.filters[handler].call(this, results, match);
		}
	}
	return results;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(fName, readOnly)
{
	this.set = readOnly ?
		function(tiddler, newValue) {
			if(newValue != tiddler[fName]) throw config.messages.fieldCannotBeChanged.format([fName]);
		} :
		function(tiddler, newValue) {
			if(newValue == tiddler[fName]) return;
			tiddler[fName] = newValue;
			return true;
		};
	this.get = function(tiddler) { return tiddler[fName] };
}

function DateFieldAccess(fName)
{
	this.set = function(tiddler, newValue) {
		var d = newValue instanceof Date ? newValue : Date.convertFromYYYYMMDDHHMM(newValue);
		if(d == tiddler[fName]) return;
		tiddler[fName] = d;
		return true;
	};
	this.get = function(tiddler) { return tiddler[fName].convertToYYYYMMDDHHMM() };
}

function LinksFieldAccess(fName)
{
	this.set = function(tiddler, newValue) {
		var items = (typeof newValue == "string") ? newValue.readBracketedList() : newValue;
		if(items.toString() == tiddler[fName].toString()) return;
		tiddler[fName] = items;
		return true;
	};
	this.get = function(tiddler) { return String.encodeTiddlyLinkList(tiddler[fName]) };
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title", true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title", true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddlerOrTitle, fieldName, value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddlerOrTitle);
	if(!t) return;

	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		// don't remove StandardFields
		if(isRemove) return;
		if(!accessor.set(t, value)) return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^" + fieldName + "\\.");
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty) return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience convert Date -> String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value) return;
			t.fields[fieldName] = value;
		}
	}

	// When we are here the tiddler/store really was changed.
	this.notify(t.title, true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddlerOrTitle, fieldName)
{
	var t = this.resolveTiddler(tiddlerOrTitle);
	if(!t) return undefined;

	if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 ||
	   fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0
	) {
		var separator = fieldName.substr(0, 2);
		var partName = fieldName.substring(2);
		return store.getTiddlerText(t.title + separator + partName);
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = TiddlyWiki.standardFieldAccess[fieldName];
		if(accessor) return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler, fieldName, value).
TiddlyWiki.prototype.forEachField = function(tiddlerOrTitle, callback, onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddlerOrTitle);
	if(!t) return undefined;

	var name, result;
	for(name in t.fields) {
		result = callback(t, name, t.fields[name]);
		if(result) return result;
	}

	if(onlyExtendedFields) return undefined;
	for(name in TiddlyWiki.standardFieldAccess) {
		// even though the "title" field can also be referenced through the name "tiddler"
		// we only visit this field once.
		if(name == "tiddler") continue;

		result = callback(t, name, TiddlyWiki.standardFieldAccess[name].get(t));
		if(result) return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

// A story is a HTML div containing a sequence of tiddlers that can be manipulated
//  container - id of containing element
//  idPrefix - string prefix prepended to title to make ids for tiddlers in this story
function Story(containerId, idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var validId = title.replace(/_/g, "__").replace(/ /g, "_");
		var id = this.idPrefix + validId;
		return id == this.container ? this.idPrefix + "_" + validId : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(handleTiddler)
{
	var place = this.getContainer();
	if(!place) return;
	var el = place.firstChild;
	while(el) {
		var next = el.nextSibling;
		var title = el.getAttribute("tiddler");
		if(title) {
			handleTiddler.call(this, title, el);
		}
		el = next;
	}
};

Story.prototype.displayTiddler = function(srcElement, tiddler,
	template, animate, unused, customFields, toggle, animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title, true);
		} else {
			this.refreshTiddler(title, template, false, customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place, before, title, template, customFields);
	}

	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim &&
		   typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title, srcElement, tiddlerElem), new Scroller(tiddlerElem));
		else
			window.scrollTo(0, ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.displayTiddlers = function(srcElement, titles, template, animate, unused, customFields, toggle)
{
	for(var i = titles.length - 1; i >= 0; i--)
		this.displayTiddler(srcElement, titles[i], template, animate, unused, customFields);
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null, store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place, before, title, template, customFields)
{
	var tiddlerElem = createTiddlyElement(null, "div", this.tiddlerId(title), "tiddler");
	tiddlerElem.setAttribute("refresh", "tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields", customFields);
	place.insertBefore(tiddlerElem, before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title, customFields);
	this.refreshTiddler(title, template, false, customFields, defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title, fields, callback)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields || {};
	var context = { serverType: tiddler.getServerType() };
	if(!context.serverType) return "";
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType]();

	var onLoadTiddlerResponse = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			t.created  = t.created  || new Date();
			t.modified = t.modified || t.created;
			var dirty = store.isDirty();
			context.tiddler = store.saveTiddler(t.title, t.title, t.text, t.modifier, t.modified,
				t.tags, t.fields, true, t.created, t.creator);
			if(!window.allowSave())
				store.setDirty(dirty);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title, null, true);
		}
		context.adaptor.close();
		if(callback) callback(context);
	};
	adaptor.getTiddler(title, context, null, onLoadTiddlerResponse);
	return config.messages.loadingMissingTiddler.format([title, context.serverType, context.host, context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title, template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title, template, tiddler)
{
	return store.getRecursiveTiddlerText(template, null, 10);
};

Story.prototype.refreshTiddler = function(title, template, force, customFields, defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(!tiddlerElem) return null;

	if(tiddlerElem.getAttribute("dirty") == "true" && !force)
		return tiddlerElem;
	template = this.chooseTemplateForTiddler(title, template);
	var currTemplate = tiddlerElem.getAttribute("template");
	if((template == currTemplate) && !force)
		return tiddlerElem;

	var tiddler = store.getTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler();
		if(store.isShadowTiddler(title)) {
			var tags = [];
			tiddler.set(title, store.getTiddlerText(title),
				config.views.wikified.shadowModifier, version.date, tags, version.date);
		} else {
			var text = template == config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE] // #166
				? config.views.editor.defaultText.format([title])
				: config.views.wikified.defaultText.format([title]);
			text = defaultText || text;
			var fields = customFields ? customFields.decodeHashMap() : null;
			tiddler.set(title, text, config.views.wikified.defaultModifier, version.date, [], version.date, fields);
		}
	}

	tiddlerElem.setAttribute("tags", tiddler.tags.join(" "));
	tiddlerElem.setAttribute("tiddler", title);
	tiddlerElem.setAttribute("template", template);
	tiddlerElem.onmouseover = this.onTiddlerMouseOver;
	tiddlerElem.onmouseout = this.onTiddlerMouseOut;
	tiddlerElem.ondblclick = this.onTiddlerDblClick;
	tiddlerElem[window.event ? "onkeydown" : "onkeypress"] = this.onTiddlerKeyPress;
	tiddlerElem.innerHTML = this.getTemplateForTiddler(title, template, tiddler);
	applyHtmlMacros(tiddlerElem, tiddler);
	if(store.getTaggedTiddlers(title).length > 0)
		jQuery(tiddlerElem).addClass("isTag");
	else
		jQuery(tiddlerElem).removeClass("isTag");
	if(store.tiddlerExists(title)) {
		jQuery(tiddlerElem).removeClass("shadow");
		jQuery(tiddlerElem).removeClass("missing");
	} else {
		jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
	}
	if(customFields)
		this.addCustomFields(tiddlerElem, customFields);

	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place, customFields)
{
	var fields = customFields.decodeHashMap();
	var container = createTiddlyElement(place, "div", null, "customFields");
	container.style.display = "none";
	for(var fieldName in fields) {
		var input = document.createElement("input");
		input.setAttribute("type", "text");
		input.setAttribute("value", fields[fieldName]);
		container.appendChild(input);
		input.setAttribute("edit", fieldName);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	this.forEachTiddler(function(title, element) {
		var template = element.getAttribute("template");
		if(template && element.getAttribute("dirty") != "true") {
			this.refreshTiddler(title, force ? null : template, true);
		}
	});
};

Story.prototype.onTiddlerMouseOver = function()
{
	jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function()
{
	jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(!target || target.nodeName.toLowerCase() == "input" || target.nodeName.toLowerCase() == "textarea")
		return false;
	if(document.selection && document.selection.empty)
		document.selection.empty();
	config.macros.toolbar.invokeCommand(this, "defaultCommand", e);
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return true;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
		case 9: // Tab
			var editor = story.getTiddlerField(title, "text");
			if(target.tagName.toLowerCase() == "input"
			   && editor.value == config.views.editor.defaultText.format([title])) {
				// moving from input field and editor still contains default text, so select it
				editor.focus();
				editor.select();
				consume = true;
			}
			if(config.options.chkInsertTabs && !e.ctrlKey && target.tagName.toLowerCase() == "textarea") {
				replaceSelection(target, String.fromCharCode(9));
				consume = true;
			}
			if(config.isOpera) {
				target.onblur = function() {
					this.focus();
					this.onblur = null;
				};
			}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey) {
				blurElement(this);
				config.macros.toolbar.invokeCommand(this, "defaultCommand", e);
				consume = true;
			}
			break;
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this, "cancelCommand", e);
			consume = true;
			break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title, field)
{
	var tiddlerElem = this.getTiddler(title);
	if(!tiddlerElem) return null;

	var $editors = jQuery(tiddlerElem).find('input, textarea');
	return $editors.filter('[edit="' + field + '"]')[0] || $editors[0] || null;
};

Story.prototype.focusTiddler = function(title, field)
{
	var e = this.getTiddlerField(title, field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title, tag, mode, field)
{
	var editor = this.getTiddlerField(title, field);
	var tags = editor.value.readBracketedList();

	var i = tags.indexOf(tag);
	if(mode == 0) mode = (i == -1) ? +1 : -1;
	if(mode == +1) {
		if(i == -1) tags.push(tag);
	} else if(mode == -1) {
		if(i != -1) tags.splice(i, 1);
	}

	editor.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title, tag, mode)
{
	this.setTiddlerField(title, tag, mode, "tags");
};

Story.prototype.closeTiddler = function(title, shouldAnimate, unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(!tiddlerElem) return;

	clearMessage();
	this.scrubTiddler(tiddlerElem);
	if(config.options.chkAnimate && shouldAnimate && anim && typeof Slider == "function") {
		anim.startAnimating(new Slider(tiddlerElem, false, null, "all"));
	} else {
		jQuery(tiddlerElem).remove();
	}
};

Story.prototype.scrubTiddler = function(tiddlerElement)
{
	tiddlerElement.id = null;
};

// 'dirty' flag attribute is used on tiddlers to mark those having unsaved changes

Story.prototype.setDirty = function(title, dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty", dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(!tiddlerElem) return null;
	return tiddlerElem.getAttribute("dirty") == "true";
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title, element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title, element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0, ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text, useCaseSensitive, useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(), useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack, "title", "excludeSearch");
	this.displayTiddlers(null, matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(), q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(el)
{
	while(el && !jQuery(el).hasClass("tiddler")) {
		el = jQuery(el).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root
			: el.parentNode;
	}
	return el;
};

Story.prototype.gatherSaveFields = function(el, fields)
{
	if(!el || !el.getAttribute) return;
	var fieldName = el.getAttribute("edit");
	if(fieldName)
		fields[fieldName] = el.value.replace(/\r/mg, "");
	if(el.hasChildNodes()) {
		for(var i = 0; i < el.childNodes.length; i++)
			this.gatherSaveFields(el.childNodes[i], fields);
	}
};

Story.prototype.hasChanges = function(title)
{
	var tiddlerElement = this.getTiddler(title);
	if(!tiddlerElement) return false;

	var fields = {};
	this.gatherSaveFields(tiddlerElement, fields);
	if(store.fetchTiddler(title)) {
		for(var fieldName in fields) {
			if(store.getValue(title, fieldName) != fields[fieldName])
				return true;
		}
		return false;
	}
	if(store.isShadowTiddler(title)) {
		// not checking for title or tags
		return store.getShadowTiddlerText(title) != fields.text;
	}
	// new tiddler
	return true;
};

Story.prototype.saveTiddler = function(title, minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(!tiddlerElem) return null;

	var fields = {};
	this.gatherSaveFields(tiddlerElem, fields);
	var newTitle = fields.title || title;
	if(!store.tiddlerExists(newTitle)) {
		newTitle = newTitle.trim();
		var creator = config.options.txtUserName;
	}
	if(store.tiddlerExists(newTitle) && newTitle != title) {
		if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
			return null;
	}
	if(newTitle != title)
		this.closeTiddler(newTitle, false);
	tiddlerElem.id = this.tiddlerId(newTitle);
	tiddlerElem.setAttribute("tiddler", newTitle);
	tiddlerElem.setAttribute("template", DEFAULT_VIEW_TEMPLATE);
	tiddlerElem.setAttribute("dirty", "false");
	if(config.options.chkForceMinorUpdate)
		minorUpdate = !minorUpdate;
	if(!store.tiddlerExists(newTitle))
		minorUpdate = false;
	if(store.tiddlerExists(title)) {
		var t = store.fetchTiddler(title);
		var extendedFields = t.fields;
		creator = t.creator;
	} else {
		extendedFields = merge({}, config.defaultCustomFields);
	}
	for(var n in fields) {
		if(!TiddlyWiki.isStandardField(n))
			extendedFields[n] = fields[n];
	}
	var tiddler = store.saveTiddler(title, newTitle, fields.text, minorUpdate ? undefined : config.options.txtUserName,
		minorUpdate ? undefined : new Date(), fields.tags, extendedFields, null, null, creator);
	autoSaveChanges(null, [tiddler]);
	return newTitle;
};

Story.prototype.getPermaViewHash = function(titles)
{
	return '#' + encodeURIComponent(String.encodeTiddlyLinkList(titles));
};

Story.prototype.permaView = function()
{
	var titles = [];
	this.forEachTiddler(function(title, element) {
		titles.push(title);
	});
	var hash = this.getPermaViewHash(titles);
	if(window.location.hash != hash)
		window.location.hash = hash;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode) return;

	var getSlice = function(theme, slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme, slice + "ReadOnly") || store.getTiddlerSlice(theme, "Web" + slice);
		r = r || store.getTiddlerSlice(theme, slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator) == 0)
			r = theme + r;
		return store.isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i, name, theme, slice) {
		var newName = getSlice(theme, slice);
		if(name != newName && store.namedNotifications[i].name == name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i = 0; i < config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
			case "PageTemplate":
				config.refresherData.pageTemplate = replaceNotification(i, config.refresherData.pageTemplate, theme, name);
				break;
			case "StyleSheet":
				removeStyleSheet(config.refresherData.styleSheet);
				config.refresherData.styleSheet = replaceNotification(i, config.refresherData.styleSheet, theme, name);
				break;
			case "ColorPalette":
				config.refresherData.colorPalette = replaceNotification(i, config.refresherData.colorPalette, theme, name);
				break;
			default:
				break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme, "ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme, "EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate != pt || config.tiddlerTemplates[vi] != vt
		   || config.tiddlerTemplates[ei] != et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet, "", 10),
				config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOption("txtTheme");
	}
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var text = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button, text, cmb.open.tooltip,
			function(e) { backstage.show(); return false }, null, "backstageShow");
		text = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button, text, cmb.close.tooltip,
			function(e) { backstage.hide(); return false }, null, "backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel, "div", null, "backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel, "div", null, "backstagePanelBody");
		this.cloak.onmousedown = function(e) { backstage.switchTab(null) };
		createTiddlyText(this.toolbar, cmb.prompt);
		for(var i = 0; i < config.backstageTasks.length; i++)
		{
			var taskName = config.backstageTasks[i];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar, text, task.tooltip, handler, "backstageTab");
			jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
		}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			anim.startAnimating(new Morpher(backstage.toolbar, config.animDuration, [
				{ style: "left", start: findWindowWidth(), end: 0, template: "%0px" }
			]));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOption("chkBackstage");
		jQuery(this.content).addClass("backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			// close current tab, not backstage
			this.switchTab(null);
			return;
		}

		backstage.toolbar.style.left = "0px";
		var hide = function() { backstage.area.style.display = "none" };
		if(anim && config.options.chkAnimate) {
			anim.startAnimating(new Morpher(backstage.toolbar, config.animDuration, [
				{ style: "left", start: 0, end: findWindowWidth(), template: "%0px" }
			], hide));
		} else {
			hide();
		}
		this.showButton.style.display = "block";
		this.hideButton.style.display = "none";
		config.options.chkBackstage = false;
		saveOption("chkBackstage");
		jQuery(this.content).removeClass("backstageVisible");
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e) {
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
		}
		if(tabName == this.currTabName) {
			this.hidePanel();
			return;
		}
		if(this.currTabElem) {
			jQuery(this.currTabElem).removeClass("backstageSelTab");
		}
		if(tabElem && tabName) {
			this.preparePanel();
			jQuery(tabElem).addClass("backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content, this.panelBody, null, null);
			this.showPanel();
		} else if(this.currTabElem) {
			this.hidePanel();
		}
		this.currTabName = tabName;
		this.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findDocHeight() + "px";
		backstage.cloak.style.display = "block";
		jQuery(backstage.panelBody).empty();
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			anim.startAnimating(new Morpher(backstage.panel, config.animDuration, [
				{ style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px" }
			]), new Scroller(backstage.panel, false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			jQuery(backstage.currTabElem).removeClass("backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var callback = function() { backstage.cloak.style.display = "none" };
			anim.startAnimating(new Morpher(backstage.panel, config.animDuration, [
				{ style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px" },
				{ style: "display", atEnd: "none" }
			], callback));
		} else {
			jQuery([backstage.panel, backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place, macroName, params)
{
	var backstageTask = config.tasks[params[0]];
	if(!backstageTask) return;
	createTiddlyButton(place, backstageTask.text, backstageTask.tooltip, function(e) {
		backstage.switchTab(params[0]);
		return false;
	});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place, macroName, params, wikifier, paramString, tiddler)
{
	if(readOnly) {
		createTiddlyElement(place, "div", null, "marked", this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place, this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title, this.step1Html);
	var name, s = wizard.getElement("selTypes");
	for(name in config.adaptors) {
		var e = createTiddlyElement(s, "option", null, null, config.adaptors[name].serverLabel || name);
		e.value = name;
	}
	if(config.defaultAdaptor) s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(name in feeds) {
		e = createTiddlyElement(s, "option", null, null, name);
		e.value = name;
	}
	wizard.setValue("feeds", feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{ caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen }]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var i, tagged = store.getTaggedTiddlers("systemServer", "title");
	for(i = 0; i < tagged.length; i++) {
		var title = tagged[i].title;
		feeds[title] = {
			title: title,
			url: store.getTiddlerSlice(title, "URL"),
			workspace: store.getTiddlerSlice(title, "Workspace"),
			workspaceList: store.getTiddlerSlice(title, "WorkspaceList"),
			tiddlerFilter: store.getTiddlerSlice(title, "TiddlerFilter"),
			serverType: store.getTiddlerSlice(title, "Type") || "file",
			description: store.getTiddlerSlice(title, "Description")
		};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName", f.serverType);
		wizard.setValue("feedHost", f.url);
		wizard.setValue("feedWorkspace", f.workspace);
		wizard.setValue("feedWorkspaceList", f.workspaceList);
		wizard.setValue("feedTiddlerFilter", f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var file = this.value;
	file = file.replace(/^C:\\fakepath\\/i, ''); // remove fakepath (chrome/opera/safari)
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
			file = this.files[0].fileName; // REQUIRES PRIVILEGES.. NULL otherwise
		} catch (ex) {
			// non-priv fallback: combine filename with path to current document
			var path = tw.io.getOriginalLocalPath();
			var slashpos = path.lastIndexOf('/');
			if (slashpos == -1) slashpos = path.lastIndexOf('\\');
			if (slashpos != -1) path = path.substr(0, slashpos + 1); // remove filename, leave trailing slash
			file = path + file;
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(path)
{
	if(!path) return path;
	// use "/" for cross-platform consistency
	path = path.replace(/\\/g, "/");

	var t = path.split(":");
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		// input is already a URL
		return path;
	}

	var p = t[1] || t[0]; // remove drive letter (if any)
	if(p.substr(0, 1) == "/") {
		// path is absolute, add protocol + domain + extra slash (if drive letter)
		return document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + path;
	}

	// path is relative, add current document protocol + domain + path
	var c = document.location.href.replace(/\\/g, "/");
	var pos = c.lastIndexOf("/");
	if(pos != -1)
		c = c.substring(0, pos); // remove filename
	return c + "/" + p;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor", adaptor);
	wizard.setValue("serverType", serverType);
	wizard.setValue("host", url);
	adaptor.openHost(url, null, wizard, me.onOpenHost);
	wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context, wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	adaptor.getWorkspaceList(context, wizard, me.onGetWorkspaceList);
	wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context, wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context", context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length == 1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		context.adaptor.openWorkspace(workspace, context, wizard, me.onOpenWorkspace);
		wizard.setValue("workspace", workspace);
		wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title, me.step2Html);
	var i, s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(i = 0; i < context.workspaces.length; i++) {
		var e = createTiddlyElement(s, "option", null, null, context.workspaces[i].title);
		e.value = context.workspaces[i].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace", null, false, true);
		for(i = 1; i < list.length; i++) {
			if(context.workspaces.findByField("title", list[i].value) == null) {
				e = createTiddlyElement(s, "option", null, null, list[i].value);
				e.value = list[i].value;
			}
		}
	}
	if(workspace) {
		wizard.getElement("txtWorkspace").value = workspace;
	}
	wizard.setButtons([{ caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace }]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	wizard.getElement("txtWorkspace").value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace", workspace);
	var context = wizard.getValue("context");
	adaptor.openWorkspace(workspace, context, wizard, me.onOpenWorkspace);
	wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context, wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var browse = wizard.getElement("txtBrowse");
	if (browse.files) context.file = browse.files[0]; // for HTML5 FileReader
	adaptor.getTiddlerList(context, wizard, me.onGetTiddlerList, wizard.getValue("feedTiddlerFilter"));
	wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context, wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		var error = context.statusText || me.errorGettingTiddlerList;
		if(context.host.indexOf("file://") === 0) {
			error = me.errorGettingTiddlerListFile;
		} else {
			error = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :
				me.errorGettingTiddlerListHttp;
		}
		wizard.setButtons([{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }], "");
		jQuery("span.status", wizard.footerEl).html(error); // so error message can be html
		return;
	}

	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var i = 0; i < context.tiddlers.length; i++) {
			var tiddler = context.tiddlers[i];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text, 100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a, b) { return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1) });

	// Display the listview
	wizard.addStep(me.step3Title, me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper, markList);
	var listView = ListView.create(listWrapper, listedTiddlers, me.listViewTemplate);
	wizard.setValue("listView", listView);
	wizard.setValue("context", context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
		{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel },
		{ caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport }
	]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType, host, workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType, host, workspace]);
	store.saveTiddler(txtSaveTiddler, txtSaveTiddler, text, me.serverSaveModifier, new Date(), ["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync", chkSync);

	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	for(var i = 0; i < rowNames.length; i++) {
		if(store.tiddlerExists(rowNames[i]))
			overwrite.push(rowNames[i]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}

	wizard.addStep(me.step4Title.format([rowNames.length]), me.step4Html);
	for(i = 0; i < rowNames.length; i++) {
		var linkHolder = document.createElement("div");
		createTiddlyLink(linkHolder, rowNames[i], true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(linkHolder, place);
	}
	wizard.setValue("remainingImports", rowNames.length);
	wizard.setButtons([
		{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }
	], me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(i = 0; i < rowNames.length; i++) {
		var context = {
			allowSynchronous: true,
			tiddler: tiddlers[tiddlers.findByField("title", rowNames[i])]
		};
		adaptor.getTiddler(rowNames[i], context, wizard, me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context, wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier,
		tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title, 'server', null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous) store.notify(tiddler.title, true);

	var remainingImports = wizard.getValue("remainingImports") - 1;
	wizard.setValue("remainingImports", remainingImports);

	if(remainingImports != 0) return;
	if(context.isSynchronous) {
		store.notifyAll();
		refreshDisplay();
	}
	var me = config.macros.importTiddlers;
	wizard.setButtons([
		{ caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose }
	], me.statusDoneImport);
	autoSaveChanges();
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.docsUrl = 'https://classic.tiddlywiki.com/#HowToUpgrade';

config.macros.upgrade.getSourceURL = function()
{
	return config.options.txtUpgradeCoreURI || config.macros.upgrade.source;
};

config.macros.upgrade.loadLatestCore = function(onSuccess, onError)
{
	ajaxReq({
		type: "GET",
		url: this.getSourceURL(),
		processData: false,
		success: onSuccess,
		error: onError
	});
};

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place, this.wizardTitle);
	w.addStep(this.step1Title, this.step1Html.format([
		this.getSourceURL(),
		this.getSourceURL().replace(/^https:\/\//, ''),
		this.docsUrl
	]));
	w.setButtons([{
		caption: this.upgradeLabel,
		tooltip: this.upgradePrompt,
		onClick: this.onClickUpgrade
	}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(!window.allowSave()) {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}

	w.setButtons([], me.statusPreparingBackup);
	var localPath = tw.io.getOriginalLocalPath();
	var backupPath = getBackupPath(localPath, me.backupExtension);
	var original = loadOriginal(localPath);

	w.setButtons([], me.statusSavingBackup);
	var backupSuccessOrPending = copyFile(backupPath, localPath) || saveFile(backupPath, original);
	if(!backupSuccessOrPending) {
		w.setButtons([], me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}

	// make sure both the backup is saved and tw.io.loadFile works before proceeding
	tw.io.loadFile(backupPath, function(backupContent) {
		if(!backupContent) {
			w.setButtons([], me.errorVerifyingBackup.format([me.docsUrl]));
			return;
		}

		w.setValue("backupPath", backupPath);

		w.setButtons([], me.statusLoadingCore);
		var sourceURL = me.getSourceURL();
		me.loadLatestCore(function(data, textStatus, jqXHR) {
			me.onLoadCore(true, w, jqXHR.responseText, sourceURL, jqXHR);
		}, function(jqXHR, textStatus, errorThrown) {
			me.onLoadCore(false, w, null, sourceURL, jqXHR);
		});
	});

	return false;
};

config.macros.upgrade.onLoadCore = function(status, w, responseText, url, xhr)
{
	var me = config.macros.upgrade;
	var errMsg;
	if(!status) errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer) errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([], errMsg);
		alert(errMsg);
		return;
	}

	var step2 = [me.step2Html_downgrade, me.step2Html_restore, me.step2Html_upgrade][compareVersions(version, newVer) + 1];
	w.addStep(me.step2Title, step2.format([formatVersion(newVer), formatVersion(version)]));
	w.setButtons([
		{ caption: me.startLabel,  tooltip: me.startPrompt,  onClick: function() {
			config.macros.upgrade.onStartUpgrade(w, responseText);
		} },
		{ caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel }
	]);
};

config.macros.upgrade.onStartUpgrade = function(wizard, newCoreHtml)
{
	wizard.setButtons([], config.macros.upgrade.statusSavingCore);
	var localPath = tw.io.getOriginalLocalPath();
	saveFile(localPath, newCoreHtml);

	wizard.setButtons([], config.macros.upgrade.statusReloadingCore);
	var backupPath = wizard.getValue("backupPath");
	var newLocation = addUpgradePartsToURI(document.location.toString(), backupPath);
	window.setTimeout(function () { window.location = newLocation }, 10);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title, me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /version = \{\s*title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return !m ? null : {
		title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])
	};
};

// a helper, splits uri into parts, passes the map of parts to modify and glues parts back
function changeUri(uri, modify)
{
	var uriPartsRE = /^(?:([\w:]+)\/\/)?([^\/\?#]+)?([^\?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;
	var match = uriPartsRE.exec(uri) || [null, '', '', '', '', ''];
	var parts = {
		scheme:	match[1],
		host:	match[2],
		path:	match[3],
		query:	match[4],
		hash:	match[5]
	};
	modify(parts);
	var newScheme = parts.scheme === undefined ? '' : (parts.scheme + '//'),
	    newHost   = parts.host || '',
	    newPath   = parts.path || '',
	    newQuery  = parts.query ? ('?' + parts.query) : '',
	    newHash   = parts.hash   === undefined ? '' : ('#' + parts.hash);
	return newScheme + newHost + newPath + newQuery + newHash;
}

function addUpgradePartsToURI(uri, backupPath)
{
	return changeUri(uri, function(uriParts)
	{
		var newParamifier = 'upgrade:[[' + encodeURI(backupPath) + ']]';
		uriParts.hash = (uriParts.hash ? uriParts.hash + '%20' : '') + newParamifier;

		var newQuery = "time=" + new Date().convertToYYYYMMDDHHMM();
		uriParts.query = (uriParts.query ? uriParts.query + '&' : '') + newQuery;
	});
}

function stripUpgradePartsFromURI(uri)
{
	return changeUri(uri, function(uriParts)
	{
		var queryParts = uriParts.query.split('&'),
		    hashParts = uriParts.hash.split('%20'); // splits paramifiers with a space in argument

		for(var i = 0; i < queryParts.length; i++)
			if(queryParts[i].indexOf('time=') == 0)
				queryParts.splice(i--, 1);

		// relies on the upgrade paramifier being added to the end of hash
		for(i = 0; i < hashParts.length; i++)
			if(hashParts[i].indexOf('upgrade:') == 0)
				hashParts = hashParts.slice(0, i);

		uriParts.query = queryParts.join('&');
		uriParts.hash = hashParts.join('%20') || undefined;
	});
}

function upgradeFrom(path)
{
	tw.io.loadFile(path, function(oldTw) {
		var importStore = new TiddlyWiki();
		importStore.importTiddlyWiki(oldTw);
		importStore.forEachTiddler(function(title, tiddler) {
			if(!store.getTiddler(title)) {
				store.addTiddler(tiddler);
			}
		});

		refreshDisplay();
		saveChanges();
		alert(config.messages.upgradeDone.format([formatVersion()]));
		window.location = stripUpgradePartsFromURI(window.location.toString());
	});
}

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place, macroName, params, wikifier, paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place, this.wizardTitle);
	wizard.addStep(this.step1Title, this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper, markList);
	listWrapper.setAttribute("refresh", "macro");
	listWrapper.setAttribute("macroName", "plugins");
	listWrapper.setAttribute("params", paramString);
	this.refresh(listWrapper, paramString);
};

config.macros.plugins.refresh = function(listWrapper, paramString)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper, function(e, rowName) {
		if(e.checked) selectedRows.push(e.getAttribute("rowName"));
	});
	jQuery(listWrapper).empty();

	var plugins = installedPlugins.slice(0);
	// not all plugins are installed, gather info about those, too
	var i, tiddler, p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(i = 0; i < configTiddlers.length; i++) {
		tiddler = configTiddlers[i];
		if(plugins.findByField("title", tiddler.title) != null) continue;

		p = getPluginInfo(tiddler);
		p.executed = false;
		p.log.splice(0, 0, this.skippedText);
		plugins.push(p);
	}

	for(i = 0; i < plugins.length; i++) {
		p = plugins[i];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[i].title) != -1;
	}

	if(plugins.length == 0) {
		createTiddlyElement(listWrapper, "em", null, null, this.noPluginText);
		wizard.setButtons([]);
	} else {
		var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
		var listView = ListView.create(listWrapper, plugins, template, this.onSelectCommand);
		wizard.setValue("listView", listView);
		if(!readOnly) {
			var me = config.macros.plugins;
			wizard.setButtons([
				{ caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag },
				{ caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete }
			]);
		}
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var i = 0; i < rowNames.length; i++) {
			store.setTiddlerTag(rowNames[i], false, "systemConfig");
		}
		autoSaveChanges();
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var i = 0; i < rowNames.length; i++) {
				store.removeTiddler(rowNames[i]);
				story.closeTiddler(rowNames[i], true);
			}
		}
		autoSaveChanges();
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea) return null;

	if(!msgArea.hasChildNodes()) {
		var toolbar = createTiddlyElement(msgArea, "div", null, "messageArea__toolbar messageToolbar");
		var btn = createTiddlyButton(toolbar, '', config.messages.messageClose.tooltip, clearMessage,
			"button messageToolbar__button");

		btn.innerHTML = tw.assets.icons.closeSvg;
		// inline SVG is unsupported in old FireFox
		if(window.HTMLUnknownElement && btn.firstChild instanceof window.HTMLUnknownElement) {
			btn.innerHTML = config.messages.messageClose.text;
		} else {
			btn.classList.add('messageToolbar__button_withIcon');
		}
	}
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea, "div", null, "messageArea__text");
}

function displayMessage(text, link)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(!link) {
		createTiddlyText(e, text);
	} else {
		createTiddlyElement(e, "a", null, null, text, { href: link, target: "_blank" });
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		jQuery(msgArea).empty();
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{ name: "SystemSettings", notify: onSystemSettingsChange },
	{ name: "StyleSheetLayout", notify: refreshStyles },
	{ name: "StyleSheetColors", notify: refreshStyles },
	{ name: "StyleSheet", notify: refreshStyles },
	{ name: "StyleSheetPrint", notify: refreshStyles },
	{ name: "PageTemplate", notify: refreshPageTemplate },
	{ name: "SiteTitle", notify: refreshPageTitle },
	{ name: "SiteSubtitle", notify: refreshPageTitle },
	{ name: "WindowTitle", notify: refreshPageTitle },
	{ name: "ColorPalette", notify: refreshColorPalette },
	{ name: null, notify: refreshDisplay }
];

config.refreshers = {
	link: function(e, changeList)
	{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e, title);
		return true;
	},

	tiddler: function(e, changeList)
	{
		if (startingUp) return true; // #147
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
			story.refreshTiddler(title, template, true);
		else
			refreshElements(e, changeList);
		return true;
	},

	content: function(e, changeList)
	{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.macroArgs; // #154
		if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.tiddler.transclude(e, title, args);
			return true;
		} else
			return false;
	},

	macro: function(e, changeList)
	{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e, params);
		return true;
	}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root, changeList)
{
	var i, nodes = root.childNodes;
	for(i = 0; i < nodes.length; i++) {
		var e = nodes[i], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = refresher ? refresher(e, changeList) : false;
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e, changeList);
	}
}

function applyHtmlMacros(root, tiddler)
{
	for(var e = root.firstChild; !!e; e = nextChild) {
		// macros can manipulate DOM, so we remember nextChild before invokeMacro
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p + 1);
					macro = macro.substr(0, p);
				}
				invokeMacro(e, macro, params, null, tiddler);
			}
		}
		if(e.hasChildNodes()) applyHtmlMacros(e, tiddler);
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes, i;
	if(display) {
		nodes = display.childNodes;
		for(i = nodes.length - 1; i >= 0; i--)
			stash.appendChild(nodes[i]);
	}
	var wrapper = document.getElementById("contentWrapper");

	if(!title || !store.isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!store.isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable

	wrapper.innerHTML = store.getRecursiveTiddlerText(title, null, 10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	jQuery(display).empty();
	if(!display)
		display = createTiddlyElement(wrapper, "div", story.containerId());
	nodes = stash.childNodes;
	for(i = nodes.length - 1; i >= 0; i--)
		display.appendChild(nodes[i]);
	jQuery(stash).remove();
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e, hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e, hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlainText(store.getTiddlerText("WindowTitle", ""), null, tiddler);
}

function refreshStyles(title, doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title, "", 10), title, doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

tw.options = {
	defaults: {},
	define: function(name, defaultValue, description) {
		this.defaults[name] = defaultValue;
		if(config.options[name] === undefined) config.options[name] = defaultValue;
		if(description) config.optionsDesc[name] = description;
	},
	hasDefaultValue: function(name) {
		return config.options[name] == this.defaults[name] ||
		       config.options[name] === undefined;
	}
};

for(var name in config.options) {
	tw.options.define(name, config.options[name], config.optionsDesc[name]);
}

config.optionHandlers = {
	'txt': {
		get: function(name) { return encodeCookie(config.options[name].toString()) },
		set: function(name, value) { config.options[name] = decodeCookie(value) }
	},
	'chk': {
		get: function(name) { return config.options[name] ? 'true' : 'false' },
		set: function(name, value) { config.options[name] = value == 'true' }
	}
};

function setOption(name, value)
{
	var optType = name.substr(0, 3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name, value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
	var optType = name.substring(0, 3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ?
		config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
	if(safeMode) return;
	loadCookies();
	loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
	var cookieList = document.cookie.split(';');
	var i, cookies = {};
	for(i = 0; i < cookieList.length; i++) {
		var p = cookieList[i].indexOf('=');
		if(p != -1) {
			var name = jQuery.trim(cookieList[i].substring(0, p));
			var value = jQuery.trim(cookieList[i].substring(p + 1));
			cookies[name] = value;
		}
	}
	return cookies;
}

function loadCookies()
{
	var i, cookies = getCookies();
	if(cookies['TiddlyWikiClassicOptions']) // TW291 and later //#159
		cookies = cookies['TiddlyWikiClassicOptions'].replace(/%22/g, '"').replace(/%25/g, '%').decodeHashMap(); // #159
	else if(cookies['TiddlyWikiOptions']) // TW290 beta //#159
		cookies = cookies['TiddlyWikiOptions'].replace(/%25/g, '%').decodeHashMap(); // #159
	else if(cookies['TiddlyWiki']) // TW281 and earlier
		cookies = cookies['TiddlyWiki'].decodeHashMap();

	for(i in cookies) {
		if(config.optionsSource[i] != 'setting') {
			setOption(i, cookies[i]);
		}
	}
}

function loadSystemSettings()
{
	var key, settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for(key in settings) {
		setOption(key, settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange()
{
	if(!startingUp) {
		loadSystemSettings();
	}
}

function saveOption(name)
{
	if(safeMode) return;
	if(name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}

	saveCookie(name);
	if(config.optionsSource[name] == 'setting') {
		saveSystemSetting(name, true);
	}
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
	var key, cookies = {};
	for(key in config.options) {
		if(tw.options.hasDefaultValue(key)) continue;
		var value = getOption(key);
		value = value == null ? 'false' : value;
		cookies[key] = value;
	}
	document.cookie = 'TiddlyWikiClassicOptions='
		+ String.encodeHashMap(cookies).replace(/%/g, '%25').replace(/"/g, '%22')
		+ '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';

	// clean up cookies saved in an earlier format, before TW291 (#159)
	cookies = getCookies();
	for(var c in cookies) {
		var optType = c.substring(0, 3);
		if(config.optionHandlers[optType])
			removeCookie(c);
	}
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
	if(systemSettingSave) {
		window.clearTimeout(systemSettingSave);
	}
	systemSettingSave = window.setTimeout(function() {
		var tiddler = store.getTiddler('SystemSettings');
		autoSaveChanges(null, [tiddler]);
	}, 1000);
}

function saveSystemSetting(name, saveFile)
{
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title, name);
	var isUnchanged = slice === getOption(name);
	if(readOnly || isUnchanged) return;

	var slices = store.calcAllSlices(title);
	for(var key in config.optionsSource) {
		var value = getOption(key) || '';
		if(slices[key] !== value) {
			slices[key] = value;
		}
	}

	var text = [];
	for(key in slices) {
		text.push('%0: %1'.format([key, slices[key]]));
	}
	text = text.sort().join('\n');

	var storeWasDirty = store.isDirty();
	var tiddler = store.getTiddler(title);
	if(tiddler) {
		tiddler.text = text;
		tiddler = store.saveTiddler(tiddler);
	} else {
		tiddler = store.saveTiddler(title, title, text, 'System',
			new Date(), ['excludeLists'], config.defaultCustomFields);
	}
	if(saveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re, function($0) { return String.fromCharCode(eval($0.replace(/[&#;]/g, ''))) });
}

config.macros.option.genericCreate = function(place, type, opt, className, desc)
{
	var typeInfo = config.macros.option.types[type];
	var text = desc != 'no' ? (config.optionsDesc[opt] || opt) : null;
	var attributes = { option: opt };
	if(typeInfo.typeValue) attributes.type = typeInfo.typeValue;
	if(config.optionsDesc[opt]) attributes.title = config.optionsDesc[opt];
	var c = createTiddlyElement(place, typeInfo.elementType, null, className || typeInfo.className, text, attributes);
	c[typeInfo.eventName] = typeInfo.onChange;
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute('option');
	if(opt) {
		var optType = opt.substring(0, 3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt, handler.valueField,
				this[handler.valueField], handler.elementType, this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: 'input',
		valueField: 'value',
		eventName: 'onchange',
		className: 'txtOptionInput',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: 'input',
		valueField: 'checked',
		eventName: 'onclick',
		className: 'chkOptionInput',
		typeValue: 'checkbox',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt, valueField, value, elementType, sourceEditor)
{
	config.options[opt] = value;
	saveOption(opt);

	jQuery(elementType + '[option=' + opt + ']').each(function(i, editor) {
		if(editor != sourceEditor) editor[valueField] = value;
	});
};

config.macros.option.handler = function(place, macroName, params, wikifier, paramString)
{
	params = paramString.parseParams('anon', null, true, false, false);
	var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params, 'name', null);
	var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params, 'class', null);
	var desc = getParam(params, 'desc', 'no');
	var type = opt.substring(0, 3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place, type, opt, className, desc);
};

config.macros.options.handler = function(place, macroName, params, wikifier, paramString)
{
	params = paramString.parseParams('anon', null, true, false, false);
	var showUnknown = getParam(params, 'showUnknown', 'no');
	var wizard = new Wizard();
	wizard.createWizard(place, this.wizardTitle);
	wizard.addStep(this.step1Title, this.step1Html);
	var markList = wizard.getElement('markList');
	var chkUnknown = wizard.getElement('chkUnknown');
	chkUnknown.checked = showUnknown == 'yes';
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement('div');
	markList.parentNode.insertBefore(listWrapper, markList);
	wizard.setValue('listWrapper', listWrapper);
	this.refreshOptions(listWrapper, showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper, showUnknown)
{
	var n, opts = [];
	for(n in config.options) {
		var isUnknown = !config.optionsDesc[n];
		if(!isUnknown || showUnknown) opts.push({
			option: '',
			name: n,
			lowlight: isUnknown,
			description: config.optionsDesc[n] || this.unknownDescription
		});
	}
	opts.sort(function(a, b) {
		var nameA = a.name.substring(3);
		var nameB = b.name.substring(3);
		return nameA < nameB ? -1 : (nameA == nameB ? 0 : +1);
	});

	ListView.create(listWrapper, opts, this.listViewTemplate);
	for(var i = 0; i < opts.length; i++) {
		var type = opts[i].name.substring(0, 3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[i].colElements['option'], type, opts[i].name, null, 'no');
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue('listWrapper');
	jQuery(listWrapper).empty();
	config.macros.options.refreshOptions(listWrapper, this.checked);
	return false;
};

//--
//-- Saving
//--

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	var hasDirtyStore = store && store.isDirty && store.isDirty();
	var hasDirtyStory = story && story.areAnyDirty && story.areAnyDirty();
	if(hasDirtyStore || hasDirtyStory) return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(!(store && store.isDirty && store.isDirty()) || window.hadConfirmExit !== false) return;
	if(confirm(config.messages.unsavedChangesWarning)) saveChanges();
}

function updateLanguageAttribute(s)
{
	if(!config.locale) return s;
	var m = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/.exec(s);
	if(!m) return s;

	var htmlTag = m[1];
	if(m[2]) htmlTag += ' xml:lang="' + config.locale + '"';
	if(m[3]) htmlTag += ' lang="' + config.locale + '"';
	htmlTag += ">";

	return s.substr(0, m.index) + htmlTag + s.substr(m.index + m[0].length);
}

function updateMarkupBlock(s, blockName, tiddlerName)
{
	return tw.textUtils.replaceChunk(s,
		"<!--%0-START-->".format([blockName]),
		"<!--%0-END-->".format([blockName]),
		"\n" + store.getRecursiveTiddlerText(tiddlerName, "") + "\n");
}

function updateOriginal(original, posDiv, localPath)
{
	if(!posDiv) posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0, posDiv[0] + startSaveArea.length) + "\n" +
		store.allTiddlersAsHtml() + "\n" +
		original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = tw.textUtils.replaceChunk(revised, "<title" + ">", "</title" + ">", " " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised, "PRE-HEAD", "MarkupPreHead");
	revised = updateMarkupBlock(revised, "POST-HEAD", "MarkupPostHead");
	revised = updateMarkupBlock(revised, "PRE-BODY", "MarkupPreBody");
	revised = updateMarkupBlock(revised, "POST-SCRIPT", "MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea divs
	if(!original) return null;
	var posOpeningDiv = original.search(startSaveAreaRE);
	var limitClosingDiv = original.indexOf("<" + "!--POST-STOREAREA--" + ">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<" + "!--POST-BODY-START--" + ">");
	var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
	var posClosingDiv = original.lastIndexOf(endSaveArea, start);
	if(posClosingDiv == -1)
		posClosingDiv = original.lastIndexOf(endSaveAreaCaps, start);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv, posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty, tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty, tiddlers);
}

// get the full HTML of the original file
function loadOriginal(localPath, callback)
{
	if(!callback) return loadFile(localPath) || window.originalHTML || recreateOriginal();

	tw.io.loadFile(localPath, function(result, details) {
		if(typeof result == 'string') {
			callback(result, details);
		} else {
			var original = window.originalHTML || recreateOriginal();
			callback(original);
		}
	});
}

// reconstruct original HTML file content from current document memory
function recreateOriginal()
{
	// construct doctype
	var content = "<!DOCTYPE ";
	var t = document.doctype;
	if (!t)
		content += "html";
	else {
		content += t.name;
		if(t.publicId)
			content += ' PUBLIC "' + t.publicId + '"';
		else if(t.systemId)
			content += ' SYSTEM "' + t.systemId + '"';
	}
	content += ' "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"';
	content += '>\n';

	// append current document content
	content += document.documentElement.outerHTML;

	// clear 'savetest' marker
	content = content.replace(/<div id="saveTest">savetest<\/div>/, '<div id="saveTest"></div>');
	content = content.replace(/script><applet [^\>]*><\/applet>/g, 'script>');
	// newline before head tag
	content = content.replace(/><head>/, '>\n<head>');
	// newlines before/after end of body/html tags
	content = content.replace(/\n\n<\/body><\/html>$/, '</' + 'body>\n</' + 'html>\n'); // #170
	// meta tag terminators
	content = content.replace(/(<(meta) [^\>]*[^\/])>/g, '$1 />');
	// decode LT/GT entities in noscript
	content = content.replace(/<noscript>[^\<]*<\/noscript>/,
		function(m) { return m.replace(/&lt;/g, '<').replace(/&gt;/g, '>') });
	// encode copyright symbols (UTF-8 to HTML entity)
	content = content.replace(/<div id="copyright">[^\<]*<\/div>/,
		function(m) { return m.replace(/\xA9/g, '&copy;') });

	return content;
}

// reconstruct the local path to TW itself
tw.io.getOriginalLocalPath = function()
{
	return getLocalPath(document.location.toString());
};

// Save tiddlywiki (but not backup or anything else)
tw.io.knownSaveMainFailures = {
	failedToLoadOriginal: 1,
	invalidFile: 2
};

// Save this tiddlywiki with the pending changes
tw.io.saveMainAndReport = function(callback)
{
	var localPath = tw.io.getOriginalLocalPath();
	var onLoadOriginal = function(original) {
		if(original == null) {
			alert(msg.cantSaveError);
			if(store.tiddlerExists(msg.saveInstructions))
				story.displayTiddler(null, msg.saveInstructions);

			return callback(false, {
				reason: tw.io.knownSaveMainFailures.failedToLoadOriginal
			});
		}

		var posDiv = locateStoreArea(original);
		if(!posDiv) {
			alert(msg.invalidFileError.format([localPath]));

			return callback(false, {
				reason: tw.io.knownSaveMainFailures.invalidFile
			});
		}

		config.saveByDownload = false;
		config.saveByManualDownload = false;
		// chkPreventAsyncSaving is checked inside saveMain
		saveMain(localPath, original, posDiv, callback);
	};

	if(!config.options.chkPreventAsyncSaving) {
		loadOriginal(localPath, onLoadOriginal);
	} else {
		// useful when loadOriginal is overwritten without support of callback
		// or when an extension relies saveChanges being a sync function
		var original = loadOriginal(localPath);
		onLoadOriginal(original);
	}
};

function saveChanges(onlyIfDirty, tiddlers)
{
	if(onlyIfDirty && !store.isDirty()) return;

	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	if(!window.allowSave()) {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null, msg.saveInstructions);
		return;
	}

	tw.io.saveMainAndReport(function postSave(savedOrPending, details) {
		var co = config.options;
		if (!config.saveByDownload && !config.saveByManualDownload && details && details.original) {
			var localPath = tw.io.getOriginalLocalPath();
			if(co.chkSaveBackups) saveBackup(localPath, details.original);
			if(co.chkSaveEmptyTemplate) saveEmpty(localPath, details.original);
			if(co.chkGenerateAnRssFeed) saveRss(localPath);
		}

		if(co.chkDisplayInstrumentation)
			displayMessage("saveChanges " + (new Date() - t0) + " ms");
	});
}

function saveMain(localPath, original, posDiv, callback)
{
	var reportStatusAndHandle = function(successOrPending, localPath, revised) {
		if(successOrPending) {
			tw.io.onSaveMainSuccess(config.saveByDownload ?
				getDataURI(revised) : "file://" + localPath,
				revised, original);
		} else {
			tw.io.onSaveMainFail();
		}
	};
	try {
		var revised = updateOriginal(original, posDiv, localPath);

		if(!callback || config.options.chkPreventAsyncSaving) {
			var savedOrPending = tw.io.saveFile(localPath, revised);
			reportStatusAndHandle(savedOrPending, localPath, revised);
			if(callback) callback(savedOrPending, {
				original: original
			});
		} else tw.io.saveFile(localPath, revised, function(success, details) {
			reportStatusAndHandle(success, localPath, revised);
			details.original = original;
			callback(success, details);
		});
	} catch (ex) {
		tw.io.onSaveMainFail(ex);
		if(callback) callback(false, { original: original });
	}
}

tw.io.onSaveMainSuccess = function(urlSaved, savedHtml, original) {
	if (!config.saveByManualDownload) {
		displayMessage(
			// set by HTML5DownloadSaveFile()
			config.saveByDownload ?
				config.messages.mainDownload :
				config.messages.mainSaved,
			urlSaved);
	}

	store.setDirty(false);
};

tw.io.onSaveMainFail = function(catchedExeption) {
	alert(config.messages.mainFailed);
	if(catchedExeption) showException(catchedExeption);
};

function saveBackup(localPath, original)
{
	var backupPath = getBackupPath(localPath);
	var backupSuccess = copyFile(backupPath, localPath) || saveFile(backupPath, original);
	if(backupSuccess)
		displayMessage(config.messages.backupSaved, "file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath, original, posDiv)
{
	posDiv = posDiv || locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.emptyFailed);
		return;
	}

	var emptyPath, slashPosition;
	if((slashPosition = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0, slashPosition) + "/";
	else if((slashPosition = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0, slashPosition) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";

	var empty = original.substr(0, posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath, empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved, "file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

// Translate URL to local path [Preemption]
window.getLocalPath = window.getLocalPath || function(origPath)
{
	var originalPath = convertUriToUTF8(origPath, config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0, argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0, hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/", "g"), "\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/", "g"), "\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/", "g"), "\\");
	return localPath;
};

function getBackupPath(localPath, filenameSuffix, extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder || ".";
	var backupPath = localPath.substring(0, dirPathPos) + slash + backupFolder + localPath.substring(dirPathPos);
	backupPath = backupPath.substring(0, backupPath.lastIndexOf(".")) + ".";
	if(filenameSuffix) {
		var illegalFilenameCharacterOrSpaceRE = /[\\\/\*\?\":<> ]/g;
		backupPath += filenameSuffix.replace(illegalFilenameCharacterOrSpaceRE, "_") + ".";
	}
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0, localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath, generateRss()))
		displayMessage(config.messages.rssSaved, "file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler, uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text, null, tiddler).htmlEncode() + "</description>\n";
	for(var i = 0; i < tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s += "<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle", ""),
		null, tiddler).htmlEncode() + "</title" + ">");
	if(u) s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle", ""),
		null, tiddler).htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified", "excludeLists");
	var i, n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length - config.numRssItems;
	for(i = tiddlers.length - 1; i >= n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i], u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

// Copy a file in filesystem [Preemption]
window.copyFile = window.copyFile || function(dest, source)
{
	return config.browser.isIE ? ieCopyFile(dest, source) : false;
};

// Save a file in filesystem [Preemption]
window.saveFile = window.saveFile || function(fileUrl, content)
{
	var r = mozillaSaveFile(fileUrl, content);
	if(!r)
		r = ieSaveFile(fileUrl, content);
	if(!r)
		r = javaSaveFile(fileUrl, content);
	if(!r)
		r = HTML5DownloadSaveFile(fileUrl, content);
	if(!r)
		r = manualSaveFile(fileUrl, content);
	return r;
};

// A placeholder method that can be overwritten/decorated by savers.
// In such a case, it's required to call callback on both success and fail.
// See details about the callback in tw.io.saveFile.
tw.io.asyncSaveFile = tw.io.asyncSaveFile || function(fileUrl, content, callback)
{
	callback(false, { reason: 'Async saving is not implemented' });
};

// The general save method to use
// ==============================
// If callback is set, tries to save in an async fashion and do callback(success: boolean, details: object)
// ⚠️ Some savers within window.saveFile, like download saving or Timimi don't care about the callback,
// so it can be called before actual saving is done (or even give false positives).
tw.io.saveFile = function(fileUrl, content, callback)
{
	if(!callback) return saveFile(fileUrl, content);

	tw.io.asyncSaveFile(fileUrl, content, function(success, details) {
		if(success) callback(success, details);
		else {
			result = saveFile(fileUrl, content);
			callback(result, {});
		}
	});
};

// Load a file from filesystem [Preemption]
window.loadFile = window.loadFile || function(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r === null) || (r === false))
		r = ieLoadFile(fileUrl);
	if((r === null) || (r === false))
		r = javaLoadFile(fileUrl);
	if((r === null) || (r === false))
		r = tw.io.xhrLoadFile(fileUrl);
	return r;
};

tw.io.xhrLoadFile = function(filePath, callback)
{
	try {
		var isAsync = !!callback;
		var url = 'file://' + (filePath[0] != '/' ? '/' : '') + encodeURIComponent(filePath);
		if(isAsync) {
			httpReq('GET', url, function(status, params, responseText, url, xhr) {
				callback(responseText, { xhr: xhr });
			});
		} else {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', url, isAsync);
			xhr.send(null);
			return xhr.responseText;
		}
	} catch(ex) {
		return callback ? callback(null) : null;
	}
};

// The general load method to use
// ==============================
// If callback is set, tries to load in an async fashion and do callback(result, details)
tw.io.loadFile = function(fileUrl, callback)
{
	if(!callback) return loadFile(fileUrl);

	tw.io.xhrLoadFile(fileUrl, function(result, details) {
		if(typeof result == 'string') {
			callback(result, details);
		} else {
			result = loadFile(fileUrl);
			callback(result);
		}
	});
};


function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	// Remove the filename, if present. Use trailing slash (i.e. "foo\bar\") if no filename.
	var pos = path.lastIndexOf("\\");
	if(pos == -1) pos = path.lastIndexOf("/");
	if(pos != -1) path = path.substring(0, pos + 1);

	// Walk up the path until we find a folder that exists
	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	// Walk back down the path, creating folders
	for(var i = scan.length - 1; i >= 0; i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath, 2, -1, 0);
	file.Write(convertUnicodeToHtmlEntities(content));
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath, 1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest, source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(!window.Components) return null;

	content = mozConvertUnicodeToUTF8(content);
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var file = Components.classes["@mozilla.org/file/local;1"]
			.createInstance(Components.interfaces.nsILocalFile);
		file.initWithPath(filePath);
		if(!file.exists())
			file.create(0, 0x01B4);// 0x01B4 = 0664
		var out = Components.classes["@mozilla.org/network/file-output-stream;1"]
			.createInstance(Components.interfaces.nsIFileOutputStream);
		out.init(file, 0x22, 0x04, null);
		out.write(content, content.length);
		out.flush();
		out.close();
		return true;
	} catch(ex) {
		return false;
	}
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(!window.Components) return null;

	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
		file.initWithPath(filePath);
		if(!file.exists())
			return null;
		var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"]
			.createInstance(Components.interfaces.nsIFileInputStream);
		inputStream.init(file, 0x01, 0x04, null);
		var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"]
			.createInstance(Components.interfaces.nsIScriptableInputStream);
		sInputStream.init(inputStream);
		var contents = sInputStream.read(sInputStream.available());
		sInputStream.close();
		inputStream.close();
		return mozConvertUTF8ToUnicode(contents);
	} catch(ex) {
		return false;
	}
}

function HTML5DownloadSaveFile(filePath, content)
{
	var link = document.createElement("a");
	if(link.download === undefined)
		return null;

	config.saveByDownload = true;
	var slashpos = filePath.lastIndexOf("/");
	if (slashpos == -1) slashpos = filePath.lastIndexOf("\\");
	var filename = filePath.substr(slashpos + 1);
	var uri = getDataURI(content);
	link.setAttribute("target", "_blank");
	link.setAttribute("href", uri);
	link.setAttribute("download", filename);
	document.body.appendChild(link);
	link.click();
	document.body.removeChild(link);
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function manualSaveFile(filePath, content)
{
	// FALLBACK for showing a link to data: URI
	config.saveByManualDownload = true;
	var slashpos = filePath.lastIndexOf("/");
	if (slashpos == -1) slashpos = filePath.lastIndexOf("\\");
	var filename = filePath.substr(slashpos + 1);
	var uri = getDataURI(content);
	displayMessage(config.messages.mainDownloadManual, uri);
	return true;
}

// construct data URI (using base64 encoding to preserve multi-byte encodings)
function getDataURI(data)
{
	return config.browser.isIE ?
		"data:text/html," + encodeURIComponent(data) :

		// manualConvertUnicodeToUTF8 was moved here from convertUnicodeToFileFormat
		// In 2.9.1, it was used only for FireFox but happened to fix
		// download saving non-ASCII in Chrome & Safari as well (see 949aff6)
		"data:text/html;base64," + encodeBase64(manualConvertUnicodeToUTF8(data));
}

function encodeBase64(data)
{
	if (!data) return "";
	var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	var out = "";
	var chr1, chr2, chr3 = "";
	var enc1, enc2, enc3, enc4 = "";
	for (var i = 0; i < data.length; )
	{
		chr1 = data.charCodeAt(i++);
		chr2 = data.charCodeAt(i++);
		chr3 = data.charCodeAt(i++);
		enc1 = chr1 >> 2;
		enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
		enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
		enc4 = chr3 & 63;
		if (isNaN(chr2)) enc3 = enc4 = 64;
		else if (isNaN(chr3)) enc4 = 64;
		out += keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);
		chr1 = chr2 = chr3 = enc1 = enc2 = enc3 = enc4 = "";
	}
	return out;
}

//--
//-- Filesystem utilities
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}


function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0, dst++).concat(c, utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0, dst++).concat(c, utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"]
			.createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s + fin : s;
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"]
			.createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re, function($0) { return "&#" + $0.charCodeAt(0).toString() + ";" });
}

function convertUriToUTF8(uri, charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"]
			.getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri, charSet);
}

// deprecated helper for backward-compatibility with elder extensions
// (browser/saving method-specific convertion is only needed in browser-specific savers)
function convertUnicodeToFileFormat(s)
{
	return s;
}

// deprecated helper for backward-compatibility with elder extensions
function convertUnicodeToUTF8(s)
{
	return s;
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host) return '';
	host = jQuery.trim(host);
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length - 1) == '/')
		host = host.substr(0, host.length - 1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host;
};

AdaptorBase.prototype.setContext = function(context, userParams, callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
//   host - uri of host (eg, "http://www.tiddlywiki.com/" or "www.tiddlywiki.com")
//   context is itself passed on as a parameter to the callback function
//   userParams - user settable object object that is passed on unchanged to the callback function
//   callback - optional function to be called on completion
// Return value is true if the request was successfully issued, false if this connector doesn't support openHost(),
//   or an error description string if there was a problem
// The callback parameters are callback(context)
//   context.status - true if OK, string if error
//   context.adaptor - reference to this adaptor object
//   userParams - parameters as originally passed into the openHost function
AdaptorBase.prototype.openHost = function(host, context, userParams, callback)
{
	this.host = host;
	context = this.setContext(context, userParams, callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() { context.callback(context, userParams) }, 10);
	return true;
};

// Open the specified workspace
//   workspace - name of workspace to open
//   context - passed on as a parameter to the callback function
//   userParams - user settable object object that is passed on unchanged to the callback function
//   callback - function to be called on completion
// Return value is true if the request was successfully issued
//   or an error description string if there was a problem
// The callback parameters are callback(context, userParams)
//   context.status - true if OK, false if error
//   context.statusText - error message if there was an error
//   context.adaptor - reference to this adaptor object
//   userParams - parameters as originally passed into the openWorkspace function
AdaptorBase.prototype.openWorkspace = function(workspace, context, userParams, callback)
{
	this.workspace = workspace;
	context = this.setContext(context, userParams, callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() { callback(context, userParams) }, 10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context, jqXHR)
{
	context.status = true;
	context.adaptor.store = new TiddlyWiki();
	if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
		context.statusText = config.messages.invalidFileError.format([context.host]);
		context.status = false;
	}
	context.complete(context, context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context, jqXHR)
{
	context.status = false;
	context.statusText = jqXHR.message;
	context.complete(context, context.userParams);
};

// Get the list of workspaces on a given server
//   context - passed on as a parameter to the callback function
//   userParams - user settable object object that is passed on unchanged to the callback function
//   callback - function to be called on completion
// Return value is true if the request was successfully issued,
//   false if this connector doesn't support getWorkspaceList(),
//   or an error description string if there was a problem
// The callback parameters are callback(context, userParams)
//   context.status - true if OK, false if error
//   context.statusText - error message if there was an error
//   context.adaptor - reference to this adaptor object
//   userParams - parameters as originally passed into the getWorkspaceList function
FileAdaptor.prototype.getWorkspaceList = function(context, userParams, callback)
{
	context = this.setContext(context, userParams, callback);
	context.workspaces = [{ title: "(default)" }];
	context.status = true;
	if(callback)
		window.setTimeout(function() { callback(context, userParams) }, 10);
	return true;
};

// Gets the list of tiddlers within a given workspace
//   context - passed on as a parameter to the callback function
//   userParams - user settable object object that is passed on unchanged to the callback function
//   callback - function to be called on completion
//   filter - filter expression
// Return value is true if the request was successfully issued,
//   or an error description string if there was a problem
// The callback parameters are callback(context, userParams)
//   context.status - true if OK, false if error
//   context.statusText - error message if there was an error
//   context.adaptor - reference to this adaptor object
//   context.tiddlers - array of tiddler objects
//   userParams - parameters as originally passed into the getTiddlerList function
FileAdaptor.prototype.getTiddlerList = function(context, userParams, callback, filter)
{
	context = this.setContext(context, userParams, callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		return context.complete(context, context.userParams);
	}
	var options = {
		type: "GET",
		url: context.host,
		file: context.file, // for HTML5 FileReader
		processData: false,
		success: function(data, textStatus, jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context, jqXHR);
		},
		error: function(jqXHR, textStatus, errorThrown) {
			context.xhr = jqXHR;
			FileAdaptor.loadTiddlyWikiError(context, jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context, userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title, tiddler) { context.tiddlers.push(tiddler) });
		}
		for(var i = 0; i < context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() { context.callback(context, userParams) }, 10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	return {
		uri: tiddler.fields['server.host'] + "#" + tiddler.title
	};
};

// Retrieve a tiddler from a given workspace on a given server
//   title - title of the tiddler to get
//   context - passed on as a parameter to the callback function
//   userParams - user settable object object that is passed on unchanged to the callback function
//   callback - function to be called on completion
// Return value is true if the request was successfully issued,
//   or an error description string if there was a problem
// The callback parameters are callback(context, userParams)
//   context.status - true if OK, false if error
//   context.statusText - error message if there was an error
//   context.adaptor - reference to this adaptor object
//   context.tiddler - the retrieved tiddler, or null if it cannot be found
//   userParams - parameters as originally passed into the getTiddler function
FileAdaptor.prototype.getTiddler = function(title, context, userParams, callback)
{
	context = this.setContext(context, userParams, callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	if(context.adaptor.store) {
		return context.complete(context, context.userParams);
	}
	var options = {
		type: "GET",
		url: context.host,
		processData: false,
		success: function(data, textStatus, jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context, jqXHR);
		},
		error: function(jqXHR, textStatus, errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context, jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context, userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context, userParams);
	} else {
		window.setTimeout(function() { context.callback(context, userParams) }, 10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

// Perform an http request using the jQuery ajax function
// fallback to privileged file I/O or HTML5 FileReader
function ajaxReq(args)
{
	if (args.file || args.url.startsWith("file"))  // LOCAL FILE
		return localAjax(args);
	return jQuery.ajax(args);
}

// perform local I/O and FAKE a minimal XHR response object
function localAjax(args)
{
	var success = function(data) {
		args.success(data, "success", { responseText: data });
	};
	var failure = function(who) {
		args.error({ message: who + ": cannot read local file" }, "error", 0);
	};

	if (args.file) try { // HTML5 FileReader (Chrome, FF20+, Safari, etc.)
		var reader = new FileReader();
		reader.onload = function(e)  { success(e.target.result) };
		reader.onerror = function(e) { failure("FileReader") };
		reader.readAsText(args.file);
		return true;
	} catch (ex) { ; }

	// local file I/O (IE, FF with security.fileuri.strict_origin_policy:false, etc.)
	try {
		var data = loadFile(getLocalPath(args.url));
		if (data) success(data);
		else failure("loadFile");
		return true;
	} catch (ex) { ; }

	return true;
}

// Perform an http request
//   type - GET/POST/PUT/DELETE
//   url - the source url
//   data - optional data for POST and PUT
//   contentType - optionalContent type for the data (defaults to application/x-www-form-urlencoded)
//   username - optional username for basic authentication
//   password - optional password for basic authentication
//   callback - function to call when there is a response
//   params - parameter object that gets passed to the callback for storing it's state
//   headers - optional hashmap of additional headers
//   allowCache - unless true, adds a "nocache=" parameter to the URL
// Return value is the underlying XMLHttpRequest object, or a string if there was an error
// Callback function is called like this:
//   callback(status, params, responseText, url, xhr)
//     status - true if OK, false if error
//     params - the parameter object provided to loadRemoteFile()
//     responseText - the text of the file
//     url - requested URL
//     xhr - the underlying XMLHttpRequest object
function httpReq(type, url, callback, params, headers, data, contentType, username, password, allowCache)
{
	var httpSuccess = function(xhr) {
		try {
			// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
			return (!xhr.status && location.protocol === "file:") ||
				(xhr.status >= 200 && xhr.status < 300) ||
				xhr.status === 304 || xhr.status === 1223;
		} catch(e) {}
		return false;
	};

	var options = {
		type: type,
		url: url,
		processData: false,
		data: data,
		cache: !!allowCache,
		beforeSend: function(xhr) {
			for(var i in headers)
				xhr.setRequestHeader(i, headers[i]);
		}
	};

	if(callback) {
		options.complete = function(xhr, textStatus) {
			if(httpSuccess(xhr))
				callback(true, params, xhr.responseText, url, xhr);
			else
				callback(false, params, null, url, xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	try {
		if(window.Components && window.netscape && window.netscape.security
		   && document.location.protocol.indexOf("http") == -1)
			window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	} catch (ex) {
	}
	return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Return TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "") +
		(v.nightly ? " (nightly " + v.nightly + ")" : "");
}

function compareVersions(v1, v2)
{
	var x1, x2, i, a = ["major", "minor", "revision"];
	for(i = 0; i < a.length; i++)
	{
		x1 = v1[a[i]] || 0;
		x2 = v2[a[i]] || 0;
		if(x1 < x2) return +1;
		if(x1 > x2) return -1;
	}
	x1 = v1.beta || Infinity;
	x2 = v2.beta || Infinity;
	return x1 < x2 ? +1 :
	       x1 > x2 ? -1 : 0;
}

function merge(dst, src, preserveExisting)
{
	for(var key in src)
		if(!preserveExisting || dst[key] === undefined)
			dst[key] = src[key];

	return dst;
}

// Get the target of an event
function resolveTarget(event)
{
	var obj = event.target || event.srcElement;
	// defeat Safari bug
	if(obj.nodeType == 3)
		obj = obj.parentNode;
	return obj;
}

// Return the description of an exception (string)
function exceptionText(ex, prependedMessage)
{
	var s = ex.description || ex.toString();
	return prependedMessage ? (prependedMessage + ":\n" + s) : s;
}

// Display an alert of an exception description with optional message
function showException(e, prependedMessage)
{
	alert(exceptionText(e, prependedMessage));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	if(!g.codes[name]) return "";
	if(g.currBrowser == null) {
		var i = 0;
		while(i < g.browsers.length - 1 && !g.browsers[i]())
			i++;
		g.currBrowser = i;
	}
	return g.codes[name][g.currBrowser];
}

function createTiddlyText(parent, text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent, caption, checked, onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type", "checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption, parent);
	return cb;
}

function createTiddlyElement(parent, element, id, className, text, attribs)
{
	var n, e = document.createElement(element);
	if(className != null) e.className = className;
	if(       id != null) e.setAttribute('id', id);
	if(     text != null) createTiddlyText(e, text);
	if(attribs) {
		for(n in attribs) e.setAttribute(n, attribs[n]);
	}
	if(parent != null) parent.appendChild(e);
	return e;
}

function createTiddlyButton(parent, text, tooltip, action, className, id, accessKey, customAttributes)
{
	var attributes = { href: 'javascript:;' };
	if(tooltip)   attributes.title = tooltip;
	if(accessKey) attributes.accessKey = accessKey;
	merge(attributes, customAttributes || {});

	var btn = createTiddlyElement(parent, 'a', id || null, className || 'button', text, attributes);
	if(action) btn.onclick = action;
	return btn;
}

function createExternalLink(place, url, label)
{
	var tooltip = config.messages.externalLinkTooltip;
	var link = createTiddlyElement(place, 'a', null, 'externalLink', label, {
		href: url,
		title: tooltip ? tooltip.format([url]) : url
	});
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	return link;
}

function getTiddlyLinkInfo(title, currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
	    var f;
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			f = config.messages.shadowedTiddlerToolTip;
			classes.pushUnique("shadow");
		} else {
			f = config.messages.undefinedTiddlerToolTip;
			classes.remove("shadow");
		}
		subTitle = f ? f.format([title]) : "";
	}
	if(typeof config.annotations[title] == "string")
		subTitle = config.annotations[title];
	return { classes: classes.join(" "), subTitle: subTitle };
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f, config.defaultCustomFields, true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target, title, null, true, null, fields, toggling);
	}
	clearMessage();
	return false;
}

function getTiddlerLinkHref(title)
{
	return window.location.toString().replace(/#.*$/, '') + story.getPermaViewHash([title]);
}

function createTiddlyLink(place, title, includeText, className, isStatic, linkedFromTiddler, noToggle)
{
	var title = jQuery.trim(title);
	var text = includeText ? title : null;
	var info = getTiddlyLinkInfo(title, className);
	var btn = isStatic ?
		createExternalLink(place, store.getTiddlerText("SiteUrl", null) + story.getPermaViewHash([title])) :
		createTiddlyButton(place, text, info.subTitle, onClickTiddlerLink, info.classes, '', '', {
			href: getTiddlerLinkHref(title)
		});
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh", "link");
	btn.setAttribute("tiddlyLink", title);
	if(noToggle)
		btn.setAttribute("noToggle", "true");
	if(linkedFromTiddler)
	{
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields", fields);
	}
	return btn;
}

function refreshTiddlyLink(e, title)
{
	var info = getTiddlyLinkInfo(title, e.className);
	e.className = info.classes;
	e.title = info.subTitle;
}

function createTiddlyDropDown(place, onchange, options, defaultValue)
{
	var sel = createTiddlyElement(place, "select");
	sel.onchange = onchange;

	for(var i = 0; i < options.length; i++)
	{
		var e = createTiddlyElement(sel, "option", null, null, options[i].caption);
		e.value = options[i].name;
		if(e.value == defaultValue)
			e.selected = true;
	}
	return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby && sortby.length) {
		store.sortTiddlers(tiddlers, sortby);
	}
	story.displayTiddlers(this, tiddlers);
	return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	jQuery(popup).addClass("taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[") == -1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby && sortby.length) {
			store.sortTiddlers(tagged, sortby);
		}
		var titles = [];
		for(var i = 0; i < tagged.length; i++) {
			if(tagged[i].title != title)
				titles.push(tagged[i].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup, "li"),
				lingo.openAllText.format([tag]), lingo.openAllTooltip, onClickTagOpenAll);
			openAll.setAttribute("tag", tag);
			openAll.setAttribute("sortby", sortby);
			createTiddlyElement(createTiddlyElement(popup, "li", null, "listBreak"), "div");
			for(i = 0; i < titles.length; i++) {
				createTiddlyLink(createTiddlyElement(popup, "li"), titles[i], true);
			}
		} else {
			createTiddlyElement(popup, "li", null, "disabled", lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup, "li", null, "listBreak"), "div");
		var link = createTiddlyLink(createTiddlyElement(popup, "li"), tag, false);
		createTiddlyText(link, lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place, tag, excludeTiddler, title, tooltip)
{
	var btn = createTiddlyButton(place, title || tag,
		(tooltip || config.views.wikified.tag.tooltip).format([tag]), onClickTag);
	btn.setAttribute("tag", tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler", excludeTiddler);
	return btn;
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this, "div", "popupTiddler");
		wikify(tiddler.text, popup, null, tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyPopup(place, caption, tooltip, tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place, caption, true);
		var btn = createTiddlyButton(place, glyph("downArrow"), tooltip, onClickTiddlyPopup, "tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place, caption);
	}
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var i = 0; i < lines.length; i++) {
		createTiddlyElement(popup, "li", null, "popupMessage", lines[i]);
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place, title, text)
{
	var btn = createTiddlyButton(place, title, null, onClickError, "errorButton");
	if(text) btn.setAttribute("errorText", text);
}
//-
//- Animation engine
//-

function Animator()
{
	// Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.running = 0;
	// ID of the timer used for animating
	this.timerID = 0;
	// List of animations in progress
	this.animations = [];
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var i = 0; i < arguments.length; i++)
		this.animations.push(arguments[i]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() { me.doAnimate(me) }, 10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var i = 0;
	while(i < me.animations.length) {
		if(me.animations[i].tick()) {
			i++;
		} else {
			me.animations.splice(i, 1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return 1 - ((Math.cos(progress * Math.PI) + 1) / 2);
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element, duration, properties, callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element, style, value)
{
	switch(style) {
		case "-tw-vertScroll":
			window.scrollTo(findScrollX(), value);
			break;
		case "-tw-horizScroll":
			window.scrollTo(value, findScrollY());
			break;
		default:
			element.style[style] = value;
			break;
	}
};

Morpher.prototype.stop = function()
{
	for(var i = 0; i < this.properties.length; i++) {
		var p = this.properties[i];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element, p.style, p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element, this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var i, progress = Animator.slowInSlowOut(Math.min(1, (currTime - this.startTime) / this.duration));
	for(i = 0; i < this.properties.length; i++) {
		var p = this.properties[i];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
				case undefined:
				case "style":
					var value = p.start + (p.end - p.start) * progress;
					this.assignStyle(this.element, p.style, template.format([value]));
					break;
				case "color":
					break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text, startElement, targetElement, unused)
{
	var e = createTiddlyElement(document.body, "div", null, "zoomer");
	createTiddlyElement(e, "div", null, null, text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{ style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px' },
		{ style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px' },
		{ style: 'width', start: Math.min(startElement.scrollWidth, winWidth),
		  end: Math.min(targetElement.scrollWidth, winWidth), template: '%0px', atEnd: 'auto' },
		{ style: 'height', start: Math.min(startElement.scrollHeight, winHeight),
		  end: Math.min(targetElement.scrollHeight, winHeight), template: '%0px', atEnd: 'auto' },
		{ style: 'fontSize', start: 8, end: 24, template: '%0pt' }
	];
	var c = function(element) { jQuery(element).remove() };
	return new Morpher(e, config.animDuration, p, c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	return new Morpher(targetElement, config.animDuration, [{
		style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)
	}]);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element, opening, unused, deleteMode)
{
	element.style.overflow = 'hidden';
	// Workaround a Firefox flashing bug
	if(opening) element.style.height = '0px';
	element.style.display = 'block';
	var height = element.scrollHeight;
	var props = [];
	var callback = null;
	if(opening) {
		props.push({ style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto' });
		props.push({ style: 'opacity', start: 0, end: 1, template: '%0' });
		props.push({ style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)' });
	} else {
		props.push({ style: 'height', start: height, end: 0, template: '%0px' });
		props.push({ style: 'display', atEnd: 'none' });
		props.push({ style: 'opacity', start: 1, end: 0, template: '%0' });
		props.push({ style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)' });
		switch(deleteMode) {
			case "all":
				callback = function(element, properties) { jQuery(element).remove() };
				break;
			case "children":
				callback = function(element, properties) { jQuery(element).empty() };
				break;
		}
	}
	return new Morpher(element, config.animDuration, props, callback);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
};

Popup.create = function(root, elem, className)
{
	var stackPosition = this.find(root, "popup");
	Popup.remove(stackPosition + 1);
	var popup = createTiddlyElement(document.body, elem || "ol", "popup", className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({ root: root, popup: popup });
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign, halign, offset)
{
	var curr = Popup.stack[Popup.stack.length - 1];
	this.place(curr.root, curr.popup, valign, halign, offset);
	jQuery(curr.root).addClass("highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0, ensureVisible(curr.popup));
};

Popup.place = function(root, popup, valign, halign, offset)
{
	if(!offset)
		offset = { x: 0, y: 0 };
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth * 0.75)
		popup.style.width = winWidth * 0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var i, pos = -1;
	for(i = this.stack.length - 1; i >= 0; i--) {
		if(isDescendant(e, this.stack[i].popup))
			pos = i;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var i = Popup.stack.length - 1; i >= from; i--) {
		var p = Popup.stack[i];
		jQuery(p.root).removeClass("highlight");
		jQuery(p.popup).remove();
	}
	Popup.stack = Popup.stack.slice(0, from);
};

//--
//-- Wizard support
//--

function Wizard(place)
{
	if(place) {
		this.formElem = findRelated(place, "wizard", "className");
		this.bodyElem = findRelated(this.formElem.firstChild, "wizardBody", "className", "nextSibling");
		this.footElem = findRelated(this.formElem.firstChild, "wizardFooter", "className", "nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name, value)
{
	jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place, title)
{
	this.formElem = createTiddlyElement(place, "form", null, "wizard");
	createTiddlyElement(this.formElem, "h1", null, "wizard__title", title);
	this.bodyElem = createTiddlyElement(this.formElem, "div", null, "wizardBody");
	this.footElem = createTiddlyElement(this.formElem, "div", null, "wizardFooter");
	return this.formElem;
};

Wizard.prototype.clear = function()
{
	jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo, status)
{
	jQuery(this.footElem).empty();
	for(var i = 0; i < buttonInfo.length; i++) {
		createTiddlyButton(this.footElem, buttonInfo[i].caption, buttonInfo[i].tooltip, buttonInfo[i].onClick);
		insertSpacer(this.footElem);
	}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem, "span", null, "status").innerHTML = status;
	}
};

Wizard.prototype.addStep = function(stepTitle, htmlString)
{
	jQuery(this.bodyElem).empty();
	var wrapper = createTiddlyElement(this.bodyElem, "div");
	createTiddlyElement(wrapper, "h2", null, "wizard__subtitle", stepTitle);
	var step = createTiddlyElement(wrapper, "div", null, "wizardStep");
	step.innerHTML = htmlString;
	applyHtmlMacros(step, tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place, listObject, listTemplate, callback, className)
{
	var table = createTiddlyElement(place, "table", null, className || "listView twtable");

	var thead = createTiddlyElement(table, "thead");
	var i, row = createTiddlyElement(thead, "tr");
	for(i = 0; i < listTemplate.columns.length; i++) {
		var columnTemplate = listTemplate.columns[i];
		var cell = createTiddlyElement(row, "th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(cell, columnTemplate, i);
			if(columnTemplate.className)
				jQuery(cell).addClass(columnTemplate.className);
		}
	}

	var rc, tbody = createTiddlyElement(table, "tbody");
	for(rc = 0; rc < listObject.length; rc++) {
		var rowObject = listObject[rc];
		row = createTiddlyElement(tbody, "tr");
		for(i = 0; i < listTemplate.rowClasses.length; i++) {
			if(rowObject[listTemplate.rowClasses[i].field])
				jQuery(row).addClass(listTemplate.rowClasses[i].className);
		}
		rowObject.rowElement = row;
		rowObject.colElements = {};
		for(i = 0; i < listTemplate.columns.length; i++) {
			cell = createTiddlyElement(row, "td");
			columnTemplate = listTemplate.columns[i];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(cell, rowObject, field, columnTemplate, i, rc);
				if(columnTemplate.className)
					jQuery(cell).addClass(columnTemplate.className);
			}
			rowObject.colElements[field] = cell;
		}
	}

	if(callback && listTemplate.actions)
		createTiddlyDropDown(place, ListView.getCommandHandler(callback), listTemplate.actions);

	if(callback && listTemplate.buttons) {
		for(i = 0; i < listTemplate.buttons.length; i++) {
			var b = listTemplate.buttons[i];
			if(b && b.name != "") createTiddlyButton(place, b.caption, null,
				ListView.getCommandHandler(callback, b.name, b.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback, name, allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this, "TABLE", null, "previousSibling");
		var tiddlers = ListView.getSelectedRows(view);
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view, this.value, tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view, name, tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view, callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var i, hadOne = false;
	for(i = 0; i < checkboxes.length; i++) {
		var cb = checkboxes[i];
		var rowName = cb.getAttribute("rowName");
		if(cb.getAttribute("type") != "checkbox" || !rowName) continue;
		callback(cb, rowName);
		hadOne = true;
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view, function(e, rowName) {
		if(e.checked) rowNames.push(rowName);
	});
	return rowNames;
};

// describes filling cells of a column of each type, a map of typeName => { createHeader, createItem }
ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place, columnTemplate, col)
	{
		createTiddlyText(place, columnTemplate.title);
	},
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v != undefined)
			createTiddlyText(place, v);
	}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v != undefined)
			wikify(v, place, null, null);
	}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v != undefined && v.title)
			createTiddlyPopup(place, v.title, config.messages.listView.tiddlerTooltip, v);
	}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v == undefined) return;
		var i = 0, msg = config.messages.sizeTemplates;
		while(i < msg.length - 1 && v < msg[i].unit)
			i++;
		createTiddlyText(place, msg[i].template.format([Math.round(v / msg[i].unit)]));
	}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		var c = columnTemplate.text;
		if(v != undefined)
			createExternalLink(place, v, c || v);
	}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v != undefined)
			createTiddlyText(place, v.formatString(columnTemplate.dateFormat));
	}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v == undefined) return;
		for(var i = 0; i < v.length; i++) {
			createTiddlyText(place, v[i]);
			createTiddlyElement(place, "br");
		}
	}
};

ListView.columnTypes.Selector = {
	createHeader: function(place, columnTemplate, col)
	{
		createTiddlyCheckbox(place, null, false, this.onHeaderChange);
	},
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var e = createTiddlyCheckbox(place, null, listObject[field], null);
		e.setAttribute("rowName", listObject[columnTemplate.rowName]);
	},
	onHeaderChange: function(e)
	{
		var state = this.checked;
		var view = findRelated(this, "TABLE");
		if(!view) return;
		ListView.forEachSelector(view, function(e, rowName) {
			e.checked = state;
		});
	}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var tags = listObject[field];
		createTiddlyText(place, String.encodeTiddlyLinkList(tags));
	}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		if(listObject[field] == true)
			createTiddlyText(place, columnTemplate.trueText);
		if(listObject[field] == false)
			createTiddlyText(place, columnTemplate.falseText);
	}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var e = createTiddlyCheckbox(place, null, listObject[field], this.onChange);
		e.setAttribute("tiddler", listObject.title);
		e.setAttribute("tag", columnTemplate.tag);
	},
	onChange: function(e)
	{
		var tag = this.getAttribute("tag");
		var tiddler = this.getAttribute("tiddler");
		store.setTiddlerTag(tiddler, this.checked, tag);
	}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place, listObject, field, columnTemplate, col, row)
	{
		var v = listObject[field];
		if(v == undefined) return;
		var link = createTiddlyLink(place, listObject[columnTemplate.tiddlerLink], false, null);
		createTiddlyText(link, listObject[field]);
	}
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field, value)
{
	for(var i = 0; i < this.length; i++) {
		if(this[i][field] === value) return i;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i = 0; i < items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i < items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array.
// If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item, unique)
{
	if(unique === false || this.indexOf(item) == -1) {
		this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1) this.splice(p, 1);
};

//--
//-- Augmented methods for the JavaScript String() object
//--

// todo: create functions substituting String augmenting methods, use in the core; deprecate all String augmenting methods

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g, "");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var match, r = [];
	while(match = subRegExp.exec(this)) {
		if(!match[1]) continue;
		if(match.index > currPos)
			r.push(this.substring(currPos, match.index));
		r.push(substrings[parseInt(match[1], 10)]);
		currPos = subRegExp.lastIndex;
	}
	if(currPos < this.length)
		r.push(this.substring(currPos, this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	return this.replace(/[\-\/\\\^\$\*\+\?\.\(\)\|\[\]\{\}]/g, '\\$&'); // #157
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg, "\\s").replace(/\n/mg, "\\n").replace(/\r/mg, "");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg, "\n").replace(/\\b/mg, " ").replace(/\\s/mg, "\\").replace(/\r/mg, "");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg, "&amp;").replace(/</mg, "&lt;").replace(/>/mg, "&gt;").replace(/\"/mg, "&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg, "<").replace(/&gt;/mg, ">").replace(/&quot;/mg, "\"").replace(/&amp;/mg, "&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName, defaultValue, allowEval, noNames, cascadeDefaults)
{
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" +
		dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token, "mg") :
		new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?", "mg");

	var parseToken = function(match, p) {
		// Double quoted
		if(match[p])     return match[p].replace(/\\"/g, '"');
		// Single quoted
		if(match[p + 1]) return match[p + 1].replace(/\\'/g, "'");
		// Double-square-bracket quoted
		if(match[p + 2]) return match[p + 2];
		// Double-brace quoted
		if(match[p + 3]) {
			var value = match[p + 3];
			if(allowEval && config.evaluateMacroParameters != "none") {
				try {
					if(config.evaluateMacroParameters == "restricted") {
						if(window.restrictedEval) value = window.restrictedEval(value);
					} else {
						value = window.eval(value);
					}
				} catch(ex) {
					throw "Unable to evaluate {{" + value + "}}: " + exceptionText(ex);
				}
			}
			return value;
		}
		// Unquoted
		if(match[p + 4]) return match[p + 4];
		// Empty quote
		if(match[p + 5]) return "";
	};

	var summary = {};
	var results = [summary], match;
	while(match = re.exec(this)) {
		// matched bit is like  firstToken  or  firstToken:tokenAfterColon  (like "param":{{evaluated expression}})
		var firstToken = parseToken(match, 1);
		if(noNames) {
			results.push({ name: "", value: firstToken });
			continue;
		}

		var tokenAfterColon = parseToken(match, 8);
		var newItem = {
			name: firstToken,
			value: tokenAfterColon
		};
		if(newItem.value == null) {
			if(defaultName) {
				newItem.value = firstToken;
				newItem.name = defaultName;
			}
			else if(defaultValue) newItem.value = defaultValue;
		}

		results.push(newItem);
		if(cascadeDefaults) {
			defaultName = newItem.name;
			defaultValue = newItem.value;
		}
	}

	for(var i = 1; i < results.length; i++) {
		var name = results[i].name;
		var value = results[i].value;
		if(!summary[name])
			summary[name] = [value];
		else
			summary[name].push(value);
	}
	return results;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
	var p = this.parseParams("list", null, !notAllowEval, true);
	return p.slice(1).map(function(param) { return param.value });
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list", null, false, true);
	var i, n = [];
	for(i = 1; i < p.length; i++) {
		if(p[i].value)
			n.pushUnique(p[i].value, unique);
	}
	return n;
};

// Get [startIndex, endIndex] of chunk between given startMarker and endMarker inside text, or undefined.
tw.textUtils.getChunkRange = function(text, startMarker, endMarker)
{
	var s = text.indexOf(startMarker);
	if(s == -1) return;
	s += startMarker.length;
	var e = text.indexOf(endMarker, s);
	if(e != -1) return [s, e];
};

// Replace a chunk of a string given start and end markers
tw.textUtils.replaceChunk = function(text, startMarker, endMarker, newValue)
{
	var r = this.getChunkRange(text, startMarker, endMarker);
	return r ? text.substring(0, r[0]) + newValue + text.substring(r[1]) : text;
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(!list) return "";
	return list.map(function(item) { return String.encodeTiddlyLink(item) }).join(" ");
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon", "", false);
	var i, hashmap = {};
	for(i = 1; i < fields.length; i++)
		hashmap[fields[i].name] = fields[i].value;
	return hashmap;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var name, r = [];
	for(name in hashmap)
		r.push(name + ':"' + hashmap[name] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n, width)
{
	var s = n.toString();
	if(s.length >= width) return s;
	return "000000000000000000000000000".substring(0, width - s.length) + s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0, prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params, name, defaultValue)
{
	if(!params) return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params, name, defaultValue)
{
	return !!getParam(params, name, defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	var t = template
		.replace(/0hh12/g, String.zeroPad(this.getHours12(), 2))
		.replace(/hh12/g, this.getHours12())
		.replace(/0hh/g, String.zeroPad(this.getHours(), 2))
		.replace(/hh/g, this.getHours())
		.replace(/mmm/g, config.messages.dates.shortMonths[this.getMonth()])
		.replace(/0mm/g, String.zeroPad(this.getMinutes(), 2))
		.replace(/mm/g, this.getMinutes())
		.replace(/0ss/g, String.zeroPad(this.getSeconds(), 2))
		.replace(/ss/g, this.getSeconds())
		.replace(/[ap]m/g, this.getAmPm().toLowerCase())
		.replace(/[AP]M/g, this.getAmPm().toUpperCase())
		.replace(/wYYYY/g, this.getYearForWeekNo())
		.replace(/wYY/g, String.zeroPad(this.getYearForWeekNo() - 2000, 2))
		.replace(/YYYY/g, this.getFullYear())
		.replace(/YY/g, String.zeroPad(this.getFullYear() - 2000, 2))
		.replace(/MMM/g, config.messages.dates.months[this.getMonth()])
		.replace(/0MM/g, String.zeroPad(this.getMonth() + 1, 2))
		.replace(/MM/g, this.getMonth() + 1)
		.replace(/0WW/g, String.zeroPad(this.getWeek(), 2))
		.replace(/WW/g, this.getWeek())
		.replace(/DDD/g, config.messages.dates.days[this.getDay()])
		.replace(/ddd/g, config.messages.dates.shortDays[this.getDay()])
		.replace(/0DD/g, String.zeroPad(this.getDate(), 2))
		.replace(/DDth/g, this.getDate() + this.daySuffix())
		.replace(/DD/g, this.getDate())
		.replace(/TZD/g, (tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60), 2) +
			':' + String.zeroPad(atz % 60, 2))
		.replace(/\\/g, "");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	// JavaScript Sun=0, ISO Sun=7
	if(d == 0) d = 7;
	// shift day to Thurs of same week to calculate weekNo
	dt.setTime(dt.getTime() + (4 - d) * 86400000);
	var n = Math.floor((dt.getTime() - new Date(dt.getFullYear(), 0, 1) + 3600000) / 86400000);
	return Math.floor(n / 7) + 1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	// JavaScript Sun=0, ISO Sun=7
	if(d == 0) d = 7;
	// shift day to Thurs of same week
	dt.setTime(dt.getTime() + (4 - d) * 86400000);
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h - 12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate() - 1];
};

// Convert to local YYYYMMDDHHMM format string
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth() + 1, 2) + String.zeroPad(this.getDate(), 2) +
		String.zeroPad(this.getHours(), 2) + String.zeroPad(this.getMinutes(), 2);
};

// Convert to UTC YYYYMMDDHHMM format string
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth() + 1, 2) + String.zeroPad(this.getUTCDate(), 2) +
		String.zeroPad(this.getUTCHours(), 2) + String.zeroPad(this.getUTCMinutes(), 2);
};

// Convert to UTC YYYYMMDD.HHMMSSMMM format string
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth() + 1, 2) +
		String.zeroPad(this.getUTCDate(), 2) + "." + String.zeroPad(this.getUTCHours(), 2) +
		String.zeroPad(this.getUTCMinutes(), 2) + String.zeroPad(this.getUTCSeconds(), 2) +
		String.zeroPad(this.getUTCMilliseconds(), 3) + "0";
};

// Static. Create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0, 12));
};

// Static. Create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0, 14));
};

// Static. Create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0, 4), 10),
		parseInt(d.substr(4, 2), 10) - 1,
		parseInt(d.substr(6, 2), 10),
		parseInt(d.substr(8, 2) || "00", 10),
		parseInt(d.substr(10, 2) || "00", 10),
		parseInt(d.substr(12, 2) || "00", 10),
		parseInt(d.substr(14, 3) || "000", 10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r, g, b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0, 1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1, 2), 16) / 255;
				this.g = parseInt(r.substr(3, 2), 16) / 255;
				this.b = parseInt(r.substr(5, 2), 16) / 255;
			} else {
				this.r = parseInt(r.substr(1, 1), 16) / 15;
				this.g = parseInt(r.substr(2, 1), 16) / 15;
				this.b = parseInt(r.substr(3, 1), 16) / 15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1], 10) / 255;
				this.g = parseInt(c[2], 10) / 255;
				this.b = parseInt(c[3], 10) / 255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c, f)
{
	return new RGB(this.r + (c.r - this.r) * f, this.g + (c.g - this.g) * f, this.b + (c.b - this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var to255Range = function(value) {
		var clamped = value < 0 ? 0 : value > 1 ? 1 : value;
		return clamped * 255;
	};

	var to2DigitString = function(value) {
		var s = Math.floor(value).toString(16);
		return ("0" + s).slice(-2);
	};

	return "#" +
		to2DigitString(to255Range(this.r)) +
		to2DigitString(to255Range(this.g)) +
		to2DigitString(to255Range(this.b));
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

tw.assets.icons.closeSvg =
	'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" class="tw-icon">' +
	'	<line x1="1" y1="1" x2="9" y2="9" rx="1" ry="1"/>' +
	'	<line x1="9" y1="1" x2="1" y2="9" rx="1" ry="1"/>' +
	'</svg>';

function drawGradient(place, horiz, loColors, hiColors)
{
	if(!hiColors) hiColors = loColors;

	for(var i = 0; i <= 100; i += 2)
	{
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? i + "%" : 0;
		bar.style.top = horiz ? 0 : i + "%";
		bar.style.width = horiz ? (101 - i) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101 - i) + "%";
		bar.style.zIndex = -1;
		var p = i / 100 * (loColors.length - 1);
		var hc = hiColors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = loColors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc, p - Math.floor(p)).toString();
	}
}

function addEvent(obj, type, fn)
{
	if(obj.attachEvent) {
		obj["e" + type + fn] = fn;
		obj[type + fn] = function() { obj["e" + type + fn](window.event) };
		obj.attachEvent("on" + type, obj[type + fn]);
	} else {
		obj.addEventListener(type, fn, false);
	}
}

function removeEvent(obj, type, fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on" + type, obj[type + fn]);
		obj[type + fn] = null;
	} else {
		obj.removeEventListener(type, fn, false);
	}
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e, value, name, relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !jQuery(e).hasClass(value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current height of the document
function findDocHeight() {
	var d = document;
	return Math.max(
		Math.max(d.body.scrollHeight, d.documentElement.scrollHeight),
		Math.max(d.body.offsetHeight, d.documentElement.offsetHeight),
		Math.max(d.body.clientHeight, d.documentElement.clientHeight)
	);
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place) place.appendChild(e);
	return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e, text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0, e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length, oldpos + text.length);
		// scroll into view
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0, e.selectionStart).split("\n").length - 1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) { // support IE
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Set the caret position in a text area
function setCaretPosition(e, pos)
{
	if(e.selectionStart || e.selectionStart == '0') {
		e.selectionStart = pos;
		e.selectionEnd = pos;
		e.focus();
	} else if(document.selection) { // support IE
		e.focus();
		var sel = document.selection.createRange();
		sel.moveStart('character', -e.value.length);
		sel.moveStart('character', pos);
		sel.moveEnd('character', 0);
		sel.select();
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var text = "";
	while(e && e.nodeName == "#text") {
		text += e.nodeValue;
		e = e.nextSibling;
	}
	return text;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e, ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE) return;
	var att = e.attributes;
	if(att) {
		for(var i = 0; i < att.length; i++) {
			var n = att[i].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function setStylesheet(s, id, doc)
{
	jQuery.twStylesheet(s, { id: id, doc: doc });
}

function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({ id: id });
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store, node, tiddlers)
{
	var title = this.getTitle(store, node);
	if(!title) return;
	if(safeMode && store.isShadowTiddler(title)) return;

	var tiddler = store.createTiddler(title);
	this.internalizeTiddler(store, tiddler, title, node);
	tiddlers.push(tiddler);
};

LoaderBase.prototype.loadTiddlers = function(store, nodes)
{
	var i, tiddlers = [];
	for(i = 0; i < nodes.length; i++) {
		try {
			this.loadTiddler(store, nodes[i], tiddlers);
		} catch(ex) {
			showException(ex, config.messages.tiddlerLoadError.format([this.getTitle(store, nodes[i])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var i, tiddlers = store.getTiddlers("title");
	for(i = 0; i < tiddlers.length; i++) {
		if(!tiddlers[i].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[i]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store, node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title") || node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var prefixLen = store.idPrefix.length;
		if(node.id.substr(0, prefixLen) == store.idPrefix)
			title = node.id.substr(prefixLen);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store, tiddler, title, node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute && node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName != "PRE" && e.nodeName != "pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg, "").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var i, attrs = node.attributes;
	for(i = attrs.length - 1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title, text, modifier, modified, tags, created, fields, creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store, tiddler)
{
	try {
		var usePre = config.options.chkUsePreForStorage;
		var created = tiddler.created;
		var modified = tiddler.modified;
		var tags = tiddler.getTags();
		var attributes =
			(tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "") +
			(tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "") +
			((usePre && created == version.date) ? "" : ' created="' + created.convertToYYYYMMDDHHMM() + '"') +
			((usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() + '"') +
			((!usePre || tags) ? ' tags="' + tags.htmlEncode() + '"' : "");
		var extendedAttributes = "";
		store.forEachField(tiddler, function(tiddler, fieldName, value) {
			if(typeof value != "string")
				value = "";
			// don't store fields from the temp namespace
			if(!fieldName.match(/^temp\./))
				extendedAttributes += ' %0="%1"'.format([fieldName, value.escapeLineBreaks().htmlEncode()]);
		}, true);
		return ('<div %0="%1"%2%3>%4</' + 'div>').format([
			usePre ? "title" : "tiddler",
			tiddler.title.htmlEncode(),
			attributes,
			extendedAttributes,
			usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
		]);
	} catch (ex) {
		throw exceptionText(ex, config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};



//]]>
</script>

<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output, this.element), this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead, "mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE) text = text.replace(/\n/g, "\r");
		createTiddlyElement(w.output, "pre", null, null, text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place, "br");
};

// Find an item in an array. If a predicate is provided, use the native Array.find (return the item);
// otherwise (for backwards compatibility) treat the argument as an item to find (return the index or null)
// @Deprecated: Use indexOf instead
Array.prototype.orig_find = Array.prototype.find;
Array.prototype.find = function(itemOrPredicate)
{
	if(itemOrPredicate instanceof Function) return Array.prototype.orig_find.apply(this, arguments);
	var i = this.indexOf(itemOrPredicate);
	return i == -1 ? null : i;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
// @Deprecated: No direct substitution
Array.prototype.setItem = function(value, mode)
{
	var i = this.indexOf(value);
	if(mode == 0) mode = (i == -1) ? +1 : -1;
	if(mode == +1) {
		if(i == -1) this.push(value);
	} else if(mode == -1) {
		if(i != -1) this.splice(i, 1);
	}
};

// For IE up to 8 (https://caniuse.com/?search=indexOf)
if(!Array.prototype.map) {
	Array.prototype.map = function(fn, thisObj)
	{
		var scope = thisObj || window;
		var i, j, a = [];
		for(i = 0, j = this.length; i < j; ++i) {
			a.push(fn.call(scope, this[i], i, this));
		}
		return a;
	};
}

// For IE up to 8 (https://caniuse.com/?search=indexOf)
if(!Array.prototype.indexOf) {
	Array.prototype.indexOf = function(item, from)
	{
		if(!from) from = 0;
		for(var i = from; i < this.length; i++) {
			if(this[i] === item) return i;
		}
		return -1;
	};
}

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef, title)
{
	return store.getLoader().internalizeTiddler(store, this, title, divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated: Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store, this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement, titles, template, unused1, unused2, animate, unused3)
{
	story.displayTiddlers(srcElement, titles, template, animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement, title, template, unused1, unused2, animate, unused3)
{
	story.displayTiddler(srcElement, title, template, animate);
}

// @Deprecated: Java IO is no longer supported;
// these "empty" versions are only left for the tiny chance of backwards
// compatibility issues and will be removed completely in the future
function javaSaveFile(filePath, content)
{
	return null;
}

function javaLoadFile(filePath)
{
	return null;
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n", "mg");
var regexpBackSlash = new RegExp("\\\\", "mg");
var regexpBackSlashEss = new RegExp("\\\\s", "mg");
var regexpNewLine = new RegExp("\n", "mg");
var regexpCarriageReturn = new RegExp("\r", "mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"':  '\\"',
		'\\': '\\\\'
	};
	var replaceFn = function(a, b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
	};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g, replaceFn) + '"';
	return '"' + this + '"';
};

// @Deprecated: no direct replacement, since not used in core code
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length - n) : this;
};

// @Deprecated: no direct replacement, since not used in core code (see unDash in inlineCssHelper)
// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var i, words = this.split("-");
	for(i = 1; i < words.length; i++)
		words[i] = words[i].substring(0, 1).toUpperCase() + words[i].substring(1);
	return words.join("");
};

// @Deprecated: use tw.textUtils.getChunkRange instead
String.prototype.getChunkRange = function(startMarker, endMarker)
{
	return tw.textUtils.getChunkRange(this, startMarker, endMarker);
};

// @Deprecated: no direct replacement, since not used in core code
// Get a chunk of a string between startMarker and endMarker, or undefined
String.prototype.getChunk = function(startMarker, endMarker)
{
	var r = tw.textUtils.getChunkRange(this, startMarker, endMarker);
	if(r) return this.substring(r[0], r[1]);
};

// @Deprecated: use tw.textUtils.replaceChunk instead
String.prototype.replaceChunk = function(startMarker, endMarker, newValue)
{
	return tw.textUtils.replaceChunk(this, startMarker, endMarker, newValue);
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min, max)
{
	var c = this;
	if(c < min) c = min;
	if(c > max) c = max;
	return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Remove a node and all its children
function removeNode(e)
{
	jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

function addClass(e, className)
{
	jQuery(e).addClass(className);
}

function removeClass(e, className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e, className)
{
	return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}


//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery.min.map
*/(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;
return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)
}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.parentNode.removeChild(el);
		}
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
			'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
